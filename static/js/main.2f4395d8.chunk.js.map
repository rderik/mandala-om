{"version":3,"sources":["../node_modules/react-iiif-viewer/dist sync","legacy/kmapsSolrUtil.js","legacy/searchui.js","legacy/places.js","legacy/audiovideo.js","legacy/subjects.js","legacy/images.js","legacy/texts.js","legacy/sources.js","legacy/visuals.js","legacy/terms.js","legacy/collections.js","legacy/pages.js","search/BasicSearch.js","main/MainSearchToggle/AdvancedToggle.js","main/MainNavToggle/MainNavToggle.js","logic/axios-jsonp/index.js","model/SearchModel.ts","logic/searchapi.js","model/KmapModel.ts","model/StatusModel.ts","model/HistoryModel.ts","model/StoreModel.ts","context/SearchContext.js","search/SearchBar.js","main/SiteHeader/SiteHeader.js","main/HomePage/Home.js","views/common/KmapLink.js","main/ContentHeader/ContentHeader.js","hooks/useStatus.ts","views/common/SmartTitle.js","views/common/SmartPath.js","views/common/SmartRelateds.js","views/common/FeatureCard/FeatureCard.js","views/common/FeaturePager/FeaturePager.js","views/common/FeatureDeck.js","hooks/useKmap.js","views/common/MandalaPopover.js","views/common/MandalaModal.js","hooks/useSolr.js","views/common/MandalaMarkup.js","views/AudioVideo/AudioVideoViewer.js","views/AudioVideo/AudioVideoHome.js","views/Images/ImageCarousel.js","views/common/utilcomponents.js","views/Images/ImageMetadata.js","views/Images/ImagesOSDViewer.js","views/Images/ImagesViewer.js","views/Images/ImagesHome.js","views/common/utils.js","views/Texts/TextsViewer.js","views/Texts/TextsHome.js","views/SourcesViewer.js","views/SourcesHome.js","views/VisualsViewer.js","views/VisualsHome.js","views/FancyTree/solr-utils.js","views/FancyTree/kmaps_relations_tree.js","views/FancyTree/FancyTree.js","views/History/HistoryLocation.js","views/History/HistoryViewer.js","views/Kmaps/RelatedViewer/RelatedsViewer.js","views/LegacyViewer.js","views/common/FeatureFoldOutViewer.js","views/common/FeatureGallery.js","views/common/FeatureList.js","search/FacetChoice.js","views/common/FeatureFilters.js","views/common/FeatureCollection.js","views/SearchViewer.js","views/CollectionsViewer.js","views/CollectionsHome.js","context/KmapContext.js","hooks/useAsset.js","hooks/useMandala.js","context/GenAssetContext.js","views/Terms/TermNames/TermNames.js","views/common/NodeHeader.js","views/common/RelatedsGallery.js","views/Terms/TermAudioPlayer/TermAudioPlayer.js","views/Terms/TermEtymology/TermEtymology.js","views/Terms/TermDefinitions/TermDefinitionsDetails/TermDefinitionsDetails.js","views/Terms/TermDefinitions/TermDefinitionsPassages/TermDefinitionsPassages.js","views/Terms/TermDefinitions/TermDefinitionsResources/TermDefinitionsResources.js","views/Terms/TermDefinitions/TermDefinitions.js","views/Terms/TermDictionaries/TermDictionaries.js","views/Terms/TermsDetails/TermsDetails.js","views/Kmaps/TermsInfo.js","views/Kmaps/PlacesInfo.js","views/Kmaps/SubjectsInfo.js","logic/assetapi.js","context/MdlAssetContext.js","views/Kmaps/KmapsViewer.js","views/PlacesHome.js","views/SubjectsHome.js","views/Terms/TermsHome.js","main/ContentMain.js","main/MainNavToggle/Hamburger.js","search/FacetBox.js","search/HistoryBox.js","search/SearchAdvanced.js","views/History/HistoryListener.js","main/Main.js","App.js","serviceWorker.js","index.js"],"names":["webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports","id","KmapsSolrUtil","overrideDefaultState","$","this","defaultState","extend","facetJSON","facetAdvancedJSON","related","domain","blockChildren","type","field","limit","facet","related_subject","related_subject_name","title","bool","state","selected_facets","filter_facet","ALL_ASSETS","allAssets","currentFacets","length","n","sf","fac","console","error","isEmptyObject","log","facet_fqs","m","split","facet_name","facet_filter","new_fq","push","searchstring","query","text","replace","page","pageSize","starts","search","slashy","start","fq_array","places","buildFq","subjects","terms","features","collections","languages","assets","i","users","creators","project_filter","kmapid","basic_req","kmapid_req","reqbase","JSON","stringify","baseurl","solrUrl","params","URLSearchParams","append","p","URL","toString","atype","alist","createBasicQuery","collection_uid","facets","facet_field","tag","bangtag","st","entry","km","op","termIndexRoot","path","lvla","lvlb","fl","levelField","ancestorField","jsonfacetblob","fieldList","join","level_fqlist","lvl","short_path","slice","path_filter","level_fqs","queryObj","SearchUI","site","useProdIndex","sui","curResults","numItems","AND","OR","NOT","ss","icon","mode","data","all","c","g","images","sources","texts","visuals","searches","showBool","showSearch","noTop","rel","href","appendTo","solrId","solrBase","view","sort","numResults","solrUtil","ClearQuery","DrawResults","html","slideToggle","on","alert","window","open","slideUp","here","location","history","pushState","hash","match","toLowerCase","setupPage","GetKmapFromID","kmap","uid","pages","Draw","v","relatedId","relatedType","relatedBase","DrawRelatedResults","ParseQuerystring","val","Query","scrollTop","remove","css","width","display","DrawHeader","DrawFooter","q","f","str","qString","o","fs","substr","relationships","termPerspective","subjectPerspective","placePerspective","fromHistory","collectionId","url","LoadingIcon","ts","parse","perspectives","buildAssetQuery","createKmapQuery","SetState","SerializeQuery","ActiveSearch","filter","s","splice","ajax","dataType","jsonp","done","MassageKmapData","response","docs","ParseFacetData","fail","msg","Popup","callback","base","Math","max","buildQuery","res","getJSON","d","r","recordings","audio_file","url_json","asset_type","subcollection_uid_ss","xhr","asset_subtype","charAt","toUpperCase","url_thumb","ancestors_txt","ancestor_ids_is","display_label","buckets","asset_counts","count","min","ResetFacetList","noRefresh","arguments","slideDown","prop","DrawItems","lastPage","floor","isNaN","currentTarget","substring","a","b","timestamp","node_user","DrawCardItem","DrawGridItem","DrawListItem","DrawRelatedAssets","num","originalEvent","metaKey","SendMessage","url_html","creator","summary","caption","s1","offset","left","top","ShowItemMore","feature_types_ss","collection_title","j","kmapid_strict","kmapid_strict_ss","label","gg","data_phoneme_ss","duration_s","name_tibt","RecentSearches","DrawInput","DrawFacetList","DrawFacetTree","ignoreText","key","activeSearch","target","AddNewFilter","off","DrawAdvanced","k","undefined","AddPop","items","searchItem","sorted","QueryFacets","color","line","keyCode","RegExp","empty","itms","an","bn","height","curTree","div","LazyLoad","GetTopRow","focus","stopPropagation","_this","prefix","tops","ka","kha","ga","nga","ca","cha","ja","nya","ta","tha","da","na","pa","pha","ba","ma","tsa","tsha","dza","wa","zha","za","ya","ra","la","sha","sa","ha","row","parent","hasClass","offsetX","children","toggleClass","clientX","lastMode","handleClick","init","GetTreeChildren","re","facet_counts","facet_fields","ancestor_id_path","header","after","plc","lat","lon","lab","ui","size","time","x","y","fadeIn","delay","fadeOut","len","middle","cname","name","decodeURIComponent","document","cookie","indexOf","value","Date","setTime","getTime","toUTCString","message","debugObject","showAlert","dir","Places","app","extent","showing","content","content2","popovers","DrawMetadata","container","map","baseMap","kml","mapView","sceneView","activeView","opt","bookmarks","legend","layers","basePick","sketch","center","zoom","tilt","reqs","loc","candidates","spatialReference","wkid","GoToExtent","DrawTabMenu","ShowTab","margin","GeoLocate","DrawContent","GetChildNamesFromID","oo","l","_childDocuments_","related_names_header_s","lang","related_names_language_s","related_names_relationship_s","write","related_names_writing_system_s","ety","related_names_etymology_s","related_names_path_s","tab","related_names_level_i","GetRelatedFromID","illustration_external_url","addClass","illustration_mms_url","AddRelatedTabs","AddRelatedPlaces","AddRelatedSubjects","which","AddRelBranch","find","tabs","drawTabB","firstChild","sups","ancestors","AddRelTreeLine","ancestor_uids_generic","counts","child_counts","AddRelatedContext","block_child_type","related_places_header_s","related_places_relation_label_s","sub","related_places_feature_type_s","related_uid_s","biggest","Object","drawCat","feature_types_idfacet","related_subjects_display_string_s","related_subjects_time_units_t","related_subjects_id_s","AudioVideo","inPlay","curTransSeg","transRes","scrollStart","handScroll","mouseDown","playEnd","entryId","kWidget","destroy","field_video","und","entryid","en","field_audio","field_year_published","FormatDate","node_created","node_user_full_s","collpath","GetPublicUrlPath","creator_short_list","main_roles","crn","crrole","creator_role_ss","includes","WrapInLangSpan","desc_text","langclass","GetLangCode","field_pbcore_description","morecnt","field_description","moretext","field_language","DrawTranscript","embed","targetId","wid","uiconf_id","entry_id","flashvars","autoPlay","wmode","addReadyCallback","kdp","getElementById","kBind","PlayAV","clearInterval","transTimer","t","field_subcollection_new","field_subject","field_location","field_recording_location_new","field_language_kmap","field_kmap_terms","field_copyright_owner","field_pbcore_rights_summary","field_pbcore_creator","agrole","agents","agname","field_creator_role","field_creator","agrolelabel","field_pbcore_contributor","agroleprefix","field_contributor_role","field_contributor","field_pbcore_publisher","field_publisher","field_pbcore_instantiation","field_terms","seg","trid_i","ts_content_rus","content_bod","dzo_bod","ts_content_sgt","ts_content_kjz","ts_content_tgf","ts_content_cgk","ts_content_dka","ts_content_dzl","ts_content_goe","ts_content_xkz","ts_content_kru","ts_content_lkh","ts_content_lya","ts_content_lep","ts_content_lhp","ts_content_luk","ts_content_npb","ts_content_neh","ts_content_ole","ts_content_tsj","ts_content_xkf","ts_content_wylie","ts_content_gyal","ts_content_gvr","ts_content_npa","ts_content_nmm","ts_content_kte","ts_content_tsum","ts_content_nep","ts_content_eng","ts_content_zho","ts_content_und","ts_content_gloss","speakers","segs","layout","rev","speaker","fts_start","end","fts_end","dur","fts_duration","ss_speaker_bod","ss_language","DrawTranscriptMenu","DrawTransContent","curHit","hits","show","av","transhits","each","mytxt","replaceWith","hid","segtxt","srchval","HighlightSeg","trigger","hide","SaveStrFile","removeClass","preventDefault","sendNotification","element","createElement","setAttribute","encodeURIComponent","style","body","appendChild","click","removeChild","SecondsToTimecode","clearTimeout","setTimeout","setInterval","evaluate","now","position","timecode","h","Number","secs","Subjects","relatedPlaceData","relatedSubjectData","GetSubjectData","GetPlaceData","GetRelatedPlaces","DrawRelatedPlaces","sortMode","level","pop","ind","addTreeLine","countChildren","addChildren","marker","before","summary_eng","names_txt","AddSubjectContext","subs","related_subjects_relation_label_s","related_subjects_header_s","child_count","numFound","Images","mid","asp","url_thumb_height","url_thumb_width","img_width_s","img_height_s","GetJSONFromKmap","drawDetails","collection_uid_s","DrawItem","field_image_type","field_image_descriptions","field_image_agents","field_agent_role","field_agent_dates","field_image_digital","field_image_color","field_image_quality","field_image_rotation","field_physical_size","field_image_capture_device","field_image_materials","field_image_enhancement","field_longitude","field_latitude","field_copyright_holder","field_copyright_statement","field_original_filename","field_technical_notes","field_license_url","sx","sy","px","py","pic","onmousedown","onwheel","cursor","event","deltaX","deltaY","pageX","pageY","onmousemove","dx","dy","onmouseup","onwheeel","def","bold","Texts","url_ajax","showTab","field_book_author","field_book_editor","field_dc_date_publication_year","field_dc_date_orginial_year","field_kmap_places","field_kmap_subjects","field_kmap_termss","field_book_translator","field_dc_language_original","field_dc_rights_general","field_pdf_version","Sources","publisher_s","biblio_pages","biblio_year","biblio_secondary_title","biblio_place_published","field_kmaps_subjects","field_kmaps_places","biblio_url","Visuals","shivaNode","parseJSON","shivanode_json","hgt","src","dataSourceUrl","node_user_full","toggle","Terms","recordingGroup","tagged","LEGACY_SUI","audioURLs","SetTabContent","Audio","play","GetAudioFromID","GetChildDataFromID","odata","str2","str3","str4","firstName","related_definitions_source_s","related_definitions_content_s","related_definitions_author_s","related_definitions_language_s","GetDefinitionAssets","defNum","addSubjectsPopover","data_grammars_ss","data_tibet_and_himalayas_ss","data_literary_period_ss","data_register_ss","data_language_context_ss","etymologies_ss","kmapid_subjects_idfacet","related_uid_ss","pagesrelatedId","Collections","AddTabContent","collection_title_path_ss","collection_uid_path_ss","subcollection_name_ss","subcollection_id_is","members_name_ss","members_id_ss","collection_visibility_s","Pages","reldiv","curKmap","carouselTimer","img","txt","vis","trm","col","recentPages","editing","PageRouter","PopoverTimer","lastPopover","ClearPopover","DisplayPopover","pos","offsetString","String","stack","scrltop","one","eq","popbotstr","sk","browse","tot","DrawTree","dot","curCon","setPanel","date","format_type","toDateString","getMonth","getDate","getFullYear","text_string","chrcode","trim","charCodeAt","nowrap","wrapclass","langcode","currapp","pts","retval","host","small","BasicSearch","props","useHistory","inputEl","useRef","useStoreState","currText","searchText","handleSubmit","setSearchText","current","onSubmit","handleChange","_","debounce","useLayoutEffect","className","defaultValue","placeholder","onChange","onKeyDownCapture","ref","onClick","AdvancedToggle","useState","viewMode","setMode","chooseViewMode","useEffect","ToggleButtonGroup","ToggleButton","evt","React","Component","buildParams","qs","arrayFormat","jsonpAdapter","config","Promise","reject","script","onload","onreadystatechange","onerror","parentNode","async","random","pow","old","isAbort","responseData","status","additionalParams","callbackParamName","readyState","test","cancelToken","promise","then","cancel","head","AssetType","Oper","spexLib","checksum","crypto","createHash","update","digest","searchstate","getAssetSearchPromise","getCached","request","localforage","getItem","catch","err","setCache","setItem","startRec","rowsRec","rows","ff","facetFilters","jsonFacet","asset_count","excludeTags","related_subjects","related_places","related_terms","feature_types","collection_nid","parent_type","perspective","associated_subjects","wt","echoParams","indent","queryParams","searchString","xact","constructTextQuery","filterParams","filters","hashedFilters","array","keyField","reduce","collector","item","fq_list","constructFQs","facetData","fieldName","not_list","and_list","or_list","forEach","operator","or_clause","fqs","fq","constructFilters","adapter","searchPromise","axios","cleanAssetData","reason","finally","narrowFilters","entries","filtered","narrowData","rej","getAssetDataPromise","getFullKmapDataPromise","getRelatedAssetsPromise","asset_types","stateKey","unpackResponse","url_large","BlockChildType","BlockType","searchModel","loadingState","results","maxStart","gotoPage","action","pageNum","nextPage","increment","newStart","prevPage","decrement","firstPage","setPageSize","narrowFilter","thunk","actions","payload","helpers","searchState","getStoreState","performance","mark","measure","getEntriesByName","clearMeasures","receiveResults","addFilters","found","findIndex","check","removeFilters","removeMe","clearFilters","clearAll","superClear","localForage","clear","setSearchState","onUpdate","thunkOn","storeActions","kmapModel","loading","computed","relatedsPage","related_type","asset","relateds","gotoRelatedsPage","firstRelatedsPage","lastRelatedsPage","nextRelatedsPage","prevRelatedsPage","setRelatedsPage","setRelatedsPageSize","relatedsPageSize","receiveKmap","setUid","kmapState","promises","allSettled","kmasset_result","kmap_result","relateds_result","Type","statusModel","headerTitle","subTitle","setId","setPath","setSubTitle","setHeaderTitle","setType","setStatus","sameLocation","storeModel","addLocation","historyStack","removeType","valueOf","newStack","pathname","startsWith","removeLocation","createTypedHooks","useStoreActions","useStoreDispatch","useStore","SearchContext","useParams","funcs","result","func","searchControls","currentText","pager","currentPage","currentPageSize","getMaxPage","maxCount","getPage","setPage","pg","maxPage","oldSize","oldPage","newPage","getPageSize","Children","child","cloneElement","SearchBar","setSearch","setViewMode","onStateChange","advanced","tree","SiteHeader","to","process","alt","role","data-toggle","data-target","aria-controls","aria-expanded","aria-label","Home","marginTop","Container","Row","Col","Jumbotron","KmapLink","ContentHeader","pathy","link","convertedPath","siteClass","useStatus","SmartTitle","smartTitle","Array","isArray","doc","findIn","arr","whiteSpace","maxLine","basedOn","SmartPath","smartPath","SmartRelateds","typeGlyphMap","FeatureCard","inline","modalShow","setModalShow","subTypeGlyph","typeGlyph","assetGlyph","viewer","kmapid_places_idfacet","footer_text","asset_view","Card","Img","variant","Body","Title","ListGroup","Item","DetailModal","onHide","scrollable","Footer","Modal","aria-labelledby","centered","Header","closeButton","Button","FeaturePager","pageInput","wingo","mobile","noStyle","refsInput","setValue","step","ps","border","FeatureDeck","shouldInline","LIST","ret","featureCard","Spinner","animation","NoResults","Accordion","Toggle","as","eventKey","Collapse","Fragment","CardDeck","solr_urls","queries","info","dataFilter","group","grouped","groups","getKmapData","qtype","kid","myparams","transformResponse","filtered_data","useKmap","query_type","useQuery","MandalaPopover","setShow","placement","kmkey","mykey","kmapIsLoading","isLoading","kmapIsError","isError","kmapRes","kmapError","relIsLoading","relIsError","relRes","relError","kmapdata","isTib","myhead","popoverLabel","onMouseOver","onMouseOut","data-kmdomain","data-kmid","Overlay","Popover","Content","MandalaPopoverBody","kminfo","alabel","groupValue","blabel","caption_eng","kmap_item_page","mandala_base","featuretypes","feature_type_ids","index","ancestor_ids","ancestor_ids_generic","ancestor_labels","anclabel","aid","aurl","akey","term_info","associated_subject_ids","myurl","related_tabs","assettype","iconclass","doclist","MandalaPopoverTest","dom","kdata","base_url","fluid","padding","backgroundColor","maxWidth","marginLeft","md","PopTestComp","me","prel","innerText","fontFamily","fontSize","imgs","rose","fire","valley","rapids","peppers","zelda","imgtype","fontStyle","paddingRight","MandalaModal","gotourl","gourl","mytext","handleClose","data-original-url","backdrop","keyboard","solrurls","getSolrData","warn","retdata","useSolr","qkey","queryobj","transform","node","attribs","kmpdom","kmpid","mtchs","prev","next","ReactHtmlParser","linkurl","mandalaid","linkcontents","convertNodeToElement","mytitle","blocked","lnkurl","allowed","domstr","isBlockedUrl","MandalaLink","contents","pathparts","shift","mtch","asset_path","MandalaPathDecoder","mpath","HtmlWithPopovers","htmlInput","markup","options","decodeEntities","HtmlCustom","newurl","data-mandala-id","newpath","AudioVideoViewer","kmasset","mdlasset","nodejson","ismain","playerDrawn","setPlayerDrawn","bcrumbs","base_path","bcn","colltitle","bc","selfbc","DrawPlayer","AudioVideoMeta","metamarkup","DrawMetaNew","tabkey","setTabkey","Tabs","activeKey","onSelect","Tab","AudioVideoRelated","nid","mlt","setMlt","AudioVideoHome","ImageCarousel","solrdoc","coll_id","resource","centerCarousel","scrollval","get","offsetLeft","offsetWidth","scrollLeft","carouseldivs","myindex","showst","showend","showdivs","onLoad","CollectionField","collurl","KmapsFields","kcolls","collfield","subjectfield","field_places","termsorig","kcollclass","subjclass","placeclass","termsclass","backbutton","back","reload","NotFoundPage","lg","IMAGE_FIELDS","ImageMetadata","sizestr","photographer","holder","stmt","crdate","crstring","field_copyright_date","constructCopyright","long","field_altitude","constructLocation","imgdescs","capkey","ImageRow","cls","ImageCreators","json","processDate","created","valclass","desc","dn","ImageDescription","defaultauth","fdstr","ImageInfoField","myclass","labclass","mydate","dstr","dtype","toLocaleString","descdate","author","field_author","clsstr","field_name","valpts","ImagesOSDViewer","manifest","rotation","defaultzoom","setOSDViewer","OpenSeadragon","prefixUrl","tileSources","degrees","showRotationControl","defaultZoomLevel","minZoomImageRatio","maxZoomPixelRatio","maxZoomLevel","minZoomLevel","ImagesViewer","iiifview","iiifchild","zoomin","zoomout","prepend","arrowClick","$this","curr","newcurr","url_iiif_s","ImagesHome","grokId","selectIcon","TextsViewer","tid","text_sections","setSections","section_showing","setSectionShowing","alt_viewer_url","setAltViewerUrl","sections_tmp","toArray","sections_new","sel","nxtoffset","el","attr","getTop","myhash","mytochash","firstlink","scrollIntoView","output","aria-hidden","bibl_summary","TextBody","alias","full_markup","listener","mybottom","vissect","nxts","stop","nxttop","lnkid","TextTabs","toc","toc_links","meta","links","views_links","sections","altChange","TextsAltViewer","txt_link","els","repat","etxt","clone","cc1","parents","addBoClass","onScroll","info_icon","collapse_icon","setOpen","setIcon","update_icon","linkscomp","suff","getRandomKey","colSpan","data-href","in","onExited","onEnter","iframe_url","clname","text_title","iframe","TextsHome","SourcesViewer","SourcesHome","VisualsViewer","errorInfo","prevProps","prevState","snapshot","nextProps","nextState","nextContext","class","VisualsHome","kmapsSolrUtils","defaults","termIndex","assetIndex","featureId","featuresPath","Plugin","jQuery","settings","plugin","dfd","Deferred","relatedCountsUrl","timeout","beforeSend","success","updates","rel_count","feature_label","group_key","feature_name","feature_block","relation_subject_list","relation_subjects_ordered","relation_subjects_count","relation_subject","relation","feature_list","feature_count","sortedFeatures","feature_index","feature_item","currNode","currNodeID","currItem","pop_container","relation_title","getSummaryElementsUrl","acc","currentNode","node_type","relation_label","related_feature_type_key","related_feature_type","node_id","relation_subject_item","related_subject_list","related_subject_index","currentFeatureId","nodeinfo","beforesend","ancestorskey","ancestorsnamekey","nodeCaptionsUrl","assetCountsUrl","subjectsRelatedPlacesCountQuery","loadDescendants","loadOnlyDirectAncestors","sortBy","extraFields","nodeMarkerPredicates","blank","concat","buildAncestorTree","ancestorsKey","ancestorNodes","lastElementIndex","recursiveAncestors","siblings","descendantsLevel","getDescendantsInPath","sib","expanded","active","lazy","backColor","resultTree","currentLevelTag","currentLevel","ancestorTree","roots","facetCount","facetHash","regex","marks","displayPath","fullDetail","buildTree","ancestorsNameKey","reduceRight","getDescendantTree","sortByQuery","feature_type","expanded_docs","related_subjects_s","pluginName","descendants","directAncestors","descendantsFullDetail","initialScrollToActive","displayPopup","mandalaURL","solrUtils","language","_defaults","_name","prototype","fancytree","extensions","source","getAncestorTree","scrollToActiveNode","glyph","preset","docOpen","expanderClosed","expanderLazy","expanderOpen","folder","folderOpen","activate","toggleExpanded","lazyLoad","getKeyPath","createNode","span","childNodes","innerHTML","elem","getParentList","parentPath","ancestor","title_match","current_title","current_link","kmapsPopup","getActiveNode","makeVisible","totalOffset","li","closest","getAncestorPath","getFullAncestorTree","keyPath","ancestorPath","sortBay","fn","returns","args","instance","apply","call","FancyTree","ks_opts","elCopy","tree_opts","kmapsRelationsTree","SearchCriteriaMini","HistoryLocation","relTitle","FacetIcons","OverlayTrigger","overlay","data-filters","popperConfig","modifiers","data-key","dataset","filterIcons","selectedIcon","propTypes","PropTypes","HistoryViewer","historyList","isSearch","unshift","RelatedsViewer","useRouteMatch","locMatch","baseArgs","baseType","baseUid","RelatedCount","iconClass","LegacyViewer","parser","Parser","withRouter","FeatureFoldOutViewer","original","FeatureFoldOutPortal","portalRootId","mount","focused","galleryRef","createPortal","VIEWER_ID","FeatureGallery","insert","focusedFeature","setFocusedFeature","DEBUG_PRE","calc_thumb_width","calc_thumb_height","thumbnail","gallery","targetRowHeight","photos","chosen","photo","getAttribute","selector","domImg","querySelector","rowtop","offsetTop","nextImg","nextSibling","renderImage","atts","photoKey","FeatureGalleryHeaderLine","FeatureList","FacetChoice","facetType","choice","onFacetClick","FeatureFilters","CSSTransition","classNames","labelText","handleFacetClick","TransitionGroup","FeatureCollection","paramsViewMode","requestedViewMode","isEmpty","FeatureCollectionViewModeSelector","showSearchFilters","deckLabel","galleryLabel","listLabel","navigate","SearchViewer","searchQueryString","allowDots","mod_count","searchStateModifiers","CollectionsViewer","CollectionsHome","KmapContext","kmapActions","relatedPage","relatedPageSize","requestId","assetType","useAsset","getMandalaAPI","useMandala","solrobj","json_url","enabled","GenAssetContext","setMdlAsset","notfound","setNotFound","relId","solrdata","TermNames","namesTree","child_type","path_field","order","_nested_","buildNestedDocs","names","NameEntry","outlist","NodeHeader","viewerType","itemHeader","relatedData","subHeader","nameTibtText","nameLatinText","name_latin","nameTibtElem","nameLatinElem","RelatedsGallery","TermAudioPlayer","audioRefs","player","defRecordingUrl","recording_url","audioUrl","setAudioUrl","option_list","recording_dialect_s","playButton","handleSelect","TermEtymology","etymologies","pickBy","accum","exec","heading","TermDefinitionsDetails","details","matches","header_title","header_text","TermDefinitionsPassages","TermDefinitionsResources","defID","resources","resCounts","TermDefinitions","relatedDocs","kmRelated","resourceCounts","orderBy","mainDefs","defaultActiveKey","parseInt","Provider","verticalAlign","TermDictionaries","definitions","dict","TermsDetails","kmAsset","associated_subject_map_idfacet","assetSplit","subID","TermsInfo","groupBy","omit","PlacesInfo","SubjectsInfo","getMandalaAssetDataPromise","mapp","envkey","json_call","getMandalaJSONUrl","apidata","getLegacyAssetPromise","solr_base","getMandalaSolrUrl","sessionStorage","ready","show_not_found","MdlAssetContext","changed","mdlasset_result","call_status","new_mdlasset","KmapsViewer","route","declaredType","declaredViewer","grokAssetType","useLocation","superPath","ids","assemblePath","from","PlacesHome","SubjectsHome","TermsHome","ContentMain","exact","component","Error404","Hamburger","openclass","hamburgerOpen","FacetControls","FacetBox","sortField","setSortField","sortDirection","setSortDirection","chosen_icon","chosenFacets","handleNarrowFilters","resetFlag","chosenHash","onNarrowFilters","isChosen","ICON_MAP","plus","minus","facetList","icoclass","chooseIconClass","fullEntry","fullLabel","refLabel","valLabel","extra","parseEntry","parseId","chosenList","Badge","pill","HistoryBox","historyLength","countSearchItems","Navbar","Link","chosenIcon","SearchAdvanced","reset","setReset","searchView","handleFacetChange","command","compound_id","new_filter","getChosenFacets","Nav","Text","defaultChecked","HistoryListener","searchMatch","relType","fixId","theId","fixedId","fixedRelId","relAsset","fixTitle","qObj","ignoreQueryPrefix","depth","plural","searchLocation","matchUrl","relDocs","relLabel","baseLocation","stateDefault","Main","setState","handleStateChange","new_state","storeReady","useStoreRehydrated","stateList","searchClasses","main","basename","TreeNav","PlacesTree","SubjectsTree","TermsTree","App","Boolean","hostname","store","createStore","persist","storage","ReactDOM","render","StrictMode","navigator","serviceWorker","registration","unregister"],"mappings":"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","file":"static/js/main.2f4395d8.chunk.js","sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 494;","/*\nKmaps Solr Util to encaspulate solr query assembly logic\n\nUsage:\n\n        var util = new KmapsSolrUtil();\n        var url = util.createBasicQuery(state);\n\n    createBasicQuery(state) uses a populated \"state\" object and returns the appropriate url as a String.\n\n */\n/* eslint-disable */\n\nimport $ from 'jquery';\n\n\nconst DEBUG = false;\n\nexport default class KmapsSolrUtil {\n\n    constructor(overrideDefaultState) {\n        // // check to make sure that jQuery is available\n        // if (typeof $ !== \"function\")\n        //     $ = jQuery;\n\n        if (typeof $ === \"undefined\") {\n            throw(\"This libraries requires jQuery\");\n        }\n\n        // this is the default state, state that is passed in overrides these values\n        this.defaultState = {\n            \"solrUrl\": \"https://solrUrl.must.be.set.in.the.state.object\",\n            \"mode\": \"input\",\n            \"view\": \"Card\",\n            \"sort\": \"Alpha\",\n            \"type\": \"All\",\n            \"page\": 0,\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Current page being shown\n            \"pageSize\": 100,\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Results per page\n            \"query\": { \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Current query\n                \"text\": \"\",\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Search word\n                \"places\": [],\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Places\n                \"collections\": [],\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Collections\n                \"languages\": [],\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Languages\n                \"features\": [],\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Feature types\n                \"subjects\": [],\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Subjects\n                \"terms\": [],\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Terms\n                \"relationships\": [],\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Relationships\n                \"users\": [],\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Users\n                \"assets\": [],\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Assets\n                \"dateStart\": \"\",\n                \"dateEnd\": \"\",\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Beginning and ending dates\n                \"project_filter\": \"\"\n            }\n        };\n\n        // override the defaultState with state that was passed in the constructor\n        if (overrideDefaultState) {\n            this.defaultState = $.extend(true, {}, this.defaultState, overrideDefaultState);\n        }\n\n\n        // facet configs.\n\n        // This probably should be a config element.\n        this.facetJSON = {\n            \"asset_counts\": {\n                \"limit\": 100,\n                \"type\": \"terms\",\n                \"field\": \"asset_type\",\n                \"domain\": {\"excludeTags\": \"ast\"}\n            },\n\n            \"places\": {\n                \"limit\": 300,\n                \"type\": \"terms\",\n                \"field\": \"kmapid_places_idfacet\"\n            },\n            \"subjects\": {\n                \"limit\": 300,\n                \"type\": \"terms\",\n                \"field\": \"kmapid_subjects_idfacet\"\n            },\n            \"terms\": {\n                \"limit\": 300,\n                \"type\": \"terms\",\n                \"field\": \"kmapid_terms_idfacet\"\n            },\n            \"features\": {\n                \"limit\": 300,\n                \"type\": \"terms\",\n                \"field\": \"feature_types_idfacet\"\n            },\n            \"languages\": {\n                \"limit\": 300,\n                \"type\": \"terms\",\n                \"field\": \"node_lang\"\n            },\n            \"collections\": {\n                \"limit\": 300,\n                \"type\": \"terms\",\n                \"field\": \"collection_idfacet\"\n            },\n\n            // \"subjects\": {\n            //     \"limit\": 300,\n            //     \"type\": \"terms\",\n            //     \"field\": \"kmapid\",\n            //     \"prefix\": \"subjects\",\n            //     \"facet\": {\n            //         \"title\": {\n            //             \"limit\":1,\n            //             \"type\":\"terms\",\n            //             \"field\":\"title\"\n            //         }\n            //     }\n            // },\n            \"collection_nid\": {\n                \"limit\": 300,\n                \"type\": \"terms\",\n                \"field\": \"collection_nid\"\n            },\n            \"collection_uid\": {\n                \"limit\": 300,\n                \"type\": \"terms\",\n                \"field\": \"collection_uid_s\"\n            },\n            \"asset_subtype\": {\n                \"limit\": 300,\n                \"type\": \"terms\",\n                \"field\": \"asset_subtype\",\n                \"facet\": {\n                    \"parent_type\": {\n                        \"limit\": 1,\n                        \"type\": \"terms\",\n                        \"field\": \"asset_type\"\n                    }\n                }\n            },\n            \"node_user\": {\n                \"limit\": 300,\n                \"type\": \"terms\",\n                \"field\": \"user_name_full_s\"\n            },\n            \"creator\": {\n                \"limit\": 300,\n                \"type\": \"terms\",\n                \"field\": \"creator\"\n            }\n            // \"feature_types_ss\": {\n            //     \"limit\": 300,\n            //     \"type\": \"terms\",\n            //     \"field\": \"feature_types_ss\"\n            // },\n\n            // \"node_lang\": {\n            //     \"limit\": 300,\n            //     \"type\": \"terms\",\n            //     \"field\": \"node_lang\"\n            // },\n            // \"schema_version\": {\n            //     \"limit\": -1,\n            //     \"type\": \"terms\",\n            //     \"field\": \"schema_version_i\"\n            // }\n        };\n\n\n        this.facetAdvancedJSON = {\n            related: {\n                domain: {blockChildren: \"block_type:parent\"},\n                type: \"terms\",\n                field: \"related_subjects_relation_code_s\",\n                limit: -1,\n                facet: {\n                    related_subject: {\n                        type: \"terms\",\n                        field: \"related_subjects_id_s\",\n                        limit: -1,\n                        facet: {\n                            related_subject_name: {\n                                type: \"terms\",\n                                field: \"related_subjects_header_s\",\n                                limit: 1\n                            }\n                        }\n                    }\n                }\n            }\n        };\n    }\n\n    allAssets() {\n        return [\n            {id: \"audio-video\", title: \"audio-video\", bool: \"OR\"},\n            {id: \"images\", title: \"images\", bool: \"OR\"},\n            {id: \"texts\", title: \"images\", bool: \"OR\"},\n            {id: \"visuals\", title: \"visuals\", bool: \"OR\"},\n            {id: \"sources\", title: \"sources\", bool: \"OR\"},\n            {id: \"subjects\", title: \"subjects\", bool: \"OR\"},\n            {id: \"places\", title: \"places\", bool: \"OR\"},\n            {id: \"terms\", title: \"terms\", bool: \"OR\"}\n        ];\n    }\n\n    createBasicQuery(state, selected_facets, filter_facet) {\n\n        const ALL_ASSETS = this.allAssets();\n\n        state = $.extend(true, {}, this.defaultState, state);\n\n        // process selected facets.\n        var currentFacets = {};\n\n        // selected facets\n        if (selected_facets && selected_facets.length > 0) {\n            for (var n = 0; n < selected_facets.length; n++) {\n                var sf = selected_facets[n];\n                var fac = this.facetJSON[sf];\n                if (fac) {\n                    currentFacets[sf] = fac;\n                } else {\n                    console.error(\"Warning: ignoring unknown facet: \" + sf);\n                }\n            }\n        }\n\n        if ($.isEmptyObject(currentFacets)) {\n            console.log(\"no currentFacets so using ALL facets\");\n            currentFacets = this.facetJSON;\n        }\n\n        var facet_fqs = [];\n        // argument form [ facetname:filterstring ]\n        if (filter_facet) {\n            if (filter_facet.length > 0) {\n                for (var m = 0; m < filter_facet.length; m++) {\n                    var split = filter_facet[m].split(':');\n                    var facet_name = split[0];\n                    var facet_filter = split[1];\n                    // console.dir({ \"facet_name\": facet_name, \"facet_filter\": facet_filter });\n\n                    var facet_blob = this.facetJSON[facet_name];\n                    // console.dir(facet_blob);\n\n                    var field = facet_blob.field;\n\n                    // console.log (\"FIELD: \"+ field);\n                    var new_fq = field + \":*\" + facet_filter + \"*\"\n                    facet_fqs.push(new_fq);\n                }\n            }\n        }\n\n        function escapeSearchString(str) {\n            str = str.replace(/ /g, '\\\\ '); // escape spaces\n            str = str.replace('(', '\\\\(');\n            str = str.replace(')', '\\\\)');\n            str = str.replace(':', '\\\\:');\n            str = str.replace('+', '\\\\+');\n            str = str.replace('-', '\\\\-');\n            str = str.replace('\"', '\\\\\\\"');\n            str = str.replace('?', '\\\\?');\n\n            return str;\n        }\n\n        // create request object\n\n        var searchstring = state.query.text || \"\";\n        searchstring = escapeSearchString(searchstring);\n        var page = state.page || 0;\n        var pageSize = state.pageSize || 100;\n\n        if (facet_fqs.length > 0) pageSize = 0;  // zero pagesize if this is a facet filtering situation\n\n        // console.log (JSON.stringify(state));\n        var starts = (searchstring.length) ? searchstring + \"*\" : \"*\";\n        var search = (searchstring.length) ? \"*\" + searchstring + \"*\" : \"*\";\n        var slashy = searchstring + \"/\";\n        if ($.type(searchstring) === \"undefined\" || searchstring.length === 0) {\n            searchstring = search = slashy = \"*\";\n        }\n        var start = page * pageSize;\n\n        var fq_array = [];\n\n        // places\n        if (state.query.places && state.query.places.length) {\n            fq_array.push(this.buildFq(state.query.places, \"kmapid\"));\n        }\n\n        // subjects\n        if (state.query.subjects && state.query.subjects.length) {\n            fq_array.push(this.buildFq(state.query.subjects, \"kmapid\"));\n        }\n\n        // terms\n        if (state.query.terms && state.query.terms.length) {\n            fq_array.push(this.buildFq(state.query.terms, \"kmapid\"));\n        }\n\n        // slices\n        if (state.query.features && state.query.features.length) {\n\n            // console.error(\"FEATURES!\");\n            // console.dir(state.query.slices);\n            fq_array.push(this.buildFq(state.query.features, \"feature_types_ss\", \"title\"));\n        }\n\n        // collections\n        if (state.query.collections && state.query.collections.length) {\n            fq_array.push(this.buildFq(state.query.collections, \"collection_uid_s\", \"id\"));\n        }\n\n        // languages\n        if (state.query.languages && state.query.languages.length) {\n            fq_array.push(this.buildFq(state.query.languages, \"node_lang\", \"title\"));\n            // console.error(\"LANGUAGES!\");\n            // console.dir(state.query.languages);\n        }\n\n        if (state.query.assets && state.query.assets.length) {\n\n            // handle \"all\" id\n            for (var i = 0; i < state.query.assets.length; i++) {\n\n                // console.log(\"asset id = \" + state.query.assets[i].id);\n                if (state.query.assets[i].id === \"all\") {\n                    state.query.assets = ALL_ASSETS;\n                }\n            }\n\n            fq_array.push(this.buildFq(state.query.assets, \"asset_type\", \"id\", \"ast\"));\n        }\n\n        if (state.query.users && state.query.users.length) {\n\n\n            if (DEBUG) {\n                console.error(\"USERS!\");\n                console.dir(state.query.users);\n            }\n\n            fq_array.push(this.buildFq(state.query.users, \"node_user\", \"title\"));\n\n        }\n\n        if (state.query.creators && state.query.creators.length) {\n\n\n            if (DEBUG) {\n                console.error(\"CREATORS!\");\n                console.dir(state.query.creators);\n            }\n\n            fq_array.push(this.buildFq(state.query.creators, \"creator\", \"title\"));\n\n        }\n\n        // project filtering\n        if (state.project_filter && state.project_filter.length) {\n            fq_array.push(state.project_filter);\n            if (DEBUG) { // debugging\n                console.error(\"PROJECT_FILTER:\");\n                console.dir(state.project_filter);\n                console.error(\"FQ:\");\n                console.dir(fq_array);\n            }\n        }\n\n        var kmapid = \"\";\n        if (state.query.kmapid) {\n            kmapid = state.query.kmapid;\n        }\n        // console.log(JSON.stringify (fq_array, undefined, 2));\n\n        var basic_req = {\n            // search: tweak for scoping later\n            \"q\": \"(\" +\n                \" title:${xact}^100\" +\n                \" title:${slashy}^100\" +\n                \" names_txt:${xact}^90\" +\n                \" title:${starts}^80\" +\n                \" names_txt:${starts}^70\" +\n                \" title:${search}^10\" +\n                \" caption:${search}\" +\n                \" summary:${search}\" +\n                \" names_txt:${search}\" +\n                \")\",\n\n            // search strings\n            \"xact\": searchstring,\n            \"starts\": starts,\n            \"search\": search,\n            \"slashy\": slashy,\n        };\n\n        var all_req = {\n            \"q\": \"*\"\n        };\n\n        var kmapid_req = {\n            \"q\": \"(uid:${kmapid}^100 kmapid:${kmapid})\",\n            \"kmapid\": kmapid\n        };\n\n        if (searchstring === \"*\" || searchstring === \"\") {\n            basic_req = all_req;\n        }\n\n        var reqbase = (kmapid.length) ? kmapid_req : basic_req;\n        var req = $.extend(\n            {},\n            {\n                // generic settings (maybe tweak for efficiency later)\n                \"fl\": \"*\",\n                \"wt\": \"json\",\n\n                // paging\n                \"start\": start,\n                \"rows\": pageSize,\n\n                // facets\n                \"facet\": \"on\",\n                \"json.facet\": JSON.stringify(currentFacets),\n\n                /*\n                // highlighting\n                \"hl\": \"on\",\n                \"hl.method\": \"unified\",\n                \"hl.fl\": \"title,caption,summary,names_txt\",\n                \"hl.fragsize\": 0,\n                \"hl.tag.pre\": \"<mark>\",\n                \"hl.tag.post\": \"</mark>\",\n                */\n\n                // debug settings  -- set both to false in production?\n                \"echoParams\": \"explicit\",\n                \"indent\": \"true\"\n            },\n            reqbase);\n\n        var baseurl = state.solrUrl;\n        var params = new URLSearchParams(req);\n\n        // process the fq's\n\n        for (var i = 0; i < fq_array.length; i++) {\n            params.append(\"fq\", fq_array[i]);\n        }\n\n        for (var p = 0; p < facet_fqs.length; p++) {\n            params.append(\"fq\", facet_fqs[p]);\n        }\n\n        var url = new URL(baseurl + \"?\" + params.toString());\n        return url;\n    }\n\n    createKmapQuery(kmapid, atype, page, pageSize) {\n\n        const ALL_ASSETS = this.allAssets();\n        pageSize = (pageSize) ? pageSize : 10;\n        page = (page) ? page : 0;\n        var alist = (atype) ? [{id: atype, title: atype, bool: \"OR\"}] : ALL_ASSETS;\n        return this.createBasicQuery(\n            {\n                page: page,\n                pageSize: pageSize,\n                query: {\n                    kmapid: kmapid,\n                    assets: alist\n                }\n            },\n            ['asset_counts']\n        );\n    }\n\n    createAssetsByCollectionQuery(collection_uid, page, pageSize) {\n        return this.createBasicQuery(\n            {\n                page: page,\n                pageSize: pageSize,\n                query: {\n                    collections: [{title: collection_uid, id: collection_uid, bool: \"OR\"}]\n                }\n            }\n        );\n    }\n\n    buildFq(facets, facet_field, type, tag) {\n        if (!type) {\n            type = \"id\";\n        }\n        var bangtag = (tag) ? \"{!tag=\" + tag + \"}\" : \"\";\n        // console.log(\"Got facet values: \" + JSON.stringify(facets));\n        var st = \"\";\n        for (var i = 0; i < facets.length; i++) {\n            var entry = facets[i];\n            // console.log(\"Got facet: \" + JSON.stringify(entry));\n            var km = entry[type];\n            var op = \"\";\n\n            if (entry.bool === \"AND\") {\n                op = \"+\";\n            } else if (entry.bool === \"NOT\") {\n                op = \"-\";\n            } else if (entry.bool === \"OR\") {\n                op = \"\";\n            } else {\n                console.error(\"Unknown operator = \" + entry.bool + \" : \" + JSON.stringify(entry));\n            }\n\n            st += \" \" + op + \"\\\"\" + km + \"\\\"\";\n        }\n\n        var fq = bangtag + facet_field +\n            \":(\" + st + \")\";\n        // console.log(\"FQ: \" + fq);\n        return fq;\n    }\n\n    createAdvancedFacetQuery(state) {\n        state = $.extend(true, {}, this.defaultState, state);\n\n        state.solrUrl = \"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmterms_dev/select\"\n\n        // create request object\n\n        var searchstring = state.query.text || \"\";\n        var page = state.page || 0;\n        var pageSize = state.pageSize || 100;\n        // console.log (JSON.stringify(state));\n        var starts = searchstring + \"*\";\n        var search = \"*\" + searchstring + \"*\";\n        var slashy = searchstring + \"/\";\n        if ($.type(searchstring) === \"undefined\" || searchstring.length === 0) {\n            searchstring = search = slashy = \"*\";\n        }\n\n        var req =\n            {\n                // search: tweak for scoping later\n                \"q\": \"(\" +\n                    \" header:${xact}^100\" +\n                    \" header:${slashy}^100\" +\n                    // \" names_txt:${xact}^90\" +\n                    \" header:${starts}^80\" +\n                    // \" names_txt:${starts}^70\" +\n                    \" header:${search}^10\" +\n                    // \" caption:${search}\" +\n                    // \" summary:${search}\" +\n                    // \" names_txt:${search}\" +\n                    \")\",\n\n                // search strings\n                \"xact\": searchstring,\n                \"starts\": starts,\n                \"search\": search,\n                \"slashy\": slashy,\n\n                // generic settings (maybe tweak for efficiency later)\n                \"fl\": \"*,[child parentFilter=block_type:parent]\",\n                \"wt\": \"json\",\n\n                // paging\n                \"start\": page,\n                \"rows\": pageSize,\n\n                // facets\n                \"facet\": \"on\",\n                \"json.facet\": JSON.stringify(this.facetAdvancedJSON),\n\n                // highlighting\n                // \"hl\": \"on\",\n                // \"hl.method\": \"unified\",\n                // \"hl.fl\": \"header,caption,summary,names_txt\",\n                // \"hl.fragsize\": 0,\n                // \"hl.tag.pre\": \"<mark>\",\n                // \"hl.tag.post\": \"</mark>\",\n\n                // debug settings  -- set both to false in production?\n                \"echoParams\": \"explicit\",\n                \"indent\": \"true\"\n            };\n\n        var baseurl = state.solrUrl;\n        var params = new URLSearchParams(req);\n        var url = new URL(baseurl + \"?\" + params.toString());\n        return url;\n    }\n\n    buildQuery(termIndexRoot, type, path, lvla, lvlb, fl) {\n        var SOLR_ROW_LIMIT = 2000;\n        path = path.replace(/^\\//, \"\").replace(/\\s\\//, \" \");  // remove root slashes\n        if (path === \"\") {\n            path = \"*\";\n        }\n\n        var levelField = \"level_i\";\n        var ancestorField = \"ancestor_id_path\";\n        if (type === \"terms\") {\n            levelField = \"level_tib.alpha_i\";\n            ancestorField = \"ancestor_id_tib.alpha_path\";\n        }\n\n        var jsonfacetblob = {\n            \"child_counts\": {\n                \"limit\": 300,\n                \"mincount\": 2,\n                \"type\": \"terms\",\n                \"field\": ancestorField,\n                \"domain\": {\"excludeTags\": \"hoot\"}\n            }\n        };\n\n        // noinspection ConditionalExpressionJS\n        var fieldList = (fl) ? fl : ([\n            \"header\",\n            \"id\",\n            \"ancestor*\",\n            \"caption_eng\",\n            \"position*\",\n            levelField\n        ].join(\",\"));\n\n        var level_fqlist = [];\n\n        for ( var lvl = lvlb + 1; lvl > lvla; lvl--) {\n            var short_path = path.split(\"/\").slice(0,lvl-1).join(\"/\");\n            // console.log(\"shorty: \" + lvl +\": \" + JSON.stringify(short_path));\n            let path_filter = (short_path.length)?\" AND \" + ancestorField + \":\" + short_path: \"\";\n            level_fqlist.push(\"(\" + levelField + \":\" + (lvl - 1) + path_filter +\")\");\n        }\n        const level_fqs = level_fqlist.join(\" \");  // space separated list (OR)\n        let top_path = path.split(\"/\").slice(0,lvla).join(\"/\");\n        // console.dir(level_fqs);\n        // console.log(\"top_path = \" + top_path)\n\n        var req_url =\n            termIndexRoot + \"/select?\" +\n            \"df=\" + ancestorField +\n            \"&q=\" + top_path +\n            \"&wt=json\" +\n            \"&indent=true\" +\n            \"&limit=\" + SOLR_ROW_LIMIT +\n            \"&facet=true\" +\n            \"&fl=\" + fieldList +\n            \"&indent=true\" +\n\n            \"&fq=tree:\" + type +\n            \"&fq=\" + levelField + \":[\" + lvla + \"+TO+\" + (lvlb + 1) + \"]\" +\n            \"&fq={!tag=hoot}\" + level_fqs +\n            \"&facet.mincount=2\" +\n            \"&facet.limit=-1\" +\n            \"&sort=\" + levelField + \"+asc,position_i+asc,header+asc\" +\n            \"&facet.sort=\" + ancestorField + \"+ASC\" +\n            \"&facet.field={!ex=hoot}\" + ancestorField +\n            \"&json.facet=\" + JSON.stringify(jsonfacetblob) +\n            \"&wt=json\" +\n            \"&json.wrf=?\" +\n            \"&rows=\" + SOLR_ROW_LIMIT;\n        return req_url;\n    }\n\n    buildAssetQuery(queryObj) {\n        var url = this.createBasicQuery(queryObj);\n        // console.log(\"Returning \" + url);\n        return url;\n    }\n\n\n};","/* \tMANDALA SEARCH UI ****************************************************************************************************************************\n\n\tUSE CASE 1:\n\tWhen allocated, attaches a <div> framework containing a search button in the top white bar of the Mandala app.\n\tWhen clicked, it will expand to cover the entire screen. \n\tAn sui=open message is sent to host.\n\tWhen a SOLR query is needed, a JSON formatted version of the search object is sent to host uoing a sui=query message.\n\tThe host responds with a SOLR query.\n\tWhen an item has been selected, a sui=page message is sent to host and the host navigates there.\n\tThe UI retreats to only the search button.\n\tA sui=close message is sent to host.\n\n\tUSE CASE 2:\n\n\tRequires: \tjQuery \t\t\t\t\t\t\t\t\t\t\t\t// Almost any version should work\n\tCalls:\t\tkmapsSolrUtil.js, [places.js, pages.js, texts.js,\t// Other JS modules that are dynamically loaded (not used in plain search)\n\t\t\t\taudiovideo.js, visuals.js, sources.js, subjects.js]\t\t\t\t\n\tCSS:\t\tsearchui.css\t\t\t\t\t\t\t\t\t\t// All styles are prefixed with 'sui-'\n\tJS:\t\t\tECMA-6\t\t\t\t\t\t\t\t\t\t\t\t// Uses lambda (arrow) functions\n\tImages:\t\tloading.gif, gradient.jpg, treebuts.png\n\tGlobals:\tsui\t\t\t\t\t\t\t\t\t\t\t\t\t// Needs to be declared globally!\n\tUsage: \t\tvar sui=new SearchUI();\t\t\t\t\t\t\t\t// Allocs SearchUI class (fully encapsulated)\n\tMessages: \tsui=page|url ->\t\t\t\t\t\t\t\t\t\t// Hides search and send url to direct Drupal to display\n\t\t\t\tsui=open|searchState ->\t\t\t\t\t\t\t\t// Tells Drupal search page is open w/ current search state (ss object)\n\t\t\t\tsui=query|searchState ->\t\t\t\t\t\t\t// Asks Drupul to turn search state (JSON) into SOLR query string\n\t\t\t\tsui=close ->\t\t\t\t\t\t\t\t\t\t// Tells Drupal search page is closed\n\t\t\t\t-> sui=open|[searchState] \t\t\t\t\t\t\t// Open search page is to search state\n\t\t\t\t-> sui=close\t\t\t\t\t\t\t\t\t\t// Close search page\n\n**********************************************************************************************************************************************/\n/* eslint-disable */\n\nimport $ from 'jquery';\nimport KmapsSolrUtil from './kmapsSolrUtil';\n\nexport default class SearchUI {\n    constructor(\n        site,\n        useProdIndex // CONSTRUCTOR\n    ) {\n        this.sui = this;\n        this.curResults = ''; // Returns results\n        this.numItems = 0; // Number of items\n        this.AND = 'AND';\n        this.OR = 'OR';\n        this.NOT = 'NOT'; // Boolean display names\n        this.ss = {}; // Holds search state\n        this.site = site; // Site to use\n        this.facets = {};\n        this.facets.assets = {\n            type: 'list',\n            icon: '&#xe60b',\n            mode: null,\n            data: [],\n        }; // Assets\n        this.facets.places = {\n            type: 'tree',\n            icon: '&#xe62b',\n            mode: null,\n            data: [],\n        }; // Places\n        this.facets.features = {\n            type: 'tree',\n            icon: '&#xe638',\n            mode: null,\n            data: [],\n        }; // Features\n        this.facets.subjects = {\n            type: 'tree',\n            icon: '&#xe634',\n            mode: null,\n            data: [],\n        }; // Subjects\n        this.facets.terms = {\n            type: 'tree',\n            icon: '&#xe635',\n            mode: null,\n            data: [],\n        }; // Terms\n        this.facets.collections = {\n            type: 'list',\n            icon: '&#xe633',\n            mode: null,\n            data: [],\n        }; // Collections\n        this.facets.languages = {\n            type: 'tree',\n            icon: '&#xe670',\n            mode: null,\n            data: [],\n        }; // Languages\n        this.facets.users = {\n            type: 'input',\n            icon: '&#xe600',\n            mode: null,\n            data: [],\n        }; // Terms\n\n        this.assets = {};\n        this.assets.all = { c: '#5b66cb', g: '&#xe60b' }; // All assets\n        this.assets.places = { c: '#6faaf1', g: '&#xe62b' }; // Places\n        this.assets['audio-video'] = { c: '#58aab4', g: '&#xe648' }; // AV\n        this.assets.images = { c: '#b49c59', g: '&#xe62a' }; // Images\n        this.assets.sources = { c: '#5a57ad', g: '&#xe631' }; // Sources\n        this.assets.texts = { c: '#8b5aa1', g: '&#xe636' }; // Texts\n        this.assets.visuals = { c: '#6e9456', g: '&#xe63b' }; // Visuals\n        this.assets.subjects = { c: '#cc4c39', g: '&#xe634' }; // Subjects\n        this.assets.terms = { c: '#a2733f', g: '&#xe635' }; // Terms\n        this.assets.collections = { c: '#5b66cb', g: '&#xe633' }; // Collections\n        this.searches = []; // Saves recent searches\n        this.showBool = false; // Where to show Boolean in advanced\n        this.showSearch = false; // Click to search or add facet\n\n        this.noTop = site == 'CU' ? true : false; // Has a top\n        $('<link/>', {\n            rel: 'stylesheet',\n            type: 'text/css',\n            href: 'searchui.css',\n        }).appendTo('head'); // Load CSS\n\n        this.solrId = useProdIndex ? '_prod' : '_dev'; // Set solrId\n        this.solrBase =\n            'https://' +\n            (useProdIndex ? 'ss395824' : 'ss251856') +\n            '-us-east-1-aws.measuredsearch.com/solr/'; // Solr base\n        this.ss.solrUrl =\n            this.solrBase +\n            'kmassets' +\n            (useProdIndex ? '' : '_dev') +\n            '/select'; // Full url\n        this.ss.mode = 'input'; // Current mode - can be input, simple, or advanced\n        this.ss.view = 'Card'; // Dispay mode - can be List, Grid, or Card\n        this.ss.sort = 'Alpha'; // Sort mode - can be Alpha, Date, or Author\n        this.ss.page = 0; // Current page being shown\n        this.ss.pageSize = 100; // Results per page\n        this.ss.site = 'Mandala'; // Site\n        this.ss.numResults = 0; // Number of resulrts found\n        this.solrUtil = new KmapsSolrUtil({ solrUrl: this.ss.solrUrl }); // Alloc Yuji's search class and pass defaultState\n        this.ClearQuery(); // Cleae our all search elements in query\n        // this.AddFrame();\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Add div framework\n\n        // if (!window.location.hash)\t{\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Normal startup\n        // \tthis.Draw(); \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Draw\n        // }\n        // window.onresize=()=> { \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// ON RESIZE\n        // \tif (this.ss.mode == \"advanced\") \t\t\t\t\t\t\t\t\t\t\t\t\t\t// Advanced search\n        // \t\t$(\"#sui-content\").css({ width:$(\"#sui-main\").width()-$(\"#sui-adv\").width() });\t\t\t// Size results area\n        // };\n\n        // window.addEventListener(\"popstate\", (h)=> { \t\t\t\t\t\t\t\t\t\t\t\t// ON PAGE STATE CHANGE\n        // \tlet state=h.state;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Get state\n        // \tif (!state)\tstate=window.location.hash;\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If no state, get directly from hash\n        // \tthis.PageRouter(state); \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Route on state\n        // \t});\n    }\n\n    // AddFrame()\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// ADD DIV FRAMEWORK FOR APP\n    // {\n    // \talert(\"addFrame()\");\n    // \tconsole.error(\"AddFrame() called!\");\n    // \treturn;\n    //\n    // \tlet key;\n    // \tthis.showBool=this.GetCookie(\"showBool\") == \"true\";\n    // \tvar str=\"\";\n    // \tif (this.site != \"CU\") str+=`<div class='sui-topBar'><img src='img/bhutanleft.gif' style='cursor:pointer' onclick='alert(\"draw landing page\")' title='Home page'></div>\n    // \t\t<div id='sui-top' class='sui-top'>\n    // \t\t<div style='display:inline-block'>\n    // \t\t<div class='sui-search1'>\n    // \t\t\t\t<input type='text' id='sui-search' class='sui-search2' placeholder='Enter Search'>\n    // \t\t\t\t<div id='sui-clear' class='sui-search3'>&#xe610</div>\n    // \t\t\t</div>\n    // \t\t\t<div id='sui-searchgo' class='sui-search4'>&#xe623</div>\n    // \t\t\t<div id='sui-mode' class='sui-search5' title='Advanced search'>ADVANCED<br>SEARCH</div>\n    // \t\t\t<div id='sui-hamBut' class='sui-hamBut' title='Help + options'>&#xe627</div>\n    // \t\t\t</div>\n    // \t\t</div>\n    // \t<div>`;\n    // \tstr+=`<div id='sui-content' class='sui-content'>\n    // \t\t<div id='sui-header' class='sui-header'>\n    // \t\t\t<div id='sui-contentHead' class='sui-contentHead'></div>\n    // \t\t</div>\n    // \t\t<div id='sui-legacy' class='sui-legacy scrollbar' style='color:#000'></div>\n    // \t</div>\n    // \t<div id='sui-adv' class='sui-adv'>`;\n    // \tfor (key in this.facets) {\n    // \t\t\tstr+=`<div class='sui-advBox' id='sui-advBox-${key}'>\n    // \t\t\t<div class='sui-advHeader' id='sui-advHeader-${key}'>\n    // \t\t\t\t${this.facets[key].icon}&nbsp;&nbsp;${key.toUpperCase()}\n    // \t\t\t\t<span id='sui-advPlus-${key}' style='float:right'>&#xe669 </span></div>\n    // \t\t\t\t<div class='sui-advTerm' id='sui-advTerm-${key}'></div>\n    // \t\t\t<div class='sui-advEdit' style='display:none' id='sui-advEdit-${key}'></div></div>`;\n    // \t\t\tif ((key == \"terms\") || (key == \"users\")) str+=\"<hr style='border-top:8px solid #ddd;margin:16px 0 16px 12px'>\";\n    // \t\t\t}\n    // \tstr+=`<div class='sui-advBox' id='sui-advBox-recent'>\n    // \t\t<div class='sui-advHeader' id='sui-advHeader-recent'>&#xe62e&nbsp;&nbsp;RECENT SEARCHES\n    // \t\t<span id='sui-advPlus-recent' style='float:right'>&#xe669</span></div>\n    // \t\t<div class='sui-advTerm'></div>\n    // \t\t<div class='sui-advEdit' style='display:none' id='sui-advEdit-recent'></div></div>\n    // \t\t<div style='margin-top:4px;float:right;font-size:13px'>\n    // \t\t\t<div>Show Boolean controls? &nbsp;<input type='checkbox' id='sui-showBool' ${this.showBool ? \"checked\" : \"\"}></div>\n    // \t\t\t<!-- div class='sui-geoLocate' id='sui-geoLocate'>Geo-Locate</div-->\n    // \t\t</div>\n    // \t</div>\n    // \t<div id='sui-footer' class='sui-footer'></div></div>\n    // \t<div class='sui-hamburger' id='sui-hamburger'></div>`;\n    //\n    // \t$(\"#sui-main\").html(str.replace(/\\t|\\n|\\r/g,\"\"));\t\t\t\t\t\t\t\t\t\t\t// Remove formatting and add framework to main div\n    // \t// $(\"#sui-advHeader-assets\").html($(\"#sui-advHeader-assets\").html().replace(/Assets/i,\"ITEM TYPE\"));  // Rename assets\n    // \t$(\"#sui-clear, sui-clear2\").on(\"mouseover\",function() { $(this).html(\"&#xe60d\"); });\t\t// Highlight\n    // \t$(\"#sui-clear, sui-clear2\").on(\"mouseout\", function() { $(this).html(\"&#xe610\"); });\t\t// Normal\n    // \t$(\"#sui-clear, sui-clear2\").on(\"click\",()=> { \t\t\t\t\t\t\t\t\t\t\t\t// ON ERASE\n    // \t\t$(\"#sui-search\").val(\"\");\tthis.ClearQuery(); \t\t\t\t\t\t\t\t\t\t\t// Clear input and query\n    // \t\tthis.Query(); \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Load and redraw\n    // \t\t});\n    //\n    // \t$(\"#sui-search\").on(\"change\", (e)=> { \t\t\t\t\t\t\t\t\t\t\t\t\t\t// ON SEARCH CHANGE\n    // \t\tthis.ss.query.text=$(\"#\"+e.currentTarget.id).val(); \t\t\t\t\t\t\t\t\t// Get query\n    // \t\t$(\"#sui-search\").val(this.ss.query.text);\t\t\t\t\t\t\t\t\t\t\t\t// Set top search\n    // \t\tif ((this.ss.mode == \"input\") || (this.ss.mode == \"related\")) this.ss.mode=\"simple\";\t// Toggle simple mode\n    // \t\tif (this.ActiveSearch(false)) this.ss.mode=\"advanced\";\t\t\t\t\t\t\t\t\t// Some advanced search items set, open advanced search\n    // \t\tthis.ss.page=0;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Start at beginning\n    // \t\tthis.Query(); \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Load and redraw\n    // \t\t});\n    //\n    // \t$(\"#sui-searchgo, #sui-searchgo2\").on(\"click\", (e)=> { \t\t\t\t\t\t\t\t\t\t// ON SEARCH BUTTON CLCK\n    // \t\tif ((this.ss.mode == \"input\") || (this.ss.mode == \"related\") ) this.ss.mode=\"simple\";\t// Toggle simple mode\n    // \t\tif (this.ActiveSearch(false)) this.ss.mode=\"advanced\";\t\t\t\t\t\t\t\t\t// Some advanced search items set, open advanced search\n    // \t\tthis.ss.page=0;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Start at beginning\n    // \t\tthis.Query(); \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Load and redraw\n    // \t\t});\n    //\n    // \t$(\"#sui-mode\").on(\"click\",()=> { \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// ON CHANGE MODE\n    // \t\tthis.ShowAdvanced((this.ss.mode == \"advanced\") ? false : true);\t\t\t\t\t\t\t// Toggle advanced menu\n    // \t\t});\n    //\n    // \t$(\"#sui-showBool\").on(\"click\",()=> { \t\t\t\t\t\t\t\t\t\t\t\t\t\t// ON CHANGE BOOLEAN\n    // \t\tthis.showBool=!this.showBool;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Toggle flag\n    // \t\tthis.SetCookie(\"showBool\", this.showBool);\t\t\t\t\t\t\t\t\t\t\t\t// Set cookie\n    // \t\tthis.DrawAdvanced();\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Draw search UI\n    // \t\t});\n    // \t$(\"#sui-geoLocate\").on(\"click\",()=> { \t\t\t\t\t\t\t\t\t\t\t\t\t\t// ON GEO LOCATE\n    // \t\tthis.GeoLocate();\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Show geolocation\n    // \t\t});\n    //\n    // \t$(\"[id^=sui-advHeader-]\").on(\"click\",(e)=> {\t\t\t\t\t\t\t\t\t\t\t\t// ON FACET HEADER CLICK\n    // \t\tvar id=e.currentTarget.id.substring(14);\t\t\t\t\t\t\t\t\t\t\t\t// Get facet name\n    // \t\t$(\".sui-advEdit\").slideUp(400, ()=> {\t\t\t\t\t\t\t\t\t\t\t\t\t// Close any open tree or lists\n    // \t\t\t$(\"[id^=sui-advHeaderBox-]\").css(\"border\",\"solid\")\t\t\t\t\t\t\t\t\t// Reset them all to closed\n    // \t\t$(\"[id^=sui-advPlus-]\").html(\"&#xe669\");\t\t\t\t\t\t\t\t\t\t\t\t// Reset them all to closed\n    // \t\tif ($(\"#sui-advEdit-\"+id).css(\"display\") != \"none\")\t{\t\t\t\t\t\t\t\t\t// If open\n    // \t\t\t$(\"#sui-advPlus-\"+id).html(\"&#xe66a\");\t\t\t\t\t\t\t\t\t\t\t\t// Show open\n    // \t\t\t$(\"#sui-advHeaderBox-\"+id).css(\"border-top-style\",\"hidden\")\t\t\t\t\t\t\t// Hide border\n    // \t\t\t}\n    // \t\t});\n    // \t\t$(\"#sui-advPlus-\"+id).html(\"&#xe66a\");\t\t\t\t\t\t\t\t\t\t\t\t\t// Show open\n    //\n    // \t\tfor (var key in this.facets)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// For each facet\n    // \t\t\tif (this.facets[key] == \"list\")\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If a list\n    // \t\t\t\t$(\"#sui-advEdit-\"+key).html(\"\");\t\t\t\t\t\t\t\t\t\t\t\t// Erase contents\n    // \t\tthis.DrawFacetItems(id);\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Draw appropriate tree, list, or input\n    // \t\t});\n    //\n    // \t$(\"#sui-main\").on(\"click\",(e)=>{\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// ON CLICK OF RESULTS PAGE\n    // \t\tthis.pages.ClearPopover();\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Clear popover\n    // \t\tif (e.target.id != \"sui-hamBut\") $(\"#sui-hamburger\").slideUp();\t\t\t\t\t\t\t// Hide hanburderv menu if open\n    // \t\t});\n    // \t$(\"#sui-hamBut\").on(\"click\",()=>{ this.ShowHamburger() });\t\t\t\t\t\t\t\t\t// SHOW HAMBURGER MENU\n    // \tif (this.noTop)\t$(\"#sui-content\").css({ top:0, height:\"calc(100% - 30px)\" });\n    // }\n\n    Draw(\n        mode // DRAW SEARCH COMPONENTS\n    ) {\n        //console.log(\"Draw called!\");\n        //console.log(\"searchui.Draw called with \" + JSON.stringify(arguments));\n        if (mode) this.ss.mode = mode; // If mode spec'd, use it\n        this.DrawResults(); // Draw results page if active\n        // this.DrawAdvanced();\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Draw search UI if active\n    }\n\n    ShowAdvanced(\n        mode // HIDE/SHOW ADVANCED MENU\n    ) {\n        throw new Error('ShowAdvanced');\n        this.ss.mode = mode ? 'advanced' : 'simple'; // Set mode\n        $('#sui-adv').css({ display: mode ? 'block' : 'none' }); // Hide/show adv ui\n        if (mode)\n            $('#c-columnContent__main').css({\n                width:\n                    $('#l-site__wrap').width() - $('#sui-adv').width() + 'px',\n            });\n        // Size results area to fit advanced\n        else\n            $('#l-content__main').css({\n                width: $('#l-site__wrap').width() + 'px',\n            }); // 100%\n        this.DrawAdvanced(); // Draw search UI if active\n    }\n\n    ShowHamburger() {\n        // SHOW HAMBURGER MENU\n        let str = `<span id='sui-help' class='sui-hamItem'>&#xe67e&nbsp;&nbsp;HELP GUIDE</span>\n\t\t<span id='sui-home' class='sui-hamItem'>&#xe60b&nbsp;&nbsp;HOME</span>`;\n        $('#sui-hamburger').html(str.replace(/\\t|\\n|\\r/g, '')); // Remove formatting and add to menu\n        $('#sui-hamburger').slideToggle(); // Open or close\n        $('#sui-home').on('click', () => {\n            alert('DrawLandingPage()');\n        }); // Go home\n        $('#sui-help').on('click', () => {\n            window.open(\n                '//confluence.its.virginia.edu/display/KB/Mandala+Suite+of+Tools',\n                '_blank'\n            );\n        }); // Show help\n        $('#sui-hamburger').on('click', () => {\n            $('#sui-hamburger').slideUp();\n        }); // Close\n    }\n\n    /*\tPAGE STATE  ////////////////////////////////////////////////////////////////////////////////////\n\t\n\tControls the forward/back buttons  and the bookmarking for the standlone version.\n\tIt uses the HTML5 History API. When page is navigated to programatically, SetState() is called.\n\tIt's state parameter contains information identifying the page via it's kmapId\n\tThis is added as a hash value to the browser's search bar for bookmarking.\n\tIt is added to the browser history for the browser's forward/back buttons.\n\n\tA listener to the 'hashchanged' event calls PageRouter() with that kmpaId, and\n\tthsat page is drawn on the screen.\n\t\n\tOPTIONS:\n\t#p=kmapId\t\t// Shows page that has kmapid\n\n///////////////////////////////////////////////////////////////////////////////////////////////// */\n\n    SetState(\n        state // SET PAGE STATE\n    ) {\n        const here = window.location.href.split('#')[0]; // Remove any hashes\n        window.history.pushState(\n            '#' + state,\n            'Mandala',\n            here + (state ? '#' + state : '')\n        ); // Show current state search bar\n    }\n\n    PageRouter(\n        hash // ROUTE PAGE BASED ON QUERY HASH OR BACK BUTTON\n    ) {\n        //console.log (\"PageRouter called.\");\n        const sui = this.sui;\n        const here = window.location.href.split('#')[0]; // Remove any hashes\n        let id;\n        if ((id = hash.match(/#p=(.+)/))) {\n            // If a page\n            id = id[1].toLowerCase(); // Isolate kmap id\n            setupPage(); // Prepare page's <div> environment\n            this.alert(\n                '======== PAGEROUTER: ' + hash + ' Handling p: Drawing ' + id\n            );\n            this.log('\tPAGEROUTER: calling pages.Draw() with id=' + id);\n            this.GetKmapFromID(id, (kmap) => {\n                this.log(\n                    '\tPAGEROUTER: calling pages.Draw() with kmap=' + kmap.uid\n                );\n                this.pages.Draw(kmap, true);\n            }); // Get kmap and show page\n        } else if ((id = hash.match(/#r=(.+)/))) {\n            // If showing related results\n            setupPage(); // Prepare page's <div> environment\n            let v = id[1].replace(/\\%20/g, ' ').split('='); // Get ids\n            this.pages.relatedId = v[0];\n            this.pages.relatedType = v[2]; // Set factors\n            this.alert(\n                '======== PAGEROUTER: ' +\n                    hash +\n                    ' Handling r: calling getKmapFromID with id = ' +\n                    v[3] +\n                    ' this.pages.relatedId=' +\n                    this.pages.relatedId +\n                    ' this.pages.relatedType=' +\n                    this.pages.relatedType\n            );\n            this.GetKmapFromID(v[3], (kmap) => {\n                this.pages.relatedBase = kmap;\n                //console.log(\"\tPAGEROUTER handling callback.  calling pages.DrawRelatedResults with kmap uid = \" + kmap.uid);\n                this.pages.DrawRelatedResults(kmap, true);\n            }); // Get kmap and show page\n        } else if ((id = hash.match(/#s=(.+)/))) {\n            // If showing search results\n            setupPage(); // Prepare page's <div> environment\n            id = id[1].replace(/\\%20/g, ' '); // Get ids\n            this.ParseQuerystring(id); // Get query\n            this.alert(\n                '======== PAGEROUTER: ' +\n                    hash +\n                    ' Handling s: Parsing querystring: ' +\n                    id +\n                    ' set ss.query.text to ' +\n                    ss.query.text\n            );\n            $('#sui-search').val(this.ss.query.text); // Set top search\n            this.Query(true); // Run query\n        }\n\n        function setupPage() {\n            // PREPARES <DIV> TO DRAW NEW PAGE\n            sui.ss.mode = 'simple'; // Simple display mode\n            sui.ss.page = 0; // Start at beginning\n            $('#sui-legacy').scrollTop(0); // Scroll to top\n            $('#c-columnContent__main').scrollTop(0); // Scroll to top\n            $('#plc-infoDiv').remove(); // Remove map buttons\n            $('#l-content__main').css({\n                width: '100%',\n                display: 'inline-block',\n            }); // Size and show results area\n            $('#sui-adv').css({ display: 'none' }); // Hide search ui\n            $('#sui-legacy').css({ display: 'block' }); // Show page\n            sui.DrawHeader(true);\n            sui.DrawFooter(); // Redraw header and footer\n        }\n    }\n\n    SerializeQuery(\n        q // SERIALZE QUERY INTO STRING\n    ) {\n        let i,\n            f,\n            str = '';\n        this.ss.query.assets = [this.ss.query.assets[0]]; // Keep only 1st asset *************************** ASSETS1\n        for (f in q.query) {\n            // For each facet type\n            if (f == 'text' && q.query[f])\n                // If text spec'd\n                str += `${f}:${q.query[f]}=`;\n            // Add it\n            // All other facets\n            else\n                for (\n                    i = 0;\n                    i < q.query[f].length;\n                    ++i // For each item\n                )\n                    str += `${f}:${q.query[f][i].title}:${q.query[f][i].id}:${q.query[f][i].bool}=`; // Add it\n        }\n        return str.slice(0, -1); // Remove last '+'\n    }\n\n    ParseQuerystring(\n        qString // PARSE QUERY FROM STRING\n    ) {\n        let i, v, o;\n        let fs = qString.split('='); // Split parts\n        this.ClearQuery(); // Clear search query\n        this.ss.query.assets = []; // Clear assets ********************************** ASSETS1\n        for (i = 0; i < fs.length; ++i) {\n            // For each term\n            if (fs[i].match(/^text/)) {\n                this.ss.query.text = fs[i].substr(5);\n            } // Get text\n            else {\n                // Get all other facets\n                v = fs[i].split(':'); // Get parts\n                o = { title: v[1], id: v[2], bool: v[3] }; // Make search item\n                this.ss.query[v[0]].push(o); // Add\n            }\n        }\n        this.ss.query.assets = [this.ss.query.assets[0]]; // Keep only 1st asset *************************** ASSETS1\n    }\n\n    /*\tQUERY TOOLS //////////////////////////////////////////////////////////////////////////////////\n\n\tA series of functions that manage the search process. The state of the current search is\n\tsaved in the ss object. It is initialized using InitSearchState(). The UI modifies the ss \n\tobject to the search parameters desired and Query() uses Yuji's query builder to get a query\n\tURL for SOLR. The results come in, they are displayed. The lists in the advsnced UI are also \n\tfiltered to reflect the current possible options based on that search.\n\n\tThere are 3 modes of the search. A general qwery, as described above. The standalone version\n\tadds search of assets related to a kmapId, and a query to get the kmaps in a given collection.\n\n//////////////////////////////////////////////////////////////////////////////////////////////  */\n\n    ClearQuery() {\n        // CLEAR SEARCH QUERY STATE TO START\n        $('#sui-search').val(''); // Clear input field\n        if (this.pages) this.pages.relatedBase = this.pages.relatedId = ''; // Clear relateds\n        this.ss.page = 0; // Start of page 0\n        this.ss.query = {\n            // Current query\n            text: '', // Search word\n            places: [], // Places\n            collections: [], // Collections\n            languages: [], // Languages\n            features: [], // Feature types\n            subjects: [], // Subjects\n            terms: [], // Terms\n            relationships: [], // Relationships\n            users: [], // Users\n            assets: [{ title: 'All', id: 'all', bool: 'AND' }], // Assets\n            termPerspective: '',\n            subjectPerspective: '',\n            placePerspective: '', // Perspectives\n            view: '', // View\n        };\n    }\n\n    //\n\n    //\n    Query(\n        fromHistory,\n        collectionId // QUERY AND UPDATE RESULTS\n    ) {\n        //console.log(\"Query() called with fromHistory = \" + fromHistory + \" collectionId =  \" + collectionId);\n        let url;\n        this.LoadingIcon(true, 64); // Show loading icon\n\n        if (collectionId) {\n            // If getting collection members\n            //console.log(\"\tSearchUI.Query: collection mode\");\n            let ts = JSON.parse(JSON.stringify(this.ss)); // Clone search\n            ts.query = {\n                text: '',\n                places: [],\n                assets: [{ id: this.pages.relatedType, bool: 'AND' }],\n                languages: [],\n                features: [],\n                subjects: [],\n                terms: [],\n                relationships: [],\n                users: [],\n                perspectives: [],\n                collections: [{ title: 'all', id: collectionId, bool: 'AND' }],\n            }; // Set new search\n            url = this.solrUtil.buildAssetQuery(ts); // Set url\n        } else if (this.ss.mode == 'related') {\n            //console.log(\"\tSearchUI.Query: related mode\");\n            url = this.solrUtil.createKmapQuery(\n                this.pages.relatedId.toLowerCase(),\n                this.pages.relatedType.toLowerCase(),\n                this.ss.page,\n                this.ss.pageSize\n            );\n        } // Get assets related to relatedId\n        else {\n            //console.log(\"\tSearchUI.Query: asset mode\");\n            url = this.solrUtil.buildAssetQuery(this.ss);\n        } // Get assets that match query\n        if (this.ss.mode != 'related' && !fromHistory) {\n            // These set their own states and not from history API\n            //console.log(\"\tSearchUI.Query: default mode\");\n            this.SetState('s=' + this.SerializeQuery(this.ss)); // Save search state\n        }\n        $('#sui-relatedAssets').remove(); // Remove related assets panel\n        if (this.ActiveSearch()) {\n            // If an active search\n            this.searches.filter((s, i) => {\n                // Check to see if it already exists in list\n                if (JSON.stringify(s.query) === JSON.stringify(this.ss.query))\n                    // It does\n                    this.searches.splice(i, 1); // Remove old one\n            });\n            this.searches.push(JSON.parse(JSON.stringify(this.ss))); // Add to recent searches\n        }\n        $.ajax({ url: url, dataType: 'jsonp', jsonp: 'json.wrf' })\n            .done((data) => {\n                // Get data from SOLR\n                //console.log (\"\tSearchUI.Query: got data back from SOLR query: \" + url);\n                //console.dir(data);\n                this.curResults = this.MassageKmapData(data.response.docs); // Normalize for display\n                this.ParseFacetData(data); // Get facet data counts\n                this.LoadingIcon(false); // Hide loading icon\n                this.DrawResults(); // Draw results page if active\n                // this.DrawAdvanced();\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Draw advanced search if active\n            })\n            .fail((msg) => {\n                //console.log(msg);\n                this.LoadingIcon(false);\n                this.Popup('Query error');\n            }); // Failure message\n    }\n\n    GetKmapFromID(\n        id,\n        callback // GET KMAP FROM ID\n    ) {\n        //console.log(\"GetKmapFromID() called with id=\" + id);\n        var url = this.ss.solrUrl + '?q=uid:' + id.toLowerCase() + '&wt=json';\n        //console.log(\"SOLR QUERY GetKmapFromID() = \" + url);// Set query url\n        $.ajax({ url: url, dataType: 'jsonp', jsonp: 'json.wrf' })\n            .done((data) => {\n                // Get kmap\n\n                try {\n                    data = this.MassageKmapData(data.response.docs[0]); // Normalize kmap\n                } catch (error) {\n                    data.error = error;\n                }\n                callback(data); // Return kmap\n            })\n            .fail((msg) => {\n                console.log(msg);\n            }); // Failure message\n    }\n\n    GetDefinitionAssets(\n        id,\n        callback // GET TAGGED ASSETS TO TERM\n    ) {\n        let url =\n            this.ss.solrUrl + '?q=kmapid:' + id.toLowerCase() + '&wt=json'; // Set query url\n        $.ajax({ url: url, dataType: 'jsonp', jsonp: 'json.wrf' })\n            .done((data) => {\n                // Get kmap\n                data = this.MassageKmapData(data.response.docs); // Normalize kmap\n                callback(data); // Return kmaps\n            })\n            .fail((msg) => {\n                console.log(msg);\n            }); // Failure message\n    }\n\n    GetRelatedFromID(\n        id,\n        callback // GET RELATED THINGS FROM ID\n    ) {\n        this.log('GetRelatedFromID() called with arguments');\n        //console.log(JSON.stringify(arguments));\n        let url = `${this.solrBase}kmterms${this.solrId}/query`; // Base url\n        url +=\n            '?child_count.fq=related_kmaps_node_type:child&child_count.fl=uid&fq=!related_kmaps_node_type:parent';\n        url +=\n            \"&child_count.rows=0&fl=child_count:[subquery],*&child_count.q={!child%20of='block_type:parent'}\";\n        url +=\n            '{!term%20f=uid%20v=$row.related_subjects_id_s}&rows=2000&q=id:' +\n            id +\n            '%20OR%20{!child%20of=block_type:parent}id:' +\n            id +\n            '%20&sort=block_type%20DESC,%20related_subjects_header_s%20ASC';\n        this.log('SOLR QUERY GetRelatedFromID():  query = ' + url);\n        $.ajax({ url: url, dataType: 'jsonp', jsonp: 'json.wrf' })\n            .done((data) => {\n                // Get kmap\n                this.log('GetRelatedFromID() returns ' + data);\n                //console.dir(data);\n                callback(data.response.docs); // Return data\n            })\n            .fail((msg) => {\n                console.log(msg);\n            }); // Failure message\n    }\n\n    GetRelatedPlaces(\n        id,\n        callback // GET RELATED THINGS FROM ID\n    ) {\n        this.LoadingIcon(true, 64); // Show loading icon\n        var url = this.solrUtil.createKmapQuery(id, 'places', 0, 10000); // Make query url\n        $.ajax({ url: url, dataType: 'jsonp', jsonp: 'json.wrf' })\n            .done((data) => {\n                // Get data from SOLR\n                data = this.MassageKmapData(data.response.docs); // Normalize for display\n                this.LoadingIcon(false); // Hide loading icon\n                callback(data); // Return data\n            })\n            .fail((msg) => {\n                console.log(msg);\n                this.LoadingIcon(false);\n                this.Popup('Related query error');\n            }); // Failure message\n    }\n\n    GetChildNamesFromID(\n        facet,\n        id,\n        callback // GET NAMES/ETYMOLGY DATA FROM ID\n    ) {\n        let url = `${this.solrBase}kmterms${this.solrId}/select?fl=uid%2C%5Bchild%20childFilter%3Did%3A${facet}-${id}_names-*%20parentFilter%3Dblock_type%3Aparent%5D&q=uid%3A${facet}-${id}&wt=json&rows=300`;\n        $.ajax({ url: url, dataType: 'jsonp', jsonp: 'json.wrf' })\n            .done((data) => {\n                // Get kmap\n                callback(data.response.docs); // Return data\n            })\n            .fail((msg) => {\n                console.log(msg);\n            }); // Failure message\n    }\n\n    GetChildDataFromID(\n        uid,\n        callback // GET CHILD DATA FROM ID\n    ) {\n        let url = `${this.solrBase}kmterms${this.solrId}/query?q=uid:${uid}&wt=json&fl=*,[child%20parentFilter=block_type:parent%20limit=300]`;\n        //console.log(\"SOLR QUERY GetChildDataFromID = \" + url);\n        $.ajax({ url: url, dataType: 'jsonp', jsonp: 'json.wrf' })\n            .done((data) => {\n                // Get kmap\n                callback(data.response.docs[0]); // Return data\n            })\n            .fail((msg) => {\n                console.log(msg);\n            }); // Failure message\n    }\n\n    GetTreeChildren(\n        facet,\n        path,\n        callback // GET CHILDREN OF TREE LIMB\n    ) {\n        const sui = this.sui;\n        let base = `${this.solrBase}kmterms${this.solrId}`; // Base url\n        let lvla = Math.max(path.split('/').length + 1, 2); // Set level\n        if (facet == 'features' || facet == 'languages') facet = 'subjects'; // Features and languages are in subjects\n        var url = sui.solrUtil.buildQuery(base, facet, path, lvla, lvla); // Build query using Yuji's builder\n        $.ajax({ url: url, dataType: 'jsonp' })\n            .done((res) => {\n                // Get children\n                callback(res); // Return dats\n            })\n            .fail((msg) => {\n                console.log(msg);\n            }); // Failure message\n    }\n\n    GetAudioFromID(\n        id,\n        callback // GET AUDIO FILE FROM ID\n    ) {\n        $.getJSON(\n            '//terms.kmaps.virginia.edu/slices/' + id + '/recordings',\n            (d) => {\n                // Get info\n                let i,\n                    r = [];\n                try {\n                    for (\n                        i = 0;\n                        i < d.recordings.length;\n                        ++i // For each recording\n                    )\n                        r.push(d.recordings[i].audio_file); // Add to array\n                    callback(r);\n                } catch (e) {} // Return audio file urls as array\n            }\n        ).fail((msg) => {\n            console.log(msg);\n        }); // Failure message\n    }\n\n    GetJSONFromKmap(\n        kmap,\n        callback // GET JSON FROM KMAP\n    ) {\n        var url = kmap.url_json; // Get json\n        if (!url) return; // No asset type\n        url = url.replace(\n            /images.shanti.virginia.edu/i,\n            'images-dev.shanti.virginia.edu'\n        ); // Look in dev\n        url = url.replace(/https:|http:/i, ''); // Strip off http\n        url += '?callback=myfunc'; // Add callback\n        if (kmap.asset_type == 'audio-video' || kmap.subcollection_uid_ss)\n            // AV or collection\n            url = url.replace(/.json/i, '.jsonp'); // Json to jsonp\n        $.ajax({\n            url: url,\n            dataType: 'jsonp',\n            error: (xhr) => {\n                this.Popup('JSON access error');\n            },\n        }).done((data) => {\n            callback(data);\n        }); // Get JSON and send to callback\n    }\n\n    MassageKmapData(\n        data // MASSAGE KMAP RESPONSE FOR DISPLAY\n    ) {\n        var i, o;\n        for (i = 0; i < data.length; ++i) {\n            // For each result, massage data\n            o = data[i]; // Point at item\n            if (o.asset_subtype)\n                o.asset_subtype =\n                    o.asset_subtype.charAt(0).toUpperCase() +\n                    o.asset_subtype.slice(1);\n            if (o.url_thumb)\n                o.url_thumb = o.url_thumb.replace(/images-test/i, 'images'); // Force to prod\n            if (o.asset_type == 'places') {\n                // If places\n                if (o.ancestors_txt && o.ancestors_txt.length)\n                    o.ancestors_txt.splice(0, 1); // Remove \"Earth\" from trail\n                if (o.ancestor_ids_is && o.ancestor_ids_is.length)\n                    o.ancestor_ids_is.splice(0, 1); // And it's id\n            }\n            if (o.asset_type == 'texts') o.url_thumb = 'gradient.jpg';\n            // Use gradient for texts\n            else if (!o.url_thumb) o.url_thumb = 'gradient.jpg'; // Use gradient for generic\n            if (o.display_label) o.title = o.display_label; // Get title form display\n        }\n        return data;\n    }\n\n    ParseFacetData(\n        data // GET FACET COUNTS\n    ) {\n        let i,\n            f,\n            val,\n            buckets,\n            n = 0;\n        for (f in this.assets) this.assets[f].n = 0; // Zero them out\n        if (\n            data &&\n            data.facets &&\n            data.facets.asset_counts &&\n            data.facets.asset_counts.buckets\n        ) {\n            // If valid\n            buckets = data.facets.asset_counts.buckets; // Point at buckets\n            for (i = 0; i < buckets.length; ++i) {\n                // For each bucket\n                val = buckets[i].val; // Get name\n                if (this.assets[val]) this.assets[val].n = buckets[i].count; // Set count\n                n += buckets[i].count; // Add to count\n            }\n            this.ss.numResults = this.assets.all.n = n; // Set total count\n        }\n    }\n\n    QueryFacets(\n        facet,\n        filter // QUERY AND UPDATE FACET OPTIONS\n    ) {\n        if (facet == 'users' || facet == 'relationships') return; // No facets for these\n        this.LoadingIcon(true, 64); // Show loading icon\n        let url = this.solrUtil.createBasicQuery(this.ss, [\n            facet == 'assets' ? 'languages' : facet,\n        ]); // Get query url (avoid assets)\n        $.ajax({ url: url, dataType: 'jsonp', jsonp: 'json.wrf' }).done(\n            (data) => {\n                // Get facets\n                let i, o, v;\n                this.LoadingIcon(false); // Hide loading icon\n                if (data.facets[facet]) {\n                    // If something there\n                    o = data.facets[facet].buckets; // Point at data\n                    this.facets[facet].data = []; // Start fresh\n                    for (i = 0; i < Math.min(300, o.length); ++i) {\n                        // Get items\n                        v = o[i].val.split('|'); // Split into parts\n                        this.facets[facet].data.push({\n                            title: v[0],\n                            id: v[1],\n                            n: o[i].count,\n                        }); // Add to assets data\n                    }\n                }\n                this.ResetFacetList(facet); // Reset list UI elements\n            }\n        );\n    }\n\n    /*\tRESULTS ///////////////////////////////////////////////////////////////////////////////////////\n\n\tShow results based on the state of the search state object ss. When a Query() is run, 100\n\tresults are paged at a time and shown in one of 3 display modes. A list mode, a full card mode,\n\tand a grid image mode.\n\n///////////////////////////////////////////////////////////////////////////////////////////////  */\n\n    DrawResults(\n        noRefresh // DRAW RESULTS SECTION\n    ) {\n        this.log('DrawResults() called', arguments);\n\n        $('#c-columnContent__main').scrollTop(0);\n        $('#sui-legacy').scrollTop(0); // Scroll to top\n        $('#sui-legacy').css({ 'background-image': '' }); // Remove any backgeound image\n        $('#sui-legacy').css({ display: 'block' }); // Show results page\n        $('#plc-infoDiv').remove(); // Remove map buttons\n\n        if (this.ss.mode == 'related')\n            this.numItems = this.assets[this.pages.relatedType].n;\n        // Set number of items based on related type\n        else this.numItems = this.assets[this.ss.query.assets[0].id].n; // Set number of items based on current asset being shown  ***ASSETS1\n        if (this.ss.mode == 'input') {\n            // Just the search box\n            $('#sui-header').css({ display: 'none' }); // Show header\n            $('#sui-header').css({\n                display: 'inline-block',\n                'background-color': '#4d59ca',\n            }); // Show header\n            $('#sui-content').css({ display: 'block', width: '100%' }); // Size and show left side\n\n            $('#sui-adv').css({ display: 'none' }); // Hide search ui\n            $('#sui-legacy').css({ display: 'none' }); // Hide results page\n            return; // Quit\n        } else if (this.ss.mode == 'simple') {\n            // Simple search\n            $('#sui-content').css({ width: '100%' }); // Size and show results area\n            $('#sui-adv').css({ display: 'none' }); // Hide search ui\n            $('#sui-content').slideDown(); // Slide down\n            $('#sui-content').css({ width: $('#l-site__wrap').width() }); // Size and results area 100%\n        } else if (this.ss.mode == 'advanced') {\n            // Advanced search\n            $('#sui-adv').css({ display: 'block' }); // Show search ui\n            $('#sui-content').css({\n                width: $('#l-site__wrap').width() - $('#sui-adv').width(),\n            }); // Size results area to fit advanced\n        }\n        $('#sui-mode').prop({\n            title:\n                this.ss.mode == 'advanced' ? 'Basic search' : 'Advanced search',\n        }); // Set tooltip\n        $('#sui-mode').html(\n            this.ss.mode == 'advanced'\n                ? 'BASIC<br>SEARCH'\n                : 'ADVANCED<br>SEARCH'\n        ); // Set mode icon\n        $('#sui-header').css({ display: 'block' }); // Show header\n        if (noRefresh) return; // Don't refresh page\n        this.DrawHeader(); // Draw header\n        this.DrawItems(); // Draw items\n        this.DrawFooter(); // Draw footer\n    }\n\n    DrawHeader() {\n        // DRAW RESULTS HEADER\n        // alert(\"pages.DrawHeader called()\");\n        //console.log(\"pages.Drawheader called!\");\n        if (this.ss.mode == 'related') return; // Quit for special search modes\n        var lastPage = Math.floor(this.numItems / this.ss.pageSize); // Calc last page\n        var s = this.ss.page * this.ss.pageSize + 1; // Starting item number\n        var e = Math.min(s + this.ss.pageSize, this.numItems); // Ending number\n        var str = `<span style='vertical-align:-10px'>${this.ss.query.assets[0].title.toUpperCase()} search results &nbsp; <span style='font-size:12px'> (${s}-${e}) of ${\n            this.numItems\n        }\t\n\t\t<div style='float:right;font-size:11px;margin:12px -48px 0 0'>\n\t\t\t<div id='sui-page1T' class='sui-resDisplay' title='Go to first page'>&#xe63c</div>\n\t\t\t<div id='sui-pagePT' class='sui-resDisplay' title='Go to previous page'>&#xe63f</div>\n\t\t\t<div class='sui-resDisplay'> PAGE <input type='text' id='sui-typePageT' \n\t\t\tstyle='border:0;border-radius:4px;width:30px;text-align:center;vertical-align:1px;font-size:10px;padding:2px'\n\t\t\ttitle='Enter page, then press Return'> OF ${lastPage + 1}</div>\n\t\t\t<div id='sui-pageNT' class='sui-resDisplay' title='Go to next page'>&#xe63e</div>\n\t\t\t<div id='sui-pageLT' class='sui-resDisplay' title='Go to last page'>&#xe63d</div>\n\t\t\t</div>`;\n\n        $('#c-content__header__main').html(str.replace(/\\t|\\n|\\r/g, '')); // Remove format and add to div\n        $('#sui-header').css('background-color', '#888'); // Set b/g color\n\n        $('#sui-typePageT').val(this.ss.page + 1); // Set page number\n        $('[id^=sui-page]').css('color', '#fff'); // Reset pagers\n        if (this.ss.page == 0) {\n            $('#sui-page1T').css('color', '#ddd');\n            $('#sui-pagePT').css('color', '#ddd');\n        } // No back\n        if (this.ss.page == lastPage) {\n            $('#sui-pageNT').css('color', '#ddd');\n            $('#sui-pageLT').css('color', '#ddd');\n        } // No forward\n        $('#sui-page1T').on('click', () => {\n            this.ss.page = 0;\n            this.Query();\n        }); // ON FIRST CLICK\n        $('#sui-pagePT').on('click', () => {\n            this.ss.page = Math.max(this.ss.page - 1, 0);\n            this.Query();\n        }); // ON PREVIOUS CLICK\n        $('#sui-pageNT').on('click', () => {\n            this.ss.page = Math.min(this.ss.page + 1, lastPage);\n            this.Query();\n        }); // ON NEXT CLICK\n        $('#sui-pageLT').on('click', () => {\n            this.ss.page = lastPage;\n            this.Query();\n        }); // ON LAST CLICK\n        $('#sui-typePageT').on('change', () => {\n            // ON TYPE PAGE\n            var p = $('#sui-typePageT').val(); // Get value\n            if (!isNaN(p))\n                this.ss.page = Math.max(Math.min(p - 1, lastPage), 0); // If a number, cap 0-last\n            this.Query(); // Get new results\n        });\n    }\n\n    DrawFooter() {\n        // DRAW RESULTS FOOTER\n        var lastPage = Math.floor(this.numItems / this.ss.pageSize); // Calc last page\n        if (this.ss.mode != 'related')\n            $('#sui-footer').css('background-color', '#888'); // Set b/g color\n        var str = `\n\t\t<div style='float:left;font-size:18px'>\n\t\t\t<div id='sui-viewModeList' class='sui-resDisplay' title='List view'>&#xe61f</div>\n\t\t\t<div id='sui-viewModeGrid' class='sui-resDisplay' title='Grid view'>&#xe61b</div>\n\t\t\t<div id='sui-viewModeCard' class='sui-resDisplay' title='Card view'>&#xe673</div>\n\t\t</div>\t\n\t\t<div style='display:inline-block;font-size:11px'>\n\t\t\t<div id='sui-page1' class='sui-resDisplay' title='Go to first page'>&#xe63c</div>\n\t\t\t<div id='sui-pageP' class='sui-resDisplay' title='Go to previous page'>&#xe63f</div>\n\t\t\t<div class='sui-resDisplay'> PAGE <input type='text' id='sui-typePage' \n\t\t\tstyle='border:0;border-radius:4px;width:30px;text-align:center;vertical-align:1px;font-size:10px;padding:2px'\n\t\t\ttitle='Enter page, then press Return'> OF ${lastPage + 1}</div>\n\t\t\t<div id='sui-pageN' class='sui-resDisplay' title='Go to next page'>&#xe63e</div>\n\t\t\t<div id='sui-pageL' class='sui-resDisplay' title='Go to last page'>&#xe63d</div>\n\t\t\t</div>\t\n\t\t<div style='float:right;font-size:16px;'>\n\t\t\t<div id='sui-viewSortAlpha' class='sui-resDisplay' title='Sort alphabetically'>&#xe652</div>\n\t\t\t<div id='sui-viewSortDate'  class='sui-resDisplay' title='Sort by date'>&#xe60c</div>\n\t\t\t<div id='sui-viewSortAuthor' class='sui-resDisplay' title='Sort by author'>&#xe600</div>\n\t\t\t</div>`;\n        $('#sui-footer').html(str.replace(/\\t|\\n|\\r/g, '')); // Remove format and add to div\n\n        $('#sui-typePage').val(this.ss.page + 1); // Set page number\n        $('[id^=sui-viewMode]').css('color', '#ddd'); // Reset modes\n        $('#sui-viewMode' + this.ss.view).css('color', '#fff'); // Highlight current mode\n        $('[id^=sui-viewMode]').on('click', (e) => {\n            // ON MODE CLICK\n            this.ss.view = e.currentTarget.id.substring(12); // Get/set mode name\n            this.DrawResults(); // Redraw\n        });\n\n        $('[id^=sui-viewSort]').css('color', '#ddd'); // Reset modes\n        $('#sui-viewSort' + this.ss.sort).css('color', '#fff'); // Highlight current mode\n        $('[id^=sui-viewSort]').on('click', (e) => {\n            // ON SORT CLICK\n            this.ss.sort = e.currentTarget.id.substring(12); // Get/set mode name\n            if (this.ss.sort == 'Alpha')\n                // Alpha sort\n                this.curResults.sort(function (a, b) {\n                    // Sort by title\n                    if (a.title[0] > b.title[0]) return 1;\n                    // Higher\n                    else if (a.title[0] < b.title[0]) return -1;\n                    // Lower\n                    else return 0; // The same\n                });\n            else if (this.ss.sort == 'Date')\n                // Date sort\n                this.curResults.sort(function (a, b) {\n                    // Sort by date\n                    if (a.timestamp > b.timestamp) return 1;\n                    // Higher\n                    else if (a.timestamp < b.timestamp) return -1;\n                    // Lower\n                    else return 0; // The same\n                });\n            else if (this.ss.sort == 'Author')\n                // User sort\n                this.curResults.sort(function (a, b) {\n                    // Sort by user\n                    if (a.node_user > b.node_user) return 1;\n                    // Higher\n                    else if (a.node_user < b.node_user) return -1;\n                    // Lower\n                    else return 0; // The same\n                });\n            this.DrawResults(); // Redraw\n        });\n\n        $('[id^=sui-page]').css('color', '#fff'); // Reset pagers\n        if (this.ss.page == 0) {\n            $('#sui-page1').css('color', '#ddd');\n            $('#sui-pageP').css('color', '#ddd');\n        } // No back\n        if (this.ss.page == lastPage) {\n            $('#sui-pageN').css('color', '#ddd');\n            $('#sui-pageL').css('color', '#ddd');\n        } // No forward\n        $('#sui-page1').on('click', () => {\n            this.ss.page = 0;\n            this.Query();\n        }); // ON FIRST CLICK\n        $('#sui-pageP').on('click', () => {\n            this.ss.page = Math.max(this.ss.page - 1, 0);\n            this.Query();\n        }); // ON PREVIOUS CLICK\n        $('#sui-pageN').on('click', () => {\n            this.ss.page = Math.min(this.ss.page + 1, lastPage);\n            this.Query();\n        }); // ON NEXT CLICK\n        $('#sui-pageL').on('click', () => {\n            this.ss.page = lastPage;\n            this.Query();\n        }); // ON LAST CLICK\n        $('#sui-typePage').on('change', () => {\n            // ON TYPE PAGE\n            var p = $('#sui-typePage').val(); // Get value\n            if (!isNaN(p))\n                this.ss.page = Math.max(Math.min(p - 1, lastPage), 0); // If a number, cap 0-last\n            this.Query(); // Get new results\n        });\n    }\n\n    // CALLS DrawCardItem(), DrawGridItem() or DrawListItem()\n    // CALLS this.pages.DrawRelatedAssets()\n\n    DrawItems() {\n        // DRAW RESULT ITEMS\n        //console.log(\"SearchUI.DrawItems()\");\n        var i,\n            str = '';\n        $('#sui-legacy').css({\n            'background-color': this.ss.view == 'List' ? '#fff' : '#ddd',\n        }); // White b/g for list only\n        if (this.ss.mode == 'related')\n            $('#sui-legacy').css({\n                'padding-left': '204px',\n                width: 'calc(100% - 216px',\n            });\n        // Shrink page\n        else\n            $('#sui-legacy').css({\n                'padding-left': '12px',\n                width: 'calc(100% - 24px',\n            }); // Reset to normal size\n\n        for (i = 0; i < this.curResults.length; ++i) {\n            // For each result\n            if (this.ss.view == 'Card') str += this.DrawCardItem(i);\n            // Draw if shoing as cards\n            else if (this.ss.view == 'Grid') str += this.DrawGridItem(i);\n            // Grid\n            else str += this.DrawListItem(i); // List\n        }\n        if (!this.curResults.length)\n            // No results\n            str =\n                \"<br><br><br><div style='text-align:center;color:#666'>Sorry, there were no items found<br>Try broadening your search</div>\";\n\n        // OUTPUT\n        $('#sui-legacy').html(str.replace(/\\t|\\n|\\r/g, '')); // Remove format and add to div\n\n        // CALL\n        if (this.ss.mode == 'related') this.pages.DrawRelatedAssets(); // Draw related assets menu\n\n        // HANDLERS\n        $('.sui-itemIcon').on('click', (e) => {\n            // ON ICON BUTTON CLICK\n            var num = e.currentTarget.id.substring(13); // Get index of result\n            if (e.originalEvent.metaKey)\n                window.open('#p=' + this.curResults[num].uid, '_blank');\n            // Open in new window\n            else\n                this.SendMessage(\n                    'page=' + this.curResults[num].url_html,\n                    this.curResults[num]\n                ); // Send message\n            return false; // Stop propagation\n        });\n        $('[id^=sui-itemPic-]').on('click', (e) => {\n            // ON ITEM CLICK\n            var num = e.currentTarget.id.substring(12); // Get index of result\n            if (e.originalEvent.metaKey)\n                window.open('#p=' + this.curResults[num].uid, '_blank');\n            // Open in new window\n            else\n                this.SendMessage(\n                    'page=' + this.curResults[num].url_html,\n                    this.curResults[num]\n                ); // Send message\n            return false; // Stop propagation\n        });\n        $('.sui-gridInfo').on('mouseover', (e) => {\n            // ON INFO BUTTON HOVER\n            var num = e.currentTarget.id.substring(13); // Get index of result\n            var o = this.curResults[num]; // Point at item\n            var str = '';\n            if (o.title) str += '<strong>' + o.title + '</strong><br><br>'; // Add title\n            str +=\n                this.assets[o.asset_type].g +\n                '&nbsp;&nbsp;' +\n                o.asset_type.toUpperCase(); // Add type\n            if (o.asset_subtype) str += ' / ' + o.asset_subtype; // Add subtype\n            str += '<br>';\n            if (o.creator)\n                str += '<p>&#xe600&nbsp;&nbsp;' + o.creator.join(', ') + '</p>'; // Add creator\n            if (o.summary || o.caption) {\n                // If a summary or caption\n                var s1 = o.summary || o.caption; // Use either summary or caption\n                if (s1.length > 80) s1 = s1.substr(0, 80) + '...'; // Limit size\n                str +=\n                    \"<p><div style='display:inline-block;background-color:#ccc;width:4px;height:18px;margin:2px 10px 0 5px;vertical-align:-4px'></div>&nbsp;<i>\" +\n                    s1 +\n                    '</i></p>'; // Add summary\n            }\n            if (o.summary)\n                str += \"<p style='font-family:serif;'>\" + o.summary + '</p>'; // Add summary\n            var p = $('#' + e.currentTarget.id).offset(); // Get position\n            this.Popup(str, 20, Math.max(8, p.left - 220), p.top + 24); // Show popup\n        });\n        $('.sui-gridInfo').on('mouseout', (e) => {\n            $('#sui-popupDiv').remove();\n        }); // ON INFO BUTTON OUT\n        $('[id^=sui-itemTitle-]').on('click', (e) => {\n            // ON TITLE CLICK\n            var num = e.currentTarget.id.substring(14); // Get index of result\n            if (e.originalEvent.metaKey)\n                window.open('#p=' + this.curResults[num].uid, '_blank');\n            // Open in new window\n            else\n                this.SendMessage(\n                    'page=' + this.curResults[num].url_html,\n                    this.curResults[num]\n                ); // Send message\n            return false; // Stop propagation\n        });\n        $('.sui-itemPlus').on('click', (e) => {\n            // ON MORE BUTTON CLICK\n            this.ShowItemMore(e.currentTarget.id.substring(13)); // Show more info below\n        });\n    }\n\n    // NO SIDE EFFECTS\n    // PASSED FROM CONTEXT:  this.curResults\n    DrawListItem(\n        num // DRAW A LIST ITEM\n    ) {\n        var i;\n        var o = this.curResults[num]; // Point at list item\n        var str = \"<div class='sui-item'>\";\n        str +=\n            \"<div class='sui-itemPlus' id='sui-itemPlus-\" +\n            num +\n            \"'>&#xe669</div>\";\n        str +=\n            \"<div class='sui-itemIcon' id='sui-itemIcon-\" +\n            num +\n            \"' style='background-color:\" +\n            this.assets[o.asset_type].c +\n            \"'>\";\n        str +=\n            \"<a class='sui-noA' href='#p=\" +\n            o.uid +\n            \"'><span style='color:#fff'>\" +\n            this.assets[o.asset_type].g +\n            '</span></a></div>'; // Add href for right click\n        str += \"<div class='sui-itemTitle' id='sui-itemTitle-\" + num + \"'>\"; // Add\n        str +=\n            \"<a class='sui-noA' href='#p=\" +\n            o.uid +\n            \"'>\" +\n            o.title +\n            '</a></div>'; // Add href for right click\n        if (o.feature_types_ss) {\n            // If a feature\n            str +=\n                \"<span style='color:\" +\n                this.assets[o.asset_type].c +\n                \"'>&nbsp;&bull;&nbsp;</span>\"; // Add dot\n            str +=\n                \"<div class='sui-itemFeature'>&nbsp;\" +\n                o.feature_types_ss.join(', ') +\n                '</div>'; // Add feature(s)\n        }\n        str += \"<div class='sui-itemId'>\" + o.uid;\n        if (o.collection_title)\n            // If a collection\n            str +=\n                \"<div style='text-align:right;margin-top:2px;'>&#xe633&nbsp;\" +\n                o.collection_title +\n                '</div>'; // Add title\n        str += '</div>'; // Close title div\n        if (o.ancestors_txt && o.ancestors_txt.length > 1) {\n            // If has an ancestors trail\n            str += \"<div class='sui-itemTrail'>\"; // Holds trail\n            for (i = 0; i < o.ancestors_txt.length; ++i) {\n                // For each trail member\n                str +=\n                    \"<span class='sui-itemAncestor' onclick='sui.SendMessage(\\\"page=\"; // Add ancestor\n                str +=\n                    'https://mandala.shanti.virginia.edu/' + o.asset_type + '/'; // URL stem\n                str +=\n                    o.ancestor_ids_is[i + 1] +\n                    '/overview/nojs#search,' +\n                    this.curResults[num] +\n                    \")'>\"; // URL end\n                str +=\n                    \"<a href='#p=\" +\n                    o.uid +\n                    \"'>\" +\n                    o.ancestors_txt[i] +\n                    '</a></span>'; // Add href for right click\n                if (i < o.ancestors_txt.length - 1) str += ' > '; // Add separator\n            }\n            str += '</div>'; // Close trail div\n        }\n        str += \"<div class='sui-itemMore' id='sui-itemMore-\" + num + \"'></div>\"; // More area\n        return str + '</div>'; // Return items markup\n    }\n\n    // MORE EXPANDER\n    ShowItemMore(\n        num // SHOW MORE INFO\n    ) {\n        var j,\n            o,\n            s1,\n            str = '';\n        if ($('#sui-itemMore-' + num).html()) {\n            // If open\n            $('#sui-itemMore-' + num).slideUp(400, () => {\n                $('#sui-itemMore-' + num).html('');\n            }); // Close it and clear\n            return; // Quit\n        }\n\n        o = this.curResults[num]; // Point at item\n        if (!o.url_thumb.match(/gradient.jpg/))\n            // If not a generic\n            str +=\n                \"<img src='\" +\n                o.url_thumb +\n                \"' class='sui-itemPic' id='sui-itemPic-\" +\n                num +\n                \"'>\"; // Add pic\n        str += \"<div class='sui-itemInfo'>\"; // Info holder\n        str +=\n            this.assets[o.asset_type].g +\n            '&nbsp;&nbsp;' +\n            o.asset_type.toUpperCase(); // Add type\n        if (o.asset_subtype) str += ' / ' + o.asset_subtype; // Add subtype\n        if (o.creator) str += '<br>&#xe600&nbsp;&nbsp;' + o.creator.join(', '); // Add creator\n        if (o.summary || o.caption) {\n            // If a summary or caption\n            s1 = o.summary || o.caption; // Use either summary or caption\n            if (s1.length > 137) s1 = s1.substr(0, 137) + '...'; // Limit size\n            str +=\n                \"<br><div style='display:inline-block;background-color:#ccc;width:4px;height:18px;margin:2px 10px 0 5px;vertical-align:-4px'></div>&nbsp;<i>\" +\n                s1 +\n                '</i>'; // Add summary\n        }\n        str += '</div>'; // Close info div\n        if (o.summary)\n            str += \"<br><div style='font-family:serif'>\" + o.summary + '</div>'; // Add summary\n        if (o.kmapid_strict && o.kmapid_strict.length) {\n            // Add related places/subjects\n            var places = [],\n                subjects = [];\n            str += \"<div style='margin-bottom:12px'>\"; // Related places and subjects container\n            for (j = 0; j < o.kmapid_strict.length; ++j) {\n                // For each item\n                if (o.kmapid_strict[j].match(/subjects/i)) subjects.push(j);\n                // Add to subjects\n                else if (o.kmapid_strict[j].match(/places/i)) places.push(j); // Add to places\n            }\n            str +=\n                \"<div style='float:left;min-width:200px;'><span style='color:\" +\n                this.assets.places.c +\n                \"'>\";\n            str +=\n                '<br><strong>' +\n                this.assets.places.g +\n                '</strong></span>&nbsp;RELATED PLACES'; // Add header\n            if (places.length) {\n                // If any places\n                for (j = 0; j < places.length; ++j) {\n                    // For each place\n                    str += '<br>';\n                    if (o.kmapid_strict_ss)\n                        // If has names\n                        str +=\n                            \"<span class='sui-itemRelated'>\" +\n                            o.kmapid_strict_ss[places[j]] +\n                            '</span>'; // Add place name\n                    str +=\n                        \"&nbsp;<span style='font-size:10px;margin-right:40px'>(\" +\n                        o.kmapid_strict[places[j]] +\n                        ')</span>'; // Add place id\n                }\n            }\n            str += '</div>'; // End places div\n\n            str +=\n                \"<div><span style='display:inline-block;color:\" +\n                this.assets.subjects.c +\n                \"'>\";\n            str +=\n                '<br><strong>' +\n                this.assets.subjects.g +\n                '</strong></span>&nbsp;RELATED SUBJECTS'; // Add header\n            if (subjects.length) {\n                // If any subjects\n                for (j = 0; j < subjects.length; ++j) {\n                    // For each subject\n                    str += '<br>';\n                    if (o.kmapid_strict_ss)\n                        // If has names\n                        str +=\n                            \"<span class='sui-itemRelated'>\" +\n                            o.kmapid_strict_ss[subjects[j]] +\n                            '</span>'; // Add place name\n                    str +=\n                        \"&nbsp;<span style='font-size:10px'>(\" +\n                        o.kmapid_strict[subjects[j]] +\n                        ')</span>'; // Add place id\n                }\n            }\n            str += '</div></div>'; // End subjects and relateds div\n        }\n        $('#sui-itemMore-' + num).html(str); // Add to div\n\n        $('#sui-itemMore-' + num).slideDown(); // Slide it down\n        $('[id^=sui-itemPic]').on('click', (e) => {\n            // ON PIC CLICK\n            var num = e.currentTarget.id.substring(12); // Get index of result\n            this.SendMessage(\n                'page=' + this.curResults[num].url_html,\n                this.curResults[num]\n            ); // Send message\n        });\n    }\n\n    // NO SIDE EFFECTS\n    // PASSED FROM CONTEXT this.curResults\n    DrawGridItem(\n        num // DRAW GRID ITEM\n    ) {\n        var str = \"<div class='sui-grid'>\";\n        var o = this.curResults[num]; // Point at item\n        str += \"<a href='#p=\" + o.uid + \"'>\"; // Add href for right click\n        str +=\n            \"<img src='\" +\n            o.url_thumb +\n            \"' class='sui-gridPic' id='sui-itemPic-\" +\n            num +\n            \"'></a>\"; // Add pic\n        if (o.url_thumb.match(/gradient.jpg/)) {\n            // If a generic\n            str += `<div class='sui-gridGlyph' style='color:${\n                this.assets[o.asset_type].c\n            }'>\n\t\t\t ${this.assets[o.asset_type].g}\n\t\t\t <p style='font-size:12px;margin-top:0'>${o.title}</p>\n\t\t\t </div>`;\n        }\n        str +=\n            \"<div id='sui-gridInfo-\" +\n            num +\n            \"' class='sui-gridInfo'>&#xe67f</div>\"; // Add info button\n        return str + '</div>'; // Return grid markup\n    }\n\n    // NO SIDE EFFECTS\n    // PASSED FROM CONTEXT:   this.curResults\n    DrawCardItem(\n        num // DRAW CARD ITEM\n    ) {\n        let i,\n            o = this.curResults[num]; // Point at item\n        let g = '&#xe633'; // Collections glyph\n        let c = '#9e894d'; // Color\n        let label = o.collection_title; // Set label\n        let str = \"<div class='sui-card'>\"; // Overall container\n        str +=\n            \"<div style='width:100%;height:100px;overflow:hidden;display:inline-block;margin:0;padding:0'>\"; // Div container\n        str += \"<a href='#p=\" + o.uid + \"'>\"; // Add href for right click\n        str +=\n            \"<img src='\" +\n            o.url_thumb +\n            \"' class='sui-cardPic' id='sui-itemPic-\" +\n            num +\n            \"'></a></div>\"; // Add pic\n        var gg = this.assets[o.asset_type].g; // Assume generic icon\n        if (o.asset_subtype == 'Audio') gg = '&#xe60a';\n        // Audio\n        else if (o.asset_subtype == 'Video') gg = '&#xe62d'; // Video\n        str += \"<div class='sui-cardType'>\" + gg + '</div>'; // Show icon\n        if (o.url_thumb.match(/gradient.jpg/))\n            // If a generic\n            str += `<div class='sui-cardGlyph' style='color:${\n                this.assets[o.asset_type].c\n            }'>${this.assets[o.asset_type].g}</div>`;\n        str +=\n            \"<div class='sui-cardInfo'><div class='sui-cardTitle' id='sui-itemTitle-\" +\n            num +\n            \"'\";\n        if (o.ancestors_txt && o.ancestors_txt.length > 2)\n            str += \"title='\" + o.ancestors_txt.join('/') + \"'\"; // Add tooltip showing path\n        str += '><strong>' + o.title + '</strong><br></div>'; // Add title\n        str +=\n            \"<div style='border-top:.5px solid \" +\n            c +\n            \";height:1px;width:100%;margin:6px 0 6px 0'></div>\"; // Dividing line\n        if (o.ancestors_txt && o.ancestors_txt.length > 1) {\n            // If has an ancestors trail\n            str += '&#xe638&nbsp;&nbsp;' + o.ancestors_txt[0] + '/...<br>'; // Add start\n            str +=\n                '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.../' +\n                o.ancestors_txt[o.ancestors_txt.length - 2] +\n                '<br>'; // Add antecedant\n        }\n        if (o.feature_types_ss)\n            str +=\n                '&#xe62b&nbsp;&nbsp;' + o.feature_types_ss.join(', ') + '<br>'; // Add feature, if a place\n        if (o.data_phoneme_ss)\n            str +=\n                '&#xe635&nbsp;&nbsp;' + o.data_phoneme_ss.join(', ') + '<br>'; // Add phoneme if a term\n        if (o.creator) str += '&#xe600&nbsp;&nbsp;' + o.creator[0] + '<br>'; // Add creator\n        if (o.duration_s) str += '&#xe61c&nbsp;&nbsp;' + o.duration_s + '<br>'; // Add duration\n        if (o.timestamp)\n            str += '&#xe60c&nbsp;&nbsp;' + o.timestamp.substr(0, 10) + '<br>'; // Add timestamp\n        if (o.name_tibt) str += '=&nbsp;&nbsp;' + o.name_tibt + '<br>'; // Add Tibettan name\n        str += '</div>'; // End info div\n        if (!label) {\n            label = o.asset_type;\n            g = this.assets[o.asset_type].g;\n        } // Generic label if no collection\n        str +=\n            \"<div class='sui-cardFooter' style='background-color:\" +\n            c +\n            \"'>\" +\n            g +\n            '&nbsp;&nbsp;'; // Card footer\n        str +=\n            \"<span style='font-size:11px;vertical-align:2px'>\" +\n            label +\n            '<span></div>'; // Add label\n        return str + '</div>'; // Return items markup\n    }\n\n    /*\tADVANCED SEARCH //////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////////////////////  */\n\n    DrawAdvanced() {\n        // DRAW SEARCH UI SECTION\n        this.log('searchui.DrawAdvanced() short circuit');\n        return; // short circuit\n\n        let i, o, str;\n        let _this = this;\n        if (this.noTop)\n            $('#sui-adv').css({ top: 0, height: 'calc(100% - 50px)' }); // Scale to fit\n        for (let key in this.facets) {\n            // For each facet\n            if ($('#sui-advEdit-' + key).css('display') == 'block') {\n                // Refresh list results if open\n                this.DrawFacetItems(key, true); // Draw proper facets menu\n                this.QueryFacets(key); // Fill facet data\n            }\n            $('#sui-advTerm-' + key).empty(); // Clear list\n            for (i = 0; i < this.ss.query[key].length; ++i) {\n                // For each term in facet\n                o = sui.ss.query[key][i]; // Point at facet to add to div\n                str = `<div><div class='sui-advTermRem' id='sui-advKill-${key}-${i}'>&#xe60f</div>`;\n                if (this.showBool)\n                    str += `<div class='sui-advEditBool' id='sui-advBool-${key}-${i}' title='Change boolean method'>${\n                        this[o.bool]\n                    }&#xe642</div>`;\n                str += `<i> &nbsp;${o.title}</i></div>`;\n                if (key == 'assets')\n                    $('#sui-advTerm-' + key).html(\n                        `<span style='color:${this.assets[o.id].c}'>${\n                            this.assets[o.id].g\n                        } </span><i> &nbsp;${o.title}</i>`\n                    );\n                else $('#sui-advTerm-' + key).append(str); // Add term\n            }\n        }\n\n        $('[id^=sui-advBool-]').on('mouseenter', function (e) {\n            // ON BOOLEAN HOVER\n            let v = e.currentTarget.id.split('-'); // Get ids\n            let str = `<div class='sui-boolItem' id='sui-boolItem-${v[2]}-${v[3]}-AND'>AND</div>|\t\t\t\n\t\t\t\t<div class='sui-boolItem' id='sui-boolItem-${v[2]}-${v[3]}-OR'>OR</div>|\t\t\t\t\t\n\t\t\t\t<div class='sui-boolItem' id='sui-boolItem-${v[2]}-${v[3]}-NOT'>NOT</div>&nbsp;`; // Add options\n            $(this).html(str.replace(/\\t|\\n|\\r/g, '')); // Set new value\n\n            $('.sui-boolItem').on('click', (e) => {\n                // ON CLICK\n                let v = e.currentTarget.id.split('-'); // Get ids\n                $('#' + e.currentTarget.id).html(_this[v[4]] + '&#xe642'); // Set new value\n                _this.ss.query[v[2]][v[3]].bool = v[4]; // Set state\n                $(this).html(_this[v[4]] + '&#xe642'); // Set new value\n                _this.Query(); // Run query and show results\n            });\n        });\n\n        $('[id^=sui-advBool-]').on('mouseleave', function (e) {\n            // ON BOOLEAN OUT\n            let v = e.currentTarget.id.split('-'); // Get ids\n            let b = _this.ss.query[v[2]][v[3]].bool; // Get current boolean state\n            $(this).html(_this[b] + '&#xe642'); // Set new value\n        });\n\n        $('[id^=sui-advKill-]').on('click', (e) => {\n            // REMOVE ITEM FROM QUERY\n            let v = e.currentTarget.id.split('-'); // Get ids\n            this.ss.query[v[2]].splice(v[3], 1); // Remove\n            this.DrawAdvanced(); // Redraw\n            this.Query(); // Run query and show results\n        });\n    }\n\n    DrawFacetItems(\n        facet,\n        open // DRAW FACETS ITEMS\n    ) {\n        if (facet == 'assets' && !this.curResults) this.Query(); // If no results, run query\n        if (facet == 'recent') this.RecentSearches();\n        // Show recent searches\n        else if (this.facets[facet].type == 'input')\n            this.DrawInput(facet, open);\n        // Draw input editor\n        else if (this.facets[facet].type == 'tree') {\n            // If base type is a tree\n            if (this.ActiveSearch()) this.DrawFacetList(facet, open);\n            // If an active search, draw tree as a list\n            else this.DrawFacetTree(facet, open); // Draw tree as a tree\n        } else this.DrawFacetList(facet, open); // Draw list editor\n    }\n\n    ActiveSearch(\n        ignoreText // IS THERE AN ACTIVE SEARCH?\n    ) {\n        let key,\n            activeSearch = false; // Assume no active search happening\n        if (this.ss.query.text.length && !ignoreText) activeSearch = true; // Flag if something set in text\n        for (key in this.facets) // For each facet\n            if (this.ss.query[key].length && key != 'assets')\n                activeSearch = true; // Flag if something set\n        return activeSearch;\n    }\n\n    // SIDE EFFECTS\n    DrawInput(\n        facet // DRAW INPUT FACET PICKER\n    ) {\n        if ($('#sui-advEdit-' + facet).css('display') != 'none') {\n            // If open\n            $('#sui-advEdit-' + facet).slideUp(); // Close it\n            return;\n        }\n        var tot = 934;\n        this.facets[facet].mode = 'input'; // Input mode active\n        var str = `<input id='sui-advInput-${facet}' placeholder='Type here'  \n\t\tstyle='width:90px;border:1px solid #999;border-radius:12px;font-size:11px;padding-left:6px'>\n\t\t<div class='sui-advEditNums'> <span id='sui-advListNum'>${tot}</span> ${facet}</div>`;\n        $('#sui-advEdit-' + facet).html(\n            str + '</div>'.replace(/\\t|\\n|\\r/g, '')\n        ); // Add to div\n        $('#sui-advEdit-' + facet).slideDown(); // Show it\n\n        $('#sui-advInput-' + facet).on('change', (e) => {\n            // ON CHANGE\n            var v = e.target.id.split('-'); // Get ids\n            this.AddNewFilter(\n                $('#sui-advInput-' + facet).val(),\n                facet + '-0',\n                'AND',\n                facet\n            ); // Add term to search state\n        });\n    }\n\n    // SELF-CONTAINED\n    RecentSearches() {\n        // SHOW RECENT SEARCHES\n        if ($('#sui-advEdit-recent').css('display') != 'none') {\n            // If open\n            $('#sui-advEdit-recent').slideUp(); // Close it\n            return; // Quit\n        }\n        let i,\n            j,\n            f,\n            str =\n                \"<i>Click below to recall a previous search</i><hr><div class='sui-advEditList'>\"; // Enclosing div\n        for (i = this.searches.length - 1; i >= 0; i--) {\n            // For each search, last first\n            str += `<div class='sui-advEditLine' style='width:100%' id='sui-recSrc-${i}' `; // Add text item, if any\n            str +=\n                \"title='\" +\n                this.searches[i].query.assets[0].title.toUpperCase(); // Add tooltip to show entire search\n            str += ' ' + this.searches[i].query.text; // Add text\n            for (f in this.facets) {\n                // For each facet\n                if (this.searches[i].query[f].length && f != 'assets')\n                    // If something there\n                    for (\n                        j = 0;\n                        j < this.searches[i].query[f].length;\n                        ++j // For each one of them\n                    )\n                        str +=\n                            ' ' +\n                            this[this.searches[i].query[f][j].bool] +\n                            ' ' +\n                            this.searches[i].query[f][j].title; // Add to tooltip\n            }\n            f = this.searches[i].query.assets[0].id; // Point at asset id\n            str += `'><span style='color:${this.assets[f].c}'>${this.assets[f].g} </span>`; // Add asset type\n            str += this.searches[i].query.text; // End title and add text item\n            for (f in this.facets)\n                if (this.searches[i].query[f].length && f != 'assets')\n                    str += ' + ' + this.facets[f].icon; // Add facets icons, except assets\n            str += '</div>';\n        }\n        $('#sui-advEdit-recent').html(str + '</div>'.replace(/\\t|\\n|\\r/g, '')); // Add to div\n        $('[id^=sui-recSrc-]').off('click'); // KILL OLD HANDLERS\n        $('[id^=sui-recSrc-]').on('click', (e) => {\n            // ON ITEM CLICK\n            let id = e.target.id.substr(11); // Get which\n            this.ss.query = JSON.parse(JSON.stringify(this.searches[id].query)); // Restore search query only\n            $('#sui-search').val(this.ss.query.text); // Set top search\n            this.DrawAdvanced(); // Draw advanced\n            this.Query(); // Rerun search\n        });\n        $('#sui-advEdit-recent').slideDown(); // Show it\n    }\n\n    //\n    ResetFacetList(\n        facet // RESET FACET LIST UI\n    ) {\n        var i,\n            k,\n            str = '';\n        if (facet == 'assets') {\n            // If assets\n            let o = (this.facets.assets.data = []); // Point at data\n            for (k in this.assets) // For each asset type\n                o.push({\n                    title: k.charAt(0).toUpperCase() + k.slice(1),\n                    id: k,\n                    n: this.assets[k].n,\n                }); // Add data\n        }\n        let n = Math.min(300, this.facets[facet].data.length); // Cap at 300\n        $('[id^=sui-advEditLine-]').remove(); // Remove old members, in all facets\n        for (i = 0; i < n; ++i) {\n            // Add items\n            k = this.facets[facet].data[i].n; // Number of assets\n            if (k == undefined) k = ''; // Hide if undefined\n            if (k > 1000) k = Math.floor(k / 1000) + 'K'; // Shorten\n            str += `<div class='sui-advEditLine' id='sui-advEditLine-${i}'>`;\n            if (facet == 'assets')\n                str += `<span style='color:${\n                    this.assets[this.facets[facet].data[i].id].c\n                }'>${\n                    this.assets[this.facets[facet].data[i].id].g\n                }</span> &nbsp;`;\n            str += `${this.facets[facet].data[i].title} (${k})`; // Add item to list\n            if (facet != 'assets')\n                str += this.pages.AddPop(this.facets[facet].data[i].id, true); // Add popover\n            str += '</div>';\n        }\n        $('#sui-advEditList-' + facet).html(\n            '</div>' + str.replace(/\\t|\\n|\\r/g, '')\n        ); // Add to div\n        $('[id^=sui-advEditLine-]').off('click'); // KILL OLD HANDLERS\n        $('[id^=sui-advEditLine-]').on('click', (e) => {\n            // ON ITEM CLICK\n            let v = e.target.id.split('-'); // Get ids\n            let items = this.facets[facet].data; // Point at items\n            if (this.showSearch && facet != 'assets')\n                // Show page\n                this.GetKmapFromID(items[v[2]].id, (kmap) => {\n                    this.SendMessage('page=' + items[v[2]].url, kmap);\n                });\n            // Get kmap and show page\n            else\n                this.AddNewFilter(\n                    items[v[2]].title,\n                    items[v[2]].id,\n                    'AND',\n                    facet\n                ); // Add to search state\n        });\n        $('#sui-advListNum').html(n < 300 ? n : '300+'); // Set number\n    }\n\n    // NEEDS ANALYSIS\n    DrawFacetList(\n        facet,\n        open,\n        searchItem // DRAW LIST FACET PICKER\n    ) {\n        let i,\n            sorted = 0;\n        if (!open && $('#sui-advEdit-' + facet).css('display') != 'none') {\n            // If open\n            $('#sui-advEdit-' + facet).slideUp(); // Close it\n            return;\n        }\n        this.QueryFacets(facet); // Get initial list\n        this.facets[facet].mode = 'list'; // List mode active\n        var str = `<input id='sui-advEditFilter-${facet}' placeholder='Filter this list' value='${\n            searchItem ? searchItem : ''\n        }' \n\t\tstyle='width:90px;border:1px solid #999;border-radius:12px;font-size:11px;padding-left:6px'> &nbsp; `;\n        if (this.facets[facet].type == 'tree') {\n            str += `<div class='sui-advEditBut' id='sui-advListMap-${facet}' title='Tree view'>&#xe638</div> | \n\t\t\t<div class='sui-advEditBut' id='sui-advTreeMap-${facet}' title='List view'>&#xe61f</div>\n\t\t\t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`;\n        }\n        if (facet != 'assets')\n            str += `<div class='sui-advEditBut' id='sui-advEditSort-${facet}' title='Sort'>&#xe652</div>`;\n        str += `<div class='sui-advEditNums'> <span id='sui-advListNum'></span> ${facet}`;\n        str += `</div><hr style='border: .5px solid #a4baec'>\n\t\t<div class='sui-advEditList' id='sui-advEditList-${facet}'></div>`;\n        $('#sui-advEdit-' + facet).html(str.replace(/\\t|\\n|\\r/g, '')); // Add to div\n        $('#sui-advEdit-' + facet).slideDown(); // Show it\n        $('#sui-advTreeMap-' + facet).css({ color: '#668eec' }); // Highlight list\n\n        $('[id^=sui-advEditFilter-]').off('click'); // KILL OLD HANDLER\n        $('#sui-advEditFilter-' + facet).on('keydown', (e) => {\n            // ON FILTER CHANGE\n            let line;\n            var n = Math.min(300, this.facets[facet].data.length); // Cap at 300\n            let r = $('#sui-advEditFilter-' + facet).val(); // Get filter text\n            if (e.keyCode > 31 && e.keyCode < 91) r += e.key; // Add current key if a-Z\n            if (e.keyCode == 8 && r.length) r = r.slice(0, -1); // Remove last char on backspace\n            r = RegExp(r, 'i'); // Turn into regex\n            for (i = 0; i < n; ++i) {\n                // For each item\n                line = $('#sui-advEditLine-' + i); // Point at line\n                if (line.text().match(r)) line.css('display', 'block');\n                // Show item if it matches\n                else line.css('display', 'none'); // Hide\n            }\n        });\n\n        $('[id^=sui-advEditSort-]').off('click'); // KILL OLD HANDLER\n        $('#sui-advEditSort-' + facet).on('click', () => {\n            // ON SORT BUTTON CLICK\n            str = '';\n            let items = this.facets[facet].data; // Point at items\n            let i,\n                k,\n                n = Math.min(300, items.length); // Cap at 300\n            sorted = 1 - sorted; // Toggle flag\n            if (!sorted) {\n                // If not sorted\n                $('#sui-advEditList-' + facet).empty(); // Remove items from list\n                for (i = 0; i < n; ++i) {\n                    // For each one\n                    k = this.facets[facet].data[i].n; // Number of assets\n                    if (k > 1000) k = Math.floor(k / 1000) + 'K'; // Shorten\n                    str += `<div class='sui-advEditLine' id='sui-advEditLine-${i}'>`;\n                    str += `${items[i].title} (${k})${this.pages.AddPop(\n                        items[i].id,\n                        true\n                    )}</div>`; // Add item to list\n                }\n                $('#sui-advEditList-' + facet).html(str); // Add back\n                $('#sui-advEditSort-' + facet).css('color', '#666'); // Off\n                return; // Quit\n            }\n            let itms = $('.sui-advEditLine'); // Items to sort\n            itms.sort(function (a, b) {\n                // Sort\n                var an = $(a).text(); // A name\n                var bn = $(b).text(); // B\n                if (an > bn) return 1;\n                // Higher\n                else if (an < bn) return -1;\n                // Lower\n                else return 0; // The same\n            });\n            $('#sui-advEditList-' + facet).html(itms);\n            $('#sui-advEditSort-' + facet).css('color', '#668eec'); // On\n        });\n\n        $('[id^=sui-advListMap-]').off('click'); // KILL OLD HANDLER\n        $('#sui-advListMap-' + facet).on('click', () => {\n            // ON CLICK TREE BUTTON\n            this.DrawFacetTree(\n                facet,\n                1,\n                $('#sui-advEditFilter-' + facet).val()\n            ); // Close it and open as tree\n        });\n        $('#sui-advEditList-' + facet).css(\n            'max-height',\n            $('#l-site__wrap').height() -\n                $('#sui-advTerm-' + facet).offset().top -\n                $('#sui-advTerm-' + facet).height() -\n                102 +\n                'px'\n        ); // Fill space\n    }\n\n    // SIDE EFFECTS!\n    AddNewFilter(\n        title,\n        id,\n        bool,\n        facet // ADD NEW TERM TO SEARCH STATE\n    ) {\n        let o = this.ss.query[facet]; // Point at facet\n        if (o.filter((o) => o.title == title).length) return; // Don't add if already there\n        if (id) id = id.replace(/languages-|features-/i, 'subjects-'); // Languages and feature\n        let num = o.length; // Facet index to add to\n        o.push({}); // Add obj\n        o[num].title = title; // Get title\n        o[num].id = id ? id.replace(/collections-/, '') : ''; // Id (remove collections- prefix)\n        o[num].bool = bool; // Bool\n        if (facet == 'assets')\n            this.ss.query.assets = [{ title: title, id: id, bool: bool }]; // Only one\n        this.ss.page = 0; // Start at 1st page in results\n        this.DrawAdvanced(); // Redraw\n        this.Query(); // Run query and show results\n    }\n\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n    // TREE\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    // ANALYZE\n    DrawFacetTree(\n        facet,\n        open,\n        searchItem // DRAW FACET TREE\n    ) {\n        var _this = this; // Save context\n        if (!open && $('#sui-advEdit-' + facet).css('display') != 'none') {\n            // If open\n            $('#sui-advEdit-' + facet).slideUp(); // Close it\n            return;\n        }\n        this.facets[facet].mode = 'tree'; // Tree mode active\n        this.curTree = facet;\n        var div = '#sui-tree' + facet; // Tree div\n\n        var str = `<input id='sui-advTreeFilter' placeholder='Filter this list' value='${\n            searchItem ? searchItem : ''\n        }' \n\t\tstyle='width:90px;border:1px solid #999;border-radius:12px;font-size:11px;padding-left:6px'> &nbsp; \n\t\t<div class='sui-advEditBut' id='sui-advListMap-${facet}' title='Tree view'>&#xe638</div> | \n\t\t<div class='sui-advEditBut' id='sui-advTreeMap-${facet}' title='List view'>&#xe61f</div>`;\n        str += `<hr style='border: .5px solid #a4baec'>\n\t\t<div id='sui-tree${facet}' class='sui-tree'></div>`;\n        $('#sui-advEdit-' + facet).html(str.replace(/\\t|\\n|\\r/g, '')); // Add tree frame to div\n\n        if (facet == 'places') this.LazyLoad(div, null, facet, 13735);\n        // Embedded top layer for places\n        else if (facet == 'features') this.LazyLoad(div, null, facet, 20);\n        // Features\n        else if (facet == 'languages') this.LazyLoad(div, null, facet, 301);\n        // Languages\n        else this.GetTopRow(div, facet); // Constructed top layers\n\n        $('#sui-advListMap-' + facet).css({ color: '#668eec' }); // Highlight tree\n\n        $('[id^=sui-advTreeMap-]').off('click'); // KILL OLD HANDLER\n        $('#sui-advTreeMap-' + facet).on('click', () => {\n            // ON CLICK LIST BUTTON\n            this.DrawFacetList(facet, 1, $('#sui-advTreeFilter').val()); // Close it and open as list\n        });\n\n        $('[id^=sui-advTreeFilter-]').off('click'); // KILL OLD HANDLER\n        $('#sui-advTreeFilter').on('keydown', (e) => {\n            // ON TYPING IN TEXT BOX\n            this.DrawFacetList(facet, 1, $('#sui-advTreeFilter').val()); // Close it and open as list\n            $('#sui-advEditFilter-' + facet).focus(); // Focus on input in list\n        });\n\n        $('.sui-advViewTreePage').off('click'); // Kill old handlers\n        $('.sui-advViewTreePage').on('click', (e) => {\n            // ON CLICK VIEW BUTTON\n            var v = e.target.id.split('-'); // Get id\n            this.GetKmapFromID(v[1] + '-' + v[2], (kmap) => {\n                sui.SendMessage('', kmap);\n            }); // Get kmap and show page\n            e.stopPropagation(); // Stop propagation\n        });\n\n        $(div).css(\n            'max-height',\n            $('#l-site__wrap').height() -\n                $('#sui-advTerm-' + facet).offset().top -\n                $('#sui-advTerm-' + facet).height() -\n                102 +\n                'px'\n        ); // Fill space\n        $('#sui-advEdit-' + facet).slideDown(); // Show it\n    }\n\n    // SIDE EFFECTS?\n    GetTopRow(\n        div,\n        facet // GET TOP-MOST TREE LEVEL\n    ) {\n        var _this = this; // Save context\n        let prefix = div.match(/sui-btree-/) ? 'b' : ''; // Id prefix to prevent confusion between trees\n        var id,\n            k,\n            tops = [],\n            str = '<ul>';\n        if (facet == 'terms') {\n            tops.ka = 1;\n            tops.kha = 14263;\n            tops.ga = 24465;\n            tops.nga = 45101;\n            tops.ca = 51638;\n            tops.cha = 55178;\n            tops.ja = 62496;\n            tops.nya = 66477;\n            tops.ta = 73101;\n            tops.tha = 80697;\n            tops.da = 87969;\n            tops.na = 105631;\n            tops.pa = 114065;\n            tops.pha = 120048;\n            tops.ba = 127869;\n            tops.ma = 142667;\n            tops.tsa = 154251;\n            tops.tsha = 158451;\n            tops.dza = 164453;\n            tops.wa = 166888;\n            tops.zha = 167094;\n            tops.za = 172249;\n            tops[\"'a\"] = 177092;\n            tops.ya = 178454;\n            tops.ra = 185531;\n            tops.la = 193509;\n            tops.sha = 199252;\n            tops.sa = 204036;\n            tops.ha = 215681;\n            tops.a = 219022;\n        } else if (facet == 'subjects') {\n            tops['Administration'] = 5550;\n            tops['Architecture'] = 6669;\n            tops['Collections'] = 2823;\n            tops['Community Services Project Types'] = 5553;\n            tops['Contemplation'] = 5806;\n            tops['Cultural Landscapes'] = 8868;\n            tops['Cultural Regions'] = 305;\n            tops['Event'] = 2743;\n            tops['General'] = 6793;\n            tops['Geographical Features'] = 20;\n            tops['Grammars'] = 5812;\n            tops['Higher Education Digital Tools'] = 6404;\n            tops['Historical Periods'] = 5807;\n            tops['Human Relationships'] = 306;\n            tops['Language Tree'] = 301;\n            tops['Literary Genres'] = 5809;\n            tops['Material Objects'] = 2693;\n            tops['Mesoamerican Studies'] = 6664;\n            tops['Oral Genres'] = 5808;\n            tops['Organizations and Organizational Units'] = 2688;\n            tops['Politics'] = 7174;\n            tops['Profession'] = 6670;\n            tops['Religious Sects'] = 302;\n            tops['Religious Systems'] = 5810;\n            tops['Ritual'] = 5805;\n            tops['Scripts'] = 192;\n            tops['Teaching Resources'] = 6844;\n            tops['Text Typologies'] = 4833;\n            tops['Tibet and Himalayas'] = 6403;\n            tops['Zoologies (Biological and Spiritual)'] = 5813;\n        }\n        for (k in tops) {\n            // For each top row\n            id = facet + '-' + tops[k]; // id\n            str += \"<li class='parent'><a id='\" + prefix + id + \"'\"; // Start row\n            str += \"' data-path='\" + tops[k] + \"'>\" + k; // Add path/header\n            str += this.pages.AddPop(id, true); // Add popover\n            str += '</a></li>'; // Add label\n        }\n        $(div).html(str + '</ul>'); // If initing 1st level\n        $('.sui-tree li > a').off(); // Clear handlers\n        $('.sui-tree li > a').on('click', function (e) {\n            handleClick($(this), e);\n        }); // Restore handler\n\n        function handleClick(row, e) {\n            // HANDLE NODE CLICK\n            let off = $(row.parent()).hasClass('parent') ? 20 : 0; // Adjust for icon\n            if (e.offsetX < off) {\n                // In icon\n                if (row.parent().children().length == 1)\n                    // If no children\n                    _this.LazyLoad(div, row, _this.curTree);\n                // Lazy load from SOLR\n                else {\n                    // Open or close\n                    row.parent().toggleClass('active'); // Toggle active class on or off\n                    row.parent().children('ul').slideToggle('fast'); // Slide into place\n                }\n            } else {\n                if (e.clientX < 200 || _this.showSearch) {\n                    // If browsing\n                    _this.pages.relatedBase = _this.pages.relatedId = ''; // No related\n                    if (_this.ss.mode == 'related')\n                        _this.ss.mode = _this.ss.lastMode; // Get back to search mode\n                    sui.GetKmapFromID(\n                        _this.curTree + '-' + e.target.id.split('-')[1],\n                        (kmap) => {\n                            sui.SendMessage('', kmap);\n                        }\n                    ); // Get kmap and show page\n                } else {\n                    // Adding facet to query\n                    let s = $('#' + e.target.id).text(); // Get term\n                    sui.AddNewFilter(\n                        s,\n                        _this.curTree + '-' + e.target.id.split('-')[1],\n                        'AND',\n                        _this.curTree\n                    ); // Add term to search state and refresh\n                }\n            }\n        }\n    }\n\n    // SIDE EFFECTS?\n    LazyLoad(\n        div,\n        row,\n        facet,\n        init // ADD NEW NODES TO TREE\n    ) {\n        const sui = this.sui;\n        var path;\n        var _this = this; // Save context\n        if (init || row.parent().children().length == 1) {\n            // If no children, lazy load\n            let prefix = div.match(/sui-btree-/) ? 'b' : ''; // Id prefix to prevent confustion between trees\n            if (init) path = '' + init;\n            // Force path as string\n            else path = '' + row.data().path; // Get path\tas string\n            this.GetTreeChildren(facet, path, (res) => {\n                // Get children\n                var o,\n                    i,\n                    re,\n                    f = '';\n                var str = '<ul>'; // Wrapper, show if not initting\n                if (facet == 'terms') {\n                    if (\n                        res.facet_counts &&\n                        res.facet_counts.facet_fields &&\n                        res.facet_counts.facet_fields[\n                            'ancestor_id_tib.alpha_path'\n                        ]\n                    )\n                        // If valid\n                        f = res.facet_counts.facet_fields[\n                            'ancestor_id_tib.alpha_path'\n                        ].join(); // Get list of facets\n                } else {\n                    if (\n                        res.facet_counts &&\n                        res.facet_counts.facet_fields &&\n                        res.facet_counts.facet_fields.ancestor_id_path\n                    )\n                        // If valid\n                        f = res.facet_counts.facet_fields.ancestor_id_path.join(); // Get list of facets\n                }\n                for (i = 0; i < res.response.docs.length; ++i) {\n                    // For each child\n                    o = res.response.docs[i]; // Point at child\n                    re = new RegExp('/' + o.id.split('-')[1]); // Id\n                    str += '<li'; // Start row\n                    if ((f && f.match(re)) || init) str += \" class='parent'\"; // If has children or is top, add parent class\n                    str += \"><a id='\" + prefix + o.id; // Add id\n                    if (facet == 'terms')\n                        // If terms\n                        str +=\n                            \"' data-path='\" +\n                            o['ancestor_id_tib.alpha_path'] +\n                            \"'>\";\n                    // Add path\n                    // All others\n                    else str += \"' data-path='\" + o.ancestor_id_path + \"'>\"; // Add path\n                    str += o.header; // Add label\n                    str += this.pages.AddPop(o.id, true); // Add popover\n                    str += '</a></li>'; // Add label\n                }\n                if (res.response.docs.length) {\n                    if (init) $(div).html(str + '</ul>');\n                    // If initing 1st level\n                    else {\n                        // Adding a level to a branch\n                        row.after(str + '</ul>'); // Add children to tree\n                        row.parent().toggleClass('active'); // Toggle active class on or off\n                        row.parent().children('ul').slideToggle('fast'); // Slide into place\n                    }\n                    $('.sui-tree li > a').off(); // Clear handlers\n                    $('.sui-tree li > a').on('click', function (e) {\n                        handleClick($(this), e);\n                    }); // Restore handler\n                }\n                $('.sui-advViewTreePage').off('click'); // Kill old handlers\n                $('.sui-advViewTreePage').on('click', (e) => {\n                    // ON CLICK VIEW BUTTON\n                    var v = e.target.id.split('-'); // Get id\n                    this.GetKmapFromID(v[1] + '-' + v[2], (kmap) => {\n                        sui.SendMessage('', kmap);\n                    }); // Get kmap and show page\n                    e.stopPropagation(); // Stop propagation\n                });\n            });\n        }\n\n        function handleClick(row, e) {\n            // HANDLE NODE CLICK\n            let off = $(row.parent()).hasClass('parent') ? 20 : 0; // Adjust for icon\n            if (e.offsetX < off) {\n                // In icon\n                if (row.parent().children().length == 1)\n                    // If no children\n                    _this.LazyLoad(div, row, _this.curTree);\n                // Lazy load from SOLR\n                else {\n                    // Open or close\n                    row.parent().toggleClass('active'); // Toggle active class on or off\n                    row.parent().children('ul').slideToggle('fast'); // Slide into place\n                }\n            } else {\n                if (e.clientX < 200 || _this.showSearch) {\n                    // If browsing\n                    _this.pages.relatedBase = _this.pages.relatedId = ''; // No related\n                    if (_this.ss.mode == 'related')\n                        _this.ss.mode = _this.ss.lastMode; // Get back to search mode\n                    sui.GetKmapFromID(\n                        _this.curTree + '-' + e.target.id.split('-')[1],\n                        (kmap) => {\n                            sui.SendMessage('', kmap);\n                        }\n                    ); // Get kmap and show page\n                } else {\n                    // Adding facet to query\n                    let s = $('#' + e.target.id).text(); // Get term\n                    sui.AddNewFilter(\n                        s,\n                        _this.curTree + '-' + e.target.id.split('-')[1],\n                        'AND',\n                        _this.curTree\n                    ); // Add term to search state and refresh\n                }\n            }\n        }\n    }\n\n    GeoLocate() {\n        // SHOW GEOLOCATED ASSESTS\n        let d = [\n            { lat: 36.6251, lon: -118.085, lab: 'Lhasa', ui: 'subjects-6061' },\n            { lat: 37.6251, lon: -119.085, lab: 'Lhasa2', ui: 'subjects-6060' },\n        ];\n        //move lat by .0001 to stack\n        sui.plc.Draw('', '', d);\n    }\n\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n    // HELPERS\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    LoadingIcon(\n        mode,\n        size // SHOW/HIDE LOADING ICON\n    ) {\n        if (!mode) {\n            // If hiding\n            $('[id^=sui-loadingIcon]').remove(); // Remove it\n            return; // Quit\n        }\n        var str = \"<img src='img/loading.gif' width='\" + size + \"' \"; // Img\n        str +=\n            \"id='sui-loadingIcon' style='position:absolute;top:calc(50% - \" +\n            size / 2 +\n            'px);left:calc(50% - ' +\n            size / 2 +\n            \"px);z-index:5000'>\";\n        $('#l-site__wrap').append(str); // Add icon to results\n    }\n\n    SendMessage(\n        msg,\n        kmap // SEND MESSAGE TO HOST\n    ) {\n        this.pages.Draw(kmap); // Route to page\n    }\n\n    Popup(\n        msg,\n        time,\n        x,\n        y // POPUP\n    ) {\n        var str = '';\n        $('#sui-popupDiv').remove(); // Kill old one, if any\n        str +=\n            \"<div id='sui-popupDiv' class='sui-gridPopup' style='left:\" +\n            x +\n            'px;top:' +\n            y +\n            \"px'>\"; // Add div\n        str += msg + '</div>'; // Add content\n        $('#l-site__wrap').append(str); // Add to div\n        $('#sui-popupDiv')\n            .fadeIn(500)\n            .delay(time ? time * 1000 : 3000)\n            .fadeOut(500); // Animate in and out\n    }\n\n    ShortenString(\n        str,\n        len,\n        middle // SHORTEN A STRING TO LENGTH\n    ) {\n        if (typeof str == 'object') str = str[0]; // Get 1st member if an array\n        if (str && str.length > len) {\n            // Too long\n            if (middle)\n                str =\n                    str.substr(0, (len - 3) / 2) +\n                    '...' +\n                    str.slice((len - 3) / -2);\n            // Shorten middle\n            else str = str.substr(0, len - 3) + '...'; // Shorten end\n        }\n        return str; // Return string\n    }\n\n    GetCookie(\n        cname // GET COOKIE\n    ) {\n        let i,\n            c,\n            name = cname + '=';\n        let ca = decodeURIComponent(document.cookie).split(';'); // Get cookie array\n        for (i = 0; i < ca.length; i++) {\n            // For each cookie\n            c = ca[i];\n            while (c.charAt(0) == ' ') c = c.substring(1);\n            if (c.indexOf(name) == 0) return c.substring(name.length, c.length);\n        }\n        return '';\n    }\n\n    SetCookie(\n        cname,\n        value // SET COOKIE\n    ) {\n        let d = new Date();\n        d.setTime(d.getTime() + 365 * 24 * 60 * 60 * 1000);\n        d = d.toUTCString(); // Cookie expires after a year\n        document.cookie = `${cname}=${value}; expires=${d};`; // Set cookie\n    }\n\n    log(message, debugObject, showAlert) {\n        //console.log(message);x\n        if (debugObject) {\n            console.dir(debugObject);\n        }\n        if (showAlert) {\n            alert(message, debugObject);\n        }\n    }\n\n    alert(message, debugObject) {\n        this.log(message, debugObject, false);\n    }\n} // SearchUI class closure\n","/* \tPLACES PAGES ****************************************************************************************************************************\n\n\tThis module draws the places page based on a kmap from SOLR. Some information comes from the kmap\n\tpassed in and some from the a second query from the child data in the Terms index.  A map pulled from\n\tarcGIS online is drawn and framed on the area highlighted. The feature\ttypes and summary are drawn below \n\tthe map.\n\n\t[ document map functions ]\n\t\n\tThe related resources menu is drawn, which pulls data via another SOLR call. If an image is present\n\tit is drawn there. Below that is a browsable index of places. Clicking on one will bring up that page.\n\t\n\tA tabbed menu shows the CONTEXT, where the page fits in the tree. Clicking on one will bring up that page.\n\tYou can drill down further in the tree by clicking on a '+' dot or collapse branches with th '-'. The SUMMARY,\n\twhich lists the related subjects to this page, catagorized by their type and alpabetically sorted.\tClicking \n\ton one will bring up that page. Hovering over a blue popover icon will show more information about it. \n\tThe NAMES tab shows the names and etymoogy and Location the GIS datas\n\n\tRequires: \tjQuery \t\t\t\t\t\t\t\t\t\t\t\t// Almost any version should work\n\tImages:\t\timg/basemapicon.gif,\n\t\t\t\timg/layericon.png\n\t\t\t\timg/legendicon.gif\n\t\t\t\timg/sketchicon.gif\n\t\t\t\timg/bookmarkicon.gif\n\n\tESRI:\t\thttps://js.arcgis.com/4.12\n\t\t\t\thttps://js.arcgis.com/4.12/esri/themes/light/main.css (dynamically loaded)\n\tDependents:\tpages.js, searchui.js\t\t\t\t\t\t\t\t// JS modules called\n\topt: \t\tBitmapped: 1=Scale | 2=Search| 4=3D | 8=Base | 16=Layers | 32=Legend | 64=Sketch | 128=Bookmarks\n\n*******************************************************************************************************************************************/\n/* eslint-disable */\nimport $ from 'jquery';\n\nexport default class Places {\n    constructor(\n        sui // CONSTRUCTOR\n    ) {\n        if (!sui) {\n            throw new Error('SearchUI must be passed to constructor');\n        }\n        this.sui = sui;\n        this.app = null;\n        this.kmap = null;\n        this.extent = null;\n        this.showing = false;\n        $('<link/>', {\n            rel: 'stylesheet',\n            type: 'text/css',\n            href: 'https://js.arcgis.com/4.12/esri/themes/light/main.css',\n        }).appendTo('head');\n        this.div = sui.pages.div;\n        this.content = ['', '...loading', '...loading'];\n        this.content2 = ['<br>', '<br>'];\n        this.popovers = null;\n    }\n\n    Draw(\n        kmap,\n        related,\n        popovers // DRAW MAP PAGE\n    ) {\n        //console.error(\"places.Draw() called with arguments: \");\n        //console.dir(arguments);\n        const sui = this.sui;\n        var _this = this; // Save context\n        this.popovers = popovers; // Add data for any popovers\n        $('#sui-legacy').css({\n            'padding-left': '12px',\n            width: 'calc(100% - 24px',\n        }); // Reset to normal size\n        this.kmap = kmap; // Save kmap\n        this.DrawMetadata(related); // Draw metadata\n        sui.LoadingIcon(true, 64); // Show loading icon\n\n        var app = {\n            container: 'plc-main', // Holds startup parameters\n            map: null,\n            baseMap: 'hybrid',\n            kml: null,\n            mapView: null,\n            sceneView: null,\n            activeView: null,\n            opt: 4 | 8 | 64,\n            bookmarks: null,\n            legend: null,\n            layers: null,\n            basePick: null,\n            sketch: null,\n            center: [91.1721, 29.6524],\n            zoom: 12,\n            tilt: 80,\n            reqs: [\n                'esri/Map',\n                'esri/WebMap',\n                'esri/views/MapView',\n                'esri/views/SceneView',\n                'esri/Graphic',\n                'esri/layers/FeatureLayer',\n                'esri/layers/KMLLayer',\n                'esri/core/watchUtils',\n                'esri/geometry/Extent',\n            ],\n            div: this.div,\n        };\n\n        // app.kml=`http://www.thlib.org:8080/thdl-geoserver/wms\n        // \t?LAYERS=thl:roman_popular_poly,thl:roman_popular_pt,thl:roman_popular_line\n        // \t&TRANSPARENT=TRUE&SPHERICALMERCATOR=true&PROJECTION=EPSG:900913&UNITS=m\n        // \t&GEOSERVERURL=http://www.thlib.org:8080/thdl-geoserver\n        // \t&STYLES=thl_noscale,thl_noscale,thl_noscale\n        // \t&CQL_FILTER=fid=${id};fid=${id};fid==${id}\n        // \t&SERVICE=WMS&SRS=EPSG:900913&FORMAT=kml&VERSION=1.1.1\n        // \t&BBOX=3159514.209965,-1447629.9642176,20066161.87184,9001617.5490246\n        // \t&WIDTH=864&HEIGHT=53\n        // \t&REQUEST=GetMap`.replace(/\\t|\\n|\\r|/g,\"\")\n        // \tapp.kml=\"https://viseyes.org/visualeyes/projects/test.kml\"\n\n        this.app = app;\n\n        if (app.opt & 1) app.reqs.push('esri/widgets/ScaleBar'); // Scalebar if spec'd\n        if (app.opt & 2) app.reqs.push('esri/widgets/Search'); // Search\n        if (app.opt & 8) app.reqs.push('esri/widgets/BasemapGallery'); // Basepicker\n        if (app.opt & 16) app.reqs.push('esri/widgets/LayerList'); // Layerlist\n        if (app.opt & 32) app.reqs.push('esri/widgets/Legend'); // Legend\n        if (app.opt & 64) {\n            app.reqs.push('esri/widgets/Sketch');\n            app.reqs.push('esri/layers/GraphicsLayer');\n        } // Sketch\n        if (app.opt & 128) app.reqs.push('esri/widgets/Bookmarks'); // Bookmarks\n        /*\n\t\trequire(app.reqs, function() {\t\t\t\t\t\t\t\t\t\t\t\t\t\t// LOAD ArcGIS MODULES\n\t\t\tvar i,key;\n\t\t\tvar Map,WebMap,MapView,SceneView,Graphic,FeatureLayer,KMLLayer,Extent;\n\t\t\tvar ScaleBar,Search,BasemapGallery,LayerList,Legend,Sketch,GraphicsLayer,Bookmarks,watchUtils;\n\t\t\tfor (i=0;i<app.reqs.length;++i)\t{\t\t\t\t\t\t\t\t\t\t\t\t\t// For each required module\n\t\t\t\tkey=app.reqs[i].match(/([^\\/]+)$/i)[1];\t\t\t\t\t\t\t\t\t\t\t// Extract variable name\n\t\t\t\tif (key == \"Map\") \t\t\t\t\tMap=arguments[i];\t\t\t\t\t\t\t// Set variable\n\t\t\t\telse if (key == \"WebMap\")\t\t\tWebMap=arguments[i];\n\t\t\t\telse if (key == \"MapView\")\t\t\tMapView=arguments[i];\n\t\t\t\telse if (key == \"SceneView\")\t\tSceneView=arguments[i];\n\t\t\t\telse if (key == \"Graphic\")\t\t\tGraphic=arguments[i];\n\t\t\t\telse if (key == \"FeatureLayer\")\t\tFeatureLayer=arguments[i];\n\t\t\t\telse if (key == \"KMLLayer\")\t\t\tKMLLayer=arguments[i];\n\t\t\t\telse if (key == \"watchUtils\")\t\twatchUtils=arguments[i];\n\t\t\t\telse if (key == \"Extent\")\t\t\tExtent=arguments[i];\n\t\t\t\telse if (key == \"ScaleBar\")\t\t\tScaleBar=arguments[i];\n\t\t\t\telse if (key == \"Search\")\t\t\tSearch=arguments[i];\n\t\t\t\telse if (key == \"BasemapGallery\")\tBasemapGallery=arguments[i];\n\t\t\t\telse if (key == \"LayerList\")\t\tLayerList=arguments[i];\n\t\t\t\telse if (key == \"Legend\")\t\t\tLegend=arguments[i];\n\t\t\t\telse if (key == \"Sketch\")\t\t\tSketch=arguments[i];\n\t\t\t\telse if (key == \"GraphicsLayer\")\tGraphicsLayer=arguments[i];\n\t\t\t\telse if (key == \"Bookmarks\")\t\tBookmarks=arguments[i];\n\t\t\t\t}\n\n\t\t\tvar str=`<div id=\"plc-infoDiv\">\n\t\t\t\t<input class=\"esri-component esri-widget--button esri-widget esri-interactive\" type=\"button\" style=\"display:none\" id=\"plc-switch-btn\" value=\"3D\"             title=\"Change view\" />\n\t\t\t\t<img   class=\"esri-component esri-widget--button esri-widget esri-interactive\" type=\"button\" style=\"display:none\" id=\"plc-base-btn\"   src=\"basemapicon.gif\"  title=\"Change base map\"/>\n\t\t\t\t<img   class=\"esri-component esri-widget--button esri-widget esri-interactive\" type=\"button\" style=\"display:none\" id=\"plc-layer-btn\"  src=\"layericon.png\"    title=\"Show list of layers\" />\n\t\t\t\t<img   class=\"esri-component esri-widget--button esri-widget esri-interactive\" type=\"button\" style=\"display:none\" id=\"plc-legend-btn\" src=\"legendicon.gif\"   title=\"Show legend\" />\n\t\t\t\t<img   class=\"esri-component esri-widget--button esri-widget esri-interactive\" type=\"button\" style=\"display:none\" id=\"plc-sketch-btn\" src=\"sketchicon.gif\"   title=\"Show sketch\" />\n\t\t\t\t<img   class=\"esri-component esri-widget--button esri-widget esri-interactive\" type=\"button\" style=\"display:none\" id=\"plc-book-btn\"   src=\"bookmarkicon.gif\" title=\"Show bookmarks\" />\n\t\t\t\t</div>`;\n\t\t\t$(\"#plc-main\").append(str);\n\n\t\tapp.ShowOptions=function() {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// SHOW ACTIVE OPTIONS\n\t\t\tdocument.getElementById(\"plc-switch-btn\").style.display=(app.opt&4) ? \"block\" : \"none\";\t// Hide/show icons\n\t\t\tdocument.getElementById(\"plc-base-btn\").style.display=(app.opt&8) ? \"block\" : \"none\";\n\t\t\tdocument.getElementById(\"plc-layer-btn\").style.display=(app.opt&16 && (app.map.portalItem || app.kml)) ? \"block\" : \"none\";\n\t\t\tdocument.getElementById(\"plc-legend-btn\").style.display=(app.opt&32 && app.map.portalItem)  ? \"block\" : \"none\";\n\t\t\tdocument.getElementById(\"plc-sketch-btn\").style.display=(app.opt&64) ? \"block\" : \"none\";\n\t\t\tdocument.getElementById(\"plc-book-btn\").style.display=(app.opt&128 && app.map.bookmarks) ? \"block\" : \"none\";\n\t\t\tif (app.opt&16  && app.show&16) \tsetOption(app.layers);\t\t\t\t\t\t\t\t// Layers\n\t\t\tif (app.opt&32  && app.show&32) \tsetOption(app.legend);\t\t\t\t\t\t\t\t// Legend\n\t\t\tif (app.opt&64  && app.show&64) \tsetOption(app.sketch);\t\t\t\t\t\t\t\t// Sketch\n\t\t\tif (app.opt&128 && app.show&128) \tsetOption(app.bookmarks);\t\t\t\t\t\t\t// Bookmarks\n\n\t\t\tfunction setOption(option) {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// SET OPTION ON\n\t\t\t\tapp.mapView.ui.add(option,\"top-right\");\t\t\t\t\t\t\t\t\t\t\t\t// Show\n\t\t\t\toption.visible=true;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Show it's on\n\t\t\t\t}\n\t\t\t}\n\t\tapp.map=new Map({ basemap:app.baseMap, ground:\"world-elevation\" });\t\t\t\t\t\t\t// Make new map\n\t\tapp.sceneView=new SceneView( { \tcontainer:null,\tmap: app.map });\t\t\t\t\t\t\t// 3D view (hidden)\n\t\tapp.activeView=app.mapView=new MapView({\t\t\t\t\t\t\t\t\t\t\t\t\t// 2D view\n\t\t\tcontainer: app.container, map: app.map \t\t\t\t\t\t\t\t\t\t\t\t\t// Primary view\n\t\t\t});\n\t\tapp.ShowOptions();\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Hide/show options\n\n\t\tif (app.kml) {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Add KML/KMZ if spec'd\n\t\t\tapp.kml=new KMLLayer({ url:app.kml });\t\t\t\t\t\t\t\t\t\t\t\t\t// Make new layer\n\t\t\tapp.map.add(app.kml);\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Add it to map\n\t\t\tapp.mapView.whenLayerView(app.kml).then(function(layerView) {\n\t\t\t\twatchUtils.whenFalseOnce(layerView, \"updating\", function() {\n\t\t\t\t\tvar polygons=layerView.allVisiblePolygons;\n\t\t\t\t\tvar lines=layerView.allVisiblePolylines;\n\t\t\t\t\tvar points=layerView.allVisiblePoints;\n\t\t\t\t\tvar images=layerView.allVisibleMapImages;\n\t\t\t\t\tvar kmlFullExtent=polygons.concat(lines).concat(points).concat(images)\n\t\t\t\t\t.map(graphic => (graphic.extent ? graphic.extent : graphic.geometry.extent))\n\t\t\t\t\t.reduce((previous, current) => previous.union(current));\n\t\t\t\t\tapp.mapView.goTo({ extent: kmlFullExtent });\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n// POPOVERS\n\n\t\tfunction AddPopovers(data) \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// ADD POPOVERS\n\t\t{\n// \t\t\tapp.fl=new FeatureLayer({\n// \t\t\t\tfields:[{ name:\"ObjectID\", alias:\"ObjectID\", type:\"oid\" },\n// \t\t\t\t  \t\t{ name:\"Name\", alias:\"Name\", type:\"string\" },\n// \t\t\t\t  \t\t{ name:\"kmid\",\talias:\"kmid\", type:\"string\" }],\n// \t\t\t\tobjectIdField:\"ObjectID\", geometryType:\"point\",\n// \t\t\t\tspatialReference:{ wkid: 4326 }, source: [],\n// \t\t\t\trenderer: { type: \"simple\", symbol: {\n// \t\t\t\t\t\t\ttype: \"web-style\", // autocasts as new WebStyleSymbol()\n// \t\t\t\t\t\t\tstyleName: \"Esri2DPointSymbolsStyle\",\n// \t\t\t\t\t\t\tname: \"landmark\" }\n// \t\t\t\t\t},\n// \t\t\t  popupTemplate: {  title: \"{Name}\"\t}\n// \t\t\t  });\n// \t\t\tapp.map.add(app.fl);\n//\n\t\t\t$(\"#sui-contentHead\").html(\"<div style='margin-top:12px'>&#xe61a&nbsp;&nbspGeo-Locate</div>\")\t// Header text\n\t\t\t$(\"#sui-footer\").html(\"\");\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Footer text\n\t\t\t$(\"#sui-header\").css(\"background-color\",\"#6faaf1\");\t\t\t\t\t\t\t\t\t\t// Color header\n\t\t\t$(\"#sui-footer\").css(\"background-color\",\"#6faaf1\");\t\t\t\t\t\t\t\t\t\t// Color footer\n\t\t\t$(\"#plc-infoDiv\").css(\"left\",\"25px\");\n\n\t\t\tlet i,graphic;\n\t\t\tlet minLat=999999,minLon=999999,maxLat=-999999,maxLon=-999999;\n\n\t\t\tfor (i=0;i<data.length;i++) {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// For each element\n\t\t\t\tif (data[i].lat < minLat)\tminLat=data[i].lat;\t\t\t\t\t\t\t\t\t\t// Get min lat\n\t\t\t\tif (data[i].lat > maxLat)\tmaxLat=data[i].lat;\t\t\t\t\t\t\t\t\t\t// Get max lat\n\t\t\t\tif (data[i].lon < minLon)\tminLon=data[i].lon;\t\t\t\t\t\t\t\t\t\t// Get min lon\n\t\t\t\tif (data[i].lon > maxLon)\tmaxLon=data[i].lon;\t\t\t\t\t\t\t\t\t\t// Get max lom\n\t\t\t\tgraphic=new Graphic({\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Addloc new graphic\n\t\t\t\t\tgeometry:{ type: \"point\", latitude:data[i].lat, longitude:data[i].lon },\t\t// Position\n\t\t\t\t\tsymbol:{ type: \"picture-marker\", url:\"popover.png\", width:19, height:13 },\t\t// Shape\n\t\t\t\t\tattributes:data[i]\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Raw data\n\t\t\t\t});\n\t\t\t\tapp.gl.add(graphic);\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Add to layer\n\t\t\t\t}\n\n\t\t\t_this.extent={ \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Set extent based on minimax of popovers\n\t\t\t\tspatialReference:4326, \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// In lat/lon coord space\n\t\t\t\txmax:maxLon, xmin:minLon,\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Longitude\n\t\t\t\tymax:maxLat, ymin:minLat\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Latitude\n\t\t\t\t}\n\n\t\t\tapp.mapView.on(\"pointer-move\", function(event) {\t\t\t\t\t\t\t\t\t\t// HANDLE HOVER\n\t\t\t\tvar screenPoint={ x: event.x, y: event.y };\t\t\t\t\t\t\t\t\t\t\t// Format pos\n\t\t\t\tapp.mapView.hitTest(screenPoint).then(function(response) {\t\t\t\t\t\t\t// Search for graphics at the clicked location\n\t\t\t\t\tif (response.results.length) {\t\t\t\t\t\t\t\t\t\t\t\t\t// Found at least one\n\t\t\t\t\t\tlet id=response.results[0].graphic.attributes.ui;\t\t\t\t\t\t\t// Get id\n\t\t\t\t\t\tevent.type=\"mousemove\";\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Make event compatible\n\t\t\t\t\t\tsui.pages.ShowPopover(id, event)\n\t\t\t\t \t\t}\n\t\t\t\t\t});\n\t\t\t   });\n\t\t\t}\n\n// ADD WIDGETS\n\n\t\tif (app.opt&1)  app.mapView.ui.add(new ScaleBar({ view:app.mapView }), \"bottom-left\");\t\t// Add scale widget\n\t\tif (app.opt&2)  app.mapView.ui.add(new Search({ view:app.mapView }), \"top-right\");\t\t\t// Add Search widget\n\t\tif (app.opt&4)\tdocument.getElementById(\"plc-switch-btn\").addEventListener(\"click\", function() { app.SwitchView();  });// 3D\n\t\tif (app.opt&8) {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Add basemap picker\n\t\t\tapp.basePick=new BasemapGallery({ view:app.mapView, source: { portal: { url:\"https://www.arcgis.com\", useVectorBasemaps: true } }, visible:false });\n\t\t\tdocument.getElementById(\"plc-base-btn\").addEventListener(\"click\", function() { app.ToggleOption(app.basePick); });\t // Add button handler\n\t\t\t}\n\t\tif (app.opt&16) {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Layer list\n\t\t\tapp.layers=new LayerList({ view:app.mapView, visible:false });\t\t\t\t\t\t\t// Add widget\n\t\t\t\tdocument.getElementById(\"plc-layer-btn\").addEventListener(\"click\", function() { app.ToggleOption(app.layers);  });\t// Add button handler\n\t\t\t}\n\t\tif (app.opt&32) {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Legend\n\t\t\tapp.legend=new Legend({ view:app.mapView, visible:false });\t\t\t\t\t\t\t\t// Add widget\n\t\t\tdocument.getElementById(\"plc-legend-btn\").addEventListener(\"click\", function() { app.ToggleOption(app.legend); });\t// Add button handler\n\t\t\t}\n\t\tif (app.opt&64) {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Sketch\n\t\t\tapp.gl=new GraphicsLayer();  app.map.add(app.gl);\t\t\t\t\t\t\t\t\t\t// Add new graphics layer to map\n\t\t\tapp.sketch=new Sketch({ view:app.mapView, visible:false, layer:app.gl });\t\t\t\t// Add widget\n\t\t\tdocument.getElementById(\"plc-sketch-btn\").addEventListener(\"click\", function() { app.ToggleOption(app.sketch); });\t// Add button handler\n\t\t\t}\n\t\tif (app.opt&128) {  \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Bookmarks\n\t\t\tapp.bookmarks=new Bookmarks({ view:app.mapView, visible:false });\t\t\t\t\t\t// Add widget\n\t\t\tdocument.getElementById(\"plc-book-btn\").addEventListener(\"click\", function() { app.ToggleOption(app.bookmarks); });\t // Add button handler\n\t\t\t}\n\n// POSITION\n\n\t\tapp.mapView.when(function() { \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// When 2D map loads\n\t\t\tif (_this.popovers)\t\t\t\tAddPopovers(_this.popovers);\t\t\t\t\t\t\t// Add popovers if any\n\t\t\tif (_this.extent)\t\t\t\tapp.GoToExtent(_this.extent);\t\t\t\t\t\t\t// If an extent given\n\t\t\telse if (!app.map.portalItem) \tapp.mapView.goTo({ center:app.center, zoom:app.zoom });\t// Center\n\t\t\tsui.LoadingIcon(false);\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Hide loading icon\n\t\t\t_this.showing=true;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Been shown\n\t\t\t});\n\t\tapp.sceneView.when(function() { app.sceneView.goTo({ tilt:80 }); });\t\t\t\t\t\t// When 3D loads, tilt\n\n\t// \tapp.DrawFooter=function()\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// DRAW MAP FOOTER\n\t// \t{\n\t// \t\tstr=`<div style='float:left;font-size:18px'>\n\t// \t\t\t<div id='plc-customMap' class='sui-resDisplay' title='Custom/normal map'>&#xe625</div></div>\n\t// \t\t\t<div style='float:right;font-size:14px;margin-right:16px'>PLACE ID: ${kmap.id}</div>`;\n\t// \t\t$(\"#sui-footer\").html(str);\n\t// \t\t$(\"#plc-customMap\").on(\"click\", ()=> {\n\t// \t\t\tif ($(\"#plc-infoDiv\").length) {\n\t// \t\t\t\t$(\"#plc-infoDiv\").remove();\n\t// \t\t\t\tvar h=$(app.div).height()-4;\n\t// \t\t\t\tvar link=\"https://www.thlib.org/places/maps/interactive_ajax/#fid:\"+kmap.id;\n\t// \t\t\t\t$(app.div).html(\"<iframe frameborder='0' src='\"+link+\"' style='height:\"+h+\"px;width:100%'></iframe>\");\n\t// \t\t\t\t}\n\t// \t\t\telse sui.plc.Draw(kmap);\n\t// \t\t\t});\n\t// \t}\n\t//\n\t// app.DrawFooter();\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Draw footer\n\n\n// HELPER FUNCTIONS //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n\t\tapp.ToggleOption=function(option) {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// HIDE/SHOW WIDGET OPTION\n\t\t\tif (option.visible)\tapp.activeView.ui.remove(option);\t\t\t\t\t\t\t\t\t// If visible, hide\n\t\t\telse\t\t\t\tapp.activeView.ui.add(option,\"top-right\");\t\t\t\t\t\t\t// Else show\n\t\t\toption.visible=!option.visible;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Toggle flag (why?)\n\t\t\t};\n\n\t\tapp.GoToExtent=function(extent) {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// SET NEW EXTENT\n\t\t\tapp.mapView.goTo({ extent:new Extent(extent) });\t\t\t\t\t\t\t\t\t\t// Set view to extent\n\t\t\t};\n\n\t\tapp.SwitchView=function() { \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// SWITCH 2D/3D MODE\n\t\t\tvar is3D=app.activeView.type === \"3d\";\t\t\t\t\t\t\t\t\t\t\t\t\t// Current mode\n\t\t\tvar activeViewpoint=app.activeView.viewpoint.clone();\t\t\t\t\t\t\t\t\t// Clone viewport\n\t\t\tapp.activeView.container=null;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Hide current one\n\n\t\t\tif (is3D) {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If 3D now\n\t\t\t\tapp.activeView=app.mapView;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Use 2D view\n\t\t\t\tdocument.getElementById(\"plc-switch-btn\").value=\"3D\";\t\t\t\t\t\t\t\t// Set button\n\t\t\t\t}\n\t\t\telse{\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If 2D now\n\t\t\t\tapp.activeView=app.sceneView;\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Use 2D view\n\t\t\t\tdocument.getElementById(\"plc-switch-btn\").value=\"2D\";\t\t\t\t\t\t\t\t// Set button\n\t\t\t\t}\n\t\t\tapp.activeView.viewpoint=activeViewpoint;\t\t\t\t\t\t\t\t\t\t\t\t// Set viewport\n\t\t\tapp.activeView.container=app.container;\t\t\t\t\t\t\t\t\t\t\t\t\t// Set container\n\t\t\t};\n\n\t\t});\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Require closure\n\n\t\t*/\n    } // End Draw()\n\n    GeoLocate() {\n        // GET EXTENT FROM PLACE PATH TREE IN KMAP\n        let loc = '';\n        this.extent = null; // Assume not found\n        var _this = this; // Save context\n        try {\n            for (\n                let i = this.kmap.ancestors_txt.length - 1;\n                i > 0;\n                --i // For each ancestor backwards\n            )\n                loc += this.kmap.ancestors_txt[i] + '%20'; // Add name\n            if (this.kmap.ancestors_txt.length == 1)\n                loc = this.kmap.ancestors_txt[0]; // Top level places\n            let url =\n                '//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/findAddressCandidates?f=pjson&SingleLine=' +\n                loc;\n            $.ajax({ url: url, dataType: 'jsonp' }).done(function (res) {\n                // Run query\n                _this.extent = res.candidates[0].extent; // Extract extent\n                _this.extent.spatialReference = res.spatialReference.wkid; // Set ref\n                if (_this.showing) _this.app.GoToExtent(_this.extent); // If already showing a map, go there\n            });\n        } catch (e) {}\n    }\n\n    /////////////////////////////////////////////////////////////////////////////////////////////////\n    // META DATA\n    /////////////////////////////////////////////////////////////////////////////////////////////////\n\n    DrawContent() {\n        // DRAW TABS AND CAPTION INFO\n        const sui = this.sui;\n        let str = \"<div id='sui-topCon' style='margin-left:192px'>\"; // Top content div\n        if (this.kmap.caption)\n            str +=\n                \"<div style='margin:5px 0 13px 0' class='sui-sourceText'>\" +\n                this.kmap.caption +\n                '</div>'; // Add caption\n        str += sui.pages.DrawTabMenu(['MAP', 'NAMES', 'LOCATION']); // Add tab menu\n        str += \"</div><div class='plc-main' id='plc-main' ></div>\"; // Map holder\n        $(this.div).html(str.replace(/\\t|\\n|\\r|/g, '')); // Add to div\n        $('#plc-main').css('height', $('#sui-main').height() * 0.667 + 'px'); // Fill 2/3rds\n        $('[id^=sui-tabTab]').on('click', (e) => {\n            // ON TAB CLICK\n            this.ShowTab(e.currentTarget.id.substring(10)); // Get index of tab\tand draw it\n        });\n    }\n\n    DrawMetadata(\n        related // SHOW PLACES METADATA\n    ) {\n        const sui = this.sui;\n\n        if (this.popovers) {\n            // Has popovers\n            $(this.div).html(\"<div class='plc-main' id='plc-main'></div>\"); // Add to div\n            $('#plc-main').css({\n                margin: 0,\n                width: '100%',\n                height: $('#sui-legacy').height() + 'px',\n            }); // Resize map area\n            return; // Don't need any metadata or tabs\n        }\n        this.GeoLocate(); // Get extent\n        this.DrawContent(); // Draw tabset and captions is not related subject/places\n        this.ShowTab(related ? related : 0); // Show tab contents\n        sui.pages.DrawRelatedAssets(this.kmap); // Draw related assets menu\n        sui.GetChildNamesFromID('places', this.kmap.id, (d) => {\n            // Get name from children\n            let i,\n                o,\n                oo,\n                l = [];\n            let str = `<div style='display:inline-block;width:50%'><br>\n\t\t\t<div style='font-weight:bold;color:#6faaf1;margin-bottom:8px'>NAMES</div>`;\n            if (\n                d &&\n                d[0] &&\n                d[0]._childDocuments_ &&\n                d[0]._childDocuments_.length\n            ) {\n                // If docs\n                for (i = 0; i < d[0]._childDocuments_.length; ++i) {\n                    // For each one\n                    o = d[0]._childDocuments_[i]; // Point at it\n                    oo = {}; // Clear obj\n                    oo.lab = o.related_names_header_s; // Label\n                    oo.lang = o.related_names_language_s; // Language\n                    oo.rel = o.related_names_relationship_s; // Relationship\n                    oo.write = o.related_names_writing_system_s; // Writing system\n                    oo.ety = o.related_names_etymology_s; // Etymology\n                    oo.path = o.related_names_path_s; // Path\n                    oo.tab = o.related_names_level_i - 1;\n                    l.push(oo); // Add to array\n                }\n                l.sort(function (a, b) {\n                    // Sort by path\n                    if (a.path > b.path) return 1;\n                    // Higher\n                    else if (a.path < b.path) return -1;\n                    // Lower\n                    else return 0; // The same\n                });\n            }\n            for (i = 0; i < l.length; ++i) {\n                // For each one\n                str += `<div style='margin-left:${l[i].tab * 16}px'>`; // Header\n                if (i) str += '&bull; '; // Add bullet\n                str += `<strong>${l[i].lab} </strong>&nbsp; (${l[i].lang}, ${l[i].write}, ${l[i].rel})</div>`; // Text\n            }\n            str += `<br></div><div style='display:inline-block;width:calc(50% - 24px);vertical-align:top;border-left:1px solid #ccc; padding-left:12px;margin-top:22px'>\n\t\t\t<div style='font-weight:bold;color:#6faaf1;margin-bottom:8px'>ETYMOLOGY</div>`;\n            for (\n                i = 0;\n                i < l.length;\n                ++i // For each one\n            )\n                if (l[i].ety)\n                    str += `<div>Etymology for <strong>${l[i].lab}</strong>: &nbsp; ${l[i].ety}</div>`; // Text\n            str += '</div><br>';\n            this.content[1] = str.replace(/\\t|\\n|\\r|/g, ''); // Set tab\n        });\n\n        sui.GetRelatedFromID(this.kmap.uid, (data) => {\n            // Load data\n            if (\n                data[0].illustration_external_url &&\n                data[0].illustration_external_url\n            ) {\n                // If an image spec'd\n                $('#sui-relatedImg').addClass('sui-relatedImg'); // Set style\n                $('#sui-relatedImg').prop(\n                    'src',\n                    data[0].illustration_external_url[0]\n                ); // Show it\n            } else if (\n                data[0].illustration_mms_url &&\n                data[0].illustration_mms_url[0]\n            ) {\n                // If an image spec'd\n                $('#sui-relatedImg').addClass('sui-relatedImg'); // Set style\n                $('#sui-relatedImg').prop(\n                    'src',\n                    data[0].illustration_mms_url[0]\n                ); // Show it\n            }\n            this.AddRelatedTabs(); // Add related places/context tab controls\n            this.AddRelatedPlaces(this.kmap, data, this.content2, 0); // Add related place context html\n            this.AddRelatedSubjects(this.kmap, data); // Add related subjects html\n        });\n    }\n\n    ShowTab(\n        which // OPEN TAB\n    ) {\n        const sui = this.sui;\n        let _this = this;\n        $('[id^=sui-tabTab]').css({\n            'background-color': '#999',\n            color: '#fff',\n        }); // Reset all tabs\n        $('#sui-tabContent').css({\n            display: 'block',\n            'background-color': '#eee',\n        }); // Show content\n        $('#sui-tabTab' + which).css({\n            'background-color': '#eee',\n            color: '#000',\n        }); // Active tab\n        $('#sui-tabTab' + which).css({\n            'background-color': '#eee',\n            color: '#000',\n        }); // Active tab\n        if (which == 0) $('#plc-main').slideDown();\n        // Show map\n        else $('#plc-main').slideUp(); // Hide map\n        if (which > 2) $('#sui-topCon').html(this.content[which]);\n        // If related subjects/places\n        else $('#sui-tabContent').html(this.content[which]); // Set content\n        if (which == 4) {\n            // Related places\n            $('#sui-tabContent').css({\n                display: 'block',\n                'background-color': '#eee',\n            }); // Show content\n            $('#sui-tabTabB0').css({\n                'background-color': '#eee',\n                color: '#000',\n            }); // Active tab\n            $('#sui-tabTabB0').css({\n                'background-color': '#eee',\n                color: '#000',\n            }); // Active tab\n            $('#sui-tabContent').html(this.content2[0]); // Set content\n            $('[id^=sui-spLab-]').on('click', function (e) {\n                return false;\n            }); // ON CONTEXT LINE CLICK, INHIBIT\n            $('[id^=sui-spDot-]').on('click', function (e) {\n                // ON RELATIONSHIP TREE DOT CLICK\n                let path = e.currentTarget.id.substring(10); // Get id\n                if (path != 'null')\n                    sui.pages.AddRelBranch(\n                        _this.kmap.asset_type,\n                        path,\n                        $(this)\n                    ); // Lazy load branch\n                $(this).html('&ndash;'); // Change label\n                $(this).parent().find('ul').slideToggle(); // Slide into place\n            });\n        }\n        $('#sui-spLab-' + this.kmap.uid).css({\n            'font-weight': 'bold',\n            'text-decoration': 'underline',\n        }); // Highlight current one\n    }\n\n    AddRelatedTabs() {\n        // ADD TAB CONTROLS FOR RELATED PLACES/SUBJECTS\n        const sui = this.sui;\n        const _this = this;\n        let str = drawTabB(['PLACE CONTEXT', 'RELATED PLACES']); // Add tab menu\n        this.content[4] = str.replace(/\\t|\\n|\\r|/g, ''); // Set content for related places\n        $('[id^=sui-tabTabB]').on('click', (e) => {\n            // ON TAB CLICK\n            let which = e.currentTarget.id.substring(11); // Get index of tab\tand draw it\n            $('[id^=sui-spDot-]').off('click'); // Kill handler\n            $('[id^=sui-spItem-]').off('click'); // Kill handler\n            $('[id^=sui-togCat-]').off('click'); // Kill handler\n            $('[id^=sui-spCatUL-]').off('click'); // Kill handler\n            $('[id^=sui-tabTabB]').css({\n                'background-color': '#999',\n                color: '#fff',\n            }); // Reset all tabs\n            $('#sui-tabContent').css({\n                display: 'block',\n                'background-color': '#eee',\n            }); // Show content\n            $('#sui-tabTabB' + which).css({\n                'background-color': '#eee',\n                color: '#000',\n            }); // Active tab\n            $('#sui-tabTabB' + which).css({\n                'background-color': '#eee',\n                color: '#000',\n            }); // Active tab\n            $('#sui-tabContent').html(this.content2[which]); // Set content\n\n            $('[id^=sui-spDot-]').on('click', function (e) {\n                // ON RELATIONSHIP TREE DOT CLICK\n                let firstChild = $(this).parent().find('ul')[0]; // Get first child\n                let path = e.currentTarget.id.substring(10); // Get id\n                if (path != 'null')\n                    sui.pages.AddRelBranch(\n                        _this.kmap.asset_type,\n                        path,\n                        $(this)\n                    ); // Lazy load branch\n                $(this).html(\n                    $(firstChild).css('display') == 'none' ? '&ndash;' : '+'\n                ); // Change label\n                $(this).parent().find('ul').slideToggle(); // Slide into place\n            });\n            $('[id^=sui-spLab-]').on('click', function (e) {\n                return false;\n            }); // ON CONTEXT LINE CLICK, INHIBIT\n            $('[id^=sui-spItem-]').on('click', function (e) {\n                return false;\n            }); // ON LINE CLICK, INHIBIT\n            $('[id^=sui-spCatUL-]').slideDown(); // All down\n            $('[id^=sui-spCat-]').on('click', (e) => {\n                // ON CATEGORY CLICK\n                let id = e.currentTarget.id.substring(9); // Get id\n                if ($('#sui-spCatUL' + id).css('display') == 'none')\n                    // If hidden\n                    $('#sui-spCatUL' + id).slideDown();\n                // Show\n                // If showing\n                else $('#sui-spCatUL' + id).slideUp(); // Hide\n            });\n            $('[id^=sui-spSub-]').on('click', (e) => {\n                // ON SUB-CATEGORY CLICK\n                let id = e.currentTarget.id.substring(9); // Get id\n                if ($('#sui-spSubUL' + id).css('display') == 'none')\n                    // If hidden\n                    $('#sui-spSubUL' + id).slideDown();\n                // Show\n                // If showing\n                else $('#sui-spSubUL' + id).slideUp(); // Hide\n            });\n            $('#sui-togCatA').on('click', () => {\n                // ON EXPAND ALL\n                $('[id^=sui-spCatUL-]').slideDown(); // All down\n            });\n            $('#sui-togCatN').on('click', () => {\n                // ON COLLAPSE ALL\n                $('[id^=sui-spCatUL-]').slideUp(); // All down\n            });\n        });\n\n        function drawTabB(tabs) {\n            // DRAW TAB MENU\n            let i,\n                str = '';\n            for (\n                i = 0;\n                i < tabs.length;\n                ++i // For each tab\n            )\n                str += `<div class='sui-tabTab' id='sui-tabTabB${i}' style='width:calc(${\n                    100 / tabs.length\n                }% - 2px)'>${tabs[i]}&nbsp;&#xe609</div>`;\n            str += \"<div class='sui-tabContent' id='sui-tabContent'></div>\"; // Tab contents\n            return str.replace(/\\t|\\n|\\r|/g, ''); // Return tab markup\n        }\n    }\n\n    AddRelatedPlaces(\n        o,\n        d,\n        content // ADD RELATED PLACES CONTENTS\n    ) {\n        const sui = this.sui;\n        let n = 0,\n            sups = 0;\n        if (d[0].ancestors && d[0].ancestors.length > 2)\n            sups = d[0].ancestors.length - 2;\n        let str = `<br><div class='sui-spHead'>Places related to ${o.title}</div>\n\t\t<div style='max-width:900px'>\n\t\t<strong>${o.title[0]}</strong> has <strong>${sups}</strong> superordinate places and<strong> TBD </strong> immediately subordinate places. \n\t\tYou can browse these subordinate places as well as its superordinate categories with the tree below. \n\t\tSee the RELATED PLACES tab if you instead prefer to view only its immediately subordinate places grouped together in useful ways, \n\t\tas well as places non-hierarchically related to it.</div><br>\n\t\t<ul class='sui-spLin' id='sui-spRows'>`;\n        if (o.asset_type == 'subjects') {\n            // If subjects assets\n            content[0] = str.replace(/\\t|\\n|\\r/g, '') + '</ul><br>'; // Set 1st content array member with html\n            return;\n        }\n        if (!d[0].ancestors) return; // No ancestors\n        for (n = 0; n < d[0].ancestors.length - 1; ++n) {\n            // For each ancestor (skipping Earth)\n            str += \"<ul style='list-style-type:none'>\"; // Add header\n            str += sui.pages.AddRelTreeLine(\n                d[0].ancestors[n + 1],\n                d[0].ancestor_uids_generic[n + 1],\n                '&ndash;',\n                null\n            ); // Add it\n        }\n\n        sui.GetTreeChildren(o.asset_type, d[0].ancestor_id_path, (res) => {\n            // Get children\n            let i, j, re, m, path;\n            let counts = [];\n            try {\n                counts = res.facets.child_counts.buckets;\n            } catch (e) {} // Get child counts\n            res = res.response.docs; // Point at docs\n            for (i = 0; i < res.length; ++i) {\n                // For each child\n                path = '';\n                m = null; // Assume a loner\n                re = new RegExp(res[i].id.split('-')[1]); // Get id to search on\n                for (j = 0; j < counts.length; ++j) {\n                    // For each count\n                    if (counts[j].val.match(re)) {\n                        // In this one\n                        m = '+'; // Got kids\n                        path = counts[j].val; // Add path\n                    }\n                }\n                str += \"<ul style='list-style-type:none'>\"; // Header\n                str +=\n                    sui.pages.AddRelTreeLine(\n                        res[i].header,\n                        res[i].id,\n                        m,\n                        path\n                    ) + '</li></ul>'; // Add it\n            }\n\n            for (i = 0; i < d[0].ancestors.length; ++i) str += '</li></ul>'; // Close chain\n            content[0] = str.replace(/\\t|\\n|\\r/g, '') + '</ul><br>'; // Set 1st content array member with html\n        });\n\n        this.AddRelatedContext(o, d, content); // Get context\n    }\n\n    AddRelatedContext(\n        o,\n        c,\n        content // ADD PLACE CONTEXT CONTENT\n    ) {\n        const sui = this.sui;\n        let f,\n            i,\n            s = [],\n            n = 0;\n        for (i = 0; i < c.length; ++i) {\n            // For each subject get data as 's=[category[{title,id}]]'\n            if (c[i].block_child_type != 'related_places') continue; // Add only related places\n            if (c[i].related_places_header_s == 'Earth') continue; // Skip earth\n            ++n; // Add to count\n            if (!s[c[i].related_places_relation_label_s])\n                // If first one of this category\n                s[c[i].related_places_relation_label_s] = []; // Alloc category array\n            s[c[i].related_places_relation_label_s].push({\n                // Add subject to category\n                title: c[i].related_places_header_s, // Add title\n                sub: c[i].related_places_feature_type_s, // Sub category\n                id: c[i].related_uid_s,\n            }); // Add id\n        }\n\n        let biggest = Object.keys(s).sort((a, b) => {\n            return a.length > b.length ? -1 : 1;\n        })[0]; // Find category with most elements\n        let str = `<br><div class='sui-spHead'>Places related to ${\n            o.title\n        }</div>\n\t\t\t<div style='max-width:900px'>\n\t\t\t<strong>${o.title[0]}</strong> has <strong>${'TBD'}</strong> other place${\n            n > 1 ? 's' : ''\n        } directly related to it, which is presented here. \n\t\t\tSee the PLACE CONTEXT tab if you instead prefer to browse all subordinate and superordinate places for ${\n                o.title[0]\n            }.</div>\n\t\t\t<p><a class='sui-advEditBut' id='sui-togCatA'>Expand all</a> / <a class='sui-advEditBut' id='sui-togCatN'>Collapse all</a>\n\t\t\t</p><div style='width:100%'><div style='width:50%;display:inline-block'>`;\n        str +=\n            drawCat(biggest) +\n            \"</div><div style='display:inline-block;width:50%;vertical-align:top'>\"; // Add biggest to 1st column, set up 2nd\n        for (f in s) if (f != biggest) str += drawCat(f); // For each other category, draw it in 2nd column\n        str += '</div></div>';\n        content[1] = str.replace(/\\t|\\n|\\r/g, '') + '</ul><br>'; // Set 2nd content array member with html\n\n        function drawCat(f) {\n            // DRAW CATEGORY\n            let sub = 'xxx';\n            s[f] = s[f].sort((a, b) => {\n                return a.sub < b.sub ? -1 : 1;\n            }); // Sort by sub category\n            let str = `<div id='sui-spCat-${f.replace(/ /g, '_')}' \n\t\t\t\tclass='sui-spCat' style='background-color:${sui.assets[o.asset_type].c}'> ${\n                o.title\n            } ${f}</div>\n\t\t\t\t<ul id='sui-spCatUL-${f.replace(/ /g, '_')}'><ul>`;\n            for (i = 0; i < s[f].length; ++i) {\n                // For each item\n                if (sub != s[f][i].sub) {\n                    // A new sub category\n                    sub = s[f][i].sub; // New sub\n                    str += \"</ul><div class='sui-spSubCat'>\"; // End last sub container ul, add sub container div\n                    str +=\n                        \"<div style='background-color:#999' class='sui-spDot' id='sui-spSub-\" +\n                        s[f][i].id +\n                        \"'>&ndash;</div>\"; // Add folding dot\n                    str += '<strong>' + sub + '</strong></div>'; // Add sub title\n                    str +=\n                        \"<ul id='sui-spSubUL-\" +\n                        s[f][i].id +\n                        \"' style='list-style-type:none'>\"; // Add new container ul\n                }\n                str +=\n                    \"<li style='list-style-type:none'><a class='sui-noA' id='sui-spItem-\" +\n                    s[f][i].id;\n                str += \"' href='#p=\" + s[f][i].id + \"'>\"; // Add url\n                str +=\n                    s[f][i].title +\n                    '</a>' +\n                    sui.pages.AddPop(s[f][i].id) +\n                    '</li>'; //Add title it with popover\n            }\n            return str + '</ul></ul>'; // Close category and sub container ul\n        }\n    }\n\n    AddRelatedSubjects(\n        o,\n        c // ADD RELATED SUBJECTS CONTENT\n    ) {\n        const sui = this.sui;\n        let i,\n            s = [],\n            ss;\n        let str = `<div style='width:50%;vertical-align:top'>\n\t\t\t<div class='sui-spHead'>Subjects related to ${o.title}</div>`;\n        if (o.feature_types_ss && o.feature_types_ss.length) {\n            // If feature types\n            str += `<div class='sui-spCat' style='background-color:#6faaf1'>\n\t\t\tFeature Types</div>\n\t\t\t<div style='margin-left:24px'>`; // Header\n            for (\n                i = 0;\n                i < o.feature_types_ss.length;\n                ++i // For each feature\n            )\n                str +=\n                    '<li>' +\n                    o.feature_types_idfacet[i].split('|')[0] +\n                    sui.pages.AddPop(o.feature_types_idfacet[i].split('|')[1]) +\n                    '</li>'; // Add\n            str += '</div><br>';\n        }\n        for (i = 0; i < c.length; ++i) {\n            // For each subject get data\n            if (c[i].block_child_type != 'related_subjects') continue; // Add only related subjects\n            ss = c[i].related_subjects_display_string_s; // Add title\n            if (\n                c[i].related_subjects_time_units_t &&\n                c[i].related_subjects_time_units_t[0]\n            )\n                // If a time\n                ss += ` (${c[i].related_subjects_time_units_t[0]})`; // Add it to title\n            s.push({ title: ss, id: c[i].related_subjects_id_s }); // Add title and id\n        }\n        if (s.length) {\n            // If subjects\n            str += `<div class='sui-spCat' style='background-color:#6faaf1'>\n\t\t\t\tRelated subjects</div>\n\t\t\t\t<div style='margin-left:24px'>`; // Header\n            for (\n                i = 0;\n                i < s.length;\n                ++i // For each subject\n            )\n                str +=\n                    '<li>' + s[i].title + sui.pages.AddPop(s[i].id) + '</li>'; // Add it\n        }\n        str += '</div>'; // End half div\n        this.content[3] = str.replace(/\\t|\\n|\\r|/g, ''); // Set summary tab\n    }\n} // Places class closure\n","/* \tAUDIO VIDEO PAGES ****************************************************************************************************************************\n\n\tThis module puts up the audio video pages based on a kmap from SOLR. It uses the Kaltura media \n\tplayer to actually play the video and has a transcript section that tracks the video.\n\n\tThe SHANTI-styled Kaltura player is loaded into an iFrame using their kwidget API. Once loaded, \n\tevents are bound to trap whenever the video is played or paused. On play, PlayAV() is called to \n\tstart a ~10fps time that calls a function to update the transcript code (see section below) to \n\ttrack the video. On pause, that timer is canceled.\n\n\tSome metadata is displyed under the video along with the summary. A MORE link will reveal and \n\tadditonal summary information about the clip. A tabbed menu appears below that\n\tto reduce coginitive load, with sections showing video DETAILS, PEOPLE, involved and TECHNICAL data.\n\n\tCSS:\t\tsearchui.css\t\t\t\t\t\t\t\t\t\t// All styles are prefixed with 'sui-'\n\tJS:\t\t\tECMA-6\t\t\t\t\t\t\t\t\t\t\t\t// Uses lambda (arrow) functions\n\tRequires: \tjQuery \t\t\t\t\t\t\t\t\t\t\t\t// Almost any version should work\n\tKaltura: \thttps://cfvod.kaltura.com,\t//cdnapi.kaltura.com,\t// Kaltura API\n\tJSON:\t\tFrom Drupal site\n\tDependents:\tpages.js, searchui.js\t\t\t\t\t\t\t\t// JS modules called\n\tGlobals:\tLooks for sui and sui.pages\n\n*************************************************************************************************************************************************/\n/* eslint-disable */\nimport $ from 'jquery';\nexport default class AudioVideo {\n    constructor(\n        sui // CONSTRUCTOR\n    ) {\n        if (!sui) {\n            throw new Error('SearchUI must be passed to constructor');\n        }\n        this.sui = sui;\n        this.div = sui.pages.div; // Div to hold page (same as Pages class)\n        this.content = ['...loading', '...loading', '...loading']; // Content pages\n        this.inPlay = false; // If AV is in play\n        this.curTransSeg = -1; // Currently active transceipt segment\n        this.transRes = null; // Holds transcript resources\n        this.scrollStart = 0; // Initial transcript scroll distance when starting play\n        this.handScroll = false; // Set when transcript is scrolled by hand\n        this.mouseDown = false; // When mouse is down\n        this.playEnd = 0; // End of clip\n        this.kmap = null; // Current kmap of clip\n    }\n\n    // Added by Ndg8f: Separated out from Draw in order to make player into its own component\n    DrawPlayer(o, d) {\n        const sui = this.sui;\n        let i,\n            f,\n            wid = 100;\n        let elid = 'sui-av';\n        const _this = $('#' + elid); // Context\n        var partnerId = '381832'; // Kaltura partner id\n        var uiConfId = '31832371'; // Kaltura confidential code\n        var entryId = ''; // Media id\n        this.inPlay = false; // Not playying yet\n        let w = $(this.div).width(); // Width of area\n        //    _this.css('background-color', '#eee'); // BG color\n        //$(this.div).html(\"<div id='sui-av'></div>\"); // Clear screen\n        //sui.pages.DrawRelatedAssets(o); // Draw related assets menu if active\n        this.kmap = o; // Save kmap\n        if (typeof window.kWidget != 'undefined')\n            window.kWidget.destroy('sui-kplayer'); // If Kaltura player already initted yet, kill it\n\n        //sui.LoadingIcon(true, 64); // Show loading icon\n        // Get details from JSON\n        var str = `<div id=\"av-player-row\" class=\"row avplayer\"><div id='sui-viewerSide' class=\"av col\">`; // Left side\n        if (d.field_video && d.field_video.und)\n            // If video\n            entryId = d.field_video.und[0].entryid;\n        // Get id\n        else if (d.field_video && d.field_video.en)\n            // If video (english)\n            entryId = d.field_video.en[0].entryid;\n        // Get id\n        else if (d.field_audio && d.field_audio.und) {\n            // Audio\n            entryId = d.field_audio.und[0].entryid; // Id\n            wid = 50; // Make smaller\n        } else if (d.field_audio && d.field_audio.en) {\n            // Audio (english)\n            entryId = d.field_audio.en[0].entryid; // Id\n            wid = 50; // Make smaller\n        }\n        str += `<div class='sui-vPlayer' id='sui-kplayer'>\n        <img src=\"https://cfvod.kaltura.com/p/${partnerId}/sp/${partnerId}00/thumbnail/entry_id/${entryId}/version/100301/width/560/height/0\" fill-height\"></div>`;\n        str += `<div style='display:inline-block;width:300px;margin-left:16px'>\n                <div title='Published'>&#xe60c&nbsp;&nbsp;&nbsp;`;\n        if (d.field_year_published && d.field_year_published.en) {\n            str += sui.pages.FormatDate(d.field_year_published.en[0].value);\n        } else if (o.node_created) {\n            str += sui.pages.FormatDate(o.node_created, 'short');\n        }\n        str += '</div>';\n        str += `<div title='Duration'>&#xe61c&nbsp;&nbsp;&nbsp;${o.duration_s}</div>`;\n        str += `<div title='Uploader'>&#xe673&nbsp;&nbsp;&nbsp;${o.node_user_full_s}</div>`;\n        // End of left side list of metadata items under video\n        str += `</div><div style='display:inline-block;vertical-align:top;width:calc(100% - 320px)'>`;\n        try {\n            if (o.collection_title) {\n                const collpath =\n                    sui.pages.GetPublicUrlPath('audio-video') +\n                    'audio-video-collection/' +\n                    o.id;\n                str += `&#xe633&nbsp;&nbsp;&nbsp;\n                <a title='Collection' id='sui-avCol' href='${collpath}'>${o.collection_title}</a>`;\n            }\n        } catch (e) {}\n        try {\n            let creator_short_list = [];\n            const main_roles = ['Creator', 'Director', 'Producer'];\n            for (var crn = 0; crn < o.creator.length; crn++) {\n                let crrole =\n                    o.creator_role_ss && o.creator_role_ss.length > crn\n                        ? o.creator_role_ss[crn]\n                        : 'none';\n                if (main_roles.includes(crrole)) {\n                    creator_short_list.push(\n                        sui.pages.WrapInLangSpan(o.creator[crn], true) +\n                            ' (' +\n                            crrole +\n                            ')'\n                    );\n                }\n            }\n            if (creator_short_list.length === 0) {\n                creator_short_list = o.creator;\n            }\n            str +=\n                \"<div title='Creators'>&#xe600&nbsp;&nbsp;&nbsp;\" +\n                creator_short_list.join(', ') +\n                '</div>';\n        } catch (e) {\n            //console.error(\"in audiovideo.js: \" + e.toString());\n        }\n        str += \"<div title='Visibility'>&#xe67c&nbsp;&nbsp;&nbsp;Public</div>\"; // TODO: sniff out actual visibility when available in solr index. For now all indexed nodes are public.\n        let desc_text = o.summary ? o.summary : o.caption ? o.caption : '';\n        let langclass = sui.pages.GetLangCode(desc_text);\n        if (langclass.length > 0) {\n            langclass = ' u-' + langclass;\n        }\n        str += `</div><hr>\n        <p class='sui-sourceText${langclass}'>${desc_text}</p>`;\n        if (\n            d.field_pbcore_description &&\n            d.field_pbcore_description.und &&\n            d.field_pbcore_description.und.length\n        ) {\n            str += `<div class='sui-avMore1'><a class='sui-avMore2'>\n            SHOW MORE</a></div>`;\n            str += \"<div id='sui-avlang' style='display:none'>\";\n            let morecnt = '';\n            for (i = 0; i < d.field_pbcore_description.und.length; ++i) {\n                // For each new description\n                try {\n                    f = d.field_pbcore_description.und[i]; // Point at it\n                    if (f.field_description.und[0].value.length > 0) {\n                        const moretext = sui.pages.WrapInLangSpan(\n                            f.field_description.und[0].value\n                        );\n                        morecnt += `<strong>${f.field_language.und[0].value.toUpperCase()}</strong>\n                            ${moretext}`;\n                    }\n                } catch (e) {}\n            }\n            str += morecnt + '</div>';\n            if (morecnt.length == 0) {\n                str = str.replace(\n                    \"class='sui-avMore2'\",\n                    \"class='sui-avMore2 hidden'\"\n                );\n            }\n        }\n        str += '</div>';\n\n        $('#sui-av').html(str.replace(/\\t|\\n|\\r/g, '')); // Add player\n        $('#sui-av').addClass('processed');\n\n        this.DrawTranscript(o, '#sui-trans'); // Draw transcript in div\n        str = `//cdnapi.kaltura.com/p/${partnerId}/sp/${partnerId}00/embedIframeJs/uiconf_id/${uiConfId}/partner_id/${partnerId}`;\n        $.ajax({ url: str, dataType: 'script' }).done((e) => {\n            window.kWidget.embed({\n                targetId: 'sui-kplayer',\n                wid: '_' + partnerId,\n                uiconf_id: uiConfId,\n                entry_id: entryId,\n                flashvars: { autoPlay: false },\n                params: { wmode: 'transparent' },\n            });\n            window.kWidget.addReadyCallback(() => {\n                // When ready, add icon callback\n                let kdp = document.getElementById('sui-kplayer'); // Get div\n                if (typeof kdp !== 'object' || typeof kdp.kBind !== 'function')\n                    return; // Quit if no player ready yet\n                kdp.kBind('doPlay.__tests__', () => {\n                    $('#sui-transTab1').html('&#xe681');\n                    this.inPlay = true;\n                    this.PlayAV();\n                }); // Pause icon\n                kdp.kBind('doPause.__tests__', () => {\n                    $('#sui-transTab1').html('&#xe641');\n                    this.inPlay = false;\n                    this.playEnd = 0;\n                    clearInterval(this.transTimer);\n                }); // Play\n            });\n        });\n        sui.LoadingIcon(false); // Hide loading icon\n        if (typeof window.kWidget != 'undefined')\n            window.kWidget.embed({ entry_id: entryId }); // If Kaltura player already inittted yet\n    }\n\n    // Added by ndg8f copied from Draw and DrawMetaData to separate metadata into its own React component\n    DrawMetaNew(o, d) {\n        const sui = this.sui;\n        let i,\n            f,\n            t,\n            v,\n            wid = 100;\n        let elid = 'meta-details';\n        // Detail Tab\n        let str = '';\n        try {\n            if (o.title)\n                str +=\n                    \"<p title='Title'><strong>TITLE</strong>&nbsp;&nbsp;\" +\n                    o.title +\n                    '</p>';\n        } catch (e) {}\n        try {\n            if (o.collection_title)\n                str +=\n                    \"<p title='Collection'><strong>COLLECTION</strong>&nbsp;&nbsp;\" +\n                    o.collection_title +\n                    '</p>';\n        } catch (e) {}\n        try {\n            if (d.field_subcollection_new.und.length > 0) {\n                str += '<p><strong>SUBCOLLECTION</strong>&nbsp;&nbsp;';\n                for (i = 0; i < d.field_subcollection_new.und.length; ++i) {\n                    str +=\n                        d.field_subcollection_new.und[i].header +\n                        sui.pages.AddPop(\n                            d.field_subcollection_new.und[i].domain +\n                                '-' +\n                                d.field_subcollection_new.und[i].id\n                        ) +\n                        '&nbsp;&nbsp; ';\n                }\n                str += '</p>';\n            }\n        } catch (e) {}\n\n        try {\n            if (d.field_subject.und.length > 0) {\n                str += '<p><strong>SUBJECT</strong>&nbsp;&nbsp;';\n                for (i = 0; i < d.field_subject.und.length; ++i) {\n                    str +=\n                        d.field_subject.und[i].header +\n                        sui.pages.AddPop(\n                            d.field_subject.und[i].domain +\n                                '-' +\n                                d.field_subject.und[i].id\n                        ) +\n                        '&nbsp;&nbsp; ';\n                }\n                str += '</p>';\n            }\n        } catch (e) {}\n        try {\n            if (d.field_location.und.length > 0) {\n                str += '<p><strong>REFERENCED PLACES</strong>&nbsp;&nbsp;';\n                for (i = 0; i < d.field_location.und.length; ++i) {\n                    str +=\n                        d.field_location.und[i].header +\n                        sui.pages.AddPop(\n                            d.field_location.und[i].domain +\n                                '-' +\n                                d.field_location.und[i].id\n                        ) +\n                        '&nbsp;&nbsp; ';\n                }\n                str += '</p>';\n            }\n        } catch (e) {}\n        try {\n            str +=\n                '<p><strong>RECORDING LOCATION</strong>&nbsp;&nbsp;' +\n                d.field_recording_location_new.und[0].header +\n                sui.pages.AddPop(\n                    d.field_recording_location_new.und[0].domain +\n                        '-' +\n                        d.field_recording_location_new.und[0].id\n                ) +\n                '</p>';\n        } catch (e) {}\n        try {\n            str +=\n                '<p><strong>LANGUAGE</strong>&nbsp;&nbsp;' +\n                d.field_language_kmap.und[0].header +\n                sui.pages.AddPop(\n                    d.field_language_kmap.und[0].domain +\n                        '-' +\n                        d.field_language_kmap.und[0].id\n                ) +\n                '</p>';\n        } catch (e) {}\n        try {\n            if (d.field_kmap_terms.und.length > 0) {\n                str += '<p><strong>TERMS</strong>&nbsp;&nbsp;';\n                for (i = 0; i < d.field_kmap_terms.und.length; ++i) {\n                    str +=\n                        d.field_kmap_terms.und[i].header +\n                        sui.pages.AddPop(\n                            d.field_kmap_terms.und[i].domain +\n                                '-' +\n                                d.field_kmap_terms.und[i].id\n                        ) +\n                        '&nbsp;&nbsp; ';\n                }\n                str += '</p>';\n            }\n        } catch (e) {}\n        try {\n            str +=\n                '<p><strong>COPYRIGHT OWNER</strong>&nbsp;&nbsp;' +\n                d.field_copyright_owner.en[0].value +\n                '</p>';\n        } catch (e) {}\n        try {\n            str +=\n                '<p><strong>YEAR PUBLISHED</strong>&nbsp;&nbsp;' +\n                d.field_year_published.en[0].value +\n                '</p>';\n        } catch (e) {}\n        try {\n            str +=\n                '<p><strong>RIGHTS SUMMARY</strong>&nbsp;&nbsp;' +\n                d.field_pbcore_rights_summary.en[0].value +\n                '</p>';\n        } catch (e) {}\n        try {\n            str +=\n                '<p><strong>UPLOADED</strong>&nbsp;&nbsp;' +\n                o.timestamp.substr(0, 10) +\n                ' by ' +\n                o.node_user_full_s +\n                '</p>';\n        } catch (e) {}\n\n        if (\n            d.field_pbcore_creator &&\n            d.field_pbcore_creator.und &&\n            d.field_pbcore_creator.und.length\n        ) {\n            // If creators spec'd\n            // TODO: combine people with same role labels into a single entry\n            /*\n            for (i = 0; i < d.field_pbcore_creator.und.length; ++i) {\n                // For each creator\n                f = d.field_pbcore_creator.und[i]; // Point at it\n                try {\n                    str += `<p><strong>${f.field_creator_role.und[0].value.toUpperCase()}</strong>&nbsp;&nbsp;${sui.pages.WrapInLangSpan(\n                        f.field_creator.und[0].value\n                    )}</p>`;\n                } catch (e) {}\n            }\n\n             */\n            try {\n                let agents = {};\n                let agrole,\n                    agname = '';\n                for (i = 0; i < d.field_pbcore_creator.und.length; ++i) {\n                    f = d.field_pbcore_creator.und[i]; // Point at it\n                    // For each creator\n                    agrole = f.field_creator_role.und[0].value.toLowerCase();\n                    agname = sui.pages.WrapInLangSpan(\n                        f.field_creator.und[0].value\n                    );\n                    if (agrole in agents) {\n                        agents[agrole].push(agname);\n                    } else {\n                        agents[agrole] = [agname];\n                    }\n                }\n                for (agrole in agents) {\n                    let agrolelabel =\n                        agents[agrole].length > 1 ? agrole + 's' : agrole;\n                    str += `<p><strong>${agrolelabel.toUpperCase()}</strong>&nbsp;&nbsp;${agents[\n                        agrole\n                    ].join(', ')}</p>`;\n                }\n            } catch (e) {\n                console.error(e);\n            }\n        }\n        if (\n            d.field_pbcore_contributor &&\n            d.field_pbcore_contributor.und &&\n            d.field_pbcore_contributor.und.length\n        ) {\n            /* Old code\n            // If creators spec'd\n            for (i = 0; i < d.field_pbcore_contributor.und.length; ++i) {\n                // For each item\n                f = d.field_pbcore_contributor.und[i]; // Point at it\n                try {\n                    str += `<p><strong>CONTRIBUTING ${f.field_contributor_role.und[0].value.toUpperCase()}</strong>&nbsp;&nbsp;${sui.pages.WrapInLangSpan(\n                        f.field_contributor.und[0].value\n                    )}</p>`;\n                } catch (e) {}\n            }\n\n             */\n\n            try {\n                let agents = {};\n                let agrole,\n                    agroleprefix,\n                    agname = '';\n                for (i = 0; i < d.field_pbcore_contributor.und.length; ++i) {\n                    f = d.field_pbcore_contributor.und[i]; // Point at it\n                    // For each creator\n                    agrole = f.field_contributor_role.und[0].value.toLowerCase();\n                    agroleprefix =\n                        agrole.indexOf('assistant') > -1 ? '' : 'CONTRIBUTING';\n                    agname = sui.pages.WrapInLangSpan(\n                        f.field_contributor.und[0].value\n                    );\n                    if (agrole in agents) {\n                        agents[agrole].push(agname);\n                    } else {\n                        agents[agrole] = [agname];\n                    }\n                }\n                for (agrole in agents) {\n                    let agrolelabel =\n                        agents[agrole].length > 1 ? agrole + 's' : agrole;\n                    str += `<p><strong>${agroleprefix} ${agrolelabel.toUpperCase()}</strong>&nbsp;&nbsp;${agents[\n                        agrole\n                    ].join(', ')}</p>`;\n                }\n            } catch (e) {\n                // console.error(e);\n            }\n        }\n        try {\n            str +=\n                '<p><strong>PUBLISHER</strong>&nbsp;&nbsp;' +\n                d.field_pbcore_publisher.und[0].field_publisher.und[0].value +\n                '</p>';\n        } catch (e) {}\n        try {\n            str +=\n                '<p><strong>DATA ENTRY</strong>&nbsp;&nbsp;' +\n                o.node_user_full_s +\n                '</p>';\n        } catch (e) {}\n\n        if (\n            d.field_pbcore_instantiation &&\n            d.field_pbcore_instantiation.und &&\n            d.field_pbcore_instantiation.und.length\n        ) {\n            // If instantiation spec'd\n            for (i in d.field_pbcore_instantiation.und[0]) {\n                // For each item\n                v = d.field_pbcore_instantiation.und[0][i]; // Point at it\n                t = i.replace(/field_/, '').replace(/_/g, ' '); // Remove header and spaces\n                try {\n                    str += `<p><strong>${t.toUpperCase()}</strong>&nbsp;&nbsp;<span>${v.und[0].value.replace(\n                        /(<([^>]+)>)/gi,\n                        ''\n                    )}</span></p>`;\n                } catch (e) {}\n            }\n        }\n        try {\n            str +=\n                '<p><strong>FORMAT ID</strong>&nbsp;&nbsp;' +\n                d.field_video.und[0].entryid +\n                '</p>';\n        } catch (e) {}\n        str +=\n            '<p><strong>FORMAT ID SOURCE</strong>&nbsp;&nbsp;(Kaltura.com)</p>';\n        return '<div>' + str + '</div>';\n    }\n\n    Draw(\n        o // DRAW AUDIO/VIDEO PAGE\n    ) {\n        return;\n        // NDG8F (Aug 14, 2020): Overriding for AV in order to separate player/transcript from metadata\n        // into different components\n        const sui = this.sui;\n        let i,\n            f,\n            wid = 100;\n        const _this = this; // Context\n        var partnerId = '381832'; // Kaltura partner id\n        var uiConfId = '31832371'; // Kaltura confidential code\n        var entryId = ''; // Media id\n        this.inPlay = false; // Not playying yet\n        let w = $(this.div).width(); // Width of area\n        $(this.div).css('background-color', '#eee'); // BG color\n        $(this.div).html(\"<div id='sui-av'></div>\"); // Clear screen\n        sui.pages.DrawRelatedAssets(o); // Draw related assets menu if active\n        this.kmap = o; // Save kmap\n        if (typeof window.kWidget != 'undefined')\n            window.kWidget.destroy('sui-kplayer'); // If Kaltura player already initted yet, kill it\n\n        sui.LoadingIcon(true, 64); // Show loading icon\n        sui.GetJSONFromKmap(o, (d) => {\n            // Get details from JSON\n            var str = `<div id=\"av-player-row\" class=\"row avplayer\"><div id='sui-viewerSide' class=\"av col\">`; // Left side\n            if (d.field_video && d.field_video.und)\n                // If video\n                entryId = d.field_video.und[0].entryid;\n            // Get id\n            else if (d.field_video && d.field_video.en)\n                // If video (english)\n                entryId = d.field_video.en[0].entryid;\n            // Get id\n            else if (d.field_audio && d.field_audio.und) {\n                // Audio\n                entryId = d.field_audio.und[0].entryid; // Id\n                wid = 50; // Make smaller\n            } else if (d.field_audio && d.field_audio.en) {\n                // Audio (english)\n                entryId = d.field_audio.en[0].entryid; // Id\n                wid = 50; // Make smaller\n            }\n            str += `<div class='sui-vPlayer' id='sui-kplayer'>\n\t\t\t<img src=\"https://cfvod.kaltura.com/p/${partnerId}/sp/${partnerId}00/thumbnail/entry_id/${entryId}/version/100301/width/560/height/0\" fill-height\"></div>`;\n            str += `<br><br><div style='display:inline-block;width:300px;margin-left:16px'>\n\t\t\t<div title='Duration'>&#xe61c&nbsp;&nbsp;&nbsp;${o.duration_s}</div>\n\t\t\t<div title='Published'>&#xe60c&nbsp;&nbsp;&nbsp;Published `;\n            if (d.field_year_published && d.field_year_published.en)\n                str += +d.field_year_published.en[0].value;\n            else if (o.node_created)\n                str += sui.pages.FormatDate(o.node_created);\n            str += '</div>';\n            try {\n                if (o.collection_title)\n                    str += `<a title='Collection' id='sui-avCol'\n\t\t\t\t\thref='#c=${o.asset_type}-${o.id}=${o.collection_idfacet[0]}'>\n\t\t\t\t\t&#xe633&nbsp;&nbsp;&nbsp;\n\t\t\t\t\t<a title='Collection' id='sui-avCol'\thref='#p=${o.collection_uid_s}'>${o.collection_title}</a>`;\n            } catch (e) {}\n            str += `</div><div style='display:inline-block;vertical-align:top;width:calc(100% - 320px)'>`;\n            try {\n                str +=\n                    \"<div title='Creators'>&#xe600&nbsp;&nbsp;&nbsp;\" +\n                    o.creator.join(', ') +\n                    '</div>';\n            } catch (e) {}\n            str += `</div><hr>\n\t\t\t<p class='sui-sourceText'>${\n                o.summary ? o.summary : o.caption ? o.caption : ''\n            }</p>`;\n            if (\n                d.field_pbcore_description &&\n                d.field_pbcore_description.und &&\n                d.field_pbcore_description.und.length\n            ) {\n                str += `<div class='sui-avMore1'><a class='sui-avMore2'>\n\t\t\t\tSHOW MORE</a></div><br>`;\n                str += \"<div id='sui-avlang' style='display:none'>\";\n                let morecnt = '';\n                for (i = 0; i < d.field_pbcore_description.und.length; ++i) {\n                    // For each new description\n                    try {\n                        f = d.field_pbcore_description.und[i]; // Point at it\n                        if (f.field_description.und[0].value.length > 0) {\n                            morecnt += `<strong>${f.field_language.und[0].value.toUpperCase()}</strong><br>${\n                                f.field_description.und[0].value\n                            }<br>`;\n                        }\n                    } catch (e) {}\n                }\n                str += morecnt + '</div>';\n                if (morecnt.length == 0) {\n                    str = str.replace(\n                        \"class='sui-avMore2'\",\n                        \"class='sui-avMore2 hidden'\"\n                    );\n                }\n            }\n            str += '</div>';\n\n            $('#sui-av').html(str.replace(/\\t|\\n|\\r/g, '')); // Add player\n\n            let info_tabs = sui.pages.DrawTabMenu([\n                'DETAILS',\n                'PEOPLE',\n                'TECHNICAL',\n            ]); // Add tab menu\n            info_tabs = $(\n                '<div id=\"av-info-tabs\" class=\"row\">' + info_tabs + '</div>'\n            );\n            $('#sui-av').append(info_tabs);\n            $('#sui-avCol').on('click', () => {\n                // ON COLLECTION CLICK\n                sui.GetKmapFromID(o.collection_uid_s, (kmap) => {\n                    sui.SendMessage('', kmap);\n                }); // Get kmap and show page\n                return false; // Stop propagation\n            });\n\n            this.DrawTranscript(o, '#sui-trans'); // Draw transcript in div\n            str = `//cdnapi.kaltura.com/p/${partnerId}/sp/${partnerId}00/embedIframeJs/uiconf_id/${uiConfId}/partner_id/${partnerId}`;\n            $.ajax({ url: str, dataType: 'script' }).done((e) => {\n                window.kWidget.embed({\n                    targetId: 'sui-kplayer',\n                    wid: '_' + partnerId,\n                    uiconf_id: uiConfId,\n                    entry_id: entryId,\n                    flashvars: { autoPlay: false },\n                    params: { wmode: 'transparent' },\n                });\n                window.kWidget.addReadyCallback(() => {\n                    // When ready, add icon callback\n                    let kdp = document.getElementById('sui-kplayer'); // Get div\n                    if (\n                        typeof kdp !== 'object' ||\n                        typeof kdp.kBind !== 'function'\n                    )\n                        return; // Quit if no player ready yet\n                    kdp.kBind('doPlay.__tests__', () => {\n                        $('#sui-transTab1').html('&#xe681');\n                        this.inPlay = true;\n                        this.PlayAV();\n                    }); // Pause icon\n                    kdp.kBind('doPause.__tests__', () => {\n                        $('#sui-transTab1').html('&#xe641');\n                        this.inPlay = false;\n                        this.playEnd = 0;\n                        clearInterval(this.transTimer);\n                    }); // Play\n                });\n            });\n            sui.LoadingIcon(false); // Hide loading icon\n            if (typeof window.kWidget != 'undefined')\n                window.kWidget.embed({ entry_id: entryId }); // If Kaltura player already inittted yet\n            this.DrawMetaData(o, d); // Draw metadata content\n            $('.sui-tabTab').eq(0).addClass('active');\n            showTab(0); // Open details\n\n            $('[id^=sui-tabTab]').on('click', (e) => {\n                // ON TAB CLICK\n                $('.sui-tabTab.active').removeClass('active');\n                $(e.currentTarget).addClass('active');\n                var id = e.currentTarget.id.substring(10); // Get index of tab\n                showTab(id); // Draw it\n            });\n\n            function showTab(which) {\n                $('#sui-tabContent').html(_this.content[which]); // Set content\n            }\n        });\n    }\n\n    DrawMetaData(\n        o,\n        d // DRAW TABBED METADATA\n    ) {\n        const sui = this.sui;\n        let i, t, v, f;\n        let str = ''; // Start fresh on tab 0\n        try {\n            if (o.title)\n                str +=\n                    \"<p title='Title'><strong>TITLE</strong>&nbsp;&nbsp;\" +\n                    o.title +\n                    '</p>';\n        } catch (e) {}\n        try {\n            if (o.collection_title)\n                str +=\n                    \"<p title='Collection'><strong>COLLECTION</strong>&nbsp;&nbsp;\" +\n                    o.collection_title +\n                    '</p>';\n        } catch (e) {}\n\n        try {\n            if (d.field_subcollection_new.und.length > 0) {\n                str += '<p><strong>SUBCOLLECTION</strong>&nbsp;&nbsp;';\n                for (i = 0; i < d.field_subcollection_new.und.length; ++i) {\n                    str +=\n                        d.field_subcollection_new.und[i].header +\n                        sui.pages.AddPop(\n                            d.field_subcollection_new.und[i].domain +\n                                '-' +\n                                d.field_subcollection_new.und[i].id\n                        ) +\n                        '&nbsp;&nbsp; ';\n                }\n                str += '</p>';\n            }\n        } catch (e) {}\n        try {\n            str += '<p><strong>SUBJECT</strong>&nbsp;&nbsp;';\n            for (i = 0; i < d.field_subject.und.length; ++i) {\n                str +=\n                    d.field_subject.und[i].header +\n                    sui.pages.AddPop(\n                        d.field_subject.und[i].domain +\n                            '-' +\n                            d.field_subject.und[i].id\n                    ) +\n                    '&nbsp;&nbsp; ';\n            }\n            str += '</p>';\n        } catch (e) {}\n        try {\n            str +=\n                '<p><strong>RECORDING LOCATION</strong>&nbsp;&nbsp;' +\n                d.field_recording_location_new.und[0].header +\n                sui.pages.AddPop(\n                    d.field_recording_location_new.und[0].domain +\n                        '-' +\n                        d.field_recording_location_new.und[0].id\n                ) +\n                '</p>';\n        } catch (e) {}\n        try {\n            str +=\n                \"<p'><strong>LANGUAGE</strong>&nbsp;&nbsp;\" +\n                d.field_language_kmap.und[0].header +\n                sui.pages.AddPop(\n                    d.field_language_kmap.und[0].domain +\n                        '-' +\n                        d.field_language_kmap.und[0].id\n                ) +\n                '</p>';\n        } catch (e) {}\n        try {\n            str +=\n                '<p><strong>TERMS</strong>&nbsp;&nbsp;' +\n                d.field_terms.und[0].header +\n                '</p>';\n        } catch (e) {}\n        try {\n            str +=\n                '<p><strong>COPYRIGHT OWNER</strong>&nbsp;&nbsp;' +\n                d.field_copyright_owner.en[0].value +\n                '</p>';\n        } catch (e) {}\n        try {\n            str +=\n                '<p><strong>YEAR PUBLISHED</strong>&nbsp;&nbsp;' +\n                d.field_year_published.en[0].value +\n                '</p>';\n        } catch (e) {}\n        try {\n            str +=\n                '<p><strong>RIGHTS SUMMARY</strong>&nbsp;&nbsp;' +\n                d.field_pbcore_rights_summary.en[0].value +\n                '</p>';\n        } catch (e) {}\n        try {\n            str +=\n                '<p><strong>UPLOADED</strong>&nbsp;&nbsp;' +\n                o.timestamp.substr(0, 10) +\n                ' by ' +\n                o.node_user_full_s +\n                '</p>';\n        } catch (e) {}\n        this.content[0] = \"<div style='height:2px'/>\" + str + '<br>'; // Add to tab\n\n        str = ''; // Start fresh on tab 1\n        if (\n            d.field_pbcore_creator &&\n            d.field_pbcore_creator.und &&\n            d.field_pbcore_creator.und.length\n        ) {\n            // If creators spec'd\n            for (i = 0; i < d.field_pbcore_creator.und.length; ++i) {\n                // For each creator\n                f = d.field_pbcore_creator.und[i]; // Point at it\n                try {\n                    str += `<p><strong>${f.field_creator_role.und[0].value.toUpperCase()}</strong>&nbsp;&nbsp;${sui.pages.WrapInLangSpan(\n                        f.field_creator.und[0].value\n                    )}</p>`;\n                } catch (e) {}\n            }\n        }\n        if (\n            d.field_pbcore_contributor &&\n            d.field_pbcore_contributor.und &&\n            d.field_pbcore_contributor.und.length\n        ) {\n            // If creators spec'd\n            for (i = 0; i < d.field_pbcore_contributor.und.length; ++i) {\n                // For each item\n                f = d.field_pbcore_contributor.und[i]; // Point at it\n                try {\n                    str += `<p><strong>CONTRIBUTING ${f.field_contributor_role.und[0].value.toUpperCase()}</strong>&nbsp;&nbsp;${\n                        f.field_contributor.und[0].value\n                    }</p>`;\n                } catch (e) {}\n            }\n        }\n        try {\n            str +=\n                '<p><strong>PUBLISHER</strong>&nbsp;&nbsp;' +\n                d.field_pbcore_publisher.und[0].field_publisher.und[0].value +\n                '</p>';\n        } catch (e) {}\n        try {\n            str +=\n                '<p><strong>DATA ENTRY</strong>&nbsp;&nbsp;' +\n                o.node_user_full_s +\n                '</p>';\n        } catch (e) {}\n        this.content[1] = \"<div style='height:2px'/>\" + str + '<br>'; // Add to tab\n\n        str = ''; // Start fresh on tab 2\n        if (\n            d.field_pbcore_instantiation &&\n            d.field_pbcore_instantiation.und &&\n            d.field_pbcore_instantiation.und.length\n        ) {\n            // If instantiation spec'd\n            for (i in d.field_pbcore_instantiation.und[0]) {\n                // For each item\n                v = d.field_pbcore_instantiation.und[0][i]; // Point at it\n                t = i.replace(/field_/, '').replace(/_/g, ' '); // Remove header and spaces\n                try {\n                    str += `<p><strong>${t.toUpperCase()}</strong>&nbsp;&nbsp;${\n                        v.und[0].value\n                    }</p>`;\n                } catch (e) {}\n            }\n        }\n        try {\n            str +=\n                '<p><strong>FORMAT ID</strong>&nbsp;&nbsp;' +\n                d.field_video.und[0].entryid +\n                '</p>';\n        } catch (e) {}\n        str +=\n            '<p><strong>FORMAT ID SOURCE</strong>&nbsp;&nbsp;(Kaltura.com)</p>';\n        this.content[2] = \"<div style='height:2px'/>\" + str + '<br>'; // Add to tab\n    } //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    /* TRANSCRIPT //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n\tThis section draws the transcript which follows a video, if available.\n\n*/ DrawTranscript(\n        kmap,\n        div // DRAW TRANSCRIPT FROM SOLR\n    ) {\n        var i, o, seg;\n        var l = {}; // Holds filed:language pairs\n        if (!kmap.trid_i) return; // Quit if no transcript\n        this.curTransSeg = -1; // Start at top\n\n        l.ts_content_rus = 'Russian';\n        l.content_bod = 'Tibetan';\n        l.dzo_bod = 'Dzongkha';\n        l.ts_content_sgt = 'Brokpake';\n        l.ts_content_kjz = 'Bumthangkha';\n        l.ts_content_tgf = 'Chalikha';\n        l.ts_content_cgk = 'Chocangacakha';\n        l.ts_content_dka = 'Dakpakha';\n        l.ts_content_dzl = 'Dzalakha';\n        l.ts_content_goe = 'Gongduk';\n        l.ts_content_xkz = 'Kurtop';\n        l.ts_content_kru = 'Kuruz';\n        l.ts_content_lkh = 'Lakha';\n        l.ts_content_lya = 'Layakha';\n        l.ts_content_lep = 'Lepcha';\n        l.ts_content_lhp = 'Lhokpu';\n        l.ts_content_luk = 'Lunanakha';\n        l.ts_content_npb = 'Nupbikha';\n        l.ts_content_neh = 'Mangdekha';\n        l.ts_content_ole = 'Olekha';\n        l.ts_content_tsj = 'Tshangla';\n        l.ts_content_xkf = 'Khengkha';\n        l.ts_content_wylie = 'Wylie';\n        l.ts_content_gyal = 'Gyalsumdo';\n        l.ts_content_gvr = 'Gurung';\n        l.ts_content_npa = 'Nar Phu';\n        l.ts_content_nmm = 'Manange';\n        l.ts_content_kte = 'Nubri';\n        l.ts_content_tsum = 'Tsum';\n        l.ts_content_nep = 'Nepali';\n        l.ts_content_eng = 'English';\n        l.ts_content_zho = 'Chinese';\n        l.ts_content_und = 'Unknown';\n        l.ts_content_gloss = 'Morpheme glossing';\n\n        var res = {\n            languages: {},\n            speakers: {},\n            segs: [],\n            layout: 'Normal',\n            rev: 0,\n            speaker: '',\n        }; // Final data\n        var url =\n            'https://ss251856-us-east-1-aws.measuredsearch.com/solr/av_test/select?indent=on&q=is_trid:' +\n            kmap.trid_i +\n            '&wt=json&start=0&rows=1000';\n        $.ajax({ url: url, dataType: 'jsonp', jsonp: 'json.wrf' }).done(\n            (data) => {\n                // Get transcript data\n                data.response.docs.sort(function (a, b) {\n                    return a.fts_start > b.fts_start ? 1 : -1;\n                }); // Sort\n                for (i = 0; i < data.response.docs.length; ++i) {\n                    // For each seg in doc\n                    o = data.response.docs[i]; // Point at it\n                    seg = {\n                        start: o.fts_start,\n                        end: o.fts_end,\n                        dur: o.fts_duration,\n                    }; // Make seg with timings\n                    if (o.ss_speaker_bod) {\n                        res.speakers[o.ss_speaker_bod] = 1;\n                        seg.speaker = o.ss_speaker_bod;\n                    } // Set speaker?\n                    seg.lang = o.ss_language ? o.ss_language : ''; // Set seg language\n                    for (var lang in l) {\n                        // For each seg\n                        if (o[lang]) {\n                            // If a language match\n                            seg[l[lang]] = o[lang]; // Add to transcript under language\n                            res.languages[l[lang]] = 1; // Add to languages list\n                        }\n                    }\n                    res.segs.push(seg); // Add seg to list\n                }\n                if (!res.segs.length) return; // Quit if no segs\n                this.transRes = res; // Set segs\n                if ($(this.div).width() > 700)\n                    // If mobile\n                    $('#sui-viewerSide').width($(this.div).width() * 0.5); // Halve viewer width\n                //$(\"#sui-kplayer\").height($(this.div).width()*0.5*0.5625);\t\t\t\t\t\t\t// Set height based on aspect ratio\n                if ($('#av-trscrpt-wrapper').length === 0) {\n                    this.DrawTranscriptMenu(); // Draw transcripts header\n                }\n                this.DrawTransContent(); // Draw the transcipt content\n            }\n        ); // AJAX closure\n    }\n\n    DrawTranscriptMenu() {\n        // DRAW TRANSCRIPT MENU\n        var res = this.transRes; // Point at res\n        var str = `<div id='av-trscrpt-wrapper' class='col'>\n            <div class='av-trscrpt-ctrls row'>\n                <div id='sui-transTab0' class='sui-transTab col' title='Options'>&#xe66f&#xe609</div>\n                <div id='sui-transTab1' class='sui-transTab col' title='Play/Pause'>&#xe641</div>\n                <div id='sui-transTab2' class='sui-transTab col' title='Previous line'>&#xe602</div>\n                <div id='sui-transTab3' class='sui-transTab col' title='Same line'>&#xe632</div>\n                <div id='sui-transTab4' class='sui-transTab col' title='Next line'>&#xe604</div>\n                <div id='sui-transTab5' class='sui-transTab col' style='border:none' title='Search transcript'>&#xe623</div>\n                <div id='sui-transSrc' class='sui-transSrc'>\n                    <div class=\"transSrcWrap\">\n                        <div class=\"navigator\">\n                            <div class=\"navwrapper\" style=\"display: none;\">\n                                <div id='sui-transSrcB' style='display:inline-block;color:#fff;font-size:20px;cursor:pointer' title='Previous result'>&#xe640</div>\n                                <div id='sui-transSrcN' style='display:inline-block;color:#fff;margin:0 16px;font-size:12px;cursor:pointer;vertical-align:4px'>0 of 0</div>\n                                <div id='sui-transSrcF' style='display:inline-block;color:#fff;font-size:20px;cursor:pointer' title='Previous result'>&#xe641</div>\n                            </div>\n                        </div>\n                        <div id='sui-transSrcGo' class='sui-search4'>\n                            <input type='text' id='sui-transSrcInp' class='sui-search2' size='40' placeholder='Search this transcript'/>\n                            <span class=\"icon shanticon-magnify search\"></span>\n                            <span class=\"icon shanticon-cancel clear\" style=\"display: none;\"></span>\n                            <button class=\"search\"><span class=\"icon shanticon-angle-right\"></span></button>\n                        </div>\n                        <!--\n                        <div id='sui-transSrcGo' class='sui-search4'>&#xe623</div> &lt;!&ndash; style='float:right;margin:12px 16px 0 0' &ndash;&gt;\n                            <div class='sui-search1'> &lt;!&ndash; style='float:right;margin-top:12px' &ndash;&gt;\n                                <input type='text' id='sui-transSrcInp' class='sui-search2' placeholder='Search this transcript'>\n                                <div id='sui-clear' class='sui-search3'>&#xe610</div>\n                            </div>\n                        </div>-->\n                    </div>\n                <div id='sui-transOps' class='sui-transOps'></div>\n            </div>\n            <div id='sui-trans' class='sui-trans row'></div>\n\t\t</div>`;\n        $('#av-player-row').append(str.replace(/\\t|\\n|\\r/g, ''));\n\n        var curHit = 0,\n            hits = []; // Holds search hits\n\n        $('#sui-transSrcGo button.search').on('click', () => {\n            // ON SEARCH\n            let i, r, lang;\n            hits = [];\n            curHit = 0; // Reset hits\n\n            if ($('#sui-transSrcInp').val()) {\n                //console.log(\"Trans Search val: \" + $('#sui-transSrcInp').val());\n                // If a valid term\n                r = RegExp($('#sui-transSrcInp').val(), 'i'); // Turn into regex\n                for (\n                    i = 0;\n                    i < res.segs.length;\n                    ++i // For each seg\n                )\n                    for (lang in res.languages) // For each language\n                        if (res.segs[i][lang] && res.segs[i][lang].match(r))\n                            hits.push(i); // If something there\n                window.sui.av.transhits = hits;\n            }\n            show(hits); // Show status\n            $('#sui-transSrcGo .icon.clear').show();\n        });\n\n        $('#sui-transSrcInp').on('change', () => {\n            $('#sui-transSrcGo').trigger('click');\n        }); // ON TEXT CHANGED\n        $('#sui-transSrcB').on('click', () => {\n            curHit = Math.max(0, curHit - 1);\n            show();\n        }); // ON PREVIOUS\n        $('#sui-transSrcF').on('click', () => {\n            curHit = Math.min(hits.length - 1, curHit + 1);\n            show();\n        }); // ON NEXT\n\n        $('div#sui-transSrcGo .icon.clear').on('click', () => {\n            $('.srchit').each(function () {\n                var mytxt = $(this).text();\n                $(this).replaceWith(mytxt);\n            });\n            $('#sui-transSrcInp').val('');\n            $(\n                'div#sui-transSrcGo .icon.clear, .transSrcWrap .navwrapper'\n            ).hide();\n        });\n\n        function show(hits) {\n            // SHOW STATUS\n            const sui = window.sui;\n            if (typeof hits == 'undefined') {\n                hits = sui.av.transhits;\n            }\n            // Remove previous highlights\n            $('.srchit').each(function () {\n                var mytxt = $(this).text();\n                $(this).replaceWith(mytxt);\n            });\n            // Highlight all hits\n            hits.map(function (hid) {\n                var segtxt = $('#sui-transBox-' + hid + ' span').html();\n                var srchval = $('#sui-transSrcInp').val();\n                segtxt = segtxt.replace(\n                    new RegExp(srchval, 'g'),\n                    `<span class=\"srchit\">${srchval}</span>`\n                );\n                $('#sui-transBox-' + hid + ' span').html(segtxt);\n            });\n            var t = hits.length ? curHit + 1 : 0; // Current number\n            if (hits.length > 0) {\n                $('.transSrcWrap .navwrapper').show();\n            }\n            $('#sui-transSrcN').html(t + ' of ' + hits.length); // Set number found\n            if (hits.length) {\n                // If somthing\n                sui.av.curTransSeg = hits[curHit]; // Set cur seg\n                sui.av.HighlightSeg(sui.av.curTransSeg, undefined); // Highlight seg\n            }\n        }\n\n        str = `<div class='sui-transRow'>Transcript options<span class='sui-transCheck trans-opts-close'>&#xe60f</span></div>\n\t\t<div class='sui-transLab'>LANGUAGES</div>`;\n        for (var lang in res.languages) // Add each language found in transcript\n            str +=\n                \"<div class='sui-transRow' id='sui-transLan-\" +\n                lang +\n                \"'>- \" +\n                lang +\n                \"<span id='sui-transLang-\" +\n                lang +\n                \"' class='sui-transCheck' style='color:#58aab4'>&#xe60e</span></div>\";\n        str += `<div class='sui-transLab'>SPEAKERS</div>\n\t\t<div class='sui-transRow'>- Tibetan<span id='sui-transS1' class='sui-transCheck' style='color:#58aab4'>&#xe60e</span></div>\t\n\t\t<div class='sui-transLab'>LAYOUTS</div>\n\t\t<div class='sui-transRow' id='sui-transMinR'>- Minimal<span id='sui-transMin' class='sui-transCheck'>&#xe60e</span></div>\n\t\t<div class='sui-transRow' id='sui-transRevR'>- Reversed<span id='sui-transRev' class='sui-transCheck'>&#xe60e</span></div>\n\t\t<div class='sui-transLab'>DOWNLOADS</div>\n\t\t<div class='sui-transRow' id='sui-transStr'->- SRT file<span class='sui-transCheck' style='color:#58aab4'>&#xe616</span></div>`;\n        $('#sui-transOps').html(str.replace(/\\t|\\n|\\r/g, ''));\n\n        $('#sui-transStr').on('click', () => {\n            this.SaveStrFile();\n        }); // ON SAVE SRT FILE\n\n        $('[id^=sui-transLan-]').on('click', (e) => {\n            // ON LANGUAGE CLICK\n            var res = this.transRes;\n            var lang = e.currentTarget.id.substring(13); // Get language\n            res.languages[lang] = 1 - res.languages[lang]; // Toggle value\n            $('#sui-transLang-' + lang).css(\n                'color',\n                res.languages[lang] ? '#58aab4' : '#ccc'\n            ); // Set check color\n            this.transRes = res;\n            this.DrawTransContent(); // Redraw\n        });\n\n        $('#sui-transMinR').on('click', () => {\n            // ON CLICK MINIMAL/NORMAL\n            var res = this.transRes;\n            res.layout = res.layout == 'Minimal' ? 'Normal' : 'Minimal'; // Toggle state\n            $('#sui-transMin').css(\n                'color',\n                res.layout == 'Minimal' ? '#58aab4' : '#ccc'\n            ); // Set check color\n            this.transRes = res;\n            this.DrawTransContent(); // Redraw\n        });\n\n        $('#sui-transRevR').on('click', () => {\n            // ON CLICK REVERSE\n            var res = this.transRes;\n            res.rev = res.rev ? 0 : 1; // Toggle state\n            $('#sui-transRev').css('color', res.rev ? '#58aab4' : '#ccc'); // Set check color\n            this.transRes = res;\n            this.DrawTransContent(); // Redraw\n        });\n\n        $('#sui-transTab0').on('click', () => {\n            $('#sui-transOps').slideToggle('fast');\n        }); // ON OPTIONS MENU CLICK\n\n        $('.sui-transCheck.trans-opts-close').on('click', () => {\n            $('#sui-transOps').slideToggle('fast');\n        });\n\n        $('#sui-transTab5').on('click', () => {\n            $('#sui-transSrc').slideToggle('fast');\n\n            if ($('#av-trscrpt-wrapper #sui-trans').hasClass('searchshown')) {\n                $('#av-trscrpt-wrapper #sui-trans').removeClass('searchshown');\n            } else {\n                $('#av-trscrpt-wrapper #sui-trans').addClass('searchshown');\n            }\n        }); // ON SEARCH MENU CLICK\n\n        $('#sui-transTab1').on('click', (e) => {\n            // ON PLAY CLICK\n            e.preventDefault();\n            clearInterval(this.transTimer); // Kill timer\n            if (this.inPlay) $('#sui-kplayer')[0].sendNotification('doPause');\n            // Pause\n            else {\n                this.PlayAV();\n                $('#sui-kplayer')[0].sendNotification('doPlay'); // Play\n            }\n        });\n\n        $('#sui-transTab2').on('click', (e) => {\n            // ON PLAY PREVIOUS SEG CLICK\n            e.preventDefault();\n            var res = this.transRes;\n            this.curTransSeg = Math.max(this.curTransSeg - 1, 0); // Go back one\n            this.PlayAV(\n                res.segs[this.curTransSeg].start,\n                res.segs[this.curTransSeg].end\n            ); // Play it\n            $('#sui-kplayer')[0].sendNotification('doPlay'); // Start playing\n        });\n\n        $('#sui-transTab3').on('click', (e) => {\n            // ON PLAY THIS SEG CLICK\n            e.preventDefault();\n            this.PlayAV(\n                res.segs[this.curTransSeg].start,\n                res.segs[this.curTransSeg].end\n            ); // Play it\n            $('#sui-kplayer')[0].sendNotification('doPlay'); // Start playing\n        });\n\n        $('#sui-transTab4').on('click', (e) => {\n            // ON PLAY NEXT SEG CLICK\n            e.preventDefault();\n            this.curTransSeg = Math.min(\n                this.curTransSeg + 1,\n                res.segs.length - 1\n            ); // Go to next one\n            this.PlayAV(\n                res.segs[this.curTransSeg].start,\n                res.segs[this.curTransSeg].end\n            ); // Play it\n            $('#sui-kplayer')[0].sendNotification('doPlay'); // Start playing\n        });\n    }\n\n    SaveStrFile() {\n        // SAVE AS SRT FILE\n        var res = this.transRes; // Point at res\n        let lang,\n            i,\n            o,\n            str = '';\n        for (i = 0; i < res.segs.length; ++i) {\n            // For each seg\n            o = res.segs[i]; // Point at it\n            str += `${i + 1}\\n${o.start},000 --> ${o.end},000\\n${\n                o.speaker ? '>> ' + o.speaker + '\\n' : ''\n            }`;\n            for (lang in res.languages) {\n                // For each language\n                if (res.segs[i][lang] && res.languages[lang])\n                    // If something there and checked\n                    str += res.segs[i][lang] + '\\n'; // Add transcription\n            }\n            str += '\\n';\n        }\n        var element = document.createElement('a');\n        element.setAttribute(\n            'href',\n            'data:text/plain;charset=utf-8,' + encodeURIComponent(str)\n        );\n        element.setAttribute('download', 'transcript-' + this.kmap.id + '.str');\n        element.style.display = 'none';\n        document.body.appendChild(element);\n        element.click();\n        document.body.removeChild(element);\n    }\n\n    DrawTransContent() {\n        // DRAW TRANSCRIPT CONTENT IN WINDOW\n        var i,\n            lang,\n            str = '';\n        const _this = this; // Context\n        var res = this.transRes; // Point at res\n        if (res.layout == 'Minimal') {\n            // Drawing minimal layput\n            for (i = 0; i < res.segs.length; ++i) {\n                // For each seg\n                str += `<div class='sui-transMinSeg' id='sui-transMinSeg-${i}'>\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t<div style='float:${res.rev ? 'right' : 'left'};font-size:18px;'>\n\t\t\t\t${res.segs[i].speaker ? res.segs[i].speaker + '<br>' : ''}\n\t\t\t\t<div class='sui-transMinPlay' id='sui-transPlay-${i}' title='Play line ${this.SecondsToTimecode(\n                    res.segs[i].start\n                )}'>&#xe680</div> \n\t\t\t\t</div>\n\t\t\t\t<div class='sui-transMinBox' id='sui-transMinBox-${i}'\n\t\t\t\tstyle='margin:${res.rev ? '0 150px 0 0' : '0  0 0 150px'}'>`;\n                for (lang in res.languages) // For each language\n                    if (res.segs[i][lang] && res.languages[lang])\n                        // If something there and checked\n                        str +=\n                            res.segs[i][lang] +\n                            \"<hr style='margin:0;border-top:1px dashed #eee'>\"; // Add transcription and dividing line\n                str += '</div></div>'; // Close box and seg\n            }\n        } else {\n            // Normal\n            for (i = 0; i < res.segs.length; ++i) {\n                // For each seg\n                str += `<div class='sui-transSeg' id='sui-transSeg-${i}'>\n\t\t\t\t<div style='float:${res.rev ? 'right' : 'left'};font-size:18px;'>\n\t\t\t\t${res.segs[i].speaker ? res.segs[i].speaker + '<br>' : ''}\n\t\t\t\t<div class='sui-transPlay' id='sui-transPlay-${i}' \n\t\t\t\ttitle='Play line'>&#xe680\n\t\t\t\t<span style='margin-left:24px;font-size:12px;vertical-align:4px'>\n\t\t\t\t${this.SecondsToTimecode(res.segs[i].start)}</span></div></div> \n\t\t\t\t<div class='sui-transBox' id='sui-transBox-${i}'\n\t\t\t\tstyle='margin:${res.rev ? '0 150px 0 0' : '0  0 0 150px'}'>`;\n                for (lang in res.languages) // For each language\n                    if (res.segs[i][lang] && res.languages[lang])\n                        // If something there and checked\n                        str +=\n                            sui.pages.WrapInLangSpan(res.segs[i][lang]) +\n                            \"<hr style='margin:0;border-top:1px dashed #eee'>\"; // Add transcription and dividing line\n                str += '</div></div>'; // Close box and seg\n            }\n        }\n        $('#sui-trans').html(str.replace(/\\t|\\n|\\r/g, '')); // Add transcript to div\n\n        $('#sui-trans').on('mousedown', () => {\n            this.mouseDown = true;\n        }); // Set scrolling flag\n        $('#sui-trans').on('mouseup', () => {\n            this.mouseDown = false;\n        }); // Unset flag\n        $('#sui-trans').on('scroll', function () {\n            // On scroll event\n            _this.handScroll = true; // Inhibit auto scrolling\n            if (_this.mouseDown) return; // Quit if mouse is still down\n            clearTimeout($.data(this, 'scrollTimer'));\n            $.data(\n                this,\n                'scrollTimer',\n                setTimeout(function () {\n                    _this.handScroll = false;\n                }, 250)\n            );\n        });\n\n        $('[id^=sui-transPlay-]').on('click', (e) => {\n            // ON PLAY CLICK\n            this.curTransSeg = e.currentTarget.id.substring(14); // Get index of seg\n            this.PlayAV(\n                res.segs[this.curTransSeg].start,\n                res.segs[this.curTransSeg].end\n            ); // Play seg\n            $('#sui-kplayer')[0].sendNotification('doPlay'); // Start playing\n        });\n    }\n\n    PlayAV(\n        start,\n        end // PLAY TRANSCRIPT SEGMENT\n    ) {\n        var i;\n        var res = this.transRes; // Point at res\n\n        clearInterval(this.transTimer); // Kill timer\n        this.scrollStart = $('#sui-trans').scrollTop(); // Scroll\n        if (start != undefined)\n            $('#sui-kplayer')[0].sendNotification('doSeek', start); // Seek to start\n        if (end) this.playEnd = end; // Set ending point\n        this.transTimer = setInterval((e) => {\n            if (typeof $('#sui-kplayer')[0].evaluate !== 'function') {\n                return;\n            }\n            // Set interval and handler\n            var now = $('#sui-kplayer')[0].evaluate(\n                '{video.player.currentTime}'\n            ); // Get current player time\n            if (this.playEnd && now >= this.playEnd) {\n                // An end set and past it\n                clearInterval(this.transTimer); // Kill timer\n                $('#sui-kplayer')[0].sendNotification('doPause'); // Pause video\n                this.playEnd = 0; // Clear end\n                return; // Quit\n            }\n            for (i = 0; i < res.segs.length; ++i) {\n                // For each seg\n                if (now >= res.segs[i].start && now < res.segs[i].end) {\n                    // In this one\n                    this.curTransSeg = i; // Set as current\n                    break; // Quit looking\n                }\n            }\n            if (this.curTransSeg > 0)\n                this.HighlightSeg(this.curTransSeg, start); // Highlight seg if note prelude\n        }, 100); // Time ~10fps\n    }\n\n    HighlightSeg(\n        num,\n        start // HIGHLIGHT A SEGMENT\n    ) {\n        let t =\n            $(\n                `#sui-trans${\n                    this.transRes.layout == 'Minimal' ? 'Min' : ''\n                }Seg-${num}`\n            ).position().top -\n            $(\n                `#sui-trans${\n                    this.transRes.layout == 'Minimal' ? 'Min' : ''\n                }Seg-0`\n            ).position().top; // Get offset to top seg\n        //if (this.handScroll) start = 1; // Inhibit transcript autoscrolling while manually scrolling\n        if (start == undefined) $('#sui-trans').scrollTop(t); // Scroll to position if not playing a particular seg\n        $('[id^=sui-transSeg-]').css('background-color', '#ddd'); // All backgrounds off\n        $('[id^=sui-transMinSeg-]').css('border-color', '#fff'); // All borders off\n        $('[id^=sui-transMinSeg-]').css('background-color', '#fff'); // All backgrounds off\n        $('#sui-transMinSeg-' + num).css('border-color', '#999'); // Hilite active one\n        $('#sui-transMinSeg-' + num).css('background-color', '#eee'); // Hilite active one\n        $('#sui-transSeg-' + num).css('background-color', '#aaa'); // Hilite active one\n    }\n\n    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n    // HELPER FUNCTIONS\n    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    TimecodeToSeconds(\n        timecode // CONVERT TIMECODE TO SECONDS\n    ) {\n        var h = 0,\n            m = 0;\n        var v = ('' + timecode).split(':'); // Split by colons\n        var s = v[0]; // Add them\n        if (v.length == 2) {\n            // Just minutes, seconds\n            s = v[1];\n            m = v[0];\n        } // Add them\n        else if (v.length == 3) {\n            // Hours, minutes, seconds\n            s = v[2];\n            m = v[1];\n            h = v[0];\n            // Add them\n        }\n        return Number(h * 3600) + Number(m * 60) + Number(s); // Convert\n    }\n\n    SecondsToTimecode(\n        secs // CONVERT SECONDS TO TIMECODE\n    ) {\n        var str = '',\n            n;\n        n = Math.floor(secs / 3600); // Get hours\n        if (n) str += n + ':'; // Add to tc\n        n = Math.floor(secs / 60); // Get mins\n        if (n < 10) str += '0'; // Add leading 0\n        str += n + ':'; // Add to tc\n        n = Math.floor(secs % 60); // Get secs\n        if (n < 10) str += '0'; // Add leading 0\n        str += n; // Add to tc\n        //\tstr+=\".\"+Math.round((secs-Math.floor(secs))*10);\t\t\t\t\t\t\t\t\t\t// Add fractional\n        return str; // Return timecode\n    }\n} // AudioVideo class closure\n","/* \tSUBJECTS PAGES ****************************************************************************************************************************\n\n\tThis module draws the subjects page based on a kmap from SOLR. Some information comes from the kmap\n\tpassed in and some from the a second query from the child data in the Terms index. \n\t\n\tThe related resources menu is drawn, which pulls data via another SOLR call. If an image is present\n\tit is drawn there. Below that is a browsable index of subjects. Clicking on one will bring up that page.\n\t\n\tA tabbed menu shows the CONTEXT, where the page fits in the tree. Clicking on one will bring up that page.\n\tYou can drill down further in the tree by clicking on a '+' dot or collapse branches with th '-'. The SUMMARY,\n\twhich lists the related subjects to this page, catagorized by their type and alpabetically sorted. \tClicking \n\ton one will bring up that page. Hovering over a blue popover icon will show more information about it.\n\n\tRequires: \tjQuery \t\t\t\t\t\t\t\t\t\t\t\t// Almost any version should work\n\tCSS:\t\tsearchui.css\t\t\t\t\t\t\t\t\t\t// All styles are prefixed with 'sui-'\n\tJS:\t\t\tECMA-6\t\t\t\t\t\t\t\t\t\t\t\t// Uses lambda (arrow) functions\n\tJSON:\t\tFrom Drupal site\n\tGlobals:\tLooks for sui and sui.pages\n\tDependents:\tpages.js, searchui.js\t\t\t\t\t\t\t\t// JS modules called\n\n*********************************************************************************************************************************************/\n/* eslint-disable */\nimport $ from 'jquery';\n\nexport default class Subjects {\n    constructor(\n        sui // CONSTRUCTOR\n    ) {\n        this.sui = sui;\n        this.div = sui.pages.div; // Div to hold page (same as Pages class)\n        this.content = ['...loading', '...loading']; // Content pages for relateds\n        this.content2 = ['<br>', '<br>'];\n        this.kmap = null; // Holds kmap\n        this.relatedPlaceData = null; // Holds related places\n        this.relatedSubjectData = null; // Holds related subjects\n    }\n\n    // CALLS this.GetSubjectData(),\n    // CALLS this.DrawContent()\n    // CALLS sui.pages.DrawRelatedAssets();\n    // ACCESSES this.sui\n    // SIDE-EFFECT sets this.kmap\n    Draw(\n        o,\n        related // DRAW SOURCE PAGE FROM KMAP\n    ) {\n        console.error('subjects.Draw() called ');\n        console.dir(arguments);\n\n        const sui = this.sui;\n        this.kmap = o; // Save kmap\n        $('#sui-legacy').css({\n            'padding-left': '12px',\n            width: 'calc(100% - 24px',\n        }); // Reset to normal size\n        this.GetSubjectData(o); // Get related subjects content\n        this.DrawContent(o, related); // Draw content\n        sui.pages.DrawRelatedAssets(o); // Draw related assets menu\n    }\n\n    // USES this.sui (sui.assets)\n    // CALLS this.ShowTab()\n    // CALLS sui.pages.DrawTabMenu()\n    // CALLS this.GetPlaceData(o)\n    // OUTPUT this.div\n    DrawContent(\n        o,\n        related // DRAW CONTENT\n    ) {\n        const sui = this.sui;\n        let str = `<div class='sui-subjects' id='sui-subConDiv'>\n\t\t<div><span class='sui-subIcon'>${sui.assets[o.asset_type].g}</span>\n\t\t<span class='sui-subText'>${o.title[0]}</span>\n\t\t<hr style='border-top: 1px solid ${sui.assets[o.asset_type].c}'>`;\n        if (o.caption) {\n            str += \"<p id='sui-spCap'>\" + o.caption + '</p></div>';\n        }\n        if (related == 1) {\n            str =\n                \"<div style='margin-left:192px'>\" +\n                sui.pages.DrawTabMenu(['SUBJECT CONTEXT', 'RELATED SUBJECTS']);\n        } // If subjects, add tab menu\n        else if (related == 2) {\n            str =\n                \"<div id='sui-topCon' style='margin-left:216px'>\" +\n                this.GetPlaceData(o);\n        } // If places, get data\n\n        // OUTPUT\n        $(this.div).html(str + '</div>'.replace(/\\t|\\n|\\r/g, '')); // Remove format and add to div\n\n        // HANDLERS\n        $('[id^=sui-tabTab]').on('click', (e) => {\n            // ON TAB CLICK\n            var id = e.currentTarget.id.substring(10); // Get index of tab\n            this.ShowTab(id); // Draw it\n        });\n    }\n\n    ShowTab(\n        which // SHOW TAB\n    ) {\n        let _this = this;\n        $('[id^=sui-spLab-]').off('click'); // Kill handler\n        $('[id^=sui-spDot-]').off('click'); // Kill handler\n        $('[id^=sui-spItem-]').off('click'); // Kill handler\n        $('[id^=sui-togCat-]').off('click'); // Kill handler\n        $('[id^=sui-spCatUL-]').off('click'); // Kill handler\n        $('[id^=sui-tabTab]').css({\n            'background-color': '#999',\n            color: '#fff',\n        }); // Reset all tabs\n        $('#sui-tabContent').css({\n            display: 'block',\n            'background-color': '#eee',\n        }); // Show content\n        $('#sui-tabTab' + which).css({\n            'background-color': '#eee',\n            color: '#000',\n        }); // Active tab\n        $('#sui-tabContent').html(this.content[which]); // Set content\n        if (which == 0) {\n            // If SUBJECT CONTEXT\n            $('#sui-spLab-' + this.kmap.uid).css({\n                'font-weight': 'bold',\n                'text-decoration': 'underline',\n            }); // Highlight current one\n            $('[id^=sui-spLab-]').on('click', function (e) {\n                return false;\n            }); // ON CONTEXT LINE CLICK, INHIBIT\n            $('[id^=sui-spDot-]').on('click', function (e) {\n                // ON RELATIONSHIP TREE DOT CLICK\n                let path = e.currentTarget.id.substring(10); // Get id\n                if (path != 'null')\n                    sui.pages.AddRelBranch(\n                        _this.kmap.asset_type,\n                        path,\n                        $(this)\n                    ); // Lazy load branch\n                $(this).html('&ndash;'); // Change label\n                $(this).parent().find('ul').slideToggle(); // Slide into place\n            });\n        } else if (which == 1) {\n            // If RELATED SUBJECTS\n            $('[id^=sui-spItem-]').on('click', function (e) {\n                return false;\n            }); // ON CONTEXT LINE CLICK, INHIBIT\n            $('[id^=sui-spCatUL-]').slideDown(); // All down\n            $('[id^=sui-spCat-]').on('click', (e) => {\n                // ON CATEGORY CLICK\n                let id = e.currentTarget.id.substring(9); // Get id\n                if ($('#sui-spCatUL' + id).css('display') == 'none')\n                    // If hidden\n                    $('#sui-spCatUL' + id).slideDown();\n                // Show\n                // If showing\n                else $('#sui-spCatUL' + id).slideUp(); // Hide\n            });\n\n            $('#sui-togCatA').on('click', () => {\n                // ON EXPAND ALL\n                $('[id^=sui-spCatUL-]').slideDown(); // All down\n            });\n            $('#sui-togCatN').on('click', () => {\n                // ON COLLAPSE ALL\n                $('[id^=sui-spCatUL-]').slideUp(); // All down\n            });\n        }\n    }\n\n    GetPlaceData(\n        o // GET RELATED PLACES\n    ) {\n        sui.GetRelatedPlaces(o.uid, (d) => {\n            // Get related place data\n            this.relatedPlaceData = d; // Save data\n            this.DrawRelatedPlaces('tree', 1); // Display related places\n        });\n        return 'Loading...'; // Say we're loading...\n    }\n\n    DrawRelatedPlaces(\n        mode,\n        sortMode // DRAW RELATED PLACES\n    ) {\n        let i,\n            j,\n            id,\n            tops = [];\n        let d = this.relatedPlaceData; // Point at realte placev data\n        let o = this.kmap; // Point at kmap\n        let str = `<br><div class='sui-spHead'>Places related to ${\n            o.title\n        }</div>\n\t\t<p style='color:#666'>\n\t\t<input id='sui-rpSearch' placeholder='&nbsp;Search places' \n\t\tstyle='width:100px;border:1px solid #999;border-radius:12px;padding-left:8px'> &nbsp;\n\t\t<span class='sui-advEditBut' style='color:${\n            mode == 'tree' ? '#668eec' : '#666'\n        }' \n\t\tid='sui-rpTree' title='Tree view'>&#xe638</span> | \n\t\t<span class='sui-advEditBut' style='color:${\n            mode != 'tree' ? '#668eec' : '#666'\n        }'\n\t\tid='sui-rpList' title='List view'>&#xe61f</span>`;\n        if (mode != 'tree') {\n            // If drawing as a list\n            j =\n                $('#sui-footer').offset().top -\n                $('#sui-legacy').offset().top -\n                150; // Fill space\n            str += ` | <span class='sui-advEditBut' id='sui-rpSort' title='Sort'>\n\t\t\t${sortMode == 1 ? '&#xe653' : '&#xe652'}</span>\t\t\n\t\t\t</p><div class='sui-rpList' style='height:${j}px'>`; // Add container\n            d = d.sort((a, b) => {\n                return a.title < b.title ? -sortMode : sortMode;\n            }); // Sort by title acending\n            for (i = 0; i < d.length; ++i) {\n                // For each related place\n                str += `<div id='sui-rpLine-${i}' style='width:300px' title='${d[\n                    i\n                ].ancestors_txt.join('/')}'>${d[i].title}</div>`; // Add line\n            }\n\n            // OUTPUT TO SUI-TOPCON\n            $('#sui-topCon').html(str + '</div>'); // Draw as list\n\n            // HANDLERS\n            $('#sui-rpTree').on('click', () => {\n                this.DrawRelatedPlaces('tree', sortMode);\n            }); // HANDLE TREE CLICK\n            $('#sui-rpSort').on('click', () => {\n                this.DrawRelatedPlaces('list', sortMode * -1);\n            }); // HANDLE SORT\n            $('#sui-rpSearch').on('keydown', (e) => {\n                // ON SEARCH\n                let line;\n                let r = $('#sui-rpSearch').val(); // Get filter text\n                if (e.keyCode > 31 && e.keyCode < 91) {\n                    r += e.key;\n                } // Add current key if a-Z\n                if (e.keyCode == 8 && r.length) {\n                    r = r.slice(0, -1);\n                } // Remove last char on backspace\n                r = RegExp(r, 'i'); // Turn into regex\n                for (i = 0; i < d.length; ++i) {\n                    // For each item\n                    line = $('#sui-rpLine-' + i); // Point at line\n                    if (line.text().match(r)) {\n                        line.css('display', 'block'); // Show item if it matches\n                    } else {\n                        line.css('display', 'none'); // Hide\n                    }\n                }\n            });\n            return; // Quit\n        }\n        str += ` | <span class='sui-advEditBut' style='vertical-align:0' \n\t\tid='sui-togCatA' title='Expand all'<strong>&#x2295</strong></span> | \n\t\t<span class='sui-advEditBut' style='vertical-align:0'\n\t\tid='sui-togCatN' title='Collapse all'><strong>&#x2296</strong></span> \n\t\t</p><div style='width:100%'><div style='display:inline-block'>\n\t\t<ul style='list-style-type:none;margin-left:-24px'>`; // Top-most <ul>\n        let n = d.length; // Number of places\n        for (i = 0; i < n; ++i) {\n            // For each related place\n            id = 'places-'; // Start id\n            for (j = 0; j < d[i].ancestor_ids_is.length; ++j) {\n                // For each level\n                id += d[i].ancestor_ids_is[j] + '-'; // Add levels\n                tops.push({\n                    lab: d[i].ancestors_txt[j],\n                    level: j,\n                    id: id.slice(0, -1),\n                    uid: 'places-' + d[i].ancestor_ids_is[j],\n                }); // Add to list\n                tops[tops.length - 1].parent = id.split('-').slice(0, -2).pop(); // Add parent\n            }\n        }\n\n        tops = tops.sort((a, b) => {\n            return a.id < b.id ? -1 : 1;\n        }); // Sort by path\n        i = tops[tops.length - 1]; // Save last\n        tops = tops.filter((a, ind) => {\n            try {\n                return a.id != tops[ind + 1].id;\n            } catch (e) {}\n        }); // Only uniques\n        tops.push(i); // Add it back\n        n = tops.length; // New n\n        for (\n            i = 0;\n            i < n;\n            ++i // For place\n        )\n            if (tops[i].level == 0)\n                // Add top row\n                str += addTreeLine(\n                    tops[i].lab,\n                    tops[i].id,\n                    tops[i].id,\n                    '&ndash;'\n                ); // Add tree line\n\n        $('#sui-topCon').html(str + '</ul></div>'); // Draw it\n\n        $('#sui-rpList').on('click', () => {\n            this.DrawRelatedPlaces('list', sortMode);\n        }); // HANDLE LIST CLICK\n        $('#sui-rpSearch').on('keyup', () => {\n            // HANDLE SEARCH WORD ENTRY\n            let t = $('#sui-rpSearch').val(); // Get value entered\n            this.DrawRelatedPlaces('list', sortMode); // Draw as list\n            $('#sui-rpSearch').val(t); // Restore value\n            $('#sui-rpSearch').focus(); // Set focus\n            $('#sui-rpSearch').trigger('keydown', { keyCode: 13 }); // Filter matches\n        });\n\n        for (i = 0; i < n; ++i) tops[i].n = countChildren(tops[i].id); // For each place, count children\n        for (i = 0; i < n; ++i)\n            if (tops[i].level == 0) addChildren(tops[i].id, 1); // For each place, add top row children and recurse\n\n        $('#sui-topCon')\n            .find('li')\n            .each(function () {\n                // For each line\n                j = $(this).parent().find('li').find('b').length; // Get count\n                if (j && !$(this).find('b').length)\n                    // If something\n                    $(this)\n                        .find('img')\n                        .before('(' + j / 2 + ') '); // Add it before popover\n            });\n\n        function countChildren(id) {\n            // COUNT NODE'S CHILDREN\n            let i,\n                num = 0;\n            id = id.split('-').pop(); // Get last id\n            for (\n                i = 0;\n                i < n;\n                ++i // For each place\n            )\n                if (tops[i].parent == id) ++num; // Has them\n            return num; // Return count\n        }\n\n        function addChildren(id, level) {\n            // ADD CHILDREN TO NODE RECURSIVELY\n            let i,\n                marker,\n                str = '';\n            for (i = 0; i < n; ++i) {\n                // For each place\n                if (tops[i].id.match(id) && tops[i].level == level) {\n                    // A child\n                    marker = tops[i].n > 0 ? '+' : '&bull;'; // Set marker type\n                    str =\n                        \"<ul style='list-style-type:none;display:none;padding:2px 0 0 24px'>\"; // Enclosing <ul> if not a loner\n                    str += addTreeLine(\n                        tops[i].lab,\n                        tops[i].id,\n                        tops[i].uid,\n                        marker\n                    ); // Add tree line\n                    str += '</ul>'; // Close <ul>\n                    $('#sui-rpDot-' + id)\n                        .parent()\n                        .parent()\n                        .append(str); // Add it\n                    addChildren(tops[i].id, level + 1); // Recurse\n                }\n            }\n        }\n\n        function addTreeLine(lab, id, uid, marker) {\n            // ADD LINE TO TREE\n            let s = `<li>`; // Header\n            if (marker != '&bull;')\n                s += `<div class='sui-spDot' id='sui-rpDot-${id}'>${marker}</div>`;\n            // If a dot, add it\n            else\n                s += `<div class='sui-spDot' id='sui-rpDot-${id}' style='display:none;color:#5b66cb'><strong>&bull;</div>&bull;&nbsp;&nbsp;`; // If a loner\n            s += `<a class='sui-noA' href='#p=${uid}'>${lab}</strong>${sui.pages.AddPop(\n                uid\n            )}</a>`; // Add line\n            return s; // Return line\n        }\n\n        $('[id^=sui-rpDot-]').off('click'); // Kill old handlers\n        $('[id^=sui-rpDot-]').on('click', function (e) {\n            // ON RELATIONSHIP TREE DOT CLICK\n            let container = $(this).parent().parent(); // Point a container\n            let c = $(this).html(); // Get char\n            $(this).html(c == '+' ? '&ndash;' : '+'); // Toggle label\n            $(container).children('ul').slideToggle(); // Slide into place\n        });\n\n        $('#sui-togCatA').on('click', () => {\n            // ON EXPAND ALL\n            let i, container;\n            for (i = 0; i < n; ++i) {\n                // For each place\n                container = $('#sui-rpDot-' + tops[i].id).parent(); // Point a container\n                $('#sui-rpDot-' + tops[i].id).html('&ndash;'); // If not a loner, change label\n                container.parent().css('display', 'block'); // Show\tparent ul\n                container.css('display', 'block'); // Show\n            }\n        });\n\n        $('#sui-togCatN').on('click', () => {\n            // ON COLLAPSE, INIT TO STARTING STATE\n            let i, p;\n            for (i = 0; i < n; ++i) {\n                // For each place\n                p = $('#sui-rpDot-' + tops[i].id); // Point at dot\n                if (p.html() != '&bull;') p.html('+'); // Change label\n                p.parent().parent().css('display', 'none'); // Hide\n                if (tops[i].level < 3) {\n                    // If 2nd level\n                    if (tops[i].level < 2) p.html('&ndash;'); // Change label is past 1st rows\n                    p.parent().parent().css('display', 'block'); // Show\n                }\n            }\n        });\n        $('#sui-togCatN').trigger('click'); // Collapse to starting point\n    }\n\n    //  LOOK THIS OVER CAREFULLY!\n    GetSubjectData(\n        o // GET TAB DATA FOR CONTEXT\n    ) {\n        const sui = this.sui;\n        sui.GetRelatedFromID(o.uid, (data) => {\n            // Load data\n            let d,\n                i,\n                k = 0,\n                str = '<table>';\n            if (!data) return; // Quit if no data\n            this.relatedSubjectData = data; // Save subject data\n\n            // THIS SHOULDN'T BE HAPPENING AND CERTAINLY NOT HERE\n            // if (data[0].illustration_external_url && data[0].illustration_external_url[0]) { // If an image spec'd\n            // \t$(\"#sui-relatedImg\").addClass(\"sui-relatedImg\");\t\t\t\t\t\t\t\t// Set style\n            // \t$(\"#sui-relatedImg\").prop(\"src\", data[0].illustration_external_url[0]);\t\t\t// Show it\n            // } else if (data[0].illustration_mms_url && data[0].illustration_mms_url[0]) {\t\t\t// If an image spec'd\n            // \t$(\"#sui-relatedImg\").addClass(\"sui-relatedImg\");\t\t\t\t\t\t\t\t// Set style\n            // \t$(\"#sui-relatedImg\").prop(\"src\", data[0].illustration_mms_url[0]);\t\t\t\t// Show it\n            // }\n\n            if (data[0].summary_eng && data[0].summary_eng[0])\n                // If an summary spec'd\n                $('#sui-spCap').html(data[0].summary_eng[0]); // Replace caption\n            if (o.names_txt && o.names_txt.length) {\n                // If names\n                for (\n                    i = 0;\n                    i < o.names_txt.length;\n                    ++i // For each name\n                )\n                    if (o.names_txt[i].match(/lang=\"bo\"/i))\n                        // Language id - bo\n                        str +=\n                            \"<tr><td style='color:#000099;font-size:20px'><strong>\" +\n                            o.names_txt[i] +\n                            \"</strong>&nbsp;&nbsp;&nbsp;</td><td span='2'><i>Dzongkha, Tibetan script, Original</i></td></tr>\"; // Add it\n            }\n            for (i = 0; i < data.length; ++i) {\n                // For each doc\n                d = data[i]; // Point at it\n                if (d.block_child_type != 'related_names') continue; // Not a name\n                if (!k) d.related_names_level_i = 0;\n                str += `<tr><td style='padding-left:${\n                    d.related_names_level_i * 16\n                }px'>\n\t\t\t\t${k++ ? '>&nbsp;' : ''}\n\t\t\t\t<strong>${d.related_names_header_s}&nbsp;&nbsp;&nbsp;</strong></td><td>\n\t\t\t\t<i>${d.related_names_language_s}, ${d.related_names_writing_system_s}, ${\n                    d.related_names_relationship_s\n                }\n\t\t\t\t</i></td></tr>`; // Add it\n            }\n            str += '</table><br>';\n            $('#sui-subConDiv').append(str.replace(/\\t|\\n|\\r/g, '')); // Remove format and add to div\n            this.AddRelatedSubjects(o, data); // Add related subjects html\n            this.AddSubjectContext(o, data); // Add context html\n        });\n    }\n\n    AddRelatedSubjects(\n        o,\n        c // ADD RELATED SUBJECTS TAB CONTENTS\n    ) {\n        let f,\n            i,\n            subs = 0,\n            s = [];\n        let n = c.length; // Get number of subjects\n        for (i = 0; i < n; ++i) {\n            // For each subject get data as 's=[category[{title,id}]]'\n            if (c[i].block_child_type != 'related_subjects') continue; // Add only related subjects\n            if (!s[c[i].related_subjects_relation_label_s])\n                // If first one of this category\n                s[c[i].related_subjects_relation_label_s] = []; // Alloc category array\n            s[c[i].related_subjects_relation_label_s].push({\n                // Add subject to category\n                title: c[i].related_subjects_header_s, // Add title\n                id: c[i].related_uid_s,\n            }); // Add id\n        }\n        let biggest = Object.keys(s).sort((a, b) => {\n            return a.length > b.length ? -1 : 1;\n        })[0]; // Find category with most elements\n        let str = `<br><div class='sui-spHead'>Subjects related to ${\n            o.title\n        }</div>\n\t\t<div>\n\t\t${o.title[0]}</strong> has <strong>~|~</strong> other subject${\n            n > 1 ? 's' : ''\n        } directly related to it, which is presented here. \n\t\tSee the SUBJECT CONTEXT tab if you instead prefer to browse all subordinate and superordinate categories for ${\n            o.title[0]\n        }.</div>\n\t\t<p><a class='sui-advEditBut' id='sui-togCatA'>Expand all</a> / <a class='sui-advEditBut' id='sui-togCatN'>Collapse all</a>\n\t\t</p><div style='width:100%'><div style='width:50%;display:inline-block'>`;\n        str +=\n            drawCat(biggest) +\n            \"</div><div style='display:inline-block;width:50%;vertical-align:top'>\"; // Add biggest to 1st column, set up 2nd\n        for (f in s) if (f != biggest) str += drawCat(f); // For each other category, draw it in 2nd column\n        str += '</div></div>';\n        str = str.replace(/~\\|~/, subs); // Set subjects count\n        this.content[1] = str; // Set tab\n\n        function drawCat(f) {\n            // DRAW CATEGORY\n            if (!s || !s[f]) return '</ul>'; // Bad data\n            s[f] = s[f].sort((a, b) => {\n                return a.title < b.title ? -1 : 1;\n            }); // Sort\n            let str =\n                \"<div id='sui-spCat-\" +\n                f.replace(/ /g, '_') +\n                \"' class='sui-spCat'>\" +\n                o.title +\n                ' ' +\n                f +\n                \"</div><ul id='sui-spCatUL-\" +\n                f.replace(/ /g, '_') +\n                \"' style='display:none'>\"; // Add category header\n            for (i = 0; i < s[f].length; ++i) {\n                // For each item\n                str += \"<li><a class='sui-noA' id='sui-spItem-\" + s[f][i].id; // Line\n                str += \"' href='#p=\" + s[f][i].id + \"'>\"; // Href\n                str +=\n                    s[f][i].title +\n                    '</a>' +\n                    sui.pages.AddPop(s[f][i].id) +\n                    '</li>'; // Add popover\n                ++subs;\n            }\n            return str + '</ul>'; // Close category\n        }\n    }\n\n    AddSubjectContext(\n        o,\n        d // ADD SUNJECYCONTEXT TAB CONTENTS\n    ) {\n        const sui = this.sui;\n        let i,\n            n = 0,\n            subs = 0;\n        for (i = 0; i < d.length; ++i) {\n            // For each child\n            subs += d[i].child_count.numFound; // Add children\n        }\n\n        subs = '(TBD)';\n\n        let str = `<br><div class='sui-spHead'>Subjects related to ${\n            o.title\n        }</div>\n\t\t<div>\n\t\t<strong>${o.title[0]}</strong> has <strong> ${\n            d[0].ancestors.length - 1\n        } </strong>superordinate subjects \n\t\tand <strong> ${subs} </strong>subordinate subjects. \n\t\tYou can browse these subordinate subjects as well as its superordinate categories with the tree below. \n\t\tSee the RELATED SUBJECTS tab if you instead prefer to view only its immediately \n\t\tsubordinate subjects grouped together in useful ways, as well as subjects non-hierarchically related to it.</div><br>\n\t\t<ul class='sui-spLin' id='sui-spRows'>`;\n\n        for (n = 0; n < d[0].ancestors.length; ++n) {\n            // For each ancestor\n            str += \"<ul style='list-style-type:none'>\"; // Add header\n            str += sui.pages.AddRelTreeLine(\n                d[0].ancestors[n],\n                d[0].ancestor_uids_generic[n],\n                '&ndash;',\n                null\n            ); // Add it\n        }\n\n        sui.GetTreeChildren(o.asset_type, d[0].ancestor_id_path, (res) => {\n            // Get children\n            let i, j, re, m, path;\n            let counts = [];\n            try {\n                counts = res.facets.child_counts.buckets;\n            } catch (e) {} // Get child counts\n            res = res.response.docs; // Point at docs\n            for (i = 0; i < res.length; ++i) {\n                // For each child\n                path = '';\n                m = null; // Assume a loner\n                re = new RegExp(res[i].id.split('-')[1]); // Get id to search on\n                for (j = 0; j < counts.length; ++j) {\n                    // For each count\n                    if (counts[j].val.match(re)) {\n                        // In this one\n                        m = '+'; // Got kids\n                        path = counts[j].val; // Add path\n                    }\n                }\n                str += \"<ul style='list-style-type:none'>\"; // Header\n                str +=\n                    sui.pages.AddRelTreeLine(\n                        res[i].header,\n                        res[i].id,\n                        m,\n                        path\n                    ) + '</li></ul>'; // Add it\n            }\n\n            str = str.replace(/~~/, n + res.length); // Set total count\n            for (i = 0; i < d[0].ancestors.length; ++i) str += '</li></ul>'; // Close chain\n            this.content[0] = str.replace(/\\t|\\n|\\r/g, '') + '</ul><br>'; // Set 1st content array member with html\n            this.ShowTab(0); // Draw it\n        });\n    }\n} // CLASS CLOSURE\n","/* \tIMAGE PAGES ****************************************************************************************************************************\n\n\tThis module draws the images page based on a kmap from SOLR. The image can be zoomed into an panned \n\tby clicking the magnifier icon.\tA row of thumbnails of all the imges in the search results appears in\n\t a scrollable window below the picture.\tClicking one shows that picture's page.\n\t\t\n\tSome metadata is displyed under the image along with the summary. Images can be downloaded by clicking\n\ton the DOWNLOAD IMAGE label.\n\n\tRequires: \tjQuery \t\t\t\t\t\t\t\t\t\t\t\t// Almost any version should work\n\tCSS:\t\tsearchui.css\t\t\t\t\t\t\t\t\t\t// All styles are prefixed with 'sui-'\n\tJS:\t\t\tECMA-6\t\t\t\t\t\t\t\t\t\t\t\t// Uses lambda (arrow) functions\n\tJSON:\t\tFrom Drupal site\n\tGlobals:\tlooks for sui and sui.pages\n\tDependents:\tpages.js, searchui.js\t\t\t\t\t\t\t\t// JS modules called\n\n**********************************************************************************************************************************************/\n/* eslint-disable */\nimport $ from 'jquery';\nexport default class Images  {\n\tconstructor(sui)   \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// CONSTRUCTOR\n\t{\n\t\tif (!sui) {\n\t\t\tthrow new Error(\"SearchUI must be passed to constructor\");\n\t\t}\n\t\tthis.sui = sui;\n\t\tthis.div=sui.pages.div;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Div to hold page (same as Pages class)\n\t}\n\n\tDraw(o)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// DRAW IMAGE PAGE FROM KMAP\n\t{\n\t\tconst sui = this.sui;\n\t\tvar i,j,mid;\n\t\tvar asp=o.url_thumb_height/o.url_thumb_width;\n\t\tvar w=$(this.div).width()/2;\n\t\tvar h=w*asp;\n\t\tif (o.url_thumb)\t o.url_thumb=o.url_thumb.replace(/images-test/i,\"images\");\t\t\t// Force to prod\n\t\tfor (i=0;i<sui.curResults.length;++i) {\tif (o.id == sui.curResults[i].id)\tmid=i; }\n\n\t\tvar str=`<div class='sui-imagesBox' id='sui-imagesBox' style='margin:${(sui.ss.mode == \"related\") ? \"-12px 0 0 0\" : \"-12px -12px 0 -12px\"}'>\n\t\t<div id='sui-picEnlarge' style='cursor:pointer;font-size:18px' title='Click to enlarge and pan'>&#xe650</div></p>\n\t\t<div id='sui-imageDiv' class='sui-imageDiv' >\n\t\t\t<img id='sui-thisPic' src='${o.url_thumb.replace(/200,200/,\"2000,2000\")}' style='width:100%'> \n\t\t</div><br>\n\t\t<div><span style='max-width:900px;font-size:20px;vertical-align:-2px;color:#ccc'>&#xe62a&nbsp;&nbsp;${o.title[0]}</span></div>\n\t\t<div style='color:#ccc;margin-bottom:24px'>${o.creator}&nbsp;&nbsp;|&nbsp;&nbsp;${o.img_width_s} x ${o.img_height_s} px</div>\n\t\t<div class='sui-imageGal'id='sui-imageGal'>`;\n\t\tfor (i=0;i<mid;++i) \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// For each image up mid point\n\t\t\tif (sui.curResults[i].asset_type == \"images\")\n\t\t\t\tstr+=`<div class='sui-pageThumb'><img id='sui-pageThumb-${i}' src='${sui.curResults[i].url_thumb}' style='height:100%'></div>`;\n\t\tstr+=`<div class='sui-pageThumb' style=' border-color:#fff'><img id='sui-pageThumb-${mid}' src='${o.url_thumb}' style='height:100%'></div>`;\t\n\t\tfor (i=mid+1;i<sui.curResults.length;++i) \t\t\t\t\t\t\t\t\t\t\t\t// For each after mid point\n\t\t\tif (sui.curResults[i].asset_type == \"images\")\n\t\t\t\tstr+=`<div class='sui-pageThumb'><img id='sui-pageThumb-${i}' src='${sui.curResults[i].url_thumb}' style='height:100%'></div>`;\n\t\tstr+=\"</div></div>\";\n\t\t\n\t\tsui.GetJSONFromKmap(o, (d)=> { drawDetails(d); });\t\t\t\t\t\t\t\t\t\t// Load detaill from JSON\n\t\t$(this.div).html(str.replace(/\\t|\\n|\\r/g,\"\"));\t\t\t\t\t\t\t\t\t\t\t// Remove format and add to div\t\n\t\tsui.pages.DrawRelatedAssets();\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Draw related assets menu if active\n\t\t// $(\"#sui-imageGal\").scrollLeft($(\"#sui-pageThumb-\"+mid).offset().left-w+25);\t\t\t\t// Scroll to center\n\n\t\tlet s, places=[],subjects=[],terms=[];\n\t\ttry{\n\t\t\tfor (i=0;i<o.kmapid_strict.length;++i) {\n\t\t\t\tif (o.kmapid_strict[i].match(/places/))\t\tplaces.push(o.kmapid_strict_ss[i]+sui.pages.AddPop(o.kmapid_strict[i]));\n\t\t\t\tif (o.kmapid_strict[i].match(/subjects/))\tsubjects.push(o.kmapid_strict_ss[i]+sui.pages.AddPop(o.kmapid_strict[i]));\n\t\t\t\tif (o.kmapid_strict[i].match(/terms/))\t{\t\t\t\t\t\t\t\t\t\t// If a term\n\t\t\t\t\ts=o.kmapid_strict_ss[i];\t\t\t\t\t\t\t\t\t\t\t\t\t// Add term\n\t\t\t\t\tlet r=RegExp(o.kmapid_strict[i]+\"_definitions-(\\d*)\",\"g\");\t\t\t\t\t// Get any definitions for this term\n\t\t\t\t\tr=o.kmapid.join().match(r);\t\t\t\t\t\t\t\t\t\t\t\t\t// Count\n\t\t\t\t\tif (r) {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If any\n\t\t\t\t\t\ts+=\"<span><i><sup> (\";\t\t\t\t\t\t\t\t\t\t\t\t\t// Start superscript\n\t\t\t\t\t\tfor (j=1;j<=r.length;++j) {\t\t\t\t\t\t\t\t\t\t\t\t// For each def\n\t\t\t\t\t\t\ts+=j;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Add number\n\t\t\t\t\t\t\tif (j < r.length) s+=\",\";\t\t\t\t\t\t\t\t\t\t\t// Add comma\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\ts+=\")</sup></i></span>\";\t\t\t\t\t\t\t\t\t\t\t\t// End super\n\t\t\t\t\t\t}\n\t\t\t\t\ts+=sui.pages.AddPop(o.kmapid_strict[i]);\t\t\t\t\t\t\t\t\t// Add popover\n\t\t\t\t\tterms.push(s);\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Add term\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t} catch(e) {}\n\t\n\t\tstr=`<br><table class='sui-imageMid'>\n\t\t\t<tr class='sui-pageLab' style='font-size:16px;padding-bottom:4px'><td style='width:50%'>MANDALA COLLECTIONS</td><td>CLASSIFICATION</td></tr>\n\t\t\t<tr class='sui-pageLab' style='padding-bottom:8px'><td>&#xe633&nbsp;&nbsp;<i>`;\n\t\t\tif (o.collection_title) \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If a collection\t\n\t\t\t\tstr+=`${o.collection_title}${sui.pages.AddPop(o.collection_uid_s)}`;\t\t\t// Show name and popup\n\t\t\telse str+=\"None\";\n\t\t\tstr+=\"</td><td><i>\";  \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Close left side\n\t\t\tif (subjects.length) {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If subjects\t\n\t\t\t\tstr+=\"<span style='color:#cc4c39'>&#xe634</span>&nbsp;&nbsp\";\t\t\t\t\t// Add icon\n\t\t\t\tfor (i=0;i<subjects.length;++i) str+=subjects[i]+\", \";\t\t\t\t\t\t\t// Add item\n\t\t\t\tstr=str.slice(0,-2)+\"<br>\";\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Remove last comma\n\t\t\t\t}\t\n\t\t\tif (places.length) {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If places\t\n\t\t\t\tstr+=\"<span style='color:#6faaf1'>&#xe62b</span>&nbsp;&nbsp\";\t\t\t\t\t// Add icon\n\t\t\t\tfor (i=0;i<places.length;++i) str+=places[i]+\", \";\t\t\t\t\t\t\t\t// Add item\n\t\t\t\tstr=str.slice(0,-2)+\"<br>\";\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Remove last comma\n\t\t\t\t}\t\n\t\t\tif (terms.length) {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If terms\t\n\t\t\t\tstr+=\"<span style='color:#a2733f'>&#xe635</span>&nbsp;&nbsp\";\t\t\t\t\t// Add icon\n\t\t\t\tfor (i=0;i<terms.length;++i) str+=terms[i]+\", \";\t\t\t\t\t\t\t\t// Add item\n\t\t\t\tstr=str.slice(0,-2)+\"<br>\";\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Remove last comma\n\t\t\t\t}\t\n\t\t\tstr+=\"</td></tr></i></table>\";\n\n\t\tvar d=this.DrawItem;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Point at this item drawer\n\t\tfunction drawDetails(j) {\t\n\t\t\t// trace(j)\n\t\t\tstr+=\"<div class='sui-images'>\";\n\t\t\tstr+=\"<div style='width:calc(49% - 24px);display:inline-block;margin-right:16px;vertical-align:top;height:100%;'><table style='width:100%'>\";\n\t\t\t\ttry{ str+=d(sui.assets[o.asset_type].g,\"CAPTION\",o.caption,\"Untitled\"); } catch(e){}\n\t\t\t\tstr+=\"<tr><td colspan='2'><hr></td></tr>\";\n\t\t\t\ttry{ str+=d(\"&#xe600\",\"CREATOR\",o.creator) } catch(e){}\n\t\t\t\ttry{ str+=d(\"&#xe66d\",\"TYPE\",j.field_image_type.und[0].value.charAt(0).toUpperCase()+j.field_image_type.und[0].value.slice(1)); } catch(e){}\n\t\t\t\ttry{ str+=d(\"&#xe665\",\"SIZE\", o.img_width_s+\" x \"+o.img_height_s+\" px\"); } catch(e){}\n\t\t\t\tstr+=\"<tr><td colspan='2'><hr></td></tr>\";\n\t\t\t\ttry{ str+=\"<p class='sui-pageLab'>\";\n\t\t\t\t\tfor (i=0;i<j.field_image_descriptions.und.length;++i) \t\t\t\t\t\t\t// For each note\n\t\t\t\t\t\tstr+=j.field_image_descriptions.und[i].title+\"<br>\";\t\t\t\t\t\t// Add it\n\t\t\t\t\tstr+=\"</p>\";  \n\t\t\t\t\t} catch(e){}\n\t\t\t\ttry{ str+=d(\"&#xe600\",j.field_image_agents.und[0].field_agent_role.und[0].value.toUpperCase(),\n\t\t\t\t\t\tj.field_image_agents.und[0].title+\" (\"+sui.pages.FormatDate(j.field_image_agents.und[0].field_agent_dates.und[0].value)+\")\"\n\t\t\t\t\t); } \tcatch(e) {}\n\t\t\t\ttry{ str+=\"</table><p>\";\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// A sub description\n\t\t\t\tstr+=j.field_image_descriptions.und[0].field_description.und[0].value+\"<br></p>\";  } \t\tcatch(e){}\n\t\t\t\tstr+=\"</div><div style='width:49%;display:inline-block;vertical-align:top;border-left:1px solid #ddd;padding-left:16px'><br><table style='width:100%'>\";\n\t\t\t\ttry{ str+=d(\"&#xe67f\",\"ONLY DIGITAL\",j.field_image_digital.und[0].value ? \"Yes\" : \"No\"); } \tcatch(e){}\n\t\t\t\ttry{ str+=d(\"&#xe67f\",\"COLOR\",j.field_image_color.und[0].value ? \"Yes\" : \"No\"); } \t\t\tcatch(e){}\n\t\t\t\ttry{ str+=d(\"&#xe67f\",\"QUALITY\",j.field_image_quality.und[0].value); } \t\t\t\t\t\tcatch(e){}\n\t\t\t\ttry{ str+=d(\"&#xe67f\",\"ROTATION\",j.field_image_rotation.und[0].value+\"&deg;\"); } \t\t\tcatch(e){}\n\t\t\t\ttry{ str+=d(\"&#xe665\",\"PHYSICAL&nbsp;SIZE\",j.field_physical_size.und[0].value); } \t\t\tcatch(e){}\n\t\t\t\ttry{ str+=d(\"&#xe659\",\"CAPURE&nbsp;DEVICE\",j.field_image_capture_device.und[0].value); } \tcatch(e){}\n\t\t\t\ttry{ str+=d(\"&#xe65f\",\"MATERIALS\",j.field_image_materials.und[0].value); } \t\t\t\t\tcatch(e){}\n\t\t\t\ttry{ str+=d(\"&#xe66c\",\"ENHANCEMENT\",j.field_image_enhancement.und[0].value); } \t\t\t\tcatch(e){}\n\t\t\t\ttry{ str+=\"<tr><td>&#xe62B&nbsp;&nbsp;<span class='sui-pageLab'>LOCATION</span>:</td><td>\"+j.field_longitude.und[0].value+\"&nbsp;&nbsp;&nbsp;\"+j.field_latitude.und[0].value+\"</td></tr>\"; } \t\t\t\t\t\t\t\t\tcatch(e){}\n\t\t\t\ttry{ str+=d(\"&copy;\",\"COPYRIGHT&nbsp;HOLDER\",j.field_copyright_holder.und[0].value); } \t\tcatch(e){}\n\t\t\t\ttry{ str+=d(\"&copy;\",\"COPYRIGHT&nbsp;STATEMENT\",j.field_copyright_statement.und[0].value);} catch(e){}\n\t\t\t\ttry{ str+=d(\"&#xe614\",\"ORIGINAL&nbsp;FILE\",j.field_original_filename.und[0].value); } \t\tcatch(e){}\n\t\t\t\ttry{ str+=d(\"&#xe678\",\"TECHNICAL&nbsp;NOTES\",j.field_technical_notes.und[0].value); } \t\tcatch(e){}\n\t\t\t\ttry{ str+=d(\"&#xe639\",\"UPLOADED&nbsp;BY\",o.node_user_full_s); } \t\t\t\t\t\t\tcatch(e){}\n\t\t\t\ttry{ str+=d(\"&#xe67f\",\"LICENSE\",\"<a style='font-weight:400' target='_blank' href='\"+j.field_license_url.und[0].value+\"'>\"+j.field_license_url.und[0].value+\"</a>\"); } catch(e){} \n\t\t\t\t\n\t\t\t\tlet asp=o.img_height_s/o.img_width_s;\n\t\t\t\tstr+=`</table><p class='sui-pageLab' style='cursor:pointer' onclick='$(\"#sui-dlOps\").toggle()'>\n\t\t\t\t&#xe616&nbsp;&nbsp;<a>DOWNLOAD IMAGE</a>\n\t\t\t\t\t<div id='sui-dlOps' style='display:none;margin-left:24px;font-size:12px'>\t\t\t\n\t\t\t\t\t<a target='_blank' href='${o.url_thumb.replace(/200,200/,o.img_width_s+\",\"+o.img_width_s)}'\n\t\t\t\t\tstyle='display:inline-block;cursor:pointer'>Original (${o.img_width_s}x${o.img_height_s})</a><br>\n\t\t\t\t\t<a target='_blank' href='${o.url_thumb.replace(/200,200/,\"1200,1200\")}'\n\t\t\t\t\tstyle='display:inline-block;cursor:pointer'>Large (1200x${1200*asp}))</a><br>\n\t\t\t\t\t<a target='_blank' href='${o.url_thumb.replace(/200,200/,\"800,800\")}'\n\t\t\t\t\tstyle='display:inline-block;cursor:pointer'>Medium (800x${800*asp})</a><br>\n\t\t\t\t\t<a target='_blank' href='${o.url_thumb.replace(/200,200/,\"400,400\")}'\n\t\t\t\t\tstyle='display:inline-block;cursor:pointer'>Small (400x${400*asp})</a>\n\t\t\t\t\t<p><i>Right-click and select \"Download/Save Linked File\"</i></p>\n\t\t\t\t\t</div>\n\t\t\t\t</p></div></div></div>`;\n\t\t\t\t$(sui.pages.div).append(str.replace(/\\t|\\n|\\r/g,\"\"));\t\t\t\t\t\t\t\t// Remove format and add to div\n\t\t\t\t\n\t\t\t\t$(\"#sui-imgCol\").on(\"click\",()=> {\t\t\t\t\t\t\t\t\t\t\t\t\t// ON COLLECTION CLICK\n\t\t\t\t\tsui.GetKmapFromID(o.collection_uid_s,(kmap)=>{ sui.SendMessage(\"\",kmap); });\t// Get kmap and show page\n\t\t\t\t\treturn false;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Stop propagation\n\t\t\t\t\t});\n\t\t\t}\n\t\n\t\t$(\"[id^=sui-pageThumb-]\").on(\"click\",(e)=> {\t\t\t\t\t\t\t\t\t\t\t\t// ON THUMBNAIL CLICK\n\t\t\tlet id=e.currentTarget.id.split(\"-\")[2];\t\t\t\t\t\t\t\t\t\t\t\t// Get id\n\t\t\tsui.pages.Draw(sui.curResults[id]);\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Show image\n\t\t\t});\n\n\t\t$(\"#sui-picEnlarge\").on(\"click\",()=> {\t\t\t\t\t\t\t\t\t\t\t\t\t\t// ON RESIZE PIC\n\t\t\tlet sx,sy,px,py;\n\t\t\tlet pic=$(\"#sui-legacy\")[0];\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Point at image\n\t\t\tlet h=$(this.div).width()/2*asp;\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Make heighr\n\t\t\t$(\"#sui-imagesBox\").css({\"padding-top\":\"12px\"});\t\t\t\t\t\t\t\t\t\t// Thinner top\n\t\t\t$(\"#sui-imageDiv\").css({width:\"100%\", height:$(\"#sui-legacy\").height()+\"px\"});\t\t\t// Full screen\n\t\t\tif ($(\"#sui-picEnlarge\").html().match(/Zoom/)) {\t\t\t\t\t\t\t\t\t\t// If zoomed already\n\t\t\t\t$(\"#sui-picEnlarge\").html(\"&#xe650\");\t\t\t\t\t\t\t\t\t\t\t\t// Restore icon\n\t\t\t\t$(\"#sui-thisPic\").offset($(\"#sui-imageDiv\").offset());\t\t\t\t\t\t\t\t// Restore offset\n\t\t\t\t$(\"#sui-imageDiv\").css({width:\"50%\",height:h+\"px\"});\t\t\t\t\t\t\t\t// Back to half screen\n\t\t\t\t$(\"#sui-imagesBox\").css({\"padding-top\":\"60px\"});\t\t\t\t\t\t\t\t\t// Restore spacing\n\t\t\t\tpic.onmousedown=pic.onwheel=null;\t\t\t\t\t\t\t\t\t\t\t\t\t// Remove listeners\n\t\t\t\treturn;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Quit\n\t\t\t\t}\n\t\t\t$(\"#sui-picEnlarge\").html(\"Zoom &nbsp; &#xe651  &nbsp; out \");\t\t\t\t\t\t\t// Zoom out icon\n\t\t\t$(\"#sui-thisPic\").css(\"width\",\"auto\");\t\t\t\t\t\t\t\t\t\t\t\t\t// True size\n\n\t\t\tpic.style.cursor=\"grab\";\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Grab cursor\n\t\t\tpic.onwheel=(e)=> {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// On wheel foir trackpad moving\n\t\t\t\te=e||window.event;\t\t\t\t\t\te.preventDefault();\t\t\t\t\t\t\t// Set event locally\t\t\t\t\t\t\t\t\t\n\t\t\t\tsx=$(\"#sui-thisPic\").offset();\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Current pos\n\t\t\t\t$(\"#sui-thisPic\").offset({left:(e.deltaX ? e.deltaX : 0)/5+sx.left,top:(e.deltaY ? e.deltaY : 0)/3+sx.top}); // Set image via offset\n\t\t\t\t};\n\n\t\t\tpic.onmousedown=(e)=> {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// On click for mouse moving\n\t\t\t\te=e||window.event;\t\t\t\t\t\te.preventDefault();\t\t\t\t\t\t\t// Set event locally\t\t\t\t\t\t\t\t\t\n\t\t\t\tsx=e.pageX;    \t\t\t\t\t\t\tsy=e.pageY;\t\t\t\t\t\t\t\t\t// Start of drag\n\t\t\t\tpx=$(\"#sui-thisPic\").offset().left;\t\tpy=$(\"#sui-thisPic\").offset().top;\t\t\t// Start image offset\n\t\t\t\tpic.onmousemove=(e)=> {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// On drag\n\t\t\t\t\te=e||window.event;\t\te.preventDefault();\t\t\t\t\t\t\t\t\t\t// Set event\n\t\t\t\t\tvar dx=e.pageX-sx;   \tvar dy=e.pageY-sy;\t\t\t\t\t\t\t\t\t\t// Get delta\n\t\t\t\t\t$(\"#sui-thisPic\").offset({left:px+dx,top:py+dy});\t\t\t\t\t\t\t\t// Set image via offset\n\t\t\t\t\t};\n\t\t\t\tpic.onmouseup=(e)=> {\tpic.onwheeel=pic.onmouseup=pic.onmousemove=null; }; \t\t// Remove listeners\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tDrawItem(icon, label, value, def, style, bold)\t\t\t\t\t\t\t\t\t\t\t// DRAW ITEM\n\t\t{\n\t\t\tlet i,str=\"<tr><td>\";\n\t\t\tif ((value == null) || (value == undefined) || (value == \"\"))\treturn \"\";\t\t\t\t// Return nothing\n\t\t\tif (icon)\tstr+=icon+\"&nbsp;&nbsp;\";\t\t\t\t\t\t\t\t\t\t\t\t\t// Add icon\n\t\t\tstr+=\"<span class='sui-pageLab'\";\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Label head\n\t\t\tif (bold)\tstr+=\" style='font-weight:600'\";\t\t\t\t\t\t\t\t\t\t\t// Bold?\n\t\t\tstr+=\">\"+label+\":&nbsp;&nbsp;</span>\";\t\t\t\t\t\t\t\t\t\t\t\t\t// Add label\n\t\t\tstr+=\"</td><td><span class='\";\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Add value span\n\t\t\tstr+=(style ? style : \"sui-pageVal\")+\"'>\";\t\t\t\t\t\t\t\t\t\t\t\t// Default, or special style\n\t\t\tif (typeof(value) == \"object\") {\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If an array\n\t\t\t\tfor (i=0;i<value.length;++i)\t{\t\t\t\t\t\t\t\t\t\t\t\t\t// For each item\n\t\t\t\t\tif (value[i].header)\t\tstr+=value[i].header;\t\t\t\t\t\t\t\t// Use .header\n\t\t\t\t\telse if (value[i].value)\tstr+=value[i].value;\t\t\t\t\t\t\t\t// .value\n\t\t\t\t\telse if (value[i].val)\t\tstr+=value[i].val;\t\t\t\t\t\t\t\t\t// .val\n\t\t\t\t\telse if (value[i].title)\tstr+=value[i].title;\t\t\t\t\t\t\t\t// .title\n\t\t\t\t\telse \t\t\t\t\t\tstr+=value[i];\t\t\t\t\t\t\t\t\t\t// Plain\t\n\t\t\t\t\tif (i != value.length-1)\tstr+=\", \";\t\t\t\t\t\t\t\t\t\t\t// Add separator\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\telse str+=(value && (!value.match(/undefined/))) ? value : def;\t\t\t\t\t\t\t// Add def if bad value or show value\n\t\t\treturn str+\"</span></td></tr>\";\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Return item\n\t\t}\n\t\n\n\n} // Images class closure\n","/* \tTEXT PAGES ****************************************************************************************************************************\n\n\tThis module draws the Texts page based on a kmap from SOLR. Some information comes from the kmap\n\tpassed in and some from the a second query from the JSON data coming from Drupal. The formatted \n\ttable of contents and text content are tsaken directly from the JSON markup.\n\n\tA tabbed interface shows that TOC, descriptive metadata. and links to alternative ways to view \n\tthe text in other formats. \n\n\tRequires: \tjQuery \t\t\t\t\t\t\t\t\t\t\t\t// Almost any version should work\n\tCSS:\t\tsearchui.css\t\t\t\t\t\t\t\t\t\t// All styles are prefixed with 'sui-'\n\t\t\t\thttps://texts-dev.shanti.virginia.edu/sites/all/themes/shanti_sarvaka_texts/css/shanti_texts.css\t\t// For contents formatting\t\t\n\tJS:\t\t\tECMA-6\t\t\t\t\t\t\t\t\t\t\t\t// Uses lambda (arrow) functions\n\tJSON:\t\tFrom Drupal site\n\tGlobals:\tLooks for sui and sui.pages\n\tDependents:\tpages.js, searchui.js\t\t\t\t\t\t\t\t// JS modules called\n\n******************************************************************************************************************************************/\n/* eslint-disable */\nimport $ from 'jquery';\nexport default class Texts {\n    constructor(\n        sui // CONSTRUCTOR\n    ) {\n        if (!sui) {\n            throw new Error('SearchUI must be passed to constructor');\n        }\n        this.sui = sui;\n        this.div = sui.pages.div; // Div to hold page (same as Pages class)\n        this.content = ['...loading', '...loading', '...loading']; // Content pages\n    }\n\n    Draw(\n        o // DRAW TEXTS PAGE FROM KMAP\n    ) {\n        console.error('texts.Draw()');\n        const sui = this.sui;\n        let _this = this;\n        if (!$('.shanti-texts-section-content').length)\n            // No CSS yet\n            $('<link/>', {\n                rel: 'stylesheet',\n                type: 'text/css',\n                href:\n                    'https://texts-dev.shanti.virginia.edu/sites/all/themes/shanti_sarvaka_texts/css/shanti_texts.css',\n            }).appendTo('head'); // Load CSS\n        var url =\n            o.url_ajax.replace(/node_ajax/i, 'node_embed') + '?callback=pfunc'; // Make url\n        $(this.div).html(); // Clear page\n        var str = `<div id='sui-textCon' class='sui-texts'></div>\n\t\t<div style='display:inline-block;width:calc(34% + 3px);margin-left:-8px;vertical-align:top'>\n\t\t<div class='sui-textTop' id='sui-textTop'>\n\t\t\t<div class='sui-textTab' id='sui-textTab0'>CONTENTS</div>\n\t\t\t<div class='sui-textTab' id='sui-textTab1'>DESCRIPTION</div>\n\t\t\t<div class='sui-textTab' id='sui-textTab2'>VIEWS</div>\n\t\t</div>\n\t\t<div class='sui-textContent' id='sui-textContent'></div></div>`;\n        $(this.div).html(str.replace(/\\t|\\n|\\r/g, '')); // Remove format and add to div\n\n        // sui.pages.DrawRelatedAssets(o);\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Draw related assets menu if active\n\n        sui.LoadingIcon(true, 64); // Show loading icon\n\n        $.ajax({ url: url, dataType: 'jsonp' }).done((data) => {\n            // Get json\n            sui.LoadingIcon(false); // Hide loading icon\n            $('#sui-textCon').html(data); // Add text content\n            $('#shanti-texts-container').height(\n                $('#c-columnContent__main').height() - 80\n            ); // Reset text height\n            $('#shanti-texts-body').height($('#sui-content').height() - 110); // Reset text height\n            this.content[0] = $('#shanti-texts-toc').html(); // Save TOC\n            $('#shanti-texts-sidebar').remove(); // Remove original sidebar\n            showTab(0); // Show TOC\n\n            $('#shanti-texts-container').append('xxxxxxxxxxxxx<br><br>');\n            $('.kmap-tag-group').each(function () {\n                // For each tag group\n                let facet = $(this).data('kmdomain'); // Get facet\n                let id = facet + '-' + $(this).data('kmid'); // Make id\n                let str = `<span style='font-family:\"Open Sans\",shanticon;color:${\n                    sui.assets[facet].c\n                }'>\n\t\t\t\t\t${sui.assets[facet].g}&nbsp;</span>\n\t\t\t\t\t${$(this.children[0]).text()}\n\t\t\t\t\t${sui.pages.AddPop(id)}&nbsp;&nbsp;`;\n                $(this.children[0]).html(str.replace(/\\t|\\n|\\r/g, ''));\n            });\n\n            let s = `<p><strong>ALTERNATIVE FORMATS</strong></p>\n\t\t\t<p>&nbsp;&nbsp;&nbsp;&nbsp;<a target='_blank' href='https://texts.shanti.virginia.edu/book_pubreader/${o.id}'>&#xe678&nbsp;&nbsp;View in PubReader</a></p>\n\t\t\t<p>&nbsp;&nbsp;&nbsp;&nbsp;<a target='_blank' href='https://texts.shanti.virginia.edu/shanti_texts/voyant/${o.id}'>&#xe678&nbsp;&nbsp;View in Voyant</a></p>\n\t\t\t<p>&nbsp;&nbsp;&nbsp;&nbsp;<a target='_blank' href='https://texts.shanti.virginia.edu/shanti_texts/node_ajax_text/${o.id}'>&#xe678&nbsp;&nbsp;View as raw text</a></p>`;\n            this.content[2] = s.replace(/\\t|\\n|\\r/g, ''); // Set view content\n\n            sui.GetJSONFromKmap(o, (d) => {\n                // Get JSON\n                let i,\n                    str = '';\n                str += \"<table style='width:100%'>\"; // Start data table\n                try {\n                    s = `<a title='Collection' id='sui-txtCol' href='#p=${\n                        o.collection_uid_s\n                    }'>${o.collection_title}</a>${sui.pages.AddPop(\n                        o.collection_uid_s\n                    )}`;\n                    if (o.collection_title)\n                        str += this.DrawItem('&#xe633', 'COLLECTION', s);\n                } catch (e) {}\n                str += this.DrawItem(\n                    '&#xe67c',\n                    'VISIBILITY',\n                    'Public - accessible to all site users'\n                );\n                if (o.summary)\n                    str +=\n                        \"<tr><hr><td colspan='2' style='max-width:\" +\n                        $('#c-columnContent__main').width() / 4 +\n                        \"px'>\" +\n                        o.summary +\n                        '<hr><td></tr>'; // Add summary\n                try {\n                    str += this.DrawItem(\n                        '&#xe600',\n                        'AUTHOR',\n                        d.field_book_author.und,\n                        '',\n                        'sui-pageLab'\n                    );\n                } catch (e) {}\n                try {\n                    str += this.DrawItem(\n                        '&#xe675',\n                        'EDITOR',\n                        d.field_book_editor.und,\n                        '',\n                        'sui-pageLab'\n                    );\n                } catch (e) {}\n                try {\n                    str += this.DrawItem(\n                        '&#xe633',\n                        'YEAR&nbsp;PUBLISHED',\n                        d.field_dc_date_publication_year.und[0].value.substr(\n                            0,\n                            4\n                        ),\n                        'sui-pageLab'\n                    );\n                } catch (e) {}\n                try {\n                    str += this.DrawItem(\n                        '&#xe633',\n                        'ORIGINAL&nbsp;YEAR PUBLISHED',\n                        d.field_dc_date_orginial_year.und[0].value.substr(0, 4),\n                        'sui-pageLab'\n                    );\n                } catch (e) {}\n                if (d.field_kmap_places && d.field_kmap_places.und) {\n                    // If places\n                    str +=\n                        \"<tr><td style='vertical-align:top'><span class='sui-pageLab'>&#xe62b&nbsp;&nbspPLACES:</td><td>\"; // Add header\n                    for (i = 0; i < d.field_kmap_places.und.length; ++i) {\n                        // For each item\n                        str += d.field_kmap_places.und[i].header; // Add name\n                        str += sui.pages.AddPop(\n                            d.field_kmap_places.und[i].domain +\n                                '-' +\n                                d.field_kmap_places.und[i].id\n                        ); // Add drop\n                        if (i < d.field_kmap_places.und.length - 1)\n                            str += '<br>'; // Add separator\n                    }\n                    str += '</td></tr>';\n                }\n                if (d.field_kmap_subjects && d.field_kmap_subjects.und) {\n                    // If subjects\n                    str +=\n                        \"<tr><td style='vertical-align:top'><span class='sui-pageLab'>&#xe634&nbsp;&nbspPLACES:</td><td>\"; // Add header\n                    for (i = 0; i < d.field_kmap_subjects.und.length; ++i) {\n                        // For each item\n                        str += d.field_kmap_subjects.und[i].header; // Add name\n                        str += sui.pages.AddPop(\n                            d.field_kmap_subjects.und[i].domain +\n                                '-' +\n                                d.field_kmap_subjects.und[i].id\n                        ); // Add drop\n                        if (i < d.field_kmap_subjects.und.length - 1)\n                            str += '<br>'; // Add separator\n                    }\n                    str += '</td></tr>';\n                }\n                if (d.field_kmap_terms && d.field_kmap_terms.und) {\n                    // If terms\n                    str +=\n                        \"<tr><td style='vertical-align:top'><span class='sui-pageLab'>&#xe635&nbsp;&nbspTERMS:</td><td>\"; // Add  header\n                    for (i = 0; i < d.field_kmap_terms.und.length; ++i) {\n                        // For each item\n                        str += d.field_kmap_terms.und[i].header; // Add name\n                        str += sui.pages.AddPop(\n                            d.field_kmap_termss.und[i].domain +\n                                '-' +\n                                d.field_kmap_terms.und[i].id\n                        ); // Add drop\n                        if (i < d.field_kmap_terms.und.length - 1)\n                            str += '<br>'; // Add separator\n                    }\n                    str += '</td></tr>';\n                }\n                try {\n                    str += this.DrawItem(\n                        '&#xe674',\n                        'TRANSLATOR',\n                        d.field_book_translator.und,\n                        'sui-pageLab'\n                    );\n                } catch (e) {}\n                try {\n                    str += this.DrawItem(\n                        '&#xe670',\n                        'LANGUAGE',\n                        d.field_dc_language_original.und,\n                        'sui-pageLab'\n                    );\n                } catch (e) {}\n                try {\n                    str += this.DrawItem(\n                        '&copy;',\n                        'RIGHTS',\n                        d.field_dc_rights_general.und,\n                        'sui-pageLab'\n                    );\n                } catch (e) {}\n                str += '</table>';\n                this.content[1] = str.replace(/\\t|\\n|\\r/g, ''); // Set view content\n                try {\n                    this.content[2] +=\n                        \"<p>&nbsp;&nbsp;&nbsp;&nbsp;<a target='_blank' href='\" +\n                        d.field_pdf_version.und[0].url +\n                        \"'>&#xe678&nbsp;&nbsp;View as PDF</a></p>\";\n                } catch (e) {}\n            });\n\n            $('[id^=sui-textTab]').on('click', (e) => {\n                // ON TAB CLICK\n                var id = e.currentTarget.id.substring(11); // Get index of tab\n                showTab(id); // Draw it\n            });\n\n            function showTab(which) {\n                // SHOW TAB CONTENTS\n                $('#sui-textContent').html(\n                    \"<div class='sui-sourceText' style='font-size:18px;color:#000'>\" +\n                        o.title +\n                        '<div><hr>'\n                ); // Set title\n                $('[id^=sui-textTab]').css({ 'background-color': '#eee' });\n                $('#sui-textTab' + which).css({ 'background-color': '#fff' });\n                $('#sui-textContent').append(_this.content[which]); // Set content\n                $('#sui-txtCol').off('click'); // Clear old handler\n                $('#sui-txtCol').on('click', () => {\n                    // ON COLLECTION CLICK\n                    sui.GetKmapFromID(o.collection_uid_s, (kmap) => {\n                        sui.SendMessage('', kmap);\n                    }); // Get kmap and show page\n                    return false; // Stop propagation\n                });\n            }\n        });\n    }\n\n    DrawItem(\n        icon,\n        label,\n        value,\n        def,\n        style,\n        bold // DRAW ITEM\n    ) {\n        let i,\n            str = '<tr><td>';\n        if (value == null || value == undefined || value == '') return ''; // Return nothing\n        if (icon) str += icon + '&nbsp;&nbsp;'; // Add icon\n        str += \"<span class='sui-pageLab'\"; // Label head\n        if (bold) str += \" style='font-weight:600'\"; // Bold?\n        str += '>' + label + ':&nbsp;&nbsp;</span>'; // Add label\n        str += \"</td><td><span class='\"; // Add value span\n        str += (style ? style : 'sui-pageVal') + \"'>\"; // Default, or special style\n        if (typeof value == 'object') {\n            // If an array\n            for (i = 0; i < value.length; ++i) {\n                // For each item\n                if (value[i].header) str += value[i].header;\n                // Use .header\n                else if (value[i].value) str += value[i].value;\n                // .value\n                else if (value[i].val) str += value[i].val;\n                // .val\n                else if (value[i].title) str += value[i].title;\n                // .title\n                else str += value[i]; // Plain\n                if (i != value.length - 1) str += ', '; // Add separator\n            }\n        } else str += value && !value.match(/undefined/) ? value : def; // Add def if bad value or show value\n        return str + '</span></td></tr>'; // Return item\n    }\n} // Texts class closure\n","/* \tSOURCE PAGES ****************************************************************************************************************************\n\n\tThis module draws the sources page based on a kmap from SOLR. Some information comes from the kmap\n\tpassed in and some from the a second query from the JSON data coming from Drupal. \t\n\t\n\tRequires: \tjQuery \t\t\t\t\t\t\t\t\t\t\t\t// Almost any version should work\n\tCSS:\t\tsearchui.css\t\t\t\t\t\t\t\t\t\t// All styles are prefixed with 'sui-'\n\tJS:\t\t\tECMA-6\t\t\t\t\t\t\t\t\t\t\t\t// Uses lambda (arrow) functions\n\tJSON:\t\tFrom Drupal site\n\tGlobals:\tLooks for sui and sui.pages\n\tDependents:\tpages.js, searchui.js\t\t\t\t\t\t\t\t// JS modules called\n\n*********************************************************************************************************************************************/\n/* eslint-disable */\nimport $ from 'jquery';\nexport default class Sources  {\n\n\tconstructor(sui)   \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// CONSTRUCTOR\n\t{\n\t\tif (!sui) {\n\t\t\tthrow new Error(\"SearchUI must be passed to constructor\");\n\t\t}\n\t\tthis.sui = sui;\n\t\tthis.div=sui.pages.div;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Div to hold page (same as Pages class)\n\t}\n\n\tDraw(o)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// DRAW SOURCE PAGE FROM KMAP\n\t{\n\t\tconst sui = this.sui;\n\t\tvar i;\n\t\tvar str=`<div class='sui-sources' id='sui-sources'>\n\t\t<span style='font-size:24px;color:${sui.assets[o.asset_type].c};vertical-align:-4px'>${sui.assets[o.asset_type].g}</span>\n\t\t&nbsp;&nbsp;<span class='sui-sourceTitle'>${o.title[0]}</span>\n\t\t<hr style='border-top: 1px solid ${sui.assets[o.asset_type].c}'>\n\t\t<div class='sui-sourceSec' id='sui-srcSec'></div><br>`;\n\t\tif (o.creator && o.creator.length) {\n\t\t\tstr+=`<span class='sui-pageLab' style='color:${sui.assets[o.asset_type].c}'>&#xe600</span>\n\t\t\t&nbsp;&nbsp;${o.creator.join(\", \")}<br><br>`;\n\t\t\t}\n\t\tif (o.url_thumb && !o.url_thumb.match(/gradient.jpg/)) str+=\"<img src='\"+o.url_thumb+\"' style='float:right;width:33%; padding:0 0 12px 12px'>\";\n\t\tif (o.collection_title) str+=`<p>COLLECTION:&nbsp;&nbsp<a id='sui-imgCol' href='#p=${o.collection_uid_s}'>${o.collection_title}</a></p>`;\n\t\tif (o.asset_subtype) str+=\"<p>FORMAT:&nbsp;&nbsp<span class='sui-sourceText'>\"+o.asset_subtype+\"</span></p>\";\n\t\tstr+=\"<p class='sui-pageLab' id='sui-p2'>PUBLICATION YEAR:&nbsp;&nbsp<span class='sui-sourceText' id='sui-srcYear'></span>\";\n\t\tif (o.publisher_s) str+=\"<p>PUBLISHER:&nbsp;&nbsp<span class='sui-sourceText'>\"+o.publisher_s+\"</span></p>\";\n\t\tstr+=\"<p class='sui-pageLab' id='sui-p3'>PLACE OF PUBLICATION:&nbsp;&nbsp<span class='sui-sourceText' id='sui-srcPlc'></span>\";\n\t\tstr+=\"<p class='sui-pageLab' id='sui-p1'>PAGES:&nbsp;&nbsp<span class='sui-sourceText' id='sui-srcPages'></span>\";\n\t\tstr+=\"<p class='sui-pageLab'>SOURCE ID:&nbsp;&nbsp<span class='sui-sourceText'>sources-\"+o.id+\"</span></p>\";\n\t\tif (o.summary) str+=\"<p>ABSTRACT:<div class='sui-sourceText'>\"+o.summary+\"</div></p>\";\n\t\tstr+=\"</div>\";\n\t\t$(this.div).html(str.replace(/\\t|\\n|\\r/g,\"\"));\t\t\t\t\t\t\t\t\t\t\t// Remove format and add to div\t\n\t\tsui.pages.DrawRelatedAssets();\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Draw related assets menu if active\n\n\t\t$(\"#sui-imgCol\").on(\"click\",()=> {\t\t\t\t\t\t\t\t\t\t\t\t\t\t// ON COLLECTION CLICK\n\t\t\tsui.GetKmapFromID(o.collection_uid_s,(kmap)=>{ sui.SendMessage(\"\",kmap); });\t\t// Get kmap and show page\n\t\t\treturn false;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Stop propagation\n\t\t\t});\n\n\t\tsui.GetJSONFromKmap(o, (d)=> {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Get details from JSON\n\t\t\tlet i,str=\"\";\n\t\t\tif (d.biblio_pages) \t\t\t$(\"#sui-srcPages\").html(d.biblio_pages);\t\t\t// Add pages\n\t\t\telse\t\t\t\t\t\t\t$(\"#sui-sp1\").hide();\t\t\t\t\t\t\t\t// Hide\n\t\t\tif (d.biblio_year) \t\t\t\t$(\"#sui-srcYear\").html(d.biblio_year);\t\t\t\t// Year\n\t\t\telse\t\t\t\t\t\t\t$(\"#sui-sp2\").hide();\t\t\t\t\t\t\t\t// Hide\n\t\t\tif (d.biblio_secondary_title) \t$(\"#sui-srcSec\").html(d.biblio_secondary_title);\t// Pub\n\t\t\telse\t\t\t\t\t\t\t$(\"#sui-srcSec\").hide();\t\t\t\t\t\t\t// Hide\n\t\t\tif (d.biblio_place_published) \t$(\"#sui-srcPlc\").html(d.biblio_place_published);\t// Pub place\n\t\t\telse\t\t\t\t\t\t\t$(\"#sui-sp3\").hide();\t\t\t\t\t\t\t\t// Hide\n\t\t\tif (d.field_kmaps_subjects && d.field_kmaps_subjects.und) {\t\t\t\t\t\t\t// If subjects\n\t\t\t\tstr+=\"<p class='sui-pageLab'>SUBJECTS:&nbsp;&nbsp;\";\t\t\t\t\t\t\t// Add header\n\t\t\t\tfor (i=0;i<d.field_kmaps_subjects.und.length;++i) {\t\t\t\t\t\t\t\t// For each item\n\t\t\t\t\tstr+=d.field_kmaps_subjects.und[i].header;\t\t\t\t\t\t\t\t\t// Add name\n\t\t\t\t\tstr+=sui.pages.AddPop(d.field_kmaps_subjects.und[i].domain+\"-\"+d.field_kmaps_subjects.und[i].id);\t// Add drop\n\t\t\t\t\tif (i < d.field_kmaps_subjects.und.length-1)\tstr+=\", \";\t\t\t\t\t// Add separator\n\t\t\t\t\t}\n\t\t\t\tstr+=\"</p>\";\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// End TERMS\n\t\t\t\t}\n\t\t\tif (d.field_kmaps_places && d.field_kmaps_places.und) {\t\t\t\t\t\t\t\t// If places\n\t\t\t\tstr+=\"<p class='sui-pageLab'>TERMS:&nbsp;&nbsp;\";\t\t\t\t\t\t\t\t// Add header\n\t\t\t\tfor (i=0;i<d.field_kmaps_places.und.length;++i) {\t\t\t\t\t\t\t\t// For each item\n\t\t\t\t\tstr+=d.field_kmaps_places.und[i].header;\t\t\t\t\t\t\t\t\t// Add name\n\t\t\t\t\tstr+=sui.pages.AddPop(d.field_kmaps_places.und[i].domain+\"-\"+d.field_kmaps_places.und[i].id);\t// Add drop\n\t\t\t\t\tif (i < d.field_kmaps_places.und.length-1)\tstr+=\", \";\t\t\t\t\t\t// Add separator\n\t\t\t\t\t}\n\t\t\t\tstr+=\"</p>\";\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// End PLACES\n\t\t\t\t}\n\t\t\tif (d.field_kmap_terms && d.field_kmap_terms.und) {\t\t\t\t\t\t\t\t\t// If terms\n\t\t\t\tstr+=\"<p class='sui-pageLab'>TERMS:&nbsp;&nbsp;\";\t\t\t\t\t\t\t\t// Add TERMS header\n\t\t\t\tfor (i=0;i<d.field_kmap_terms.und.length;++i) {\t\t\t\t\t\t\t\t\t// For each item\n\t\t\t\t\tstr+=d.field_kmap_terms.und[i].header;\t\t\t\t\t\t\t\t\t\t// Add name\n\t\t\t\t\tstr+=sui.pages.AddPop(d.field_kmap_terms.und[i].domain+\"-\"+d.field_kmap_terms.und[i].id);\t// Add drop\n\t\t\t\t\tif (i < d.field_kmap_terms.und.length-1)\tstr+=\", \";\t\t\t\t\t\t// Add separator\n\t\t\t\t\t}\n\t\t\t\tstr+=\"</p>\";\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// End TERMS\n\t\t\t\t}\n\t\t\tif (d.biblio_url) str+=\"<p class='sui-pageLab'>URL:&nbsp;&nbsp;<a target='_blank' href='\"+d.biblio_url+\"'>\"+d.biblio_url+\"</a></p>\";\t// URL\n\t\t\t$(\"#sui-sources\").append(str);\n\t\t\t});\t\t\t\t\t\t\t\t\t\n\t}\n\n} // Sources class closure\n","/* \tVISUAL PAGES ****************************************************************************************************************************\n\n\tThis module draws the visuals page based on a kmap from SOLR. An iframe displays the visualization \n\tbased on a url and the metadata associated with it appears below. The various methods of sharing\n\tthe viz with other are revealed aa they are clicked on.\n\n\tRequires: \tjQuery \t\t\t\t\t\t\t\t\t\t\t\t// Almost any version should work\n\tCSS:\t\tsearchui.css\t\t\t\t\t\t\t\t\t\t// All styles are prefixed with 'sui-'\n\tJS:\t\t\tECMA-6\t\t\t\t\t\t\t\t\t\t\t\t// Uses lambda (arrow) functions\n\tJSON:\t\tFrom Drupal site\n\tGlobals:\tlooks for sui and sui.pages\n\tDependents:\tpages.js, searchui.js\t\t\t\t\t\t\t\t// JS modules called\n\n********************************************************************************************************************************************/\n/* eslint-disable */\nimport $ from 'jquery';\nexport default class Visuals {\n    constructor(\n        sui // CONSTRUCTOR\n    ) {\n        if (!sui) {\n            throw new Error('SearchUI must be passed to constructor');\n        }\n        this.sui = sui;\n        this.div = sui.pages.div; // Div to hold page (same as Pages class)\n    }\n\n    Draw(\n        o // DRAW VISUAL PAGE FROM KMAP\n    ) {\n        const sui = this.sui;\n        sui.GetJSONFromKmap(o, (d) => {\n            drawDetails(d);\n        }); // Gert JSON\n        var url =\n            '//visuals.shanti.virginia.edu/sites/all/libraries/SHIVA/go.htm?m=//visuals.shanti.virginia.edu/data/json/';\n        url += o.id; // Full url\n        var d = sui.pages.DrawItem; // Point at item drawer\n\n        function drawDetails(j) {\n            // Draw details\n            let s;\n            var shivaNode = $.parseJSON(j.shivanode_json.und[0].value); // Get shiva data\n            var wid = shivaNode.width ? shivaNode.width + 'px' : '100%'; // If width set use it\n            var hgt = shivaNode.height\n                ? shivaNode.height + 'px'\n                : 'calc(100% - 155px)'; // Height\n            var src = shivaNode.dataSourceUrl ? shivaNode.dataSourceUrl : ''; // Data source\n            var str = `<iframe id='sui-iframe' frameborder='0' scrolling='no' src='${url}' \n\t\t\tstyle='margin-left:auto;margin-right:auto;height:${hgt};width:${wid};display:block;overflow:hidden'></Iframe><br>`;\n            str += \"<div class='sui-sources' style='padding-top:0'>\";\n            try {\n                if (o.collection_title)\n                    s = `<a title='Collection' id='sui-imgCol'\thref='#p=${o.collection_uid_s}'>${o.collection_title}</a>`;\n                else s = 'None';\n            } catch (e) {}\n            str +=\n                \"<div style='text-align:center'>\" +\n                d('&#xe633', 'MANDALA COLLECTION', s) +\n                '</div>';\n            str += \"<hr style='border-top: 1px solid #6e9456;margin-top:12px'>\";\n            try {\n                str += d('&#xe63b', 'TITLE', o.title[0], 'Untitled');\n            } catch (e) {}\n            try {\n                str += d(\n                    '&#xe65f',\n                    'TYPE',\n                    o.asset_subtype.replace(/:/g, ' | ')\n                );\n            } catch (e) {}\n            try {\n                str += d('&#xe60c', 'DATE', o.node_created.substr(0, 10));\n            } catch (e) {}\n            try {\n                str +=\n                    \"&#xe600&nbsp;&nbsp;<span class='sui-pageLab'>CREATOR</span>:&nbsp;&nbsp;<span class='sui-pageVal'>\";\n                str += o.node_user_full\n                    ? o.node_user_full + '&nbsp;&nbsp'\n                    : '' + '';\n                str += o.node_user ? o.node_user : '';\n                str += '</span>';\n            } catch (e) {}\n            if (j.field_kmaps_subjects && j.field_kmaps_subjects.und) {\n                // If subjects\n                str += \"<p class='sui-pageLab'>SUBJECTS:&nbsp;&nbsp;\"; // Add header\n                for (let i = 0; i < j.field_kmaps_subjects.und.length; ++i) {\n                    // For each item\n                    str += j.field_kmaps_subjects.und[i].header; // Add name\n                    str += sui.pages.AddPop(\n                        j.field_kmaps_subjects.und[i].domain +\n                            '-' +\n                            j.field_kmaps_subjects.und[i].id\n                    ); // Add drop\n                    if (i < j.field_kmaps_subjects.und.length - 1) str += ', '; // Add separator\n                }\n                str += '</p>'; // End TERMS\n            }\n            if (j.field_kmaps_places && j.field_kmaps_places.und) {\n                // If places\n                str += \"<p class='sui-pageLab'>TERMS:&nbsp;&nbsp;\"; // Add header\n                for (let i = 0; i < j.field_kmaps_places.und.length; ++i) {\n                    // For each item\n                    str += j.field_kmaps_places.und[i].header; // Add name\n                    str += sui.pages.AddPop(\n                        j.field_kmaps_places.und[i].domain +\n                            '-' +\n                            j.field_kmaps_places.und[i].id\n                    ); // Add drop\n                    if (i < j.field_kmaps_places.und.length - 1) str += ', '; // Add separator\n                }\n                str += '</p>'; // End PLACES\n            }\n            if (j.field_kmap_terms && j.field_kmap_terms.und) {\n                // If terms\n                str += \"<p class='sui-pageLab'>TERMS:&nbsp;&nbsp;\"; // Add TERMS header\n                for (let i = 0; i < j.field_kmap_terms.und.length; ++i) {\n                    // For each item\n                    str += j.field_kmap_terms.und[i].header; // Add name\n                    str += sui.pages.AddPop(\n                        j.field_kmap_terms.und[i].domain +\n                            '-' +\n                            j.field_kmap_terms.und[i].id\n                    ); // Add drop\n                    if (i < j.field_kmap_terms.und.length - 1) str += ', '; // Add separator\n                }\n                str += '</p>'; // End TERMS\n            }\n            if (src)\n                str +=\n                    \"<p>&#xe678&nbsp;&nbsp;<a target='_blank' href='\" +\n                    src +\n                    \"'>External spreadsheet</a></p>\";\n            if (o.caption) str += o.caption;\n\n            var urlw = `[iframe src=\"${url}\" width=\"${wid}\" height=\"${hgt}\"]`; // Wordpress embed code\n            var urli = `&lt;iframe src=\\\"${url}\\\" width=\\\"${wid}\\\" height=\\\"${hgt}\\\"&gt;`; // Iframe\n            str += `<hr>&#xe600&nbsp;&nbsp;<span class='sui-pageLab'>SHARE AS</span>:&nbsp;&nbsp;\n\t\t\t\t<a id='sui-share-1' style='display:inline-block;cursor:pointer'>Link&nbsp;&nbsp;&nbsp;</a>\n\t\t\t\t<a id='sui-share-2' style='display:inline-block;cursor:pointer'>WordPress&nbsp;&nbsp;&nbsp;</a>\n\t\t\t\t<a id='sui-share-3' style='display:inline-block;cursor:pointer'>Iframe&nbsp;&nbsp;&nbsp;</a>\n\t\t\t\t<p id='sui-resShare' style='border-radius:4px;background-color:#fff;padding:8px;display:none;border:1px solid #ccc'></p>\n\t\t\t\t</div>`;\n\n            $('#sui-resShare').html('<strong>LINK</strong>: ${url}');\n            $('#sui-resShare').toggle();\n            $(sui.pages.div).html(str.replace(/\\t|\\n|\\r/g, '')); // Remove format and add to div\n            sui.pages.DrawRelatedAssets(o); // Draw related assets menu if active\n\n            $('[id^=sui-share-]').on('click', (e) => {\n                // ON THUMBNAIL CLICK\n                var id = e.currentTarget.id.split('-')[2]; // Get id\n                if (id == '1') $('#sui-resShare').html(url);\n                // Link\n                else if (id == '2')\n                    $('#sui-resShare').html(\n                        `[iframe src=\"${url}\" width=\"${wid}\" height=\"${hgt}\"]`\n                    );\n                // Wordpress embed code\n                else if (id == '3')\n                    $('#sui-resShare').html(\n                        `&lt;iframe src=\"${url}\" width=\"${wid}\" height=\"${hgt}\"&gt;`\n                    ); // Iframe\n                $('#sui-resShare').show(); // Toggle state\n            });\n        }\n    }\n} // Visuals class closure\n","/* \tTEERMS PAGES ****************************************************************************************************************************\n\n\tThis module draws the terms page based on a kmap from SOLR. Some information comes from the kmap\n\tpassed in and some from the a second query from the child data in the Terms index. \tThe terms icon\n\tand the term are shown, followed by a list of names associated with that term.\n\n\tThe related resources menu is drawn, which pulls data via another SOLR call. If an image is present\n\tit is drawn there. Below that is a browsable index of terms. Clicking on one will bring up that page.\n\n\tAn button will appear if there is a recording associated with the term,found by a third query to SOLR.\n\tClicking on it will play the various mp3 versions as available  and chosen by the pulldown menu.\n\n\tA tabbed menu shows the DEFINITIONS, whih lists the definition for that term, along with its language.\n\tThe DETAILS tab lists the subjects to this page Hovering over a blue popover icon will show more information \n\tabout it. The OTHER DICTIONARIES tab shows definitions from other dictionaries.\n\n\tThe tab will open to the DEFINATIONS tab is there are any, otehr wise it will open the OTHER DICTIONARIES\n\ttab, and fianlly the DETAILS tab\n\n\tRequires: \tjQuery \t\t\t\t\t\t\t\t\t\t\t\t// Almost any version should work\n\tCSS:\t\tsearchui.css\t\t\t\t\t\t\t\t\t\t// All styles are prefixed with 'sui-'\n\tJS:\t\t\tECMA-6\t\t\t\t\t\t\t\t\t\t\t\t// Uses lambda (arrow) functions\n\tJSON:\t\tFrom Drupal site\n\tGlobals:\tLooks for sui and sui.pages\n\tDependents:\tpages.js, searchui.js\t\t\t\t\t\t\t\t// JS modules called\n\n\t\n*********************************************************************************************************************************************/\n/* eslint-disable */\nimport $ from 'jquery';\n\nexport default class Terms {\n    constructor(\n        sui // CONSTRUCTOR\n    ) {\n        if (!sui) {\n            throw new Error('SearchUI must be passed to constructor');\n        }\n        // sui.trm=this;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Save context\n        this.sui = sui;\n        this.div = sui.pages.div; // Div to hold page (same as Pages class)\n        this.recordingGroup = 0; // Which group\n        this.tabs = []; // Tab contents\n        this.tagged = []; // Kmaps of tagged definitions\n        this.kmap = null; // Current kmap\n    }\n\n    Draw(\n        o // DRAW TERM PAGE FROM KMAP\n    ) {\n        const LEGACY_SUI = this.sui;\n        let audioURLs = [''];\n        this.kmap = o;\n        var str = `<div class='c-content__main__kmaps' id='sui-terms' style=''>\n\t\t<span class='sui-termIcon'>${\n            LEGACY_SUI.assets[o.asset_type].g\n        }</span>&nbsp;&nbsp;&nbsp;\n\t\t<span class='sui-termTitle' id='sui-termTitle'>${o.title[0]}</span>\n\t\t<hr style='border-top: 1px solid ${LEGACY_SUI.assets[o.asset_type].c}'>\n\t\t<p id='sui-termNames'>Names</p>\n\t\t<div id='sui-player' style='display:none'>\n\t\t<p><div class='sui-termPlay' id='sui-termPlay'>&#xe60a</div>\n\t\t<select class='sui-termSpeak unpopulated' id='sui-termGroup'><option>AMDO GROUP</option></select></p></div>`;\n        str += \"<div id='sui-termDetails'></div>\"; // Add div for details\n\n        str += \"<div id='sui-termDefs' class='sui-termOther'></div>\"; // Add div for primary defs\n        str += \"<br><div class='sui-termOHead'>OTHER DICTIONARIES</div>\"; // Add other header\n        str +=\n            \"<div id='sui-termOther' class='sui-termOther' style='padding:0 24px'></div></div>\"; // Add div for other dictionaries\n        $(this.div).html(str.replace(/\\t|\\n|\\r/g, '')); // Remove format and add to div\n        this.tabs = []; // Start fresh\n        this.SetTabContent(o); // Fill tab contents\n\n        /*\n         * REFACTOR:  Audio Player\n         * Todo:  Refactor Audio-Player into a more React-friendly form...\n         *\n         */\n        $('#sui-termPlay')\n            .off('click')\n            .on('click', (e) => {\n                // ON TERM PLAY\n                // let snd=new Audio();\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Init audio object\n                let snd = new Audio(audioURLs[this.recordingGroup]); // Load it\n                snd.play(); // Play it\n            });\n\n        $('#sui-termGroup')\n            .off('change')\n            .on('change', (e) => {\n                // ON GROUP SET\n                this.recordingGroup = $('#sui-termGroup').prop('selectedIndex'); // Get group\n            });\n\n        LEGACY_SUI.GetAudioFromID(o.id, (d) => {\n            // Get audio info\n            audioURLs = d; // Get urls\n            if (d.length) $('#sui-player').slideDown(); // If any recording, show structure\n            if (d.length > 1)\n                $('#sui-termGroup.unpopulated').append(\n                    '<option>KHAM-HOR GROUP</option>'\n                ); // Add 2nd group if there\n            if (d.length > 2)\n                $('#sui-termGroup.unpopulated').append(\n                    '<option>CENTRAL TIBET DIALECT</option>'\n                ); // Add 3rd group if there\n            $('#sui-termGroup.unpopulated').removeClass('unpopulated');\n        });\n        /* END REFACTOR:   Audio Player */\n\n        LEGACY_SUI.pages.DrawRelatedAssets(o); // Draw related assets menu\n    }\n\n    SetTabContent(\n        o // FILL TABS\n    ) {\n        const LEGACY_SUI = this.sui;\n        LEGACY_SUI.GetChildDataFromID(o.uid, (odata) => {\n            // LOAD CHILD DATA\n            let i,\n                k = 1,\n                l = 0,\n                t;\n            let str = '<br>',\n                str2 = '';\n            let str3 = \"<div style='height:2px'/>\"; // Spacer\n            let str4 = '<table>';\n            let firstName = ''; // First name listed\n            try {\n                let data = odata._childDocuments_; // Point at data\n                for (i = 0; i < data.length; ++i) {\n                    // For each doc\n                    if (data[i].id.match(/_definitions-/)) {\n                        // If a definition\n                        if (data[i].related_definitions_source_s) {\n                            // If another dictionary\n                            str +=\n                                '<div>' +\n                                k++ +\n                                '. <i>' +\n                                data[i].related_definitions_source_s +\n                                '</i></div>'; // Add title\n                            str += \"<p class='termDefs'>\";\n                            str += data[i].related_definitions_content_s; // Add text\n                            str += \"</p><div class='sui-termData'>\";\n                            if (data[i].related_definitions_author_s)\n                                str +=\n                                    'AUTHOR: ' +\n                                    data[i].related_definitions_author_s +\n                                    ' | ';\n                            str +=\n                                'LANGUAGE: ' +\n                                data[i].related_definitions_language_s; // Add language\n                            str +=\n                                \"</div><br><hr style='border-top:1px solid #a2733f'>\"; // End rule and div\n                        } else {\n                            // A primary definition\n                            str2 += this.DrawTabMenu(l++, [\n                                l + '.&nbsp;&nbsp;DEFINITION',\n                                'DETAILS',\n                                'PASSAGES (0)',\n                                'RESOURCES (0)',\n                            ]); // Add tab menu\n                            t = [\n                                '',\n                                '<br>',\n                                '<br>Waiting for data from Derik...<br><br><br><br>',\n                                '<br>',\n                            ]; // New tab\n                            t[0] += \"<div class='termDefs'>\";\n                            t[0] += data[i].related_definitions_content_s; // Add text\n                            t[0] += \"</div><div class='sui-termData'>\";\n                            if (data[i].related_definitions_author_s)\n                                t[0] +=\n                                    'AUTHOR: ' +\n                                    data[i].related_definitions_author_s +\n                                    ' | ';\n                            t[0] +=\n                                'LANGUAGE: ' +\n                                data[i].related_definitions_language_s +\n                                '</div><br><br>'; // Add language\n\n                            if (\n                                data[i][\n                                    'related_definitions_branch_subjects-185_header_s'\n                                ]\n                            ) {\n                                // If a header\n                                t[1] += data[i][\n                                    'related_definitions_branch_subjects-185_header_s'\n                                ].toUpperCase(); // Add label\n                                t[1] +=\n                                    ': <i>' +\n                                    data[i][\n                                        'related_definitions_branch_subjects-185_subjects_headers_t'\n                                    ] +\n                                    '</i>'; // Add value\n                                t[1] +=\n                                    LEGACY_SUI.pages.AddPop(\n                                        data[i][\n                                            'related_definitions_branch_subjects-185_subjects_uids_t'\n                                        ][0]\n                                    ) + '<br>'; // Add popover\n                            }\n                            t[1] +=\n                                'LANGUAGE: <i>' +\n                                data[i].related_definitions_language_s +\n                                '</i>';\n\n                            if (\n                                data[i][\n                                    'related_definitions_branch_subjects-184_subjects_uids_t'\n                                ]\n                            ) {\n                                t[1] +=\n                                    LEGACY_SUI.pages.AddPop(\n                                        data[i][\n                                            'related_definitions_branch_subjects-184_subjects_uids_t'\n                                        ][0]\n                                    ) + '<br>'; // Add popover\n                            }\n                            if (\n                                data[i][\n                                    'related_definitions_branch_subjects-5855_header_s'\n                                ]\n                            ) {\n                                // If a header\n                                t[1] += data[i][\n                                    'related_definitions_branch_subjects-5855_header_s'\n                                ].toUpperCase(); // Add label\n                                t[1] +=\n                                    ': <i>' +\n                                    data[i][\n                                        'related_definitions_branch_subjects-5855_subjects_headers_t'\n                                    ] +\n                                    '</i>'; // Add value\n                                t[1] +=\n                                    LEGACY_SUI.pages.AddPop(\n                                        data[i][\n                                            'related_definitions_branch_subjects-5855_subjects_uids_t'\n                                        ][0]\n                                    ) + '<br>'; // Add popover\n                            }\n                            t[1] += '<br>';\n                            this.tabs.push(t); // Add tab data for this def\n                        }\n                    }\n                    if (data[i].id.match(/_names-/)) {\n                        // If a name\n                        if (!firstName)\n                            firstName = data[i].related_names_header_s; // Save first name listed\n                        str4 += `<tr><td <td style='padding-left:${\n                            data[i].related_names_level_i * 16\n                        }px'>> <strong>${\n                            data[i].related_names_header_s\n                        }&nbsp;&nbsp;&nbsp;</strong></td><td>\n\t\t\t\t\t\t<i>${data[i].related_names_language_s}, ${\n                            data[i].related_names_writing_system_s\n                        }, ${data[i].related_names_relationship_s}\n\t\t\t\t\t\t</i></td></tr>`; // Add it\n                        str += '</table><br>';\n                    }\n\n                    // Todo: REFACTOR TabContent OUTPUT\n                    $('#sui-termNames').html(str4 + '</table>'); // Add names\n                    $('#sui-termTitle').html(\n                        `${firstName}&nbsp;&nbsp;&nbsp;${o.title[0]}`\n                    ); // Add first\n                    // END REFACTOR\n                }\n            } catch (e) {\n                throw e;\n            }\n\n            function drawAssetButton(facet, defNum, num) {\n                let str = `<div id='sui-termAssetBut-${defNum}-${facet}'\n\t\t\t\t\tclass='sui-termAssetBut' style='background-color:${LEGACY_SUI.assets[facet].c}'>\n\t\t\t\t\t<span style='font-size:20px; vertical-align:-4px'>${LEGACY_SUI.assets[facet].g}&nbsp;</span>${facet}&nbsp;&nbsp;\n\t\t\t\t\t(${num})</div>`;\n                return str.replace(/\\t|\\n|\\r/g, '');\n            }\n\n            LEGACY_SUI.GetDefinitionAssets(o.uid, (data) => {\n                // MAKE TAGGED RESOUCES BUTTONS\n                let i,\n                    j,\n                    d,\n                    s,\n                    def,\n                    t = [];\n                if (!data) return ''; // Quit if nothing tagged\n                if (!data.length) return ''; // Quit if nothing tagged\n                this.tagged = []; // Init tagged array\n                for (i = 0; i < this.tabs.length; ++i) this.tagged.push([]); // For each def, add array\n\n                for (i = 0; i < data.length; ++i) {\n                    // For each result, get list of tagged assets\n                    d = data[i]; // Point at it\n                    if (d.asset_type == 'terms') continue; // Skip terms\n                    for (j = 0; j < d.kmapid.length; ++j) {\n                        // Look through kmapids\n                        def = d.kmapid[j].match(/_definitions-(\\d*)/i); // A def?\n                        if (def) this.tagged[def[1] - 1].push(d); // Add kmap\tif tied to a tag\n                    }\n                }\n\n                for (i = 0; i < this.tabs.length; ++i) {\n                    // For each def, make button panel\n                    t.all = t.subjects = t.places = t.images = t.sources = t.visuals = t.collections = t.texts = t[\n                        'audio-video'\n                    ] = 0; // Reset counts\n                    for (j = 0; j < this.tagged[i].length; ++j) {\n                        // For each tagged kmap in def\n                        t[this.tagged[i][j].asset_type]++; // Update count\n                        t['all']++; // Update total count\n                    }\n                    s = ''; // Null title\n                    for (j in t) {\n                        // For each asset type\n                        if (t[j]) {\n                            // If anything tagged\n                            s =\n                                '<strong>Resources tagged with this definition: </strong><br>'; // Add title\n                            break; // Quit looking\n                        }\n                    }\n                    for (j in t) {\n                        // For each asset type\n                        if (t[j]) {\n                            // If anything tagged\n                            s += drawAssetButton(j, i, t[j]); // Make button\n                        }\n                    }\n                    $('#sui-tabTab-' + i + '-3').text(\n                        'RESOURCES (' + t['all'] + ')'\n                    ); // Set number of resources\n                    this.tabs[i][3] += s; // Add to definition tab\n                }\n            });\n\n            str3 = \"<table style='width:100%'><tr>\"; // Add subject types\n            addSubjectsPopover('PHONEME', o.data_phoneme_ss);\n            addSubjectsPopover('GRAMMARS', o.data_grammars_ss);\n            str3 += '</tr><tr>';\n            addSubjectsPopover('TOPICS', o.data_tibet_and_himalayas_ss);\n            addSubjectsPopover('LITERARY PERIOD', o.data_literary_period_ss);\n            str3 += '</tr><tr>';\n            addSubjectsPopover('REGISTER', o.data_register_ss);\n            addSubjectsPopover('LANGUAGE CONTEXT', o.data_language_context_ss);\n            str3 += '</tr></table>';\n            if (odata.etymologies_ss && odata.etymologies_ss.length) {\n                // If etymologies\n                str3 +=\n                    \"<br><strong>Etymology</strong><br><div class='sui-termDefs'>\"; // Add header\n                for (\n                    i = 0;\n                    i < odata.etymologies_ss.length;\n                    ++i // For each one\n                )\n                    str3 += odata.etymologies_ss[i]; // Add it\n                str += '</div>'; // Close div\n            }\n            $('#sui-termDetails').html(str3 + '<br>'); // Add Details\n            $('#sui-termDefs').html(str2.replace(/\\t|\\n|\\r/g, '')); // Remove format and add primary defs to div\n            $('#sui-termOther').html(str.replace(/\\t|\\n|\\r/g, '')); // Remove format and add others to div\n            for (i = 0; i < l; ++i) this.ShowTab(i, 0); // Open 1st tab\tin each def\n\n            function addSubjectsPopover(title, val) {\n                // ADD SUBJECTS\n                let i = 0;\n                if (!val) return; // Quit if nothing there\n                if (o.kmapid_subjects_idfacet) {\n                    // No facet data\n                    for (\n                        i = 0;\n                        i < o.kmapid_subjects_idfacet.length;\n                        ++i // For each one\n                    )\n                        if (o.kmapid_subjects_idfacet[i].split('|')[0] == val)\n                            // Find a match\n                            break; // Quit\n                    i = Math.min(o.kmapid_subjects_idfacet.length - 1, i); // Cap\n                }\n                str3 += `<td>${title}: <i>${val}</i>`; // Add title\n\n                // WARNING: changes str3 via context\n                if (o.kmapid_subjects_idfacet)\n                    // If data\n                    str3 +=\n                        LEGACY_SUI.pages.AddPop(\n                            o.kmapid_subjects_idfacet[i].split('|')[1]\n                        ) + '</td>';\n                // Add popover\n                else\n                    str3 +=\n                        LEGACY_SUI.pages.AddPop(o.related_uid_ss[i]) + '</td>'; // Add popover\n            }\n        });\n    }\n\n    DrawTabMenu(\n        num,\n        tabs // DRAW TAB MENU\n    ) {\n        let i,\n            str = '';\n        for (i = 0; i < tabs.length; ++i) {\n            // For each tab\n            str += `<div class='sui-tabTab' id='sui-tabTab-${num}-${i}' style='display:inline-block;text-align:left;padding-left:24px;width:calc(25% - 26px)'>\n\t\t\t${tabs[i]}&nbsp;&#xe609</div>`; // Add it\n        }\n        str += `<div class='sui-tabContent' id='sui-tabContent-${num}'>hhh</div>`; // Tab contents\n        return str.replace(/\\t|\\n|\\r|/g, ''); // Return tab markup\n    }\n\n    ShowTab(\n        num,\n        which // SHOW TAB\n    ) {\n        const LEGACY_SUI = this.sui;\n        $('[id^=sui-tabTab-' + num).css({\n            'background-color': '#999',\n            color: '#fff',\n            'border-top': '1px solid #999',\n        }); // Reset all tabs\n        $('#sui-tabContent-' + num).css({\n            display: 'block',\n            'background-color': '#eee',\n        }); // Show content\n        $('#sui-tabTab-' + num + '-' + which).css({\n            'background-color': '#eee',\n            color: '#000',\n            'border-top': '1px solid #a2733f',\n        }); // Active tab\n        $('#sui-tabContent-' + num).html(this.tabs[num][which]); // Set content\n\n        $('[id^=sui-tabTab]').off(); // Kill old handlers\n        $('[id^=sui-termAssetBut-]').off();\n\n        $('[id^=sui-termAssetBut-]').on('click', (e) => {\n            // ON TAGGED BUTTON CLICK\n            let i,\n                v = e.currentTarget.id.substring(17).split('-'); // Get def and facet type\n            LEGACY_SUI.ss.mode = 'related'; // Go to related mode\n            if (v[1] == 'audio') v[1] = 'audio-video'; // Compensate for extra '-'\n            LEGACY_SUI.pages.relatedType = v[1]; // Set asset type\n            LEGACY_SUI.pages.relatedBase = this.kmap; // Set base\n            LEGACY_SUI.pagesrelatedId =\n                LEGACY_SUI.pages.relatedBase.asset_type +\n                '-' +\n                LEGACY_SUI.pages.relatedBase.id; // Set id\n            if (v[1] == 'all') LEGACY_SUI.curResults = this.tagged[v[0]];\n            // Show all\n            else {\n                // Just one\n                LEGACY_SUI.curResults = []; // Clear\n                for (\n                    i = 0;\n                    i < this.tagged[v[0]].length;\n                    ++i // For each asset\n                )\n                    if (this.tagged[v[0]][i].asset_type == v[1])\n                        // If it matches\n                        LEGACY_SUI.curResults.push(this.tagged[v[0]][i]); // Add it\n            }\n            LEGACY_SUI.DrawResults(); // Draw results\n        });\n\n        $('[id^=sui-tabTab]').on('click', (e) => {\n            // ON TAB CLICK\n            var id = e.currentTarget.id.substring(11); // Get index of tab\n            let v = id.split('-'); // Get num and which\n            this.ShowTab(v[0], v[1]); // Draw it\n        });\n    }\n} // CLASS CLOSURE\n","/* \tCOLLECTIONS PAGES ****************************************************************************************************************************\n\n\tThis module draws the collections page based on a kmap from SOLR. Some information comes from the kmap\n\tpassed in and some from the a second query from the JSON data coming from Drupal. \t\n\t\n\tRequires: \tjQuery \t\t\t\t\t\t\t\t\t\t\t\t// Almost any version should work\n\tCSS:\t\tsearchui.css\t\t\t\t\t\t\t\t\t\t// All styles are prefixed with 'sui-'\n\tJS:\t\t\tECMA-6\t\t\t\t\t\t\t\t\t\t\t\t// Uses lambda (arrow) functions\n\tJSON:\t\tFrom Drupal site\n\tGlobals:\tLooks for sui and sui.pages\n\tDependents:\tpages.js, searchui.js\t\t\t\t\t\t\t\t// JS modules called\n\n*********************************************************************************************************************************************/\nimport $ from 'jquery';\n\nexport default class Collections {\n    constructor(\n        sui // CONSTRUCTOR\n    ) {\n        if (!sui) {\n            throw new Error('SearchUI must be passed to constructor');\n        }\n        this.div = sui.pages.div; // Div to hold page (same as Pages class)\n        this.content = ['', '', ' ']; // Content pages\n        this.sui = sui;\n    }\n\n    Draw(\n        o // DRAW SOURCE PAGE FROM KMAP\n    ) {\n        const sui = this.sui;\n        let a = sui.assets[o.asset_subtype.toLowerCase()];\n        var str = `<div id='sui-topCon' style='margin-left:192px'>\n\t\t<div class='sui-sources'  id='sui-collections'>\n\t\t\t<span style='font-size:24px;color:${a.c};vertical-align:-4px'>${a.g}</span>\n\t\t\t&nbsp;&nbsp;<span class='sui-sourceTitle'>${o.title[0]}</span>\n\t\t\t&nbsp;&nbsp;(${o.asset_subtype.toUpperCase()})\n\t\t\t<hr style='border-top: 1px solid ${sui.assets[o.asset_type].c}'>\n\t\t\t<div class='sui-sourceSec' id='sui-srcSec'></div>`;\n        if (o.url_thumb && !o.url_thumb.match(/gradient.jpg/))\n            str +=\n                \"<img src='\" +\n                o.url_thumb +\n                \"' style='width:33%;padding-right:12px;vertical-align:top'>\";\n        if (o.summary)\n            str += `<div class='sui-sourceText' style='display:inline-block;width:calc(66% - 12px)'>${o.summary}</div>`;\n        str +=\n            '<br>' +\n            sui.pages.DrawTabMenu([\n                'RELATED COLLECTIONS',\n                'MEMBERS',\n                'DETAILS',\n            ]) +\n            '</div>'; // Add tab menu\n        $(this.div).html(str.replace(/\\t|\\n|\\r/g, '')); // Remove format and add to div\n\n        $('[id^=sui-tabTab]').on('click', (e) => {\n            // ON TAB CLICK\n            var id = e.currentTarget.id.substring(10); // Get index of tab\n            this.ShowTab(id); // Draw it\n        });\n\n        $('#sui-imgCol').on('click', () => {\n            // ON COLLECTION CLICK\n            sui.GetKmapFromID(o.collection_uid_s, (kmap) => {\n                sui.SendMessage('', kmap);\n            }); // Get kmap and show page\n            return false; // Stop propagation\n        });\n\n        sui.pages.DrawRelatedAssets(o); // Draw related assets menu if active\n        this.AddTabContent(o); // Add contents of tabs\n        this.ShowTab(0); // Show collections\n    }\n\n    AddTabContent(\n        o // GET TAB CONTENTS\n    ) {\n        const sui = this.sui;\n        let i,\n            a,\n            tab = 0;\n        this.content[0] = '<br>';\n        let base = o.asset_subtype.toLowerCase() + '-collection-'; // Collections base id\n        try {\n            if (o.collection_title_path_ss) {\n                // If a parent\n                a = o.collection_uid_path_ss; // Get parent id\n                this.content[0] += `<div><a href='#p=${a}' id='sui-spItem-${a}+\"'>${o.collection_title_path_ss}</a></div>`; // Add\n                tab++; // Next tab\n            }\n        } catch (e) {}\n\n        this.content[0] += `<div style='margin-left:${tab * 24}px'><strong>${\n            o.title[0]\n        }</strong></div>`; // Add\n\n        if (o.subcollection_name_ss && o.subcollection_name_ss.length) {\n            // If subcollections\n            tab++;\n            for (i = 0; i < o.subcollection_name_ss.length; ++i) {\n                // For each sub\n                a = base + o.subcollection_id_is[i]; // Make full id\n                this.content[0] += `<div style='margin-left:${\n                    tab * 24\n                }px'><a  href='#p=${a}' id='sui-spItem-${a}+\"'>${\n                    o.subcollection_name_ss[i]\n                }</a></div>`; // Add\n            }\n        }\n        this.content[0] += '<br><br>';\n        this.content[1] = '';\n        if (o.members_name_ss && o.members_name_ss.length) {\n            // If members\n            for (\n                i = 0;\n                i < o.members_name_ss.length;\n                ++i // For each member\n            )\n                this.content[1] +=\n                    '<br>' +\n                    o.members_name_ss[i] +\n                    ' &nbsp; (' +\n                    o.members_id_ss[i] +\n                    ')'; // Add\n            this.content[1] += '<br><br>';\n        }\n        this.content[2] = '<br>'; // Advance to details tab\n        if (o.node_user_full_s)\n            this.content[2] += sui.pages.DrawItem(\n                '&#xe600',\n                'OWNER',\n                o.node_user_full_s + ' &nbsp; (' + o.node_user + ')',\n                '',\n                'sui-pageLab',\n                1\n            ); // Owner\n        if (o.collection_visibility_s)\n            this.content[2] += sui.pages.DrawItem(\n                '&#xe622',\n                'VISIBILITY',\n                o.collection_visibility_s.substr(0, 1).toUpperCase() +\n                    o.collection_visibility_s.substr(1),\n                '',\n                'sui-pageLab',\n                1\n            ); // Visibility\n        if (o.asset_subtype)\n            this.content[2] += sui.pages.DrawItem(\n                sui.assets[o.asset_subtype.toLowerCase()].g,\n                'TYPE',\n                o.asset_subtype,\n                '',\n                'sui-pageLab',\n                1\n            ); // Type\n        if (o.collection_title)\n            this.content[2] += sui.pages.DrawItem(\n                sui.assets[o.asset_subtype.toLowerCase()].g,\n                'COLLECTION',\n                `<a title='Collection' id='sui-imgCol'\thref='#p=${o.collection_uid_s}'>${o.collection_title}</a>`,\n                '',\n                'sui-pageLab',\n                1\n            ); // Type\n        this.content[2] += '<br>';\n    }\n\n    ShowTab(\n        which // SHOW TAB\n    ) {\n        $('[id^=sui-tabTab]').css({\n            'background-color': '#999',\n            color: '#fff',\n        }); // Reset all tabs\n        $('#sui-tabContent').css({\n            display: 'block',\n            'background-color': '#eee',\n        }); // Show content\n        $('#sui-tabTab' + which).css({\n            'background-color': '#eee',\n            color: '#000',\n        }); // Active tab\n        $('#sui-tabContent').html(this.content[which]); // Set content\n    }\n} // Collections class closure\n","/* \tPAGES ****************************************************************************************************************************\n\n\tThis module provide the backbone to draw individual asset pages, and control the somewhat complex flow\n\twhen browsing collections and related resources. It routes to the specific modules that draw a page based on a kmap,\n\tand it contains helper functions to  that all pages use to draw (.e. headers, footers, related assets, popovers)\n\n\tIt allocates the indivisual page classes and puts pointer to them in the global app variable (sui)\n\n\n\tRequires: \tjQuery \t\t\t\t\t\t\t\t\t\t\t\t// Almost any version should work\n\tCalls:\t\tseachui.js, audiovideo.js, places.js,\t\t\t\t// Other JS modules that are dynamically loaded (not ued in plain search)\n\t\t\t\ttexts.js, images.js, subjects.js, sources.js,\n\t\t\t\tterms.js, places.js, visuals.js\n\tCSS:\t\tsearchui.css\t\t\t\t\t\t\t\t\t\t// All styles are prefixed with 'sui-'\n\tJS:\t\t\tECMA-6\t\t\t\t\t\t\t\t\t\t\t\t// Uses lambda (arrow) functions\n\tImages:\t\tpopover.png\n\tGlobals:\tsui\t\t\t\t\t\t\t\t\t\t\t\t\t// Declared globally\n\n********************************************************************************************************************************************/\n/* eslint-disable */\nimport $ from 'jquery';\n\nimport Places from './places';\nimport AudioVideo from './audiovideo';\nimport Subjects from './subjects';\nimport Images from './images';\nimport Texts from './texts';\nimport Sources from './sources';\nimport Visuals from './visuals';\nimport Terms from './terms';\nimport Collections from './collections';\n\nexport default class Pages {\n    constructor(\n        sui // CONSTRUCTOR\n    ) {\n        if (!sui) {\n            throw new Error('sui must be defined in constructor');\n        }\n        this.sui = sui;\n        sui.pages = this; // Save context\n\n        // OUTPUT DIVS\n        this.div = $('<div></div>'); //\"#sui-legacy\";\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Div to hold page\n        this.reldiv = $('<div></div>'); // '#sui-legacy-related';\n\n        this.relatedBase = null; // Holds based kmap for related\n        this.relatedType = 'Home'; // Holds current related category\n        this.relatedId = ''; // Holds current related id\n        this.lastMode = sui.ss.mode; // Previous search mode\n        this.curKmap = null; // Currently active page kmap\n        this.carouselTimer = null; // Timer to advance carousel\n        sui.plc = new Places(sui); // Alloc places module (standalone)\n        sui.av = new AudioVideo(sui); // Alloc AV (standalone)\n        sui.sub = new Subjects(sui); // Alloc Subjects (standalone)\n        sui.img = new Images(sui); // Alloc Images (standalone)\n        sui.txt = new Texts(sui); // Alloc Texts (standalone)\n        sui.src = new Sources(sui); // Alloc Sources (standalone)\n        sui.vis = new Visuals(sui); // Alloc Visuals (standalone)\n        sui.trm = new Terms(sui); // Alloc Terms (standalone)\n        sui.col = new Collections(sui); // Alloc Collections (standalone)\n        this.recentPages = []; // Hold recent pages (title|id)\n        this.editing = false; // Show editing interface?\n        if (window.location.hash) sui.PageRouter(window.location.hash); // Go to particular page\n    }\n\n    Draw(\n        kmap,\n        fromHistory // DRAW KMAP PAGE\n    ) {\n        //console.error(\"pages.Draw() called! with args: \");\n        //console.dir(arguments);\n        const sui = this.sui;\n        clearInterval(this.carouselTimer); // Kill carousel timer\n        if (!kmap) return; // Quit if no kmap\n        if (!fromHistory) sui.SetState(`p=${kmap.uid}`); // This is the active page\n        this.curKmap = kmap; // Set active page's map\n        this.recentPages.push(\n            kmap.uid + '|' + kmap.title + '|' + kmap.asset_type\n        ); // Add to recents list\n        let i,\n            n = this.recentPages.length - 1; // Length of recents\n        for (\n            i = n - 1;\n            i >= 0;\n            --i // Work backwards\n        )\n            if (this.recentPages[i] == this.recentPages[n]) {\n                // Ff already saved\n                this.recentPages.splice(i, 1); // Remove it\n                break; // Quit looking\n            }\n        if (sui.ss.mode != 'related') {\n            this.DrawHeader(kmap); // Draw header if not showing relateds\n        }\n\n        // Style sui-legacy\n        $(this.div).css({ 'background-image': '' }); // Remove any backgeound image\n        $(this.div).css({ 'padding-left': '12px', width: 'calc(100% - 24px' }); // Reset to normal size and hide\n        $(this.div).css({ display: 'block', color: '#000' }); // Show page\n        if (sui.ss.mode == 'related') {\n            // If browsing related pages\n            if (!kmap.asset_type.match(/places|subjects|terms/))\n                // Need to add space for these types\n                $(this.div).css({\n                    'padding-left': '192px',\n                    width: 'calc(100% - 216px',\n                }); // Shrink page\n        }\n\n        // Draw Content\n        if (kmap.asset_type == 'places') sui.plc.Draw(kmap);\n        // Show place\n        else if (kmap.asset_type == 'sources') sui.src.Draw(kmap);\n        // Source\n        else if (kmap.asset_type == 'terms') sui.trm.Draw(kmap);\n        // Term\n        else if (kmap.asset_type == 'subjects') sui.sub.Draw(kmap);\n        // Subject\n        else if (kmap.asset_type == 'images') sui.img.Draw(kmap);\n        // Image\n        else if (kmap.asset_type == 'audio-video') sui.av.Draw(kmap);\n        // AV\n        else if (kmap.asset_type == 'texts') sui.txt.Draw(kmap);\n        // Text\n        else if (kmap.asset_type == 'visuals') sui.vis.Draw(kmap);\n        // Visual\n        else if (kmap.asset_type == 'collections') sui.col.Draw(kmap); // Collections\n    }\n\n    ShowPopover(\n        id,\n        event // DISPLAY KMAP DROP DOWN FROM EVENT\n    ) {\n        const sui = this.sui;\n        if (id && id.match(/collections-/)) return; // No maps for collections yet\n        if (this.PopoverTimer && event.type == 'mousemove') {\n            return;\n        } // Already timeing one\n        if (event.type == 'mousemove' && id == this.lastPopover) {\n            return;\n        } // Already in this one\n        if (event.type == 'mousedown') {\n            // Click on popover\n            if (sui.ss.mode == 'related') sui.ss.mode = this.lastMode; // Get out of related and collections\n            this.relatedBase = null; // No base and set to home\n            sui.GetKmapFromID(id, (kmap) => {\n                this.Draw(kmap);\n            }); // Get kmap and show page\n            this.ClearPopover(); // Clear popover\n            return; // Quit\n        }\n        this.PopoverTimer = setTimeout(() => {\n            this.DisplayPopover(id, event);\n        }, 500); // Draw it\n    }\n\n    ClearPopover() {\n        // CLEAR KMAP DROP DOWN\n        clearTimeout(this.PopoverTimer); // Kill timer\n        this.PopoverTimer = null; // Kill flag\n        $('[id^=sui-popover-]').remove(); // Remove old one\n        this.lastPopover = ''; // Clear last\n    }\n\n    // CALLS sui.GetKmapFromID();\n    // MAKES AJAX CALLS\n\n    // Todo:  Refactor popup closing:(ClearPopovers)\n    DisplayPopover(\n        id,\n        event // ACTUALLY DISPLAY KMAP DROP DOWN\n    ) {\n        const sui = this.sui;\n        let i, pos;\n\n        clearTimeout(this.PopoverTimer); // Kill timer\n        this.PopoverTimer = null; // Kill flag\n\n        if (event.target) {\n            pos = $(event.target).offset();\n        } // Get position of icon\n        else {\n            pos = $('#plc-main').offset();\n            pos.top += event.y;\n            pos.left += event.x;\n        } // If coming from a map\n        let x = Math.max(160, Math.min(pos.left, $('#sui-main').width() - 200)); // Cap sides\n        let offset = pos.left - x + 150; // Offset for triangle\n        let offsetString = String(offset) + 'px';\n        if (!pos.top) {\n            return;\n        } // Race condition\n        this.lastPopover = id;\n\n        // DRAW POPOVER DATA\n        sui.GetKmapFromID(id, (o) => {\n            // GET KMAP DATA\n            let v;\n            if (!o) return; // Quit if nothing\n            if (o.error) {\n                console.error(\n                    `Solr Callback for sui.GetKmapFromID (pages.js, line 201) returned error for kmap ${id}: \\n`,\n                    o.error.stack\n                );\n                return;\n            }\n            $('[id^=sui-popover-]').remove(); // Remove old one\n            let scrltop = $('#sui-main').scrollTop();\n            let str = `<div id='sui-popover-${id}' class='sui-popover' \n\t\t\tstyle='top:${pos.top + 24 + scrltop}px;left:${\n                x - 150\n            }px'><div class='sui-popover-body'>\n\t\t\t<div style='position:absolute;width:0;height:0;border-left:8px solid transparent;\n\t\t\tborder-right:8px solid transparent;border-bottom:10px solid #999;top:-10px;\n\t\t\tleft:${offsetString}'</div>\n\t\t\t<div style='position:absolute;width:0;height:0;border-left:8px solid transparent;\n\t\t\tborder-right:8px solid transparent;border-bottom:10px solid white;left:-8px;top:2px;'</div>\n\t\t\t</div>`;\n            $('#sui-main').append(str.replace(/\\t|\\n|\\r/g, '')); // Remove format and add to div\n\n            // one-time trap to clear popover\n\n            $('#sui-main').one('click', () => {\n                this.ClearPopover();\n            });\n\n            str = `<div style='float:right;margin-top:-8px;font-size:10px'>${\n                o.id\n            }</div>\n\t\t\t<strong>${\n                o.title ? o.title[0] : 'untitled'\n            }</strong><hr style='border-top:1px solid #ccc'>\n\t\t\t<span style='font-size:12px;text-transform:capitalize'>\n\t\t\tFor more information about this ${o.asset_type.slice(\n                0,\n                -1\n            )}, see Full Entry below.<p>`;\n            if (o.feature_types_idfacet && o.asset_type == 'places') {\n                // Show Feature types in places\n                str += '<strong>Feature types: </strong>'; // Add title\n                for (i = 0; i < o.feature_types_idfacet.length; ++i) {\n                    // For each feature\n                    v = o.feature_types_idfacet[i].split('|'); // Split title and id\n                    str += `<a class='sui-crumb' style='color:#000;text-transform:none' id='sui-crumb-${v[1]}'\n\t\t\t\t\thref='#p=${v[1]}'>${v[0]}</a>`;\n                    if (i < o.feature_types_idfacet.length - 1) str += ', ';\n                    // Add separator\n                    else str += '<br>';\n                }\n            }\n            if (o.ancestors_txt && o.ancestors_txt.length > 1)\n                str += `<strong>${o.asset_type}: </strong>`; // Show header if any breadcrumbs\n            if (o.ancestors_txt)\n                // If breadcrumbs\n                for (i = 0; i < o.ancestors_txt.length - 1; ++i) {\n                    // For each trail member\n                    str += `<a class='sui-crumb' style='color:#000;text-transform:none' id='sui-crumb-${o.asset_type}-${o.ancestor_ids_is[i]}'\n\t\t\t\t\thref='#p=${o.asset_type}-${o.ancestor_ids_is[i]}'>${o.ancestors_txt[i]}</a>`;\n                    if (i < o.ancestors_txt.length - 2) str += ' / '; // Add separator\n                }\n            str += `</p></span>`;\n            $('#sui-popover-' + id)\n                .find('.sui-popover-body')\n                .eq(0)\n                .append(str.replace(/\\t|\\n|\\r/g, ''));\n            let popbotstr = `<div id='sui-popbot'> \n\t\t\t<a class='sui-popItem' href='#p=${o.uid}'>\n\t\t\t<p id='sui-full-${o.uid}'>&#xe629&nbsp;&nbsp;FULL ENTRY</p></a>\n\t\t\t</div>`; /* popbot has this style: style='width:100%;padding:1px 12px;background-color:#333;font-size:14px;\n\t\t\tborder-radius:0 0 6px 6px;color:#ddd;margin:-12px;cursor:pointer'*/\n            $('#sui-popover-' + id).append(popbotstr.replace(/\\t|\\n|\\r/g, '')); // Remove format and add to div\n\n            // MOUSELEAVE LISTENER\n            $('#sui-popover-' + id).on('mouseleave', () => {\n                this.ClearPopover();\n            });\n\n            $('#sui-full-' + id).on('click', (e) => {\n                // ON FULL ENTRY CLICK\n                this.ClearPopover(); // Clear popover\n                if (sui.ss.mode == 'related') sui.ss.mode = this.lastMode; // Get out of related and collections\n                this.relatedBase = null; // No base and set to home\n                var id = e.currentTarget.id.substring(9).toLowerCase(); // Get id\n                sui.GetKmapFromID(id, (kmap) => {\n                    sui.SendMessage('', kmap);\n                }); // Get kmap and show page\n                return false; // Don't propagate\n            });\n\n            $('[id^=sui-crumb-]').on('click', (e) => {\n                // ON BREAD CRUMB CLICK\n                this.ClearPopover(); // Clear popover\n                if (sui.ss.mode == 'related') sui.ss.mode = this.lastMode; // Get out of related and collections\n                this.relatedBase = null; // No base and set to home\n                var id = e.currentTarget.id.substring(10).toLowerCase(); // Get id\n                sui.GetKmapFromID(id, (kmap) => {\n                    sui.SendMessage('', kmap);\n                }); // Get kmap and show page\n                return false; // Don't propagate\n            });\n        });\n\n        // DRAW MORE POPOVER DATA\n        var url = sui.solrUtil.createKmapQuery(id, null, null, 300); // Get query url\n        $.ajax({ url: url, dataType: 'jsonp', jsonp: 'json.wrf' }).done(\n            (data) => {\n                // Get related places\n                let i,\n                    n,\n                    str = '';\n                if ($('[id^=sui-pop-]')[0]) return; // Quit if already loaded\n                if (\n                    data.facets.asset_counts.buckets &&\n                    data.facets.asset_counts.buckets.length\n                ) {\n                    // If valid data\n                    let d = data.facets.asset_counts.buckets; // Point at bucket array\n                    for (i = 0; i < d.length; ++i) {\n                        // For each bucket\n                        n = d[i].count; // Get count\n                        if (d[i].val == 'texts:pages') continue; // Ignore pages of texts\n                        if (n > 1000) n = Math.floor(n / 1000) + 'K'; // Shorten\n                        str += `<a class='sui-popItem' href='#v=${id}=${\n                            d[i].val\n                        }'>\n\t\t\t\t\t<p id='sui-pop-${id}-${\n                            d[i].val\n                        }' style='cursor:pointer;text-transform:capitalize'>\n\t\t\t\t\t<span style='color:${sui.assets[d[i].val].c}'>${sui.assets[d[i].val].g}</span>\n\t\t\t\t\t&nbsp;&nbsp;Related ${d[i].val} (${n})</p></a>`;\n                    }\n                    $('#sui-popbot').append(str.replace(/\\t|\\n|\\r/g, '')); // Remove format and add to div\n\n                    $('[id^=sui-pop-]').on('click', (e) => {\n                        // ON ITEM CLICK\n                        this.ClearPopover(); // Clear popover\n                        let v = e.currentTarget.id.toLowerCase().split('-'); // Get id\n                        if (v[4] == 'audio') v[4] = 'audio-video'; // Rejoin AV\n                        let url = sui.solrUtil.createKmapQuery(\n                            v[2] + '-' + v[3],\n                            v[4],\n                            0,\n                            1000\n                        ); // Get query url\n                        $.ajax({\n                            url: url,\n                            dataType: 'jsonp',\n                            jsonp: 'json.wrf',\n                        }).done((data) => {\n                            // Get related places\n                            sui.curResults = sui.MassageKmapData(\n                                data.response.docs\n                            ); // Normalize for display\n                            sui.DrawItems(); // Draw items\n                            sui.DrawFooter(); // Draw footer\n                            sui.ss.page = 0; // Start at beginning\n                        });\n                        sui.GetKmapFromID(id, (o) => {\n                            // Get kmap\n                            this.relatedBase = o; // Set new base\n                            this.relatedId = o.asset_type + '-' + o.id; // Set id\n                            this.DrawHeader(o); // Set header\n                        });\n                        return false; // Don't propagate\n                    });\n                }\n            }\n        );\n    }\n\n    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n    // RELATED SIDEBAR\n    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    // ARGUMENT o: kmassets solr entry\n    // ARGUMENT fromHistory: boolean that determines whether a new history item is pushed\n    // CALLS sui.GetKmapFromID()\n    // MAKES AJAX CALLS\n    // ATTACHES HANDLERS WHICH CALL this.DrawRelatedResults(o), sui.plc.Draw(), sui.sub.Draw();\n    DrawRelatedAssets(\n        o,\n        fromHistory // DRAW RELATED ASSETS MENU\n    ) {\n        //console.error(\"pages.DrawRelatedAssets() called with arguments\");\n        //console.dir(arguments);\n        const sui = this.sui;\n        let i,\n            v,\n            k,\n            sk,\n            str = '',\n            browse = true;\n        let p = this.relatedBase || o; // Pointer to base kmap\n        if (p) {\n            browse = p.asset_type.match(/places|subjects|terms|collections/);\n        } // Add browsing to this menu?\n\n        if (sui.ss.mode == 'related') {\n            o = this.relatedBase;\n        } // If special, use base\n        else {\n            this.lastMode = sui.ss.mode;\n        } // Save last search mode\n\n        // SHORT CIRCUIT\n        if (!o) {\n            return;\n        } // No related to show\n\n        // SHORT CIRCUIT\n        if (!browse && sui.ss.mode != 'related') {\n            return;\n        } // Quit if not related or a sub/term/place/collection\n\n        // SIDE QUERY FOR COLLECTIONS\n        if (p.asset_type != 'collections') {\n            var url = sui.solrUtil.createKmapQuery(o.uid); // Get query url\n            $.ajax({ url: url, dataType: 'jsonp', jsonp: 'json.wrf' }).done(\n                (data) => {\n                    // Get related assets\n                    var i,\n                        n,\n                        tot = 0;\n                    if (\n                        data.facets.asset_counts.buckets &&\n                        data.facets.asset_counts.buckets.length\n                    ) {\n                        // If valid data\n                        let d = data.facets.asset_counts.buckets; // Point at bucket array\n                        for (i = 0; i < d.length; ++i) {\n                            // For each bucket\n                            if (d[i].val == 'texts:pages') continue; // Skip it\n                            if (o.asset_type == 'terms' && d[i].val == 'terms')\n                                continue; // Skip\n                            n = d[i].count; // Get count\n                            tot += n; // Add to total\n                            if (n > 1000) n = Math.floor(n / 1000) + 'K'; // Shorten\n                            $('#sui-rln-' + d[i].val).html(n); // Set number\n                            $('#sui-rl-' + d[i].val).css({ display: 'block' }); // Show it\n                        }\n                        if (tot > 1000) tot = Math.floor(tot / 1000) + 'K'; // Shorten\n                        $('#sui-rln-all').html(tot); // Set total number\n                        $('#sui-rl-all').css({ display: 'block' }); // Show total\n                    }\n                    let div = '#sui-btree-' + o.asset_type; // Point at tree\n\n                    // COSMETICS\n                    if ($('#sui-footer').offset() && $(div).offset()) {\n                        $(div).css(\n                            'max-height',\n                            $('#sui-footer').offset().top -\n                                $(div).offset().top -\n                                40 +\n                                'px'\n                        ); // Fill space\n                    } else {\n                        //console.error(\"no footer or no sui-btree\");\n                    }\n                }\n            );\n        } else {\n            // Collections\n            browse = false; // No browsing\n            sk = o.asset_subtype.toLowerCase(); // Get asset sub-type\n        }\n\n        $('#c-columnContent__main').scrollTop(0);\n        $(this.div).scrollTop(0); // Scroll to top\n        k = o.asset_type; // Get this asset type\n        str += `<div class='l-related__wrap' style='border-color:${\n            sui.ss.mode == 'related' ? sui.assets[k].c : 'transparent'\n        };\n\t\t\theight:${$(this.div).height() + 6}px'>`;\n        if (sui.ss.mode != 'related') str += 'RELATED RESOURCES<hr>';\n        str += \"<div class='c-relatedViewer'>\";\n        str +=\n            \"<div class='c-related__item' id='sui-rl-Home'><span style='font-size:18px; vertical-align:-3px; color:\" +\n            sui.assets[k].c +\n            \"'>\" +\n            sui.assets[k].g +\n            \" </span> <b style='color:\" +\n            sui.assets[k].c +\n            \"'>Home</strong></div>\";\n        if (p.asset_type == 'collections')\n            str +=\n                \"<div class='c-related__item' id='sui-rl-\" +\n                sk +\n                \"'><span style='font-size:18px; vertical-align:-3px; color:\" +\n                sui.assets[sk].c +\n                \"'>\" +\n                sui.assets[sk].g +\n                ' </span> ' +\n                o.asset_subtype +\n                '</div>';\n        for (k in sui.assets) {\n            // For each asset type\n            str +=\n                \"<a class='c-related__item' style='display:none' id='sui-rl-\" +\n                k.toLowerCase();\n            str +=\n                \"' href='#r=\" +\n                this.relatedId +\n                '=' +\n                this.relatedId +\n                '=' +\n                k +\n                '=' +\n                o.uid +\n                \"'>\";\n            str +=\n                \"<span style='font-size:18px; vertical-align:-3px; color:\" +\n                sui.assets[k].c +\n                \"'>\" +\n                sui.assets[k].g +\n                '</span> ';\n            str +=\n                k.charAt(0).toUpperCase() +\n                k.substr(1) +\n                \" (<span id='sui-rln-\" +\n                k.toLowerCase() +\n                \"'>0</span>)</a>\";\n        }\n        if (false && browse && p) {\n            // If browsing\n            str += \"<img id='sui-relatedImg'></div>\"; // Image, if available\n            str += \"RECENTLY VIEWED<hr style='margin:8px 0 12px 0'>\"; // Add label\n            str += \"<div class='sui-relatedRecent' id='sui-relatedRecent'>\"; // Div to recent entries\n            for (i = this.recentPages.length - 1; i >= 0; --i) {\n                // For each recent (backwards)\n                v = this.recentPages[i].split('|'); // Split title from id\n                v[1] = sui.ShortenString(v[1], 18); // Cap\n                str += `<a class='sui-noA' id='sui-rcItem-${v[0]}' href='#p=${\n                    v[0]\n                }'>\n\t\t\t\t<div class='sui-relatedRecentItem' id='sui-rr-${v[0]}'>&nbsp;&nbsp;\n\t\t\t\t<span style='color:${sui.assets[v[2]].c}'>${sui.assets[v[2]].g}\n\t\t\t\t</span>&nbsp;&nbsp;${v[1]}</div></a>`; // Add entry\n            }\n            str +=\n                '</div><br>BROWSE ' +\n                p.asset_type.toUpperCase() +\n                \"<hr style='margin:8px 0 16px 0'>\"; // Add label\n            str +=\n                \"<div class='sui-tree' style='padding-left:0;margin-right:12px;' id='sui-btree-\" +\n                p.asset_type +\n                \"'></div>\"; // Add browsing tree div\n        }\n\n        // OUTPUT append to div\n        $(this.reldiv).html(str.replace(/\\t|\\n|\\r/g, '')); // Remove format and add to div\n\n        if (browse) {\n            this.DrawTree('#sui-btree-' + o.asset_type, o.asset_type);\n        } // If browsing, add tree\n\n        if (!this.relatedType) {\n            $('#sui-rl-Home').css({ 'background-color': '#f7f7f7' });\n        } // Hilite Home\n        else {\n            $('#sui-rl-' + this.relatedType).css({\n                'background-color': '#f7f7f7',\n            });\n        } // Hilite current\n\n        // HANDLERS\n        $('[id^=sui-rcItem-]').off('click'); // KILL RECENTS HANDLER\n        $('[id^=sui-rcItem-]').on('click', (e) => {\n            // ON RECENTS CLICK\n            let id = e.currentTarget.id.substring(11); // Get id\n            if (sui.ss.mode == 'related') sui.ss.mode = this.lastMode; // Get out of related\n            this.relatedBase = null; // Remove umbrella\n            sui.GetKmapFromID(id, (kmap) => {\n                sui.SendMessage('', kmap);\n            }); // Get kmap and show page\n            return false; // Stop propagation\n        });\n\n        $('[id^=sui-rl-]').on('click', (e) => {\n            // ON CLICK ON ASSET\n\n            alert('CLICKED RELATED LINK ' + e.target);\n            this.relatedType = e.currentTarget.id.substring(7); // Get asset type\n            if (this.relatedType == 'Home') {\n                // Home asset\n                if (sui.ss.mode == 'related') sui.ss.mode = this.lastMode; // Get out of related\n\n                this.Draw(this.relatedBase ? this.relatedBase : o); // Show\n                this.relatedBase = null; // No base and set to home\n            } else if (p.asset_type == 'places' && this.relatedType == 'places')\n                sui.plc.Draw(o, 4);\n            // If place in places, show places\n            else if (p.asset_type == 'places' && this.relatedType == 'subjects')\n                sui.plc.Draw(o, 3);\n            // If subject in places, show subjects\n            else if (\n                p.asset_type == 'subjects' &&\n                this.relatedType == 'subjects'\n            )\n                sui.sub.Draw(o, 1);\n            // If subject in subjects\n            else if (p.asset_type == 'subjects' && this.relatedType == 'places')\n                sui.sub.Draw(o, 2);\n            // If places in subjects\n            else {\n                // Regular results\n                if (!this.relatedBase) {\n                    this.relatedBase = o; // If starting fresh\n                }\n\n                this.DrawRelatedResults(o); // Related asset browsing\n\n                if (!fromHistory) {\n                    // If not from history API\n                    sui.SetState(\n                        'r=' +\n                            this.relatedId +\n                            '=' +\n                            this.relatedBase.uid +\n                            '=' +\n                            this.relatedType +\n                            '=' +\n                            o.uid\n                    ); // Set state\n                }\n            }\n            return false; // Don't propagate\n        });\n    }\n\n    DrawRelatedResults(\n        o // SHOW RELATED ASSETS\n    ) {\n        let x = o.uid ? o.uid : o;\n        const message = 'pages.DrawRelatedResults() called with ' + x;\n        //console.error(message);\n        // alert(message);\n        //console.dir(o);\n        const sui = this.sui;\n        sui.ss.mode = 'related'; // Go to related mode\n        if (!this.relatedBase) this.relatedBase = o; // If starting fresh\n        this.relatedId =\n            this.relatedBase.asset_type + '-' + this.relatedBase.id; // Set id\n        sui.Query(false, o.asset_type == 'collections' ? o.uid : ''); // Query and show results add id if a collection to trigger collection search\n        sui.DrawFooter(); // Draw footer\n        sui.ss.page = 0; // Start at beginning\n    }\n\n    DrawHeader(\n        o // DRAW HEADER\n    ) {\n        // alert(\"pages.DrawHeader called()\");\n        //console.error(\"STUBBED pages.Drawheader called with arguments\");\n        //console.dir(o);\n        return;\n\n        const sui = this.sui;\n        var i;\n        if (!o) return; // Return if not kmap defines\n        var str = `${sui.assets[o.asset_type].g}&nbsp;&nbsp`;\n        str += o.title[0]; // Add title\n        if (o.ancestors_txt && o.ancestors_txt.length) {\n            // If has an ancestors trail\n            str +=\n                \"<div class='breadcrumb'>\" +\n                o.asset_type.toUpperCase() +\n                ':&nbsp; '; // Header\n            for (i = 0; i < o.ancestors_txt.length; ++i) {\n                // For each trail member\n                str += `<a class='sui-crumb' style='color:#fff' id='sui-crumb-${\n                    o.uid.split('-')[0]\n                }-${o.ancestor_ids_is[i]}'\n\t\t\t\t href='#p=${o.uid.split('-')[0]}-${o.ancestor_ids_is[i]}'>\t\t\t\t\n\t\t\t\t${o.ancestors_txt[i]}</a>`;\n                if (i < o.ancestors_txt.length - 1) str += ' > '; // Add separator\n            }\n            str += '</div>'; // Cloase breadcrumbs div\n        }\n        if (this.editing)\n            str +=\n                \"<div id='sui-editBut' class='sui-editBut' title='Edit this item'>&#xe688</div>\"; // Add editing button\n\n        //console.error(\"EXAMINE sui\");\n        //console.dir(sui);\n\n        $('#c-content__header__main').html(str.replace(/\\t|\\n|\\r/g, '')); // Remove format and add to div\n        $('#sui-footer').html(\n            `<div style='float:right;font-size:14px;margin-right:16px'>${o.asset_type.toUpperCase()} ID: ${\n                o.id\n            }</div>`\n        ); // Set footer\n        $('#sui-header').css('background-color', sui.assets[o.asset_type].c); // Color header\n        $('#sui-footer').css('background-color', sui.assets[o.asset_type].c); // Color footer\n\n        $('[id^=sui-crumb-]').on('click', (e) => {\n            // ON BREAD CRUMB CLICK\n            var id = e.currentTarget.id.substring(10).toLowerCase(); // Get id\n            if (sui.ss.mode == 'related') sui.ss.mode = sui.ss.lastMode; // Get back to regular search mode\n            sui.GetKmapFromID(id, (kmap) => {\n                sui.SendMessage('', kmap);\n            }); // Get kmap and show page\n            return false; // Don't propagate\n        });\n\n        $('#sui-editBut').on('click', () => {\n            // ON EDIT BUTTON CLICK\n            let str = 'http://' + o.asset_type + '.'; // URL head\n            sui.Popup('Editing this item in Rails now!'); // Show we're editing\n            if (o.asset_type.match(/subjects|places|terms/i))\n                str += 'kmaps.virginia.edu/admin/slices/' + o.id;\n            else str += 'shanti.virginia.edu/node/' + o.id + '/edit';\n            window.open(str, '_blank'); // Open in new window\n        });\n    }\n\n    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n    // RELATED TREE TOOLS\n    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    AddRelTreeLine(\n        lab,\n        id,\n        marker,\n        path // ADD LINE TO TREE\n    ) {\n        const sui = this.sui;\n        let s = `<li style='margin:2px 0 2px ${-24}px'>`; // Header\n        if (marker)\n            s += `<div class='sui-spDot' id='sui-spDot-${path}'>${marker}</div>`;\n        // If a dot, add it\n        else\n            s +=\n                \"<div class='sui-spLoner'><strong>&bull;&nbsp;&nbsp;</strong></div>\"; // If a loner\n        s += `<a class='sui-noA' href='#p=${id}' id='sui-spLab-${id}'>${lab}</strong>${sui.pages.AddPop(\n            id\n        )}</a>`;\n        return s; // Return line\n    }\n\n    AddRelBranch(\n        facet,\n        path,\n        dot // LAZY LOAD BRANCH\n    ) {\n        const sui = this.sui;\n        let _this = this; // Save context\n        sui.GetTreeChildren(facet, path, (res) => {\n            // Get children\n            let str = '';\n            let i, j, re, m, path;\n            let counts = [];\n            try {\n                counts = res.facets.child_counts.buckets;\n            } catch (e) {} // Get child counts\n            res = res.response.docs; // Point at docs\n            for (i = 0; i < res.length; ++i) {\n                // For each child\n                path = '';\n                m = null; // Assume a loner\n                re = new RegExp(res[i].id.split('-')[1]); // Get id to search on\n                for (j = 0; j < counts.length; ++j) {\n                    // For each count\n                    if (counts[j].val.match(re)) {\n                        // In this one\n                        m = '+'; // Got kids\n                        path = counts[j].val; // Add path\n                    }\n                }\n                str += \"<ul style='list-style-type:none'>\"; // Header\n                str +=\n                    this.AddRelTreeLine(res[i].header, res[i].id, m, path) +\n                    '</li></ul>'; // Add it\n            }\n            $(dot).prop('id', 'sui-spDot-null'); // Inhibit reloading\n            dot.parent().append(str); // Append branch\n\n            $('[id^=sui-spDot-]').off('click'); // Kill handler\n            $('[id^=sui-spDot-]').on('click', function (e) {\n                // ON RELATIONSHIP TREE DOT CLICK\n                let firstChild = $(this).parent().find('ul')[0]; // Get first child\n                let path = e.currentTarget.id.substring(10); // Get id\n                if (path != 'null') {\n                    // Not loaded yet\n                    $(this).html('&ndash;'); // Show it's open\n                    _this.AddRelBranch(facet, path, $(this)); // Lazy load branch\n                } else $(this).html($(firstChild).css('display') == 'none' ? '&ndash;' : '+'); // Change label\n                $(this).parent().find('ul').slideToggle(); // Slide into place\n            });\n        });\n    }\n\n    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n    // HELPERS\n    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    // NO SIDE EFFECTS\n    DrawTabMenu(\n        tabs // DRAW TAB MENU\n    ) {\n        let i,\n            str = '';\n        for (\n            i = 0;\n            i < tabs.length;\n            ++i // For each tab\n        )\n            str += `<div class='sui-tabTab' id='sui-tabTab${i}' style='width:calc(${\n                100 / tabs.length\n            }% - 2px)'>${tabs[i]}&nbsp;&#xe609</div>`;\n        str += \"<div class='sui-tabContent' id='sui-tabContent'></div>\"; // Tab contents\n        return str.replace(/\\t|\\n|\\r|/g, ''); // Return tab markup\n    }\n\n    // OUTPUT: WRITES TO DOM\n    DrawCarousel(\n        content // DRAW RESOURCE CAROUSEL\n    ) {\n        const sui = this.sui;\n        let i,\n            curCon = 0;\n        content = [\n            {\n                title: 'The Shinjé Yapyum Cham is performed',\n                text:\n                    'One of the most common sacred masked dances performed during religious festivals in Bhutan is the Shinjé Yapyum Cham. The dance is often performed early during a festival’s program as it is believed to subdue negative spirits and harmful influences. Although known as the Shinjé Yapyum Cham, or the Dance of the Male and Female Lords of Death, it represents the male and female Yamāntaka is the Destroyer of Death...',\n                pic:\n                    'https://cicada.shanti.virginia.edu/images/mandala/shanti-image-550401/full/!600,/0/default.jpg',\n                id: 'images-stage_shanti_virginia_edu-1187696',\n            },\n            {\n                title: 'A Song Called Ja legmo Tsering',\n                text:\n                    'Unlike today, meeting a person was extremely difficult in the past. The lyrics of this song say that meeting someone was considered as an act of fate. People would meet even if they had never thought of meeting that person. The composer wishes for two people who have met through fate, to stay together for their entire life...',\n                pic:\n                    'https://cfvod.kaltura.com/p/381832/sp/38183200/thumbnail/entry_id/1_xvwn4fvx/version/100021/600/600/height/0',\n                id: 'audio-video-stage_shanti_virginia_edu-22741',\n            },\n            {\n                title: 'Tongue Twister in the Kheng Language',\n                text:\n                    'In the past, parents taught their kids tongue twisters as a way to practice pronunciation. Rinchen Drakpa from Sharigang presents two tongue twisters in his local language, Khengkha. Rinchen Drakpa says that in his childhood he witnessed villagers competing to be the one who could say the tongue twisters with the most perfect pronunciation.',\n                pic:\n                    'https://cfvod.kaltura.com/p/381832/sp/38183200/thumbnail/entry_id/0_ou7n6lp9/version/100021/600/600/height/0',\n                id: 'audio-video-stage_shanti_virginia_edu-3806',\n            },\n            {\n                title: 'Seven Limbs of Practice: Chöpa',\n                text:\n                    'Most Bhutanese Buddhist rituals contain the set of seven practices known as yoen lak duen pa (ཡན་ལག་བདུན་པ་). The seven practices prostration (ཕྱག་), offering (མཆོད་པ་), confession (བཤགས་པ་), rejoicing (རྗེས་སུ་ཡི་རང་བ་), request to live long (བཞུགས་པར་གསོལ་བ་འདེབས་པ་), request to turn the wheel of Dharma (ཆོས་ཀྱི་འཁོར་ལོ་སྐོསྐོར་བར་བསྐུལ་བ་) and to dedicate the merits (བསྔོ་བ་).This piece was initially published in Bhutan’s national newspaper Kuensel..',\n                pic: 'https://mms.thlib.org/images/0050/8753/63691_large.jpg',\n                id: 'texts-stage_shanti_virginia_edu-38836',\n            },\n            {\n                title: 'A Story of a Rich and a Poor Girl',\n                text:\n                    'Ap Tempo of Karna Gewog, Dagana narrates a story of a poor girl who is straight forward and faithful. Her rich friend was always insecure. The poor girl gets rewarded by a deity for her kind heart and good attitude; she suddenly becomes rich, and her rich friend became insecure about her. She tries to achieve what the poor girl has achieved, but gets punished due to her jealousy and greediness.',\n                pic:\n                    'https://cfvod.kaltura.com/p/381832/sp/38183200/thumbnail/entry_id/1_607tfowl/version/100031/600/600/height/0',\n                id: 'audio-video-stage_shanti_virginia_edu-24651',\n            },\n            {\n                title: 'An Exchange of Tsangmo Poems',\n                text:\n                    \"Tsangmo is a type of song used to express individual's emotions, conveying their inner warmth and affection to another person, through numerious lyrical tunes. Tsangmo can be sung to express love, hatred and any other feelings. While it is sung, the Tsangmo songs are never sung with dance, as it is a poetry song for a singing expression without a dance. It is usually a composition limited to a verse of four lines for an expression.\",\n                pic:\n                    'https://cfvod.kaltura.com/p/381832/sp/38183200/thumbnail/entry_id/1_zk9hsnff/version/100011/609/600/height/0',\n                id: 'audio-video-stage_shanti_virginia_edu-22596',\n            },\n        ];\n\n        let str = `<div class='sui-caroBox'>\n\t\t<div class='sui-caroButL' id='sui-caroButL'>&#xe640</div>\n\t\t<div class='sui-caroButR' id='sui-caroButR'>&#xe641</div>\n\t\t<div class='sui-caroHeader'>&nbsp;</div>\n\t\t\t<div class='sui-caroLeft'>\n\t\t\t\t<div class='sui-caroTitle' id='sui-caroTitle'></div>\n\t\t\t\t<div class='sui-caroText' id='sui-caroText'></div>\n\t\t\t</div>\n\t\t\t<img class='sui-caroPic' id='sui-caroPic' src=''><br>\n\t\t\t<a class='sui-caroRes' id='sui-caroRes')' href='#p=${content[curCon].id}'>\n\t\t\t<i>View Resource</i>&nbsp;&nbsp;&#xe683</a>\n\t\t\t<div class='sui-caroDots'>`;\n        for (\n            i = 0;\n            i < content.length;\n            ++i // For each panel\n        )\n            str += `<div class='sui-caroDot' id='sui-caroDot-${i}'></div>`; // Add dot\n        str += '</div></div>';\n        $(this.div).append(str.replace(/\\t|\\n|\\r/g, '')); // Remove format and add to div\n\n        // TIMERS\n        clearInterval(this.carouselTimer); // Kill timer\n        this.carouselTimer = setInterval(() => {\n            $('#sui-caroButR').trigger('click');\n        }, 8000); // Change panel every 8 secs\n\n        // OUTPUT\n        setPanel(curCon); // Set 1st pane;\n        function setPanel(num) {\n            // SET PANEL CONTENTS\n            $('#sui-caroTitle').html(\n                '&#xe633&nbsp;&nbsp;' + content[num].title\n            ); // Set title\n            $('#sui-caroText').html(content[num].text); // Set text\n            $('#sui-caroPic').prop('src', content[num].pic); // Set pic\n            $('[id^=sui-caroDot-]').css({ 'background-color': '#fff' }); // Reset dot\n            $('#sui-caroDot-' + num).css({ 'background-color': '#5d68cc' }); // Highlight current\n        }\n\n        // HANDLERS\n        $('#sui-caroRes').on('click', (e) => {\n            // ON SEE RESOURCE CLICK\n            sui.GetKmapFromID(content[curCon].id, (kmap) => {\n                sui.SendMessage('', kmap);\n            }); // Get kmap and show page\n            return false; // Don't propagate\n        });\n\n        $('#sui-caroButL').on('click', (e) => {\n            // ON BACK CLICK\n            curCon = curCon ? curCon - 1 : content.length - 1; // Go back or wrap\n            setPanel(curCon); // Draw panel\n        });\n\n        $('#sui-caroButR').on('click', (e) => {\n            // ON FORWARD CLICK\n            curCon = curCon == content.length - 1 ? 0 : curCon + 1; // Go forward or wrap\n            setPanel(curCon); // Draw panel\n        });\n\n        $('[id^=sui-caroDot-]').on('click', (e) => {\n            // ON DOT CLICK\n            curCon = e.target.id.substring(12); // Get number\n            curCon = Math.min(content.length - 1, Math.max(curCon, 0)); // Cap\n            setPanel(curCon); // Draw panel\n        });\n    }\n\n    // NO SIDE EFFECTS\n    DrawItem(\n        icon,\n        label,\n        value,\n        def,\n        style,\n        bold // DRAW ITEM\n    ) {\n        let i,\n            str = '<p>';\n        if (value == null || value == undefined) return ''; // Return nothing\n        if (icon) str += icon + '&nbsp;&nbsp;'; // Add icon\n        str += \"<span class='sui-pageLab'\"; // Label head\n        if (bold) str += \" style='font-weight:600'\"; // Bold?\n        str += '>' + label + ':&nbsp;&nbsp;</span>'; // Add label\n        str += \"<span class='\"; // Add value span\n        str += (style ? style : 'sui-pageVal') + \"'>\"; // Default, or special style\n        if (typeof value == 'object') {\n            // If an array\n            for (i = 0; i < value.length; ++i) {\n                // For each item\n                if (value[i].header) str += value[i].header;\n                // Use .header\n                else if (value[i].value) str += value[i].value;\n                // .value\n                else if (value[i].val) str += value[i].val;\n                // .val\n                else if (value[i].title) str += value[i].title;\n                // .title\n                else str += value[i]; // Plain\n                if (i != value.length - 1) str += ', '; // Add separator\n            }\n        } else str += value && !value.match(/undefined/) ? value : def; // Add def if bad value or show value\n        return str + '</span></p>'; // Return item\n    }\n\n    // NO SIDE EFFECTS\n    FormatDate(\n        date, // FRIENDLY FORMAT OF DATE\n        format_type\n    ) {\n        let d = new Date(date); // Parse date\n        if (d)\n            format_type =\n                typeof format_type != 'string' ? 'default' : format_type;\n        if (format_type == 'short') {\n            date = d.toDateString();\n        } else {\n            date = d.getMonth() + 1 + '/' + d.getDate() + '/' + d.getFullYear(); // Remake it\n        }\n        return date;\n    }\n\n    // Take a string with or without tags in it and get the language code for its text. These codes are for font or script\n    // so Dzongkha is bo and Hindi or Nepali etc. is sa. Of course, CSS styles need to be made for all of these.\n    GetLangCode(text_string) {\n        // Strip out tags and extra whitespaces\n        text_string = $.trim(text_string.replace(/(<([^>]+)>)/gi, ''));\n        const chrcode = text_string.charCodeAt(0);\n        if (chrcode > 2303 && chrcode < 2432) {\n            return 'sa';\n        }\n        if (chrcode > 3455 && chrcode < 3584) {\n            return 'si';\n        }\n        if (chrcode > 3583 && chrcode < 3712) {\n            return 'th';\n        }\n        if (chrcode > 3839 && chrcode < 4096) {\n            return 'bo';\n        }\n        if (chrcode > 4095 && chrcode < 4256) {\n            return 'my';\n        }\n        if (chrcode > 4352 && chrcode < 4547) {\n            return 'ko';\n        }\n        if (chrcode > 6143 && chrcode < 6320) {\n            return 'mn';\n        }\n        if (chrcode > 12351 && chrcode < 12446) {\n            return 'ja';\n        }\n        if (chrcode > 19967) {\n            return 'zh';\n        } else {\n            return '';\n        }\n    }\n\n    // Take a string with or without tags and wrap it in a span with its language class, add nowrap class if desired.\n    WrapInLangSpan(text_string, nowrap) {\n        const wrapclass = nowrap ? ' text-nowrap' : '';\n        const langcode = this.GetLangCode(text_string);\n        if (langcode === '') {\n            return text_string;\n        }\n        return `<span class=\"u-${langcode}${wrapclass}\">${text_string}</span>`;\n    }\n\n    GetPublicUrlPath(currapp) {\n        const href = window.location.href;\n        let pts = href.split('#');\n        pts = pts[0].split(currapp);\n        pts = pts[0].split(window.location.host);\n        let retval = pts.length > 1 ? pts[1] : false;\n        if (retval && retval[retval.length - 1] !== '/') {\n            retval += '/';\n        }\n        return retval;\n    }\n\n    // !!!!  WRITES sui TO GLOBAL WINDOW IN ORDER TO IMPLEMENT POPOVERS...   !!!!\n    AddPop(\n        id,\n        small // ADD KMAP POPOVER\n    ) {\n        const sui = this.sui;\n        window.sui = this.sui;\n        let popimg_data =\n            'data:image/png;base64,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';\n        let str = `&nbsp;<img class='popover-icon' style='display:inline-block' src='${popimg_data}' \n                    ${small ? \"style='width:13px'\" : ''}\n                    onmouseenter='sui.pages.ShowPopover(\"${id}\",event); return false;'\n                    onmousemove='sui.pages.ShowPopover(\"${id}\",event); return false;'\n                    onmousedown='sui.pages.ShowPopover(\"${id}\",event) return false;'>`; // Make image call to show popover\n        return str.replace(/\\t|\\n|\\r|/g, ''); // Return markup\n        /*\n         */\n    }\n\n    // ARGUMENT  div\n    // ARGUMENT facet (string) e.g. \"places\"\n    // USES this.sui\n    // SETS sui.curTree\n    // CALLS sui.LazyLoad()\n    // CALLS sui.GetTopRow()\n    // OUTPUT: alters CSS of passed div\n    DrawTree(\n        div,\n        facet // DRAW FACET TREE\n    ) {\n        const sui = this.sui;\n        sui.curTree = facet; // Save current facet\n        if (facet == 'places') sui.LazyLoad(div, null, facet, 13735);\n        // Embedded top layer for places\n        else sui.GetTopRow(div, facet); // Constructed top layers\n\n        if ($('#sui-footer').offset() && $(div).offset()) {\n            $(div).css(\n                'max-height',\n                $('#sui-footer').offset().top - $(div).offset().top - 120 + 'px'\n            ); // Fill space\n        } else {\n            //console.error(\"no footer\");\n        }\n    }\n} // Pages class closure\n","import React, { useEffect, useLayoutEffect, useRef, useState } from 'react';\nimport { useStoreState } from 'easy-peasy';\nimport * as PropTypes from 'prop-types';\nimport _ from 'lodash';\nimport { Redirect, useHistory } from 'react-router';\n\nexport function BasicSearch(props) {\n    const history = useHistory();\n    const inputEl = useRef(null);\n    const state = useStoreState((state) => state);\n    const show_debug = false;\n    if (show_debug) console.debug('BasicSearch: state = ', state);\n\n    const currText = state.search.query?.searchText;\n    // const [state, setState] = useState({searchString: {currText}});\n    const handleSubmit = () => {\n        props.search.setSearchText(inputEl.current.value);\n        props.onSubmit(inputEl.current.value);\n        console.log('BasicSearch handleSubmit: ', inputEl.current.value);\n        history.push('/search');\n    };\n    const clearInput = () => {\n        inputEl.current.value = '';\n        handleSubmit();\n        props.onSubmit(inputEl.current.value);\n        console.log('BasicSearch clearInput: ', inputEl.current.value);\n    };\n    const handleChange =\n        // To be used for completions if desired\n        _.debounce(() => {\n            console.log('BasicSearch handleChange: ', inputEl.current.value);\n        }, 500);\n\n    const handleKey = (x) => {\n        // submit on return\n        if (x.keyCode === 13) {\n            handleSubmit();\n        }\n    };\n\n    useLayoutEffect(() => {\n        if (inputEl.current.value !== props.search.query.searchText) {\n            inputEl.current.value = props.search.query.searchText;\n        }\n    });\n\n    return (\n        <>\n            <div className=\"sui-search1\">\n                <input\n                    type=\"text\"\n                    id=\"sui-search\"\n                    className=\"sui-search2\"\n                    defaultValue={currText}\n                    placeholder=\"Enter Search\"\n                    onChange={handleChange}\n                    onKeyDownCapture={handleKey}\n                    ref={inputEl}\n                />\n                <span className={'l-search__input__buttons'}>\n                    <span\n                        id=\"sui-searchgo\"\n                        className=\"sui-search4\"\n                        onClick={handleSubmit}\n                    >\n                        <span className={'icon'}></span>\n                    </span>\n                    <span\n                        id=\"sui-clear\"\n                        className=\"sui-search3\"\n                        onClick={clearInput}\n                    >\n                        {' '}\n                        x{' '}\n                    </span>\n                </span>\n            </div>\n        </>\n    );\n}\n\nBasicSearch.propTypes = { onChange: PropTypes.func };\n","import React, { useState, useEffect } from 'react';\nimport { ADVANCED_LABEL, BASIC_LABEL } from '../../App';\nimport ToggleButtonGroup from 'react-bootstrap/ToggleButtonGroup';\nimport ToggleButton from 'react-bootstrap/ToggleButton';\nimport { BsMap, BsSearch, ImTree } from 'react-icons/all';\nimport './MainSearchToggle.scss';\n\nexport function AdvancedToggle(props) {\n    const [mode, setMode] = useState(props.viewMode || 'off'); // \"search\" | \"tree\" | \"off\"\n\n    const chooseViewMode =\n        props.chooseViewMode ||\n        (() => {\n            alert('No chooseViewMode handler:  mode = ' + mode);\n        });\n\n    useEffect(() => {\n        chooseViewMode(mode);\n    }, [mode]);\n\n    return (\n        <ToggleButtonGroup\n            name=\"Georgie\"\n            value={mode}\n            type={'radio'}\n            className={'c-MainSearchToggle--group'}\n        >\n            <ToggleButton\n                name={'viewMode'}\n                value={'tree'}\n                type={'radio'}\n                className={'c-MainSearchToggle--button'}\n                onClick={(evt) => {\n                    if (evt.target.value === 'tree') {\n                        if (mode === 'tree') {\n                            setMode('off');\n                        } else {\n                            setMode('tree');\n                        }\n                        evt.stopPropagation();\n                        return false;\n                    }\n                }}\n            >\n                <ImTree></ImTree>\n            </ToggleButton>\n            <ToggleButton\n                name={'viewMode'}\n                value={'advanced'}\n                type={'radio'}\n                className={'c-MainSearchToggle--button'}\n                onClick={(evt) => {\n                    if (evt.target.value === 'advanced') {\n                        if (mode === 'advanced') {\n                            setMode('off');\n                        } else {\n                            setMode('advanced');\n                        }\n                        evt.stopPropagation();\n                        return false;\n                    }\n                }}\n            >\n                <BsSearch></BsSearch>\n            </ToggleButton>\n        </ToggleButtonGroup>\n    );\n}\n","import React from 'react';\nimport './MainNavToggle.scss';\n\nexport class MainNavToggle extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.toggleHamburger = this.toggleHamburger.bind(this);\n        this.setHamburgerOpen = this.setHamburgerOpen.bind(this);\n    }\n\n    setHamburgerOpen(hamOpen) {\n        // send state change message\n        this.props.onStateChange({ hamburgerOpen: hamOpen });\n    }\n\n    toggleHamburger() {\n        this.setHamburgerOpen(!this.props.hamburgerOpen);\n    }\n\n    componentDidMount() {}\n\n    componentDidUpdate(prevProps, prevState, snapshot) {}\n\n    componentWillUnmount() {}\n\n    componentDidCatch(error, errorInfo) {}\n\n    render() {\n        return (\n            <div\n                onClick={this.toggleHamburger}\n                id=\"sui-hamBut\"\n                className=\"sui-hamBut\"\n                title=\"Help + options\"\n            >\n                &#xe627;\n            </div>\n        );\n    }\n}\n","import qs from 'qs';\n\nfunction getRandom() {\n    return Math.floor(Math.random() * Math.pow(10, 12)) + 1;\n}\n\n// var cid = getRandom();\n\nfunction buildParams(params) {\n    // var result = [];\n    //\n    //\n    //\n    // for (var i in params) {\n    //     result.push(encodeURIComponent(i) + '=' + encodeURIComponent(params[i]));\n    // }\n\n    const newParams = qs.stringify(params, { arrayFormat: 'repeat' });\n    return newParams;\n}\n\nexport default function jsonpAdapter(config) {\n    return new Promise(function (resolve, reject) {\n        var script = document.createElement('script');\n        var src = config.url;\n\n        if (config.params) {\n            var params = buildParams(config.params);\n\n            if (params) {\n                src += (src.indexOf('?') >= 0 ? '&' : '?') + params;\n            }\n        }\n\n        script.async = true;\n\n        function remove() {\n            if (script) {\n                script.onload = script.onreadystatechange = script.onerror = null;\n\n                if (script.parentNode) {\n                    script.parentNode.removeChild(script);\n                }\n\n                script = null;\n            }\n        }\n\n        var jsonp = 'axiosJsonpCallback_' + getRandom();\n        var old = window[jsonp];\n        var isAbort = false;\n\n        window[jsonp] = function (responseData) {\n            window[jsonp] = old;\n\n            if (isAbort) {\n                return;\n            }\n\n            var response = {\n                data: responseData,\n                status: 200,\n            };\n\n            resolve(response);\n        };\n\n        var additionalParams = {\n            _: new Date().getTime(),\n        };\n\n        additionalParams[config.callbackParamName || 'callback'] = jsonp;\n\n        src +=\n            (src.indexOf('?') >= 0 ? '&' : '?') + buildParams(additionalParams);\n\n        script.onload = script.onreadystatechange = function () {\n            if (\n                !script.readyState ||\n                /loaded|complete/.test(script.readyState)\n            ) {\n                remove();\n            }\n        };\n\n        script.onerror = function () {\n            remove();\n\n            reject(new Error('Network Error'));\n        };\n\n        if (config.cancelToken) {\n            config.cancelToken.promise.then(function (cancel) {\n                if (!script) {\n                    return;\n                }\n\n                isAbort = true;\n\n                reject(cancel);\n            });\n        }\n\n        script.src = src;\n\n        document.head.appendChild(script);\n    });\n}\n","import {\n    Action,\n    action,\n    Computed,\n    computed,\n    thunk,\n    Thunk,\n    ThunkOn,\n    thunkOn,\n} from 'easy-peasy';\nimport { search } from '../logic/searchapi';\nimport { StoreModel } from './StoreModel';\nimport localForage from 'localforage';\n\ninterface Results {\n    numFound: number | number;\n    docs: string[];\n    facets: string[];\n}\n\ninterface Query {\n    searchText: string;\n    filters: Filter[];\n    facetFilters: any;\n}\n\ninterface Page {\n    current: number;\n    start: number;\n    rows: number;\n    maxStart: number;\n}\n\nexport interface SearchModel {\n    loadingState: boolean;\n    results: Results;\n    query: Query;\n    page: Page;\n\n    // PAGING ACTIONS\n    gotoPage: Action<SearchModel, number>;\n    nextPage: Action<SearchModel, number>;\n    prevPage: Action<SearchModel, number>;\n    firstPage: Action<SearchModel, number>;\n    lastPage: Action<SearchModel, number>;\n    setPageSize: Action<SearchModel, number>;\n\n    // QUERY ACTIONS\n    setSearchText: Action<SearchModel, string>;\n    update: Thunk<SearchModel, void, any, StoreModel, any>;\n    receiveResults: Action<SearchModel, Results>;\n    addFilters: Action<SearchModel, Filter[]>;\n    removeFilters: Action<SearchModel, Filter[]>;\n    setSearchState: Action<SearchModel, SearchState>;\n\n    // can clearFilters of a certain type\n    clearFilters: Action<SearchModel, string>;\n\n    // clear all filters and the search string\n    clearAll: Action<SearchModel>;\n\n    // clear underlying stores as well\n    superClear: Action<SearchModel>;\n\n    // narrowFilters\n    narrowFilters: Action<SearchModel, NarrowFilter>;\n    onUpdate: ThunkOn<SearchModel, StoreModel>;\n}\n\ninterface SearchState {\n    searchString: string;\n    filters: Filter[];\n}\n\nenum AssetType {\n    Places = 'places',\n    Subjects = 'subjects',\n    Terms = 'terms',\n    AudioVideo = 'audio-video',\n    Images = 'images',\n    Visuals = 'visuals',\n    Sources = 'sources',\n}\n\nenum Oper {\n    Not = 'NOT',\n    And = 'AND',\n    Or = 'OR',\n}\n\ninterface Filter {\n    id: string;\n    label: string;\n    asset_type?: AssetType;\n    operator: Oper;\n    field: string;\n    match: string;\n}\n\ninterface NarrowFilter {\n    filter: string;\n    search: string;\n    offset: number;\n    limit: number;\n    sort: string;\n}\n\nexport const searchModel: SearchModel = {\n    loadingState: false,\n    results: {\n        numFound: 0,\n        docs: [],\n        facets: [],\n    },\n    query: {\n        searchText: '',\n        filters: [],\n        facetFilters: {},\n    },\n    page: {\n        current: 0,\n        start: 0,\n        rows: 100,\n        maxStart: 0,\n    },\n    gotoPage: action((state, pageNum) => {\n        if (pageNum * state.page.rows > state.page.maxStart) {\n            pageNum = Math.floor(state.page.maxStart / state.page.rows);\n        } else if (pageNum < 0) {\n            pageNum = 0;\n        }\n        //console.error(\"gotoPage() pageNum = \", pageNum);\n        state.page.start = state.page.rows * pageNum;\n        state.page.current = pageNum;\n    }),\n    nextPage: action((state, increment) => {\n        increment |= 1;\n        //console.log(\"SearchModel: pager.nextPage() \", increment);\n        //console.log(\"SearchModel: state.page \", state.page)\n        let oldPage = state.page.current;\n        let newStart = state.page.start + increment * state.page.rows;\n        if (newStart > state.page.maxStart) {\n            newStart =\n                state.page.rows *\n                Math.floor(state.page.maxStart / state.page.rows);\n        }\n\n        //console.log(\"SearchModel: newStart \", newStart);\n        state.page.start = newStart;\n        state.page.current = Math.floor(newStart / state.page.rows);\n    }),\n    prevPage: action((state, decrement) => {\n        decrement |= 1;\n        //console.log(\"SearchModel: pager.prevPage() \", decrement);\n        //console.log(\"SearchModel: state.page \", state.page)\n\n        let newStart = state.page.start - decrement * state.page.rows;\n        if (newStart < 0) {\n            newStart = 0;\n        }\n        //console.log(\"SearchModel: newStart \", newStart);\n        state.page.start = newStart;\n        state.page.current = Math.floor((newStart + 1) / state.page.rows);\n    }),\n    lastPage: action((state) => {\n        state.page.start =\n            state.page.rows * Math.floor(state.page.maxStart / state.page.rows);\n        state.page.current = Math.floor(state.page.maxStart / state.page.rows);\n    }),\n    firstPage: action((state) => {\n        state.page.start = 0;\n        state.page.current = 0;\n    }),\n\n    setPageSize: action((state, pageSize) => {\n        if (pageSize < 1) {\n            pageSize = 1;\n        }\n        state.page.rows = pageSize;\n    }),\n\n    narrowFilters: action((state, narrowFilter) => {\n        // console.log('NARROW FILTER: ', narrowFilter);\n        state.query.facetFilters[narrowFilter.filter] = {\n            search: narrowFilter.search,\n            limit: narrowFilter.limit,\n            offset: narrowFilter.offset,\n            sort: narrowFilter.sort,\n        };\n    }),\n\n    // THE MAIN THUNK\n    update: thunk(async (actions, payload, helpers) => {\n        const searchState = helpers.getStoreState().search;\n\n        searchState.loadingState = true;\n        //         console.log('SEARCH START');\n        performance.mark('SearchModelSearchUpdateThunkStart');\n        const results = await search(searchState);\n        //         console.log('SEARCH DONE');\n        performance.mark('SearchModelSearchUpdateThunkEnd');\n        performance.measure(\n            'SearchModelSearchUpdate',\n            'SearchModelSearchUpdateThunkStart',\n            'SearchModelSearchUpdateThunkEnd'\n        );\n\n        const perf = performance.getEntriesByName('SearchModelSearchUpdate');\n        perf.forEach((x) => {\n            // console.log('SearchModelSearchUpdate duration: ' + x.duration);\n        });\n        performance.clearMeasures();\n\n        actions.receiveResults(results);\n    }),\n\n    receiveResults: action((state, results) => {\n        //console.log(\"SEARCH Receive RESULTS: \", results);\n        // Is it as simple as that?\n        if (state.page.maxStart !== results.numFound) {\n            state.page.maxStart = results.numFound;\n        }\n\n        if (state.results !== results) {\n            state.results = results;\n        }\n\n        state.loadingState = false;\n    }),\n    setSearchText: action((state, searchString) => {\n        // TODO: might need to insert sanity checks here.\n        state.query.searchText = searchString;\n        state.page.current = 0; // always reset page when changing filters\n        state.page.start = 0;\n    }),\n\n    addFilters: action((state, filters) => {\n        for (let i = 0; i < filters.length; i++) {\n            const filter = filters[i];\n            // USE SPLICE TO UPDATE THE ARRAY SO THAT WE DON'T CHANGE THE ARRAY REFERENCE\n            const found = state.query.filters.findIndex((check) => {\n                return check.id === filter.id;\n            });\n\n            if (found >= 0) {\n                state.query.filters.splice(found, 1);\n            }\n            state.query.filters.push(filters[i]);\n            state.page.current = 0; // always reset page when changing filters\n            state.page.start = 0;\n        }\n    }),\n    removeFilters: action((state, filters) => {\n        for (let i = 0; i < filters.length; i++) {\n            const removeMe = filters[i];\n            const found = state.query.filters.findIndex((check) => {\n                console.log('checking ' + check.id + ' against ', removeMe.id);\n                return check.id === removeMe.id;\n            });\n\n            if (found >= 0) {\n                // MAKE SURE TO USE splice() to preserve reference to original array.\n                state.query.filters.splice(found, 1);\n                state.page.current = 0; // always reset page when changing filters\n                state.page.start = 0;\n            } else {\n                console.log(\n                    \"SearchFilter.removeFilters(): Couldn't find filter by that id: \",\n                    removeMe.id,\n                    '  -- Ignoring.'\n                );\n                console.log('   Requested = ', removeMe);\n                console.log(\n                    '   Filters = ',\n                    JSON.parse(JSON.stringify(state.query.filters))\n                );\n            }\n        }\n    }),\n    clearFilters: action((state, type) => {\n        // clearFilters of a given \"type\"\n        // if no type given. clear all filters.\n\n        if (!type) {\n            state.query.filters = [];\n            state.query.facetFilters = {};\n        } else {\n            console.error(\n                'HEY: clearing by specific filter not implemented yet!  type = ',\n                type\n            );\n        }\n        state.page.current = 0; // always reset page when changing filters\n        state.page.start = 0;\n    }),\n\n    clearAll: action((state) => {\n        state.query.filters = [];\n        state.query.facetFilters = {};\n        state.query.searchText = '';\n        state.page.current = 0; // always reset page when changing filters\n        state.page.start = 0;\n    }),\n\n    superClear: action((state) => {\n        state.query.filters = [];\n        state.query.facetFilters = {};\n        state.query.searchText = '';\n        state.page.current = 0; // always reset page when changing filters\n        state.page.start = 0;\n        localForage\n            .clear()\n            .then(() => {\n                console.log('localForage cleared!');\n            })\n            .catch((e) => {\n                console.error('localForage error on clear(): ', e);\n            });\n    }),\n\n    setSearchState: action((state, searchState) => {\n        state.query.searchText = searchState.searchString;\n        state.query.filters = searchState.filters;\n    }),\n\n    // LISTENERS\n    onUpdate: thunkOn(\n        // targetResolver:\n        (actions, storeActions) => [\n            actions.setPageSize,\n            actions.nextPage,\n            actions.prevPage,\n            actions.gotoPage,\n            actions.lastPage,\n            actions.firstPage,\n            actions.removeFilters,\n            actions.clearFilters,\n            actions.clearAll,\n            actions.addFilters,\n            actions.setSearchText,\n            actions.narrowFilters,\n            actions.superClear,\n            actions.setSearchState,\n        ],\n        // handler:\n        async (actions, target) => {\n            actions.update();\n        }\n    ),\n};\n","import axios from 'axios';\nimport jsonpAdapter from './axios-jsonp';\nimport crypto from 'crypto';\nimport _ from 'lodash';\nimport localforage from 'localforage';\n// import Qs from 'qs';\nimport spexLib from 'spex';\n\nconst spex = spexLib(Promise);\n\nfunction checksum(data) {\n    return crypto.createHash('sha1').update(data).digest('base64');\n}\n\nexport async function search(searchstate) {\n    return await getAssetSearchPromise(searchstate);\n}\n\n//  TODO: Maybe refactor to use declarative caching instead...?\nfunction getCached(request) {\n    localforage\n        .getItem(checksum(JSON.stringify(request)))\n        .then((data) => {\n            return data;\n        })\n        .catch((err) => {\n            console.log('getCached failed.  Returning null: ', err);\n            return null;\n        });\n}\n\nfunction setCache(request, data) {\n    localforage\n        .setItem(checksum(JSON.stringify(request)), data)\n        .then(() => {\n            // localForage.length().then((length) => {\n            //     console.log('localForage length = ', length);\n            //     console.log('localForage driver = ', localForage.driver());\n            // });\n        })\n        .catch((err) => {\n            console.log('setCache failed.  Ignoring: ', err);\n        });\n}\n\nexport function clearCache() {\n    localforage\n        .clear()\n        .then(() => {\n            console.log('cache cleared successfully');\n        })\n        .catch((err) => {\n            console.log('ERROR: Failed to clear cache: ', err);\n        });\n}\n\nfunction narrowData(data, narrowFilters) {\n    // console.log('narrowData called with data = ', data);\n\n    Object.entries(narrowFilters).forEach((x) => {\n        const [key, searchObj] = x;\n        const search = searchObj.search;\n        // const limit = searchObj.limit || 500;\n        // const offset = searchObj.offset || 0;\n        // const sort = searchObj.sort || \"alpha\";\n        // console.log(' search = ' + search);\n        // console.log(\" limit = \" + limit);\n        // console.log(\" offset = \" + offset);\n        // console.log(\" sort = \" + sort);\n        let facet = '';\n        if (key === 'subjects') {\n            facet = 'related_subjects';\n        } else if (key === 'places') {\n            facet = 'related_places';\n        } else if (key === 'terms') {\n            facet = 'related_terms';\n        } else if (key === 'users') {\n            facet = 'node_user';\n        } else {\n            facet = key;\n        }\n\n        if (data.facets && data.facets[facet]) {\n            const buckets = data.facets[facet].buckets;\n            const filtered = _.filter(buckets, (x) => {\n                const str = x.val.split('|')[0].toLowerCase();\n                return str.includes(search);\n            });\n            // console.log(' setting bucket with facet= ', facet);\n            data.facets[facet].buckets = filtered;\n        }\n    });\n    return data;\n}\n\nexport function getAssetSearchPromise(search) {\n    // console.error(\"searchapi.getAssetSearchPromise who's calling me? with \", search);\n    // TODO: parameterize the use of facets\n    // TODO: parameterize constructTextQuery\n\n    //console.log(\"UNPACKING search: \", search);\n    const { page, query } = search;\n\n    //console.log(\"UNPACKING page: \", page);\n    // console.log('UNPACKING query: ', query);\n\n    const host = 'ss251856-us-east-1-aws.measuredsearch.com';\n    const index = 'kmassets_dev';\n    const selectUrl = 'https://' + host + '/solr/' + index + '/select';\n    const startRec = page.start || 0;\n    const rowsRec = page.rows || 100;\n\n    // const qaxios = axios.create({\n    //     paramsSerializer: (params) =>\n    //         Qs.stringify(params, { arrayFormat: 'repeat' }),\n    // });\n\n    let filters = [];\n\n    const ff = query.facetFilters;\n    // console.log('UNPACKING facetFilters: ', query.facetFilters);\n    // Object.entries(query.facetFilters).forEach((x) => {\n    //     const [key, searchObj] = x;\n    //     const search = searchObj.search;\n    //     const limit = searchObj.limit || 500;\n    //     const offset = searchObj.offset || 0;\n    //     const sort = searchObj.sort || \"alpha\";\n    //     console.log(\" search = \" + search);\n    //     console.log(\" limit = \" + limit);\n    //     console.log(\" offset = \" + offset);\n    //     console.log(\" sort = \" + sort);\n    //     let facet = \"\";\n    //     if (key === \"subjects\") {\n    //         facet = \"related_subjects\";\n    //     } else if (key === \"places\") {\n    //         facet = \"related_places\"\n    //     } else if (key === \"terms\") {\n    //         facet = \"related_terms\";\n    //     } else if (key === \"users\") {\n    //         facet = \"node_user\";\n    //     } else {\n    //         facet = key;\n    //     }\n    // });\n\n    // TODO: Parameterize facets.  e.g. You won't need all of them, every time.\n    const jsonFacet = {\n        asset_count: {\n            type: 'terms',\n            field: 'asset_type',\n            limit: ff['asset_type']?.limit || 20,\n            offset: ff['asset_type']?.offset || 0,\n            sort: ff['asset_type']?.sort || 'count desc',\n            domain: { excludeTags: 'asset_type' },\n        },\n        related_subjects: {\n            type: 'terms',\n            field: 'kmapid_subjects_idfacet',\n            limit: ff['subjects']?.limit || 500,\n            offset: ff['subjects']?.offset || 0,\n            sort: ff['subjects']?.sort || 'count desc',\n        },\n        related_places: {\n            type: 'terms',\n            field: 'kmapid_places_idfacet',\n            limit: ff['places']?.limit || 500,\n            offset: ff['places']?.offset || 0,\n            sort: ff['places']?.sort || 'count desc',\n        },\n        related_terms: {\n            type: 'terms',\n            field: 'kmapid_terms_idfacet',\n            limit: ff['terms']?.limit || 500,\n            offset: ff['terms']?.offset || 0,\n            sort: ff['terms']?.sort || 'count desc',\n        },\n        feature_types: {\n            type: 'terms',\n            field: 'feature_types_idfacet',\n            limit: ff['feature_types']?.limit || 500,\n            offset: ff['feature_types']?.offset || 0,\n            sort: ff['feature_types']?.sort || 'count desc',\n        },\n        languages: {\n            type: 'terms',\n            field: 'node_lang',\n            limit: ff['languages']?.limit || 500,\n            offset: ff['languages']?.offset || 0,\n            sort: ff['languages']?.sort || 'count desc',\n        },\n        collections: {\n            type: 'terms',\n            field: 'collection_idfacet',\n            limit: ff['collections']?.limit || 500,\n            offset: ff['collections']?.offset || 0,\n            sort: ff['collections']?.sort || 'count desc',\n        },\n\n        collection_nid: {\n            type: 'terms',\n            field: 'collection_nid',\n            limit: ff['collection_nid']?.limit || 500,\n            offset: ff['collection_nid']?.offset || 0,\n            sort: ff['collection_nid']?.sort || 'count desc',\n        },\n        collection_uid: {\n            type: 'terms',\n            field: 'collection_uid_s',\n            limit: ff['collection_uid']?.limit || 500,\n            offset: ff['collection_uid']?.offset || 0,\n            sort: ff['collection_uid']?.sort || 'count desc',\n        },\n        asset_subtype: {\n            type: 'terms',\n            field: 'asset_subtype',\n            facet: {\n                parent_type: {\n                    limit: 1,\n                    type: 'terms',\n                    field: 'asset_type',\n                },\n            },\n            limit: ff['asset_subtype']?.limit || 500,\n            offset: ff['asset_subtype']?.offset || 0,\n            sort: ff['asset_subtype']?.sort || 'count desc',\n        },\n        node_user: {\n            type: 'terms',\n            field: 'node_user_full_s',\n            limit: ff['user']?.limit || 500,\n            offset: ff['user']?.offset || 0,\n            sort: ff['user']?.sort || 'count desc',\n        },\n        creator: {\n            type: 'terms',\n            field: 'creator',\n            limit: ff['creator']?.limit || 500,\n            offset: ff['creator']?.offset || 0,\n            sort: ff['creator']?.sort || 'count desc',\n        },\n        perspective: {\n            type: 'terms',\n            field: 'perspectives_ss',\n            limit: ff['perspective']?.limit || 50,\n            offset: ff['perspective']?.offset || 0,\n            sort: ff['perspective']?.sort || 'count desc',\n        },\n        associated_subjects: {\n            type: 'terms',\n            field: 'associated_subject_map_idfacet',\n            limit: ff['associated_subjects']?.limit || 50,\n            offset: ff['associated_subjects']?.offset || 0,\n            sort: ff['associated_subjects']?.sort || 'count desc',\n        },\n    };\n\n    // console.log('FACETING: ' + JSON.stringify(jsonFacet, undefined, 2));\n\n    let params = {\n        fl: '*',\n        wt: 'json',\n        echoParams: 'explicit',\n        indent: 'true',\n        start: startRec,\n        rows: rowsRec,\n        // eslint-disable-next-line\n        // 'q': 'text:${text}',\n        // 'text': search.query.searchText,\n        'json.facet': JSON.stringify(jsonFacet),\n    };\n\n    const queryParams = constructTextQuery(search.query.searchText);\n    const filterParams = constructFilters(search.query.filters);\n\n    params = { ...params, ...queryParams, ...filterParams };\n\n    const request = {\n        adapter: jsonpAdapter,\n        callbackParamName: 'json.wrf',\n        url: selectUrl,\n        params: params,\n    };\n\n    const searchPromise = new Promise((resolve, reject) => {\n        const cached = getCached(request);\n        if (false && cached) {\n            // console.log('Returning cached data: ', cached);\n            resolve(cached);\n            return;\n        }\n\n        // performance.mark('getAssetSearchPromise:start');\n        axios\n            .request(request)\n            .then((res) => {\n                //                 console.log('getAssetSearchPromise():  Yay! axios call succeeded!', res);\n                //                 console.log('getAssetSearchPromise(): res = ', res);\n\n                if (typeof (res.data.response === 'undefined')) {\n                    // console.log('HERE DATA', res.data);\n                }\n                if (!res.data.response) {\n                    return;\n                }\n                const data = {\n                    numFound: res.data.response.numFound,\n                    docs: _.map(res.data.response.docs, (x) => {\n                        return cleanAssetData(x);\n                    }),\n                    facets: res.data.facets,\n                };\n\n                setCache(request, data);\n                resolve(data);\n            })\n            .catch((reason) => {\n                console.log(\n                    'getAssetSearchPromise(): OUCH axios call failed!',\n                    reason\n                );\n                reject(reason);\n            })\n            .finally(() => {\n                // performance.mark('getAssetSearchPromise:done');\n                // performance.measure(\n                //     'getAssetSearchPromise',\n                //     'getAssetSearchPromise:start',\n                //     'getAssetSearchPromise:done'\n                // );\n                // //                 console.log('performance:',performance.getEntriesByName('getAssetSearchPromise'));\n                //\n                // const perf = performance.getEntriesByName(\n                //     'getAssetSearchPromise'\n                // );\n                // perf.forEach((x) => {\n                //     console.log(\n                //         'getAssetSearchPromise() duration:' + x.duration\n                //     );\n                // });\n                // //console.log(\"performance getEntries:\", performance.getEntries());\n                // performance.clearMeasures();\n            });\n    });\n\n    const promise = new Promise((resolve, reject) => {\n        searchPromise\n            .then((data) => {\n                resolve(narrowData(data, query.facetFilters));\n            })\n            .catch((rej) => {\n                console.log('Promise rejected: ', rej);\n                reject(rej);\n            });\n    });\n    return promise;\n}\n\nexport function getAssetDataPromise(kmapid) {\n    const host = 'ss251856-us-east-1-aws.measuredsearch.com';\n    const index = 'kmassets_dev';\n    const selectUrl = 'https://' + host + '/solr/' + index + '/select';\n    const startRec = 0;\n    const rowsRec = 1;\n\n    const request = {\n        adapter: jsonpAdapter,\n        callbackParamName: 'json.wrf',\n        url: selectUrl,\n        params: {\n            fl: '*',\n            wt: 'json',\n            echoParams: 'explicit',\n            indent: 'true',\n            start: startRec,\n            rows: rowsRec,\n            // eslint-disable-next-line\n            q: 'uid:${kmapid}',\n            kmapid: kmapid,\n        },\n    };\n\n    const promise = new Promise((resolve, reject) => {\n        let data = getCached(request);\n        if (data) {\n            resolve(data);\n            return;\n        }\n\n        //console.log(\"getAssetDataPromise(): Calling axios:\");\n        axios\n            .request(request)\n            .then((res) => {\n                //console.log(\"getAssetDataPromise():  Yay! axios call succeeded!\", res);\n                const data = res.data.response.docs[0];\n                setCache(request, data);\n                resolve(data);\n            })\n            .catch((reason) => {\n                //console.log(\"gertAssetDataPromise(): OUCH axios call failed!\", reason);\n                reject(reason);\n            });\n    });\n    return promise;\n}\n\nexport function getFullKmapDataPromise(kmapid) {\n    const host = 'ss251856-us-east-1-aws.measuredsearch.com';\n    const index = 'kmterms_dev';\n    const selectUrl = 'https://' + host + '/solr/' + index + '/select';\n    const startRec = 0;\n    const rowsRec = 1;\n\n    // console.log( \"getFullKmapDataPromise: kmapid = \", kmapid );\n\n    const request = {\n        adapter: jsonpAdapter,\n        callbackParamName: 'json.wrf',\n        url: selectUrl,\n        params: {\n            fl: '*,[child parentFilter=block_type:parent limit=1000]',\n            wt: 'json',\n            echoParams: 'explicit',\n            indent: 'true',\n            start: startRec,\n            rows: rowsRec,\n            // eslint-disable-next-line\n            q: 'uid:${kmapid}',\n            kmapid: kmapid,\n        },\n    };\n\n    const promise = new Promise((resolve, reject) => {\n        let data = getCached(request);\n        if (data) {\n            resolve(data);\n            return;\n        }\n        //console.log(\"getFullKmapDataPromise(): Calling axios:\")\n        axios\n            .request(request)\n            .then((res) => {\n                //console.log(\"getFullKmapDataPromise(): Yay! axios call succeeded!\", res);\n                const data = cleanKmapData(res.data.response.docs[0]);\n                setCache(request, data);\n                resolve(data);\n            })\n            .catch((reason) => {\n                //console.log(\"getFullKmapDataPromise(): OUCH axios call failed!\", reason);\n                reject(reason);\n            });\n    });\n    return promise;\n}\n\nfunction deriveImageUrl(url_thumb, size) {\n    //console.log(\"deriveImageUrl: \", url_thumb);\n    const url_large = url_thumb\n        .toString()\n        .replace('200,200', size + ',' + size);\n    //console.log(\"deriveImageUrl: large = \", url_large);\n    return url_large;\n}\n\nfunction cleanKmapData(data) {\n    //console.log(\"clean kmap data = \", data);\n\n    return data;\n}\n\nexport function getRelatedAssetsPromise(kmapid, type, start, rows) {\n    //console.log(\"getRelatedAssetsPromise() Promising: \", arguments);\n    const host = 'ss251856-us-east-1-aws.measuredsearch.com';\n    const index = 'kmassets_dev';\n    const selectUrl = 'https://' + host + '/solr/' + index + '/select';\n    const defaultStart = 0;\n    const defaultRows = 100;\n\n    const ALL = [\n        'audio-video',\n        'images',\n        'texts',\n        'visuals',\n        'sources',\n        'subjects',\n        'places',\n        'terms',\n    ];\n\n    const asset_types =\n        typeof type === 'undefined' || type === null || type === 'all'\n            ? ALL\n            : [type];\n    const startRec = typeof start === 'undefined' ? defaultStart : start;\n    const rowsRec = typeof rows === 'undefined' ? defaultRows : rows;\n\n    // console.log(\n    //     'getRelatedAssetsPromise: asset_types = ' +\n    //         asset_types +\n    //         ' start = ' +\n    //         startRec +\n    //         ' rows = ' +\n    //         rowsRec\n    // );\n\n    const facetJson = JSON.stringify({\n        asset_counts: {\n            limit: 20,\n            type: 'terms',\n            field: 'asset_type',\n            domain: { excludeTags: 'ast' },\n        },\n    });\n\n    let params = {\n        fl: '*',\n        wt: 'json',\n        echoParams: 'explicit',\n        indent: 'true',\n        start: startRec,\n        rows: rowsRec,\n        'json.facet': facetJson,\n        // eslint-disable-next-line\n        q: '(uid:${kmapid}^100+kmapid:${kmapid})',\n        kmapid: kmapid,\n        fq: '{!tag=ast}asset_type:( ' + asset_types.join(' ') + ')',\n    };\n\n    const request = {\n        adapter: jsonpAdapter,\n        callbackParamName: 'json.wrf',\n        url: selectUrl,\n        params: params,\n    };\n\n    const unpackResponse = (res) => {\n        // console.log('unpacking asset_counts: ', res.data.facets);\n\n        const buckets = res.data.facets.asset_counts.buckets;\n\n        let asset_counts = {\n            all: { count: 0, docs: res.data.response.docs },\n        };\n        buckets.forEach((x) => {\n            asset_counts[x.val] = { count: x.count, docs: [] };\n            asset_counts['all'].count += x.count;\n        });\n\n        //console.log(\"unpacking assets: \", res.data.response.docs);\n        const docs = res.data.response.docs;\n\n        docs.forEach((x) => {\n            const y = cleanAssetData(x);\n            asset_counts[x.asset_type].docs.push(y);\n        });\n\n        return {\n            uid: kmapid,\n            start: start,\n            rows: rows,\n            type: type,\n            stateKey: [kmapid, type, start, rows].join('/'),\n            assets: asset_counts,\n        };\n    };\n\n    const promise = new Promise((resolve, reject) => {\n        // let data = getCached(request);\n        // if (data) {\n        //     resolve(data);\n        //     return;\n        // }\n        //console.log(\"getRelatedAssetsPromise(): Calling axios:\")\n        axios\n            .request(request)\n            .then((res) => {\n                // console.log(\n                //     'getRelatedAssetsPromise():  Yay! axios call succeeded!',\n                //     res\n                // );\n                const data = unpackResponse(res);\n                setCache(request, data);\n                resolve(data);\n            })\n            .catch((reason) => {\n                console.log(\n                    'getRelatedAssetsPromise(): OUCH axios call failed!',\n                    reason\n                );\n                reject(reason);\n            });\n    });\n    return promise;\n}\n\nfunction cleanAssetData(data) {\n    // TODO: refactor this grunginess\n\n    const asset_type = data.asset_type;\n\n    //console.log(\"cleanAssetData \", asset_type);\n\n    switch (asset_type) {\n        case 'texts':\n        case 'sources':\n        case 'subjects':\n        case 'places':\n        case 'terms':\n        case 'collections':\n            data.url_large = '/mandala-om/img/gradient.jpg';\n            data.url_thumb = '/mandala-om/img/gradient.jpg';\n            data.url_thumb_height = 100.0;\n            data.url_thumb_width = 150.0;\n            break;\n        case 'images':\n            data.url_large = deriveImageUrl(data.url_thumb, 1200);\n            break;\n        default:\n            break;\n    }\n\n    //console.log(\"clean thumb = \", data.url_thumb);\n    //console.log(\"returning clean: \", data);\n    return data;\n}\n\n// TODO: Refactor: parameterize basic_req to select which fields to search.\nfunction constructTextQuery(searchString) {\n    let searchstring = escapeSearchString(searchString || '');\n\n    // console.log (JSON.stringify(state));\n    let starts = searchstring.length ? searchstring + '*' : '*';\n    let search = searchstring.length ? '*' + searchstring + '*' : '*';\n    let slashy = searchstring + '/';\n    if (!searchString || searchstring.length === 0) {\n        searchstring = search = slashy = '*';\n    }\n\n    var basic_req = {\n        // search: tweak for scoping later\n        q:\n            '(' +\n            ' title:${xact}^100' +\n            ' title:${slashy}^100' +\n            // \" title:${search}^10\" +\n            ' title:${starts}^80' +\n            ' names_txt:${xact}^90' +\n            ' names_txt:${starts}^70' +\n            // \" names_txt:${search}\" +\n            // \" caption:${search}\" +\n            // \" summary:${search}\" +\n            ')',\n\n        // search strings\n        xact: searchstring,\n        starts: starts,\n        search: search,\n        slashy: slashy,\n    };\n\n    return basic_req;\n}\n\nfunction constructFilters(filters) {\n    function arrayToHash(array, keyField) {\n        // console.log('received: ', array);\n        if (!array) {\n            array = [];\n        }\n        return array.reduce((collector, item) => {\n            const key = item[keyField] || 'unknown key';\n            if (!collector[key]) {\n                collector[key] = [];\n            }\n            collector[key].push(item);\n            return collector;\n        }, {});\n    }\n\n    // console.log('constructFilters: received filters: ', filters);\n    const hashedFilters = arrayToHash(filters, 'field');\n    // console.log('constructFilters: sorted filters = ', hashedFilters);\n\n    const facets = Object.keys(hashedFilters);\n    // console.log('constructFilters: keys = ', facets);\n\n    let fq_list = [];\n\n    function constructFQs(facetData, fieldName) {\n        let fq_list = [];\n        let not_list = [];\n        let and_list = [];\n        let or_list = [];\n\n        facetData.forEach((f) => {\n            if (f.operator === 'NOT') {\n                not_list.push(f.match);\n            } else if (f.operator === 'AND') {\n                and_list.push(f.match);\n            } else {\n                /* OR default case */\n                or_list.push('\"' + f.match + '\"');\n            }\n        });\n\n        const or_clause =\n            '{!tag=' +\n            fieldName +\n            '}' +\n            fieldName +\n            ':' +\n            '(' +\n            or_list.join(' ') +\n            ')';\n\n        // TODO: does the order matter?\n        if (or_list.length) fq_list.push(or_clause);\n        if (and_list.length) fq_list.push(...and_list);\n        if (not_list.length) fq_list.push(...not_list);\n\n        // console.log('constructFQs returning: ', fq_list);\n        return fq_list;\n    }\n\n    // TODO: Refactor so that facets can be added via configuration.\n    facets.forEach((facet) => {\n        const facetData = hashedFilters[facet];\n        let fqs = [];\n        // console.log('constructFilters:\\tfacet ' + facet + ' = ', facetData);\n        switch (facet) {\n            case 'asset_type':\n                fqs = constructFQs(facetData, 'asset_type');\n                fq_list.push(...fqs);\n                break;\n            case 'subjects':\n                fqs = constructFQs(facetData, 'kmapid');\n                fq_list.push(...fqs);\n                break;\n            case 'places':\n                fqs = constructFQs(facetData, 'kmapid');\n                fq_list.push(...fqs);\n                break;\n            case 'terms':\n                fqs = constructFQs(facetData, 'kmapid');\n                fq_list.push(...fqs);\n                break;\n            case 'languages':\n                fqs = constructFQs(facetData, 'language');\n                fq_list.push(...fqs);\n                break;\n            case 'feature_types':\n                fqs = constructFQs(facetData, 'kmapid');\n                fq_list.push(...fqs);\n                break;\n            case 'users':\n                fqs = constructFQs(facetData, 'node_user_full_s');\n                fq_list.push(...fqs);\n                break;\n            case 'creator':\n                fqs = constructFQs(facetData, 'creator');\n                fq_list.push(...fqs);\n                break;\n            case 'collections':\n                fqs = constructFQs(facetData, 'collection_uid_s');\n                fq_list.push(...fqs);\n                break;\n            case 'perspective':\n                fqs = constructFQs(facetData, 'perspectives_ss');\n                fq_list.push(...fqs);\n                break;\n            case 'associated_subjects':\n                fqs = constructFQs(facetData, 'associated_subject_map_idfacet');\n                fq_list.push(...fqs);\n                break;\n            default:\n                console.error('UNHANDLED FACET TYPE: ' + facet);\n                break;\n        }\n    });\n\n    // console.log('RETURNING FQ_LIST = ', fq_list);\n    return { fq: fq_list };\n}\n\nfunction escapeSearchString(str) {\n    str = str.replace(/ /g, '\\\\ '); // escape spaces\n    str = str.replace('(', '\\\\(');\n    str = str.replace(')', '\\\\)');\n    str = str.replace(':', '\\\\:');\n    str = str.replace('+', '\\\\+');\n    str = str.replace('-', '\\\\-');\n    str = str.replace('\"', '\\\\\"');\n    str = str.replace('?', '\\\\?');\n    return str;\n}\n","import {\n    action,\n    Action,\n    ThunkOn,\n    thunkOn,\n    thunk,\n    Thunk,\n    computed,\n    Computed,\n} from 'easy-peasy';\nimport {\n    getRelatedAssetsPromise,\n    getAssetDataPromise,\n    getFullKmapDataPromise,\n} from '../logic/searchapi';\nimport { StoreModel } from './StoreModel';\n\ninterface KmRelatedsSolrMode {\n    uid: string;\n    relateds: [];\n}\n\nexport interface KmapModel {\n    uid: string;\n    stateKey: Computed<KmapModel, any, StoreModel>;\n    loading: boolean;\n    kmap: KmapSolrModel;\n    asset: KmAssetSolrModel;\n    relateds: KmAssetSolrModel[];\n    relatedsPage: RelatedsPage;\n\n    // RELATEDS PAGING ACTIONS\n    gotoRelatedsPage: Action<KmapModel, number>;\n    nextRelatedsPage: Action<KmapModel>;\n    prevRelatedsPage: Action<KmapModel>;\n    firstRelatedsPage: Action<KmapModel>;\n    lastRelatedsPage: Action<KmapModel>;\n    setRelatedsPage: Action<KmapModel, RelatedsPage>;\n    setRelatedsPageSize: Action<KmapModel, number>;\n\n    // setting the primary UID\n    setUid: Action<KmapModel, string>;\n\n    // receives changes from update();\n    receiveKmap: Action<KmapModel, any>;\n\n    // thunk for updating after any change\n    update: Thunk<KmapModel, void, any, StoreModel, any>; // see https://easy-peasy.now.sh/docs/typescript-tutorial/adding-typed-thunks.html\n    onUpdate: ThunkOn<KmapModel, StoreModel>;\n}\n\nexport const kmapModel: KmapModel = {\n    loading: false,\n    stateKey: computed((state) => {\n        return (\n            state.kmap?.uid +\n            '/' +\n            state.relatedsPage?.related_type +\n            '/' +\n            state.relatedsPage?.page +\n            '/' +\n            state.relatedsPage?.pageSize\n        );\n    }),\n    uid: '',\n    kmap: { uid: '' },\n    asset: { uid: '' },\n    relateds: [],\n    relatedsPage: {\n        related_type: null,\n        page: 0,\n        pageSize: 100,\n    },\n    gotoRelatedsPage: action((state, pageNum) => {\n        state.relatedsPage.page = pageNum;\n    }),\n    firstRelatedsPage: action((state) => {\n        state.relatedsPage.page = 0;\n    }),\n    lastRelatedsPage: action((state) => {\n        throw new Error('need maxpage!');\n    }),\n    nextRelatedsPage: action((state) => {\n        state.relatedsPage.page++;\n    }),\n    prevRelatedsPage: action((state) => {\n        state.relatedsPage.page--;\n    }),\n    setRelatedsPage: action((state, relatedsPage) => {\n        state.relatedsPage = relatedsPage;\n    }),\n    setRelatedsPageSize: action((state, relatedsPageSize) => {\n        state.relatedsPage.pageSize = relatedsPageSize;\n    }),\n    receiveKmap: action((state, kmap) => {\n        // console.log(' receiveKmap received: ', kmap);\n        //  what do we do with this?\n    }),\n\n    setUid: action((state, uid) => {\n        state.uid = uid;\n        // console.log('KmapModel: set uid = ', uid, state);\n    }),\n    onUpdate: thunkOn(\n        (actions, storeActions) => [\n            actions.gotoRelatedsPage,\n            actions.nextRelatedsPage,\n            actions.prevRelatedsPage,\n            actions.firstRelatedsPage,\n            actions.lastRelatedsPage,\n            actions.setRelatedsPage,\n            actions.setUid,\n        ],\n        async (actions, target) => {\n            actions.update();\n        }\n    ),\n\n    // Do the deed\n    update: thunk(async (actions, payload, helpers) => {\n        const kmapState = helpers.getStoreState().kmap;\n        kmapState.loading = true;\n        const type = kmapState.relatedsPage.related_type;\n        const start =\n            Number(\n                kmapState.relatedsPage.page * kmapState.relatedsPage.pageSize\n            ) || 0;\n        const rows = kmapState.relatedsPage.pageSize || 100;\n\n        // console.log('KmapModel update thunk: kmapState: ', kmapState);\n        // console.log('KmapModel update thunk: kmapState.uid: ', kmapState.uid);\n\n        // console.log('KmapModel update thunk:type: ', type);\n        // console.log('KmapModel update thunk: start: ', start);\n        // console.log('KmapModel update thunk: rows: ', rows);\n\n        const promises = [\n            getAssetDataPromise(kmapState.uid),\n            getFullKmapDataPromise(kmapState.uid),\n            getRelatedAssetsPromise(kmapState.uid, type, start, rows),\n        ];\n\n        Promise.allSettled(promises)\n            .then(([kmasset_result, kmap_result, relateds_result]) => {\n                // console.log(\n                //     'kmapModel Promises settled: kmasset:',\n                //     kmasset_result\n                // );\n                // console.log('kmapModel Promises settled: kmap:', kmap_result);\n                // console.log(\n                //     'kmapModel Promises settled: relateds:',\n                //     relateds_result\n                // );\n                if (kmap_result.status === 'fulfilled') {\n                    kmapState.kmap = kmap_result.value;\n                }\n                if (kmasset_result.status === 'fulfilled') {\n                    kmapState.asset = kmasset_result.value;\n                }\n                if (relateds_result.status === 'fulfilled') {\n                    kmapState.relateds = relateds_result.value;\n                }\n\n                actions.receiveKmap(kmapState);\n            })\n            .catch((e) => {\n                console.error('oh dear! ', e);\n                throw e;\n            });\n        kmapState.loading = false;\n    }),\n};\n\ninterface RelatedsPage {\n    // stateKey: Computed<KmapModel, any, StoreModel>\n    related_type: string | null;\n    page: number;\n    pageSize: number;\n}\n\n// interface RelatedAsset {\n//     related_type: string;\n//     field: string;\n//     uid: string;\n//     page: number;\n//     pageSize: number;\n// }\n\n// MODEL KMASSET (kmassets)\nexport interface KmAssetSolrModel {\n    schema_version_i?: number;\n    asset_type?: string;\n    service?: string;\n    id?: string;\n    uid: string;\n    uid_i?: number;\n    url_html?: string;\n    kmapid?: string[];\n    kmapid_is?: number[];\n    kmapid_strict?: string[];\n    names_txt?: string[];\n    name_autocomplete?: string[];\n    name_tibt?: string[];\n    name_latin?: string[];\n    title?: string[];\n    feature_types_ss?: string[];\n    ancestors_txt?: string[];\n    ancestor_ids_is?: number[];\n    kmapid_subjects_idfacet?: string[];\n    kmapid_places_idfacet?: string[];\n    feature_types_idfacet?: string[];\n    position_i?: number;\n    parent_uid?: string;\n    caption?: string;\n    _version_?: number;\n    timestamp?: Date;\n}\n\n// MODEL KMAP (kmterms)\nexport interface KmapSolrModel {\n    tree?: string;\n    feature_types?: string[];\n    feature_type_ids?: number[];\n    has_shapes?: boolean;\n    has_altitudes?: boolean;\n    block_type?: string;\n    interactive_map_url?: string;\n    kmz_url?: string;\n    closest_fid_with_shapes?: number;\n    id?: string;\n    uid?: string;\n    uid_i?: number;\n    header?: string;\n    position_i?: number;\n    caption_eng?: string[];\n    text?: string[];\n    caption_eng_2_content_t?: string[];\n    summary_eng?: string[];\n    summary_eng_1_content_t?: string[];\n    illustration_mms_url?: string[];\n    created_at?: Date;\n    updated_at?: Date;\n    'ancestor_id_closest_cult.reg_path'?: string;\n    'level_closest_cult.reg_i'?: number;\n    'ancestor_id_cult.reg_path'?: string;\n    'ancestors_closest_cult.reg'?: string[];\n    'ancestor_ids_closest_cult.reg'?: number[];\n    'ancestor_uids_closest_cult.reg'?: string[];\n    'level_pol.admin.hier_i'?: number;\n    'ancestor_id_pol.admin.hier_path'?: string;\n    'ancestors_pol.admin.hier'?: string[];\n    'ancestor_ids_pol.admin.hier'?: number[];\n    'ancestor_uids_pol.admin.hier'?: string[];\n    'level_closest_hist.pol.admin.unit_i'?: number;\n    'ancestor_id_hist.pol.admin.unit_path'?: string;\n    'ancestor_id_closest_elect.rel_path'?: string;\n    'level_closest_elect.rel_i'?: number;\n    'ancestor_id_elect.rel_path'?: string;\n    'ancestors_closest_elect.rel'?: string[];\n    'ancestor_ids_closest_elect.rel'?: number[];\n    'ancestor_uids_closest_elect.rel'?: string[];\n    'level_closest_site.rel_i'?: number;\n    'ancestor_id_site.rel_path'?: string;\n    'level_closest_pol.rel_i'?: number;\n    'level_closest_cult.rel_i'?: number;\n    'ancestor_id_closest_envir.rel_path'?: string;\n    'level_closest_envir.rel_i'?: number;\n    'ancestor_id_envir.rel_path'?: string;\n    'ancestors_closest_envir.rel'?: string[];\n    'ancestor_ids_closest_envir.rel'?: number[];\n    'ancestor_uids_closest_envir.rel'?: string[];\n    'level_closest_admin.rel_i'?: number;\n    'level_closest_org.rel_i'?: number;\n    'level_closest_rel.rel_i'?: number;\n    'level_closest_geo.rel_i'?: number;\n    'name_roman.popular'?: string[];\n    'name_roman.scholar'?: string[];\n    'name_trad.chi'?: string[];\n    'name_simp.chi'?: string[];\n    'name_pri.tib.sec.roman'?: string[];\n    'name_pri.tib.sec.chi'?: string[];\n    name_deva?: string[];\n    name_tibt?: string[];\n    name_autocomplete?: string[];\n    name_latin?: string[];\n    name?: string[];\n    name_hans?: string[];\n    name_zh?: string[];\n    name_hant?: string[];\n    ancestors?: string[];\n    ancestor_ids_generic?: number[];\n    ancestor_uids_generic?: string[];\n    ancestor_id_path?: string;\n    level_i?: number;\n    _version_?: number;\n    _timestamp_?: Date;\n    _childDocuments_?: ChildDocuments[];\n}\n\nexport interface ChildDocuments {\n    id?: string;\n    uid?: string;\n    related_uid_s?: string;\n    origin_uid_s?: string;\n    feature_type_path_s?: string;\n    block_child_type?: BlockChildType;\n    block_type?: BlockType;\n    feature_type_name_s?: string;\n    related_names_t?: string[];\n    feature_type_id_i?: number;\n    _timestamp_?: Date;\n    related_places_id_s?: string;\n    related_places_header_s?: string;\n    related_places_path_s?: string;\n    related_places_feature_type_s?: string;\n    related_places_feature_type_id_i?: number;\n    related_subjects_t?: string[];\n    related_subject_ids?: string[];\n    related_places_feature_types_t?: string[];\n    related_places_feature_type_ids?: string[];\n    related_places_relation_label_s?: string;\n    related_places_relation_code_s?: string;\n    related_kmaps_node_type?: string[];\n}\n\nexport enum BlockChildType {\n    FeatureTypes = 'feature_types',\n    RelatedPlaces = 'related_places',\n}\n\nexport enum BlockType {\n    Child = 'child',\n}\n","import {\n    action,\n    Action,\n    ThunkOn,\n    thunkOn,\n    thunk,\n    Thunk,\n    computed,\n    Computed,\n} from 'easy-peasy';\nimport { StoreModel } from './StoreModel';\n\nexport interface StatusModel {\n    type: string | null;\n    headerTitle: string | null;\n    subTitle: string | null;\n    path: Link[];\n    id: string | null;\n\n    setType: Action<StatusModel, string>;\n    setHeaderTitle: Action<StatusModel, string>;\n    setId: Action<StatusModel, string>;\n    setPath: Action<StatusModel, Link[]>;\n    setSubTitle: Action<StatusModel, string>;\n    setStatus: Action<StatusModel, StatusModel>;\n    clear: Action<StatusModel>;\n}\n\nexport interface Link {\n    uid: string;\n    name: string;\n}\n\nexport const statusModel: StatusModel = {\n    type: null,\n    headerTitle: 'Mandala',\n    subTitle: null,\n    path: [],\n    id: null,\n\n    // ACTIONS\n    clear: action((state) => {\n        state.id = null;\n        state.type = null;\n        state.subTitle = null;\n        state.headerTitle = null;\n        state.path = [];\n        state.id = null;\n    }),\n    setId: action((state, id) => {\n        document.title = state.headerTitle + ' (' + id + ')';\n        state.id = id;\n    }),\n    setPath: action((state, path) => {\n        state.path = path;\n    }),\n    setSubTitle: action((state, subTitle) => {\n        state.subTitle = subTitle;\n    }),\n    setHeaderTitle: action((state, title) => {\n        document.title = title + (state.id ? ' (' + state.id + ')' : '');\n        state.headerTitle = title;\n    }),\n    setType: action((state, type) => {\n        state.type = type;\n    }),\n    setStatus: action((state, status) => {\n        state = { ...status };\n    }),\n};\n","import {\n    action,\n    Action,\n    ThunkOn,\n    thunkOn,\n    thunk,\n    Thunk,\n    computed,\n    Computed,\n} from 'easy-peasy';\nimport { StoreModel } from './StoreModel';\nimport _ from 'lodash';\n\nexport interface HistoryModel {\n    historyStack: Location[];\n    addLocation: Action<HistoryModel, Location>;\n    removeType: Action<HistoryModel, Type>;\n    removeLocation: Action<HistoryModel, Location>;\n    clear: Action<HistoryModel>;\n}\n\nexport interface Location {\n    hash: string | null;\n    key: string | null;\n    pathname: string;\n    search: string | null;\n    state: any | null | undefined;\n}\n\nexport enum Type {\n    'search',\n    'visit',\n}\n\nfunction sameLocation(x: Location, location: Location) {\n    if (x.key === location.key) return true;\n\n    // compare all fields except \"key\" and \"name\"\n    const a = JSON.stringify({ ...x, key: null, name: null });\n    const b = JSON.stringify({ ...location, key: null, name: null });\n\n    if (a === b) {\n        return true;\n    }\n\n    return false;\n}\n\nfunction isHistoryType(loc: Location, type: Type) {\n    switch (type) {\n        case Type.search:\n            break;\n\n        case Type.visit:\n            break;\n\n        default:\n    }\n}\n\nexport const historyModel: HistoryModel = {\n    addLocation: action((state, location) => {\n        const ind = state.historyStack.findIndex((x) => {\n            return sameLocation(x, location);\n        });\n        // console.log('pathname = ', location.pathname, ' ind = ', ind);\n\n        // remove old one, if its there\n        if (ind > -1) {\n            state.historyStack.splice(ind, 1);\n        }\n\n        // push the new on top of the stack\n        state.historyStack.push(location);\n    }),\n\n    clear: action((state) => {\n        state.historyStack = [];\n    }),\n\n    removeType: action((state, type) => {\n        console.log('HistoryModel: type = ', type.valueOf());\n        console.log('HistoryModel: Type.search = ', Type.search);\n        console.log(type == Type.search);\n        const newStack = state.historyStack.filter((x) => {\n            console.log(' x====> ', JSON.stringify(x));\n            if (\n                type.valueOf() == Type.search &&\n                x.pathname.startsWith('/search/')\n            ) {\n                console.log('omitting: ', x);\n\n                return false;\n            } else {\n                return true;\n            }\n        });\n        state.historyStack = newStack;\n    }),\n\n    removeLocation: action((state, location) => {\n        // console.error('removeLocation: ', location);\n        const ind = state.historyStack.findIndex((x) => {\n            return sameLocation(x, location);\n        });\n\n        // remove it, if its there\n        if (ind > -1) {\n            console.log('removing item number ' + ind);\n            state.historyStack.splice(ind, 1);\n        } else {\n            console.log(\n                'HistoryModel.ts: remove failed:  location = ',\n                location\n            );\n        }\n    }),\n\n    historyStack: [],\n};\n","import { SearchModel, searchModel } from './SearchModel';\nimport { KmapModel, kmapModel } from './KmapModel';\nimport { StatusModel, statusModel } from './StatusModel';\nimport { createTypedHooks } from 'easy-peasy';\nimport { HistoryModel, historyModel } from './HistoryModel';\n\nexport interface StoreModel {\n    kmap: KmapModel;\n    search: SearchModel;\n    status: StatusModel;\n    history: HistoryModel;\n}\n\nexport const storeModel: StoreModel = {\n    kmap: kmapModel,\n    search: searchModel,\n    status: statusModel,\n    history: historyModel,\n};\n\nexport const {\n    useStoreActions,\n    useStoreState,\n    useStoreDispatch,\n    useStore,\n} = createTypedHooks<StoreModel>();\n","import React, { useCallback, useEffect, useState } from 'react';\nimport { useStoreState, useStoreActions } from '../model/StoreModel';\nimport _ from 'lodash';\nimport { useParams } from 'react-router';\n\n/**\n *    Container which injects the current search data, before rendering the its children.\n *\n *    It injects the props:\n *\n *         searchState:  the current searchState object\n *         results: the current populated results\n *\n *          NB:  This will ONLY inject into top-level children.  It is fully expected for these top-level components to manage\n *          passing its props to its children as needed.\n *\n *          We may memoize the results at this point for performance reasons.\n *\n * */\n\nexport default function SearchContext(props) {\n    const params = useParams();\n    const show_debug = false;\n    if (show_debug) console.log('SearchContext params = ', params);\n\n    function debounce(func) {\n        return _.debounce(func, 100);\n    }\n\n    function debounceAll(funcs) {\n        return _.reduce(\n            funcs,\n            (result, f, key) => {\n                result[key] = debounce(f);\n                return result;\n            },\n            {}\n        );\n    }\n\n    // This makes the Easy Peasy State Store available.\n    // we are mapping \"search\" from the Store into const \"search\".\n    const search = useStoreState((state) => state.search);\n\n    // we are unpacking all the state store's actions.\n    // eventually this list of action will be enhanced with things like sort controls\n    // TODO: review: we debounce ALL the calls, for now...   maybe this is not the right place to do that.\n    // TODO: probably should make the debounce adjustable per call.  Otherwise it introduces artificial sluggishness in many cases.\n    const {\n        update,\n        setSearchText,\n        addFilters,\n        gotoPage,\n        nextPage,\n        prevPage,\n        lastPage,\n        firstPage,\n        clearFilters,\n        clearAll,\n        removeFilters,\n        setPageSize,\n        narrowFilters,\n        superClear,\n    } = debounceAll(useStoreActions((actions) => actions.search));\n\n    const query = search.query;\n    if (show_debug) console.log('setting searchControls: search = ', search);\n\n    const searchControls = {\n        query: query,\n        currentText: search.searchText,\n        update: update,\n        setSearchText: setSearchText,\n        addFilters: addFilters,\n        clearFilters: clearFilters,\n        clearAll: clearAll,\n        superClear: superClear,\n        removeFilters: removeFilters,\n        narrowFilters: narrowFilters,\n    };\n\n    // Let's dispatch an update right off the bat...\n    // TODO: review what gets populated initially and how.\n    // Need to populate the facets but should we populate the search results?\n    useEffect(() => {\n        if (show_debug) console.log('INITING');\n        update();\n    }, []);\n\n    // The pager encapsulates and controls paging of the results in docs.\n    // Eventually it will also include things like sorting\n    const docs = search.results?.docs;\n    const pager = {\n        numFound: search.results?.numFound,\n        currentPage: search.page?.current,\n        currentPageSize: search.page?.rows,\n\n        getMaxPage: () => {\n            if (!search.results?.numFound) {\n                return 0;\n            } else {\n                const maxCount = search.results?.numFound;\n                const pageSize = search.page?.rows;\n                const maxPage = Math.floor((maxCount - 1) / pageSize);\n                // console.log( \"getMaxPage(): pageSize = \",pageSize, \" maxCount = \",maxCount,\" => maxPage = \", maxPage);\n                return maxPage;\n            }\n        },\n        getPage: () => {\n            return search.page?.current;\n        },\n        setPage: (pg) => {\n            pg = Number(pg);\n            const maxCount = search.results?.numFound;\n            const pageSize = search.page?.rows;\n            const maxPage = Math.floor(maxCount / pageSize);\n            pg = _.isNaN(pg) ? 0 : pg;\n            if (pg > maxPage) {\n                gotoPage(maxPage);\n            } else if (pg < 0) {\n                if (show_debug) console.log('SearchContext: gotoPage: 0');\n                gotoPage(0);\n            } else {\n                if (show_debug) console.log('SearchContext: gotoPage: ' + pg);\n                gotoPage(pg);\n            }\n        },\n        setPageSize: (size) => {\n            size = Number(size);\n            let oldSize = Number(size);\n            let oldPage = Number(search.page?.current);\n            size = size < 1 ? 1 : size;\n            size = _.isNaN(size) ? oldSize : size;\n            setPageSize(size);\n            const pageSize = search.page?.rows;\n            let newPage = Math.floor((pageSize / oldSize) * oldPage);\n            // console.log(\"newPage: \" + newPage + \" oldPage: \" + oldPage + \" pageSize = \" + pageSize + \" oldSize = \" + oldSize);\n            newPage = _.isNaN(newPage) ? 0 : newPage;\n            pager.setPage(newPage);\n        },\n        getPageSize: () => {\n            return search.page?.rows;\n        },\n        nextPage: () => {\n            nextPage();\n        },\n        prevPage: () => {\n            prevPage();\n        },\n        firstPage: () => {\n            firstPage();\n        },\n        lastPage: () => {\n            lastPage();\n        },\n    };\n    const facets = search.results?.facets;\n\n    // Pass the docs and pager as properties.\n    const ret_children = React.Children.map(props.children, (child) => {\n        // when a child is an Element or Component it will have a \"type\" attribute\n        // if its a text node, it will not.\n        if (child.type) {\n            // clone the element (or Component) and pass new properties.\n            const new_child = React.cloneElement(child, {\n                docs: docs,\n                facets: facets,\n                pager: pager,\n                search: searchControls,\n            });\n            return new_child;\n        } else {\n            // otherwise, just pass the child as-is.\n            return child;\n        }\n    });\n    return ret_children;\n}\n","import React, { useState } from 'react';\nimport { BasicSearch } from './BasicSearch';\nimport { AdvancedToggle } from '../main/MainSearchToggle/AdvancedToggle';\nimport { MainNavToggle } from '../main/MainNavToggle/MainNavToggle';\nimport SearchContext from '../context/SearchContext';\n\nexport function SearchBar(props) {\n    const [search, setSearch] = useState('');\n    const [viewMode, setViewMode] = useState('off');\n\n    function chooseViewMode(mode) {\n        console.log('chooseViewMode = ', mode);\n        setViewMode(mode);\n        if (mode === 'off') {\n            props.onStateChange({ advanced: false, tree: false });\n        } else if (mode === 'tree') {\n            props.onStateChange({ advanced: false, tree: true });\n        } else if (mode === 'advanced') {\n            props.onStateChange({ advanced: true, tree: false });\n        }\n    }\n\n    function handleInputChange(event) {\n        console.log('Input Change', event.target.value);\n        setSearch(event.target.value);\n    }\n\n    function handleSubmit(value) {\n        console.log('Submit: ' + value);\n        setSearch(value);\n    }\n\n    function handleClearBasic(event) {\n        console.log('Clear');\n        event.preventDefault();\n    }\n\n    const searchbar = (\n        <section id=\"c-site__search\" className=\"c-site__search\">\n            {/*<form onSubmit={this.handleSubmit}>*/}\n            <SearchContext>\n                <BasicSearch\n                    onSubmit={handleSubmit}\n                    onChange={handleInputChange}\n                />\n                <AdvancedToggle\n                    chooseViewMode={chooseViewMode}\n                    viewMode={viewMode}\n                />\n            </SearchContext>\n            {/*</form>*/}\n        </section>\n    );\n    return searchbar;\n}\n","import { Link } from 'react-router-dom';\nimport React, { useLayoutEffect, useState } from 'react';\nimport { SearchBar } from '../../search/SearchBar';\n// import Headroom from '../../../node_modules/headroom.js'; // see https://wicky.nillia.ms/headroom.js/\nimport './SiteHeader.scss';\n\nexport function SiteHeader(props) {\n    //   useLayoutEffect(() => {\n    //       var myElement = document.querySelector('.c-site__header');\n    //      var headroom = new Headroom(myElement, {\n    //          tolerance: {\n    //              down: 0,\n    //              up: 20,\n    //          },\n    //         offset: 20,\n    //    });\n    //    headroom.init();\n    //  });\n    const topBar = (\n        <header className={'c-site__header'}>\n            <nav className=\"navbar navbar-expand-lg navbar-light bg-light\">\n                <Link to={'/home'} className={'navbar-brand'}>\n                    <img\n                        src={process.env.PUBLIC_URL + '/img/bhutanleft.gif'}\n                        alt={'Home Page'}\n                        className={'o-image-logo d-inline-block align-top'}\n                    />\n                    <h1 className=\"sr-only\">Bhutan Library</h1>\n                </Link>\n\n                <div\n                    className=\"collapse navbar-collapse\"\n                    id=\"navbarNav\"\n                    role=\"navigation\"\n                >\n                    <ul className=\"navbar-nav\">\n                        <li className=\"nav-item active\">\n                            <a className=\"nav-link\" href=\"#\">\n                                Home <span className=\"sr-only\">(current)</span>\n                            </a>\n                        </li>\n                        <li className=\"nav-item\">\n                            <a className=\"nav-link\" href=\"#\">\n                                About\n                            </a>\n                        </li>\n                        <li className=\"nav-item\">\n                            <a className=\"nav-link\" href=\"#\">\n                                Documentation\n                            </a>\n                        </li>\n                    </ul>\n                </div>\n\n                <SearchBar\n                    advanced={props.advanced}\n                    tree={props.tree}\n                    onStateChange={props.onStateChange}\n                />\n\n                <button\n                    className=\"navbar-toggler\"\n                    type=\"button\"\n                    data-toggle=\"collapse\"\n                    data-target=\"#navbarNav\"\n                    aria-controls=\"navbarNav\"\n                    aria-expanded=\"false\"\n                    aria-label=\"Toggle navigation\"\n                >\n                    <span className=\"navbar-toggler-icon\"></span>\n                </button>\n            </nav>\n        </header>\n    );\n    return topBar;\n}\n","import { Link } from 'react-router-dom';\nimport React from 'react';\nimport { Jumbotron, Toast } from 'react-bootstrap';\nimport JSXExpressionContainerMock from 'eslint-plugin-jsx-a11y/__mocks__/JSXExpressionContainerMock';\nimport Container from 'react-bootstrap/Container';\nimport Row from 'react-bootstrap/Row';\nimport Col from 'react-bootstrap/Col';\nimport '../../Om.css';\n\nexport function Home(props) {\n    return (\n        <div className={'sui-main'} style={{ marginTop: '5em' }}>\n            <Container>\n                <Row>\n                    <Col>\n                        <Jumbotron>\n                            <h3>Work-in-Progress</h3>\n\n                            <h4>Terms</h4>\n                            <ul>\n                                <li>\n                                    <Link to={'/terms/terms-12434'}>\n                                        /terms/terms-12434\n                                    </Link>\n                                </li>\n                                <li>\n                                    <Link to={'/terms/terms-45057'}>\n                                        'gro ba/ (terms-45057)\n                                    </Link>\n                                </li>\n                                <li>\n                                    <Link to={'/terms/terms-85193'}>\n                                        thod rgal/: (terms-85193)\n                                    </Link>\n                                </li>\n                            </ul>\n                            <h4>Places</h4>\n                            <ul>\n                                <li>\n                                    <Link to={'/places/places-16408'}>\n                                        Potala Palace: (places-16408)\n                                    </Link>\n                                </li>\n                                <li>\n                                    <Link to={'/places/places-637'}>\n                                        Lhasa: (places-637)\n                                    </Link>\n                                </li>\n                                <ul>\n                                    <li>\n                                        <Link\n                                            to={\n                                                '/places/places-637/related-images/deck'\n                                            }\n                                        >\n                                            Related Images\n                                        </Link>\n                                    </li>\n                                    <li>\n                                        <Link\n                                            to={\n                                                '/places/places-637/related-audio-video/deck'\n                                            }\n                                        >\n                                            Related Audio-Video\n                                        </Link>\n                                    </li>\n                                </ul>\n                                <li>\n                                    <Link to={'/places/places-427'}>\n                                        Bhutan: (places-427)\n                                    </Link>\n                                </li>\n                                <ul>\n                                    <li>\n                                        <Link\n                                            to={\n                                                '/places/places-427/related-images/deck'\n                                            }\n                                        >\n                                            Related Images\n                                        </Link>\n                                    </li>\n                                    <li>\n                                        <Link\n                                            to={\n                                                '/places/places-427/related-audio-video/deck'\n                                            }\n                                        >\n                                            Related Audio-Video\n                                        </Link>\n                                    </li>\n                                </ul>\n                            </ul>\n                            <h4>Search</h4>\n                            <ul>\n                                <li>\n                                    <Link to={'/search'}>/search</Link>\n                                </li>\n                            </ul>\n\n                            <h4>Images</h4>\n                            <ul>\n                                <li>\n                                    <Link to={'/images/1421596'}>\n                                        Image: Dudul Dorjay Festival Photo\n                                    </Link>\n                                </li>\n                                <li>\n                                    <Link to={'/images/160186'}>\n                                        Image: High Tibet Chu ser\n                                    </Link>\n                                </li>\n                                <li>\n                                    <Link to={'/images/1243906'}>\n                                        Image: Lhasa Mural Painting\n                                    </Link>\n                                </li>\n                                <li>\n                                    <Link to={'/images/45806'}>\n                                        Image: Woman on Basum Island\n                                    </Link>\n                                </li>\n                            </ul>\n\n                            <h4>Audio-Video</h4>\n                            <ul>\n                                <li>\n                                    <Link to={'/audio-video/825'}>\n                                        Video: Carpenter of Lhagya Ri Palace\n                                    </Link>\n                                </li>\n                                <li>\n                                    <Link to={'/audio-video/306'}>\n                                        Video: Dawa and Pudrön Flirt\n                                    </Link>\n                                </li>\n                                <li>\n                                    <Link to={'/audio-video/9246'}>\n                                        Video: Riddle of the Terma Vase\n                                    </Link>{' '}\n                                    (Many Agents, Transcript, Tibetan and\n                                    Chinese text)\n                                </li>\n                            </ul>\n\n                            <h4>Texts</h4>\n                            <ul>\n                                <li>\n                                    <Link to={'/texts/16230'}>\n                                        Text: Introduction to Drepung Colleges\n                                    </Link>\n                                </li>\n                                <li>\n                                    <Link to={'/texts/46641'}>\n                                        Text: Veronoica’s Test\n                                    </Link>{' '}\n                                    has embedded video etc.\n                                </li>\n                                <li>\n                                    <Link to={'/texts/50751'}>\n                                        Text: Hagar of The Pawn-Shop\n                                    </Link>{' '}\n                                    has Hagar... and a Pawn Shop.\n                                </li>\n                            </ul>\n\n                            <h4>References</h4>\n                            <ul>\n                                <li>\n                                    <a\n                                        href={\n                                            'https://www.viseyes.org/ksolr/#s=text:lhasa=assets:All:all:AND'\n                                        }\n                                    >\n                                        KSolr search on Lhasa\n                                    </a>\n                                </li>\n                                <li>\n                                    <Link to={'/poptest/places/637'}>\n                                        Kmaps Popover Test Page\n                                    </Link>\n                                </li>\n                            </ul>\n                        </Jumbotron>\n                    </Col>\n                </Row>\n            </Container>\n        </div>\n    );\n}\n","import { Link } from 'react-router-dom';\nimport * as PropTypes from 'prop-types';\nimport React from 'react';\n\nexport function KmapLink({ uid, label, key, className }) {\n    const [type, id] = uid.split('-');\n\n    if (!key) {\n        key = uid;\n    }\n    return (\n        <Link className={className} key={key} to={'/' + type + '/' + uid}>\n            {label}\n        </Link>\n    );\n}\n\nKmapLink.propTypes = {\n    uid: PropTypes.string,\n    label: PropTypes.string,\n};\n","import React, { useEffect } from 'react';\nimport { useStoreState } from '../../model/StoreModel';\nimport { KmapLink } from '../../views/common/KmapLink';\nimport './ContentHeader.scss';\n\nexport function ContentHeader(props) {\n    const status = useStoreState((state) => state.status);\n    // console.error(\"ContentHeader status = \" , status);\n    // console.log(\" ContentHeader path = \", status.path)\n    const sep = '>';\n    let pathy = [];\n    status.path.forEach((link, i) => {\n        if (i !== 0) {\n            pathy.push(sep);\n        }\n        pathy.push(\n            <KmapLink\n                className={'breadcrumb-item'}\n                key={link.uid}\n                uid={link.uid}\n                label={link.name}\n            />\n        );\n    });\n\n    const convertedPath = pathy;\n\n    const cheader = (\n        <header\n            id=\"c-content__header__main\"\n            className={`c-content__header__main sui-header legacy ${props.siteClass} ${status.type}`}\n        >\n            <div\n                id=\"c-content__header__main__wrap\"\n                className=\"c-content__header__main__wrap legacy\"\n            >\n                <h1 className={'c-content__header__main__title'}>\n                    <span className={`icon u-icon__${status.type}`}></span>\n                    {status.headerTitle}\n                </h1>\n\n                <div className={'c-content__header__breadcrumb breadcrumb'}>\n                    {convertedPath}\n                </div>\n                <h5 className={'c-content__header__main__id'}>{status.id}</h5>\n                <h4 className={'c-content__header__main__sub'}>\n                    {status.subTitle}\n                </h4>\n            </div>\n        </header>\n    );\n    return cheader;\n}\n","import { action, useStoreActions } from 'easy-peasy';\nimport { StatusModel } from '../model/StatusModel';\n\n/* This passes the StatusModel actions:\n\n\nSo a Component would use it like this:\n\n    const status = useStatus();\n\n    status.clear();\n    status.setHeaderTitle(data.title);\n    status.setType(data.asset_type);\n    status.setId(data.id);\n\nCurrently these are the Actions that are passed:\n\n    setType(string)\n    setHeaderTitle(string)\n    setId(string)\n    setPath(string[])\n    setSubTitle(string)\n    setStatus(StatusModel)\n    clear()\n\n    It is currently in use in src/main/ContentHeader.js via Easy Peasy state.\n\n    TODO: Review whether this is a safe practice to just pass the full Easy Peasy StatusModel\n    Maybe I should write a proxy object.   It would be nice if the proxy dynamically updated the functions it's proxying.\n\n */\n\nfunction useStatus() {\n    const statusActions = <StatusModel>(\n        useStoreActions((actions) => actions.status)\n    );\n    return statusActions;\n}\nexport default useStatus;\n","import _ from 'lodash';\nimport React from 'react';\nimport LinesEllipsis from 'react-lines-ellipsis';\n\n/**\n * React functional component:  Renders a Title with appropriate context information\n *\n * @param props.doc: kmasset solr document\n * @returns rendered title\n */\nexport function SmartTitle(props) {\n    let smartTitle =\n        Array.isArray(props.doc.title) && props.doc.title.length > 0\n            ? props.doc.title[0]\n            : props.doc.title; // default\n\n    function findIn(arr, value) {\n        return _.findIndex(arr, (x) => x === value);\n    }\n\n    // TODO: abstract logic into composable functions\n    switch (props.doc.asset_type) {\n        case 'places':\n            // UNITED STATES NAMING RULES\n            // TODO: what about state abbreviations?\n            const n = findIn(\n                props.doc.ancestors_txt,\n                'United States of America'\n            );\n            if (n > 1) {\n                let state = props.doc.ancestors_txt[n + 1];\n                if (findIn(props.doc.feature_types_ss, 'County') > -1) {\n                    smartTitle += ' County';\n                }\n\n                if (findIn(props.doc.feature_types_ss, 'State') === -1) {\n                    smartTitle += ', ' + state;\n                }\n            }\n            break;\n        case 'subjects':\n            break;\n        case 'terms':\n            break;\n        case 'audio-video':\n            break;\n        case 'texts':\n            break;\n        case 'sources':\n            break;\n        case 'visuals':\n            break;\n        case 'images':\n            break;\n        case 'collections':\n            if (props.doc.asset_subtype) {\n                smartTitle += ' (' + props.doc.asset_subtype + ')';\n            }\n            break;\n    }\n\n    // applying LinesEllipsis component...\n    // ys2n: style-kludge: adding \"white-space: pre-wrap\" as per https://github.com/xiaody/react-lines-ellipsis/issues/59\n    return (\n        <LinesEllipsis\n            style={{ whiteSpace: 'pre-wrap' }}\n            maxLine={2}\n            text={smartTitle}\n            basedOn={'words'}\n        />\n    );\n}\n","import React from 'react';\nimport _ from 'lodash';\n\n/**\n * React functional component\n *\n * @param props.doc kmasset solr document\n * @returns Component with rendered truncated path\n */\nexport function SmartPath(props) {\n    const { doc } = props;\n    // console.log('SmartPath doc = ', doc);\n\n    function findIn(arr, value) {\n        return _.findIndex(arr, (x) => x === value);\n    }\n\n    let smartPath = <>{doc.ancestors_txt.join('/')}</>;\n    switch (doc.asset_type) {\n        case 'places':\n            const n = findIn(\n                props.doc.ancestors_txt,\n                'United States of America'\n            );\n            if (n > 1) {\n                smartPath = <>{doc.ancestors_txt.slice(3, 6).join('/')}</>;\n            } else {\n                smartPath = <>{doc.ancestors_txt.slice(2, 5).join('/')}</>;\n            }\n            break;\n        case 'subjects':\n            smartPath = <>{doc.ancestors_txt.slice(1, 2).join('/')}</>;\n            break;\n        case 'terms':\n            // NO PATH for terms.\n            smartPath = null;\n            break;\n    }\n    return smartPath;\n}\n","import * as PropTypes from 'prop-types';\nimport React from 'react';\nimport LinesEllipsis from 'react-lines-ellipsis';\nimport HTMLEllipsis from 'react-lines-ellipsis/lib/html';\nimport { renderToString } from 'react-dom/server';\nimport './SmartRelateds.css';\n\nexport function SmartRelateds(props) {\n    return <div className={'c-smartRelateds__limited'}>{props.relateds}</div>;\n}\n\nSmartRelateds.propTypes = { relateds: PropTypes.any };\n","import Card from 'react-bootstrap/Card';\nimport { Link } from 'react-router-dom';\n// import Accordion from \"react-bootstrap/Accordion\";\n// import Button from \"react-bootstrap/Button\";\nimport * as PropTypes from 'prop-types';\nimport React from 'react';\nimport Modal from 'react-bootstrap/Modal';\nimport Button from 'react-bootstrap/Button';\nimport ListGroup from 'react-bootstrap/ListGroup';\nimport { KmapLink } from '../KmapLink';\nimport { SmartTitle } from '../SmartTitle';\nimport { SmartPath } from '../SmartPath';\nimport { SmartRelateds } from '../SmartRelateds';\n\nimport './FeatureCard.scss';\n// import '../../../css/fonts/shanticon/style.css';\n// import '../../../_index-variables.scss';\n\n// import {  } from 'react-icons/bs';\n\n// Map of special type glyphs:  This uses a compound key of \"<asset_type>/<asset_subtype>\" so that special glyphs can be used.\n// If a type/subtype does not appear in this map, then the asset_type glyph is used.  -- ys2n\nconst typeGlyphMap = {\n    'audio-video/video': <span className={'icon color-invert u-icon__video'} />,\n    'audio-video/audio': <span className={'icon color-invert u-icon__audio'} />,\n};\n\nexport function FeatureCard(props) {\n    // console.log('FeatureCard: doc = ', props.doc.uid);\n    // console.log('FeatureCard: inline = ', props.inline);\n    const inline = props.inline || false;\n\n    const [modalShow, setModalShow] = React.useState(false);\n\n    const subTypeGlyph =\n        typeGlyphMap[props.doc.asset_type + '/' + props.doc.asset_subtype];\n    const typeGlyph = props.doc.uid ? (\n        subTypeGlyph ? (\n            subTypeGlyph\n        ) : (\n            <span\n                className={'icon color-invert u-icon__' + props.doc.asset_type}\n            ></span>\n        )\n    ) : null;\n\n    const assetGlyph =\n        props.doc.uid &&\n        props.doc.asset_type !== 'images' &&\n        props.doc.asset_type !== 'audio-video' ? (\n            <span className={'icon u-icon__' + props.doc.asset_type}></span>\n        ) : null;\n\n    const viewer = props.doc.asset_type;\n\n    const related_places = props.doc.kmapid_places_idfacet?.map((x, i) => {\n        const [name, id] = x.split('|');\n        return (\n            <div key={i} className=\"c-card__content-field shanti-field-place\">\n                <span className=\"icon shanti-field-content\">\n                    <KmapLink uid={id} label={name} />\n                </span>\n            </div>\n        );\n    });\n\n    const related_subjects = props.doc.kmapid_subjects_idfacet?.map((x, i) => {\n        const [name, id] = x.split('|');\n        return (\n            <div key={i} className=\"c-card__content-field shanti-field-subject\">\n                <span className=\"icon shanti-field-content\">\n                    <KmapLink uid={id} label={name} />\n                </span>\n            </div>\n        );\n    });\n\n    const feature_types = props.doc.feature_types_idfacet?.map((x, i) => {\n        const [name, id] = x.split('|');\n        return (\n            <div\n                key={id}\n                className=\"c-card__content-field shanti-field-subject\"\n            >\n                <span className=\"icon shanti-field-content\">\n                    <KmapLink uid={id} label={name} />\n                </span>\n            </div>\n        );\n    });\n\n    let date = props.doc.node_created\n        ? props.doc.node_created\n        : props.doc.timestamp;\n    date = date?.split('T')[0];\n\n    let creator =\n        props.doc.creator?.length > 0\n            ? props.doc.creator.join(', ')\n            : props.doc.node_user;\n    if (props.doc.creator?.length > 3) {\n        creator = props.doc.creator.slice(0, 3).join(', ') + '…';\n    }\n\n    if (creator) {\n        creator = creator.replace(/\\&amp\\;/g, '&');\n    }\n\n    const footer_text = props.doc.collection_title ? (\n        <span className={'icon u-icon__collections'}>\n            {' '}\n            {props.doc.collection_title}{' '}\n        </span>\n    ) : (\n        <span>\n            {props.doc.ancestors_txt && props.doc.asset_type !== 'terms' && (\n                <div className=\"info shanti-field-path\">\n                    <span\n                        className={\n                            'shanti-field-content u-icon__' +\n                            props.doc.asset_type\n                        }\n                    >\n                        <SmartPath doc={props.doc} />\n                    </span>\n                </div>\n            )}\n        </span>\n    );\n\n    let relateds = null;\n\n    if (props.doc.asset_type === 'places') {\n        // relateds = related_subjects;\n        relateds = feature_types;\n    } else if (props.doc.asset_type === 'subjects') {\n        relateds = related_places;\n    } else if (props.doc.asset_type === 'terms') {\n        relateds = related_subjects;\n    }\n\n    // console.log(\"FOOTERING: \", props.doc);\n    const asset_view = inline\n        ? `./view/${props.doc.uid}?asset_type=${props.doc.asset_type}`\n        : `/${viewer}/${props.doc.id}`;\n    return (\n        <Card\n            key={props.doc.uid}\n            className={'c-card__grid--' + props.doc.asset_type}\n        >\n            <Link\n                to={asset_view}\n                className={'c-card__link--asset c-card__wrap--image'}\n            >\n                <Card.Img\n                    className={'c-card__grid__image--top'}\n                    variant=\"top\"\n                    src={props.doc.url_thumb}\n                />\n                <div className={'c-card__grid__glyph--type color-invert'}>\n                    {typeGlyph}\n                </div>\n                <div className={'c-card__grid__glyph--asset'}>{assetGlyph}</div>\n            </Link>\n\n            <Card.Body>\n                <Card.Title>\n                    <Link to={asset_view} className={'c-card__link--asset'}>\n                        <SmartTitle doc={props.doc} />\n                    </Link>\n                </Card.Title>\n\n                <ListGroup>\n                    <ListGroup.Item className={'c-card__listItem--creator'}>\n                        {props.doc.creator && (\n                            <div className=\"info shanti-field-creator\">\n                                <span className=\"icon shanti-field-content\">\n                                    {creator}\n                                </span>\n                            </div>\n                        )}\n                    </ListGroup.Item>\n                    <ListGroup.Item className={'c-card__listItem--duration'}>\n                        {props.doc.duration_s && (\n                            <div className=\"info shanti-field-duration\">\n                                <span className=\"icon shanti-field-content\">\n                                    {props.doc.duration_s}\n                                </span>\n                            </div>\n                        )}\n                    </ListGroup.Item>\n                    <ListGroup.Item className={'c-card__listItem--related'}>\n                        <div className=\"info shanti-field-related\">\n                            <span className=\"shanti-field-content\">\n                                <SmartRelateds relateds={relateds} />\n                            </span>\n                        </div>\n                    </ListGroup.Item>\n                    <ListGroup.Item className={'c-card__listItem--created'}>\n                        {date && (\n                            <div className=\"shanti-field-created\">\n                                <span className=\"icon shanti-field-content\">\n                                    {date}\n                                </span>\n                            </div>\n                        )}\n                    </ListGroup.Item>\n                </ListGroup>\n\n                <div className={'c-button__json'}>\n                    <span\n                        className={'sui-showinfo u-icon__info float-right'}\n                        onClick={() => setModalShow(true)}\n                    ></span>\n                    <DetailModal\n                        show={modalShow}\n                        onHide={() => setModalShow(false)}\n                        data={props.doc}\n                        scrollable={true}\n                    />\n                </div>\n            </Card.Body>\n\n            <Card.Footer\n                className={\n                    'c-card__footer c-card__footer--' + props.doc.asset_type\n                }\n            >\n                <Link>{footer_text}</Link>\n            </Card.Footer>\n        </Card>\n    );\n}\n\nFeatureCard.propTypes = { doc: PropTypes.any };\n\nfunction DetailModal(props) {\n    return (\n        <Modal\n            {...props}\n            size=\"lg\"\n            aria-labelledby=\"contained-modal-title-vcenter\"\n            centered\n        >\n            <Modal.Header closeButton>\n                <Modal.Title id=\"contained-modal-title-vcenter\">\n                    JSON DATA\n                </Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <pre>{JSON.stringify(props.data, undefined, 3)}</pre>\n            </Modal.Body>\n            <Modal.Footer>\n                <Button onClick={props.onHide}>Close</Button>\n            </Modal.Footer>\n        </Modal>\n    );\n}\n","import InputNumber from 'rc-input-number';\nimport * as PropTypes from 'prop-types';\nimport React, { useState, useRef } from 'react';\nimport NumericInput from 'react-numeric-input';\n\nimport './FeaturePager.scss';\n\nexport function FeaturePager(props) {\n    const [pg, setPg] = useState(0);\n    const pageInput = useRef(null);\n\n    if (props.pager === undefined) {\n        return null;\n    }\n\n    let wingo = (\n        <NumericInput\n            aria-label=\"Goto page\"\n            min={1}\n            max={props.pager.getMaxPage() + 1}\n            size={5}\n            value={props.pager.getPage() + 1}\n            onChange={(pg) => {\n                console.log(\n                    'FeaturePager pg = ' +\n                        pg +\n                        ' maxPage = ' +\n                        props.pager.getMaxPage()\n                );\n                props.pager.setPage(pg - 1);\n            }}\n            mobile={false}\n            noStyle={true}\n            ref={pageInput}\n        />\n    );\n\n    function firstPage() {\n        props.pager.firstPage();\n        console.log('firstPage()', pageInput.current);\n        console.log('getPage()', props.pager.getPage());\n        pageInput.current.refsInput.setValue(props.pager.getPage() + 1);\n    }\n\n    function nextPage() {\n        props.pager.nextPage();\n        console.log('getPage()', props.pager.getPage());\n        pageInput.current.refsInput.setValue(props.pager.getPage() + 1);\n    }\n\n    function prevPage() {\n        props.pager.prevPage();\n        console.log('getPage()', props.pager.getPage());\n        pageInput.current.refsInput.setValue(props.pager.getPage() + 1);\n    }\n\n    function lastPage() {\n        props.pager.lastPage();\n        console.log('getPage()', props.pager.getPage());\n        pageInput.current.refsInput.setValue(props.pager.getPage() + 1);\n    }\n\n    if (props.pager.getMaxPage() < props.pager.getPage()) {\n        props.pager.setPage(props.pager.getMaxPage());\n    }\n\n    return (\n        <div className={'c-featurePager__container'}>\n            <div className={'c-featurePager__navButtons'}>\n                <span\n                    onClick={firstPage}\n                    className={\n                        'icon u-icon__arrow-end-left c-pagerIcon__buttonFirst'\n                    }\n                >\n                    {' '}\n                </span>\n                <span\n                    onClick={prevPage}\n                    className={\n                        'icon u-icon__arrow3-left c-pagerIcon__buttonPrev'\n                    }\n                >\n                    {' '}\n                </span>\n                <span className={'c-pager__counterWrapper'}>\n                    <span className={'c-pager__counter-1'}>{wingo}</span>\n                    of\n                    <span className={'c-pager__counterMax'}>\n                        {props.pager.getMaxPage() + 1}\n                    </span>\n                </span>\n                <span\n                    onClick={nextPage}\n                    className={\n                        'icon u-icon__arrow3-right c-pagerIcon__buttonNext'\n                    }\n                >\n                    {' '}\n                </span>\n                <span\n                    onClick={lastPage}\n                    className={\n                        'icon u-icon__arrow-end-right c-pagerIcon__buttonLast'\n                    }\n                >\n                    {' '}\n                </span>\n            </div>\n            {props.loadingState ? <span> loading...</span> : <span></span>}\n            <div className={'c-featurePager__itemCount'}>\n                <span>Items per page:</span>\n                <NumericInput\n                    aria-label=\"Set number of items per page\"\n                    min={1}\n                    max={100}\n                    size={3}\n                    step={10}\n                    // style={{width: \"4em\"}}\n                    value={props.pager.getPageSize()}\n                    onChange={(ps) => {\n                        props.pager.setPageSize(ps);\n                    }}\n                    mobile={false}\n                    style={{\n                        'input.mobile': {\n                            border: '0px',\n                        },\n                        'btnUp.mobile': {},\n                    }}\n                />\n            </div>\n        </div>\n    );\n}\n\nFeaturePager.propTypes = {\n    pager: PropTypes.shape({\n        getPageSize: PropTypes.func,\n        getMaxPage: PropTypes.func,\n        getPage: PropTypes.func,\n        setPageSize: PropTypes.func,\n        setPage: PropTypes.func,\n    }),\n};\n","import Card from 'react-bootstrap/Card';\nimport Accordion from 'react-bootstrap/Accordion';\nimport Button from 'react-bootstrap/Button';\nimport Jumbotron from 'react-bootstrap/Jumbotron';\nimport { FeatureCard } from './FeatureCard/FeatureCard';\nimport React, { useEffect, useState } from 'react';\nimport Container from 'react-bootstrap/Container';\nimport CardDeck from 'react-bootstrap/CardDeck';\nimport { FeaturePager } from './FeaturePager/FeaturePager';\nimport Spinner from 'react-bootstrap/Spinner';\n\n// The length of the Rows at each Break Point\n// const BP_SIZES = {\n//    sm: 2,\n//    md: 3,\n//    lg: 4,\n//    xl: 6,\n// };\n\n// utility function to insert breakpoints\n/*\nfunction insertBreakPoints(i, BP_SIZES, ret) {\n    if (i !== 0) {\n        if (i % BP_SIZES.sm === 0) {\n            ret.push(\n                <div\n                    className=\"w-100 d-none d-sm-block d-md-none\"\n                    key={'sm' + i}\n                ></div>\n            );\n        }\n        if (i % BP_SIZES.md === 0) {\n            ret.push(\n                <div\n                    className=\"w-100 d-none d-md-block d-lg-none\"\n                    key={'md' + i}\n                ></div>\n            );\n        }\n        if (i % BP_SIZES.lg === 0) {\n            ret.push(\n                <div\n                    className=\"w-100 d-none d-lg-block d-xl-none\"\n                    key={'lq' + i}\n                ></div>\n            );\n        }\n        if (i % BP_SIZES.xl === 0) {\n            ret.push(\n                <div className=\"w-100 d-none d-xl-block\" key={'xl' + i}></div>\n            );\n        }\n    }\n}\n*/\n/**\n * Feature Deck : Returns a list of Feature Cards for creating galleries etc. Takes the following properties:\n *      docs : a list of solr asset records\n *      inline : boolean (meaning? render inline?)\n *      pager : a FeaturePager component or false for no pager\n *      loadingState : boolean (are we loading?)\n *      title : the title for the deck/gallery\n *\n * @param props : {object}\n * @returns {JSX.Element}\n * @constructor\n *\n * @author ys2n\n */\nexport function FeatureDeck(props) {\n    const shouldInline = (doc) => {\n        let inline = true;\n\n        if (props.inline === false) {\n            return false;\n        }\n        switch (doc.asset_type) {\n            case 'subjects':\n            case 'terms':\n            case 'places':\n                break;\n            default:\n                inline = true;\n        }\n        return inline;\n    };\n\n    const docs = props.docs;\n\n    let DEBUG_PRE = [];\n    let LIST = [];\n    if (docs) {\n        // console.log(\"FeatureDeck: looking at \", docs);\n        LIST = docs?.map((doc, i) => {\n            let ret = [];\n            const featureCard = (\n                <FeatureCard doc={doc} key={i} inline={shouldInline(doc)} />\n            );\n\n            // Insert breakpoints for various window sizes\n            //        insertBreakPoints(i, BP_SIZES, ret);\n            ret.push(featureCard);\n            return ret;\n        });\n\n        if (docs.length) {\n            //    let REMAINDER = rowFiller(LIST.length, BP_SIZES);\n            //    LIST.push(...REMAINDER);\n        } else {\n            LIST = (\n                <div className={'u-search__results__wrap'}>\n                    {props.loadingState ? (\n                        <Spinner animation=\"border\" role=\"status\">\n                            <span className=\"sr-only\">Loading...</span>\n                        </Spinner>\n                    ) : (\n                        <NoResults />\n                    )}\n                </div>\n            );\n        }\n        // console.log('FeatureDeck LIST = ', LIST);\n\n        DEBUG_PRE = (\n            <Accordion>\n                <Accordion.Toggle as={Button} eventKey=\"0\">\n                    Full JSON\n                </Accordion.Toggle>\n                <Accordion.Collapse eventKey=\"0\">\n                    <pre>{JSON.stringify(docs, undefined, 1)}</pre>\n                </Accordion.Collapse>\n            </Accordion>\n        );\n    }\n\n    const output = (\n        <React.Fragment>\n            <FeaturePager pager={props.pager} />\n            <CardDeck className={'c-card__grid'}>{LIST}</CardDeck>\n            <FeaturePager pager={props.pager} />\n        </React.Fragment>\n    );\n    return output;\n}\n\n/* utility function to fill the remaining spaces in the last row\nfunction rowFiller(length, bp_sizes) {\n    let remainderCards = [];\n    const maxLength = bp_sizes.xl;\n    const remainVisible = 'invisible';\n    for (let i = 0; i < maxLength; i++) {\n        let remClasses = ['m-1', 'p-2', 'd-none'];\n        for (let [type, size] of Object.entries(bp_sizes)) {\n            // console.log(`${type}: ${size}`);\n            if (length % size !== 0 && i < size - (length % size)) {\n                remClasses.push(`d-${type}-block ${remainVisible}`);\n            } else {\n                remClasses.push(`d-${type}-none`);\n            }\n        }\n        const remainderCard = (\n            <Card className={remClasses.join(' ')} key={'fill' + i}>\n            //    { for debugging}\n                <Card.Body>\n                    <pre>{remClasses.join('\\n')}</pre>\n                </Card.Body>\n            </Card>\n        );\n        remainderCards.push(remainderCard);\n    }\n    return remainderCards;\n}\n*/\n// TODO: deprecate FeatureGalleryHeaderLine\nfunction FeatureGalleryHeaderLine(props) {\n    if (props.title) {\n        return <h5 className={'sui-relatedHeader'}>{props.title}</h5>;\n    } else {\n        return null;\n    }\n}\n\nfunction NoResults(props) {\n    return (\n        <h2 className={'u-search__noresults__header'}>\n            No results. Your query yielded no results.\n        </h2>\n    );\n}\n","import React from 'react';\nimport { useQuery, queryCache } from 'react-query';\nimport axios from 'axios';\nimport jsonpAdapter from '../logic/axios-jsonp';\n\nconst solr_urls = getSolrUrls(process.env.NODE_ENV);\n\n/**\n *  \"queries\" object lists different queries by their key. Each query is an object defining:\n *      url: the base url for the query\n *      params: an object of named parameters and values for the query. Queries can have variables,\n *              _DOMAIN_ for the domain placeholder, and _KID_ for the kmaps ID placeholder\n *      dataFilter: is a function that takes the raw data returned from axios and filters it in a custom way\n *                  to return the desired portion of the result.\n */\nconst queries = {\n    info: {\n        url: solr_urls.terms,\n        params: {\n            q: 'uid:_DOMAIN_-_KID_',\n            fl: '*',\n        },\n        dataFilter: function (data) {\n            return data.response && data.response.numFound > 0\n                ? data.response.docs[0]\n                : false;\n        },\n    },\n    related: {\n        url: solr_urls.assets,\n        params: {\n            q: 'kmapid:_DOMAIN_-_KID_',\n            start: '0',\n            facets: 'on',\n            group: 'true',\n            'group.field': 'asset_type',\n            'group.ngroups': 'true',\n            'group.limit': '0',\n        },\n        dataFilter: function (data) {\n            return data.grouped && data.grouped.asset_type\n                ? data.grouped.asset_type.groups\n                : false;\n        },\n    },\n};\n\nconst getKmapData = async (_, { qtype, domain, kid }) => {\n    // console.log(\"getKmapData \", _, qtype, domain, kid);\n\n    // ys2n:\n    // Need to copy this way to prevent overwriting the templates in queries\n    // Can't use deep JSON copy because that doesn't copy functions.\n    const query = { ...queries[qtype] }; // shallow copy\n    query.params = { ...query.params }; // deeper copy of params\n\n    for (let key in query.params) {\n        query.params[key] = query.params[key]\n            .replace('_DOMAIN_', domain)\n            .replace('_KID_', kid);\n    }\n    // Most kmap queries are wt=json. So added here by default.\n    let myparams = query.params;\n    if (!('wt' in myparams)) {\n        myparams['wt'] = 'json';\n    }\n\n    const request = {\n        adapter: jsonpAdapter,\n        callbackParamName: 'json.wrf',\n        url: query.url,\n        params: myparams,\n        transformResponse: function (data) {\n            const filtered_data = query.dataFilter(data);\n            return filtered_data ? filtered_data : data;\n        },\n    };\n    const { data } = await axios.request(request);\n    // console.log(\"Axios request params = \", myparams);\n    // console.log('Axios request/response = ', request, data);\n    return data;\n};\n\n/**\n * useKmap is a custom React Hook implementing useQuery from react-query to query SOLR indices for information concerning\n * kmaps subjects, places, and terms. The types of queries are defined in the \"queries\" object above.\n *\n * @param domain\n * @param kid\n * @param query_type\n * @returns {any}\n */\nexport function useKmap(domain, kid, query_type) {\n    // console.log(\"useKmap: domain = \", domain, \" kid = \", kid, \" query_type = \",  query_type );\n    query_type = typeof query_type === 'undefined' ? 'info' : query_type;\n    return useQuery(\n        ['kmap', { qtype: query_type, domain: domain, kid: kid }],\n        getKmapData\n    );\n}\n\n/**\n * A function to get the proper Solr base URL for the current environment.\n * Returns an object with both an assets and a terms property that contains the base url to that index\n * for the given environment. Uses environment variables set by .env files for each environment\n * @param env\n * @returns {{assets: string, terms: string}}\n */\nfunction getSolrUrls(env) {\n    return {\n        assets: process.env.REACT_APP_SOLR_KMASSETS + '/select',\n        terms: process.env.REACT_APP_SOLR_KMTERMS + '/select',\n    };\n}\n","import React, { useRef, useState } from 'react';\nimport { useKmap } from '../../hooks/useKmap';\n// import { ReactQueryDevtools } from 'react-query-devtools';\nimport { Overlay, Popover, Container, Col, Row } from 'react-bootstrap';\n\n/**\n * Mandala popover is component that displays a kmap term with the popover icon that shows the popover on hover.\n * It takes three properties:\n *      domain: The kmap domain--subjects, places, terms\n *      kid: The numberic kmaps id for the item in that domain\n *      placement: (optional) where to place the popover relative to the icon, defaults to 'below'.\n *                 Other values are: 'top', 'right', and 'left'.\n *\n *      Example:   <MandalaPopover\n *                      domain=\"subjects\"\n *                      kid=\"8260\"\n *                  />\n *\n *  Styling instructions for Popovers are in: ./views/css/Popover.scss which is included by call in App.js\n * @param props\n * @returns {*}\n * @constructor\n */\nexport function MandalaPopover(props) {\n    //console.log(\"mandala popover props\", props);\n    // Basic Hooks\n    const [show, setShow] = useState(false);\n    const target = useRef(null);\n\n    // Props\n    const domain = props.domain;\n    const kid = props.kid;\n    const placement = props.placement ? props.placement : 'bottom';\n    const kmkey = props.mykey;\n\n    // Query Custom Hooks (see hooks/useKmaps.js)\n    // Info for Kmap Itself: kmapRes\n    const {\n        isLoading: kmapIsLoading,\n        isError: kmapIsError,\n        data: kmapRes,\n        error: kmapError,\n    } = useKmap(domain, kid, 'info');\n\n    // Info of Related Kmaps/Assets: relRes\n    const {\n        isLoading: relIsLoading,\n        isError: relIsError,\n        data: relRes,\n        error: relError,\n    } = useKmap(domain, kid, 'related');\n\n    if (kmapIsLoading || relIsLoading) {\n        return <span>Loading ....</span>;\n    }\n    if (kmapIsError || relIsError) {\n        console.error(kmapIsError ? kmapError : relError);\n        return <span className={'red'}>Error occurred ....</span>;\n    }\n    //console.log('kmapdata', kmapRes);\n    const kmapdata = kmapRes;\n    const related = relRes;\n\n    if (!kmapdata || !related) {\n        return <>No data!</>;\n    }\n    const isTib = kmapdata.tree == 'terms' && kmapdata.name_tibt;\n    const myhead = isTib ? kmapdata.name_tibt[0] : kmapdata.header;\n    let popoverLabel = '';\n    if (props.children) {\n        popoverLabel = (\n            <span\n                className=\"popover-link-custom\"\n                ref={target}\n                onMouseOver={() => setShow(true)}\n                onMouseOut={() => setShow(false)}\n            >\n                {props.children}\n            </span>\n        );\n    } else {\n        popoverLabel = (\n            <>\n                <span className={isTib ? 'u-bo' : ''}>{myhead}</span>\n                <span\n                    className=\"popover-link\"\n                    ref={target}\n                    onMouseOver={() => setShow(true)}\n                    onMouseOut={() => setShow(false)}\n                >\n                    <span className=\"icon u-icon__kmaps-popover\" />\n                </span>\n            </>\n        );\n    }\n    // JSX\n    return (\n        <span\n            key={kmkey}\n            className=\"kmap-tag-group processed\"\n            data-kmdomain={domain}\n            data-kmid={kid}\n        >\n            {popoverLabel}\n            <Overlay target={target.current} show={show} placement={placement}>\n                <Popover\n                    data-kmid={kid}\n                    className={'related-resources-popover processed'}\n                    onMouseOver={() => setShow(true)}\n                    onMouseOut={() => setShow(false)}\n                >\n                    <Popover.Title as=\"h5\" className={isTib ? 'bo' : ''}>\n                        {myhead} <span className={'kmid'}>{kid}</span>\n                    </Popover.Title>\n                    <Popover.Content>\n                        <MandalaPopoverBody\n                            domain={domain}\n                            kid={kid}\n                            info={kmapdata}\n                            related={related}\n                        />\n                    </Popover.Content>\n                </Popover>\n            </Overlay>\n        </span>\n    );\n}\n\nfunction MandalaPopoverBody(props) {\n    const kminfo = props.info;\n    //console.log(kminfo);\n    const related = props.related;\n    // Sort related by Asset/Kmap type (groupValue)\n    related.sort((a, b) => {\n        const alabel = a.groupValue;\n        const blabel = b.groupValue;\n        if (alabel < blabel) {\n            return -1;\n        }\n        if (alabel > blabel) {\n            return 1;\n        }\n        return 0;\n    });\n    const domain = props.domain;\n    const kid = props.kid;\n    const caption =\n        kminfo.caption_eng && kminfo.caption_eng.length > 0\n            ? kminfo.caption_eng[0].replace(/<\\/?p>/g, '') + ' '\n            : '';\n    const pubfolder = process.env.PUBLIC_URL;\n    const mandala_base = pubfolder; // TODO: Check if this needs to change?\n    const kmap_item_page =\n        mandala_base + '/' + domain + '/' + domain + '-' + kid;\n\n    // Feature types\n    let featuretypes = '';\n    if (kminfo.feature_type_ids && kminfo.feature_type_ids.length > 0) {\n        featuretypes = (\n            <div className=\"other featuretypes clearfix\">\n                <p>\n                    <strong>Feature Type</strong>\n                    {kminfo.feature_type_ids.map((item, index) => {\n                        const url = mandala_base + '/subjects/subjects-' + item;\n                        return (\n                            <>\n                                <a href={url}>{kminfo.feature_types[index]}</a>\n                            </>\n                        );\n                    })}\n                </p>\n            </div>\n        );\n    }\n\n    // Ancestors\n    let ancestors = '';\n    const ancestor_ids =\n        kminfo.tree == 'terms' && kminfo['ancestor_ids_tib.alpha']\n            ? kminfo['ancestor_ids_tib.alpha']\n            : kminfo.ancestor_ids_generic;\n    const ancestor_labels =\n        kminfo.tree == 'terms' && kminfo['ancestors_tib.alpha']\n            ? kminfo['ancestors_tib.alpha']\n            : kminfo.ancestors;\n    if (ancestor_ids && ancestor_ids.length > 1) {\n        const anclabel = kminfo.tree[0].toUpperCase() + kminfo.tree.substr(1);\n        ancestors = (\n            <div className=\"parents clearfix\">\n                <p>\n                    <strong>{anclabel}</strong>&nbsp;\n                    {ancestor_ids.map((aid, index) => {\n                        if (index == ancestor_ids.length - 1) {\n                            return;\n                        } // Don't show self in ancestry list\n                        const aurl =\n                            mandala_base +\n                            '/' +\n                            kminfo.tree +\n                            '/' +\n                            kminfo.tree +\n                            '-' +\n                            aid;\n                        const label = ancestor_labels[index];\n                        const akey = 'akey-' + aid + '-' + index;\n                        return (\n                            <a key={akey} href={aurl}>\n                                {label}\n                            </a>\n                        );\n                    })}\n                </p>\n            </div>\n        );\n    }\n\n    // Term Information\n    let term_info = '';\n    if (kminfo.tree == 'terms' && kminfo.associated_subject_ids) {\n        term_info = (\n            <>\n                <div className=\"other\">\n                    <strong>Wylie</strong>\n                    {kminfo.header}\n                </div>\n                <div className=\"termtypes\">\n                    {kminfo.associated_subject_ids.map((item, n) => {\n                        const myurl =\n                            mandala_base + '/subjects/subjects-' + item;\n                        return (\n                            <a href={myurl}>{kminfo.associated_subjects[n]}</a>\n                        );\n                    })}\n                </div>\n            </>\n        );\n    }\n\n    // Related Tabs\n    let related_tabs = (\n        <>\n            {related.map((item, index) => {\n                const assettype = item.groupValue;\n                if (assettype == 'texts:pages') {\n                    return;\n                }\n                const myurl =\n                    kmap_item_page + '/related-' + assettype + '/deck';\n                const label =\n                    'Related ' +\n                    assettype[0].toUpperCase() +\n                    assettype.substr(1).replace('-v', ' V').replace('-', ' ');\n                const iconclass = 'icon u-icon__' + assettype;\n                return (\n                    <div className=\"popover-footer-button\">\n                        <a href={myurl} className={iconclass}>\n                            {label} ({item.doclist.numFound})\n                        </a>\n                    </div>\n                );\n            })}\n        </>\n    );\n\n    // Return JSX Markup for popover body\n    return (\n        <div className={'react-popover-body'}>\n            <span className=\"kmdomain\">{domain}</span>\n            <span className=\"kmid\">{kid}</span>\n            <div className=\"popover-body\">\n                {term_info}\n                <div className=\"desc\">\n                    {caption}\n                    For more information about this term, see Full Entry below.\n                </div>\n                {featuretypes}\n                {ancestors}\n            </div>\n            <div className=\"popover-footer\">\n                <div className=\"popover-footer-button\">\n                    <a\n                        className=\"icon u-icon__link-external\"\n                        href={kmap_item_page}\n                    >\n                        Full Entry\n                    </a>\n                </div>\n                {related_tabs}\n            </div>\n        </div>\n    );\n}\n\n/**\n * A test function returned from the path in ContentMain.js. Path is: /poptest/{domain}/{kid}\n *\n * @param props\n * @returns {*}\n * @constructor\n */\nexport function MandalaPopoverTest(props) {\n    const domain = props.match.params.dom;\n    const kid = props.match.params.kid;\n    const kdata = useKmap(domain, kid, 'info');\n    const kmapdata = JSON.stringify(kdata, null, 4);\n    const placement = props.placement ? props.placement : 'bottom';\n    const testdivstyle = {\n        margin: '20px',\n        border: 'thin dashed green',\n        padding: '15px',\n        backgroundColor: '#e1eff3',\n        maxWidth: '98vw',\n    };\n    const base_url = process.env.PUBLIC_URL + '/poptest/{}';\n    return (\n        <>\n            <Container fluid id={'mptestdiv'} style={testdivstyle}>\n                <Row>\n                    <h1 style={{ marginLeft: '10px' }}>\n                        Mandala Popover React Test\n                    </h1>\n                </Row>\n                <Row>\n                    <Col md={'4'}>\n                        <p>\n                            We’re rolling along in the text, when we cite a kamp\n                            term,\n                            <MandalaPopover\n                                domain={domain}\n                                kid={kid}\n                                placement={placement}\n                            />{' '}\n                            Magnis turpis inceptos nostrud malesuada, faucibus\n                            excepteur modi laboriosam, commodi suscipit viverra?\n                        </p>\n                        <p>\n                            Now this is the mandala inline popover test:{' '}\n                            <MandalaPopover\n                                domain={'subjects'}\n                                kid={'442'}\n                                placement={placement}\n                            >\n                                <PopTestComp label={'Bologna'} type={'fire'} />\n                            </MandalaPopover>{' '}\n                            The whale has no famous author, and whaling no\n                            famous chronicler, you will say.{' '}\n                            <MandalaPopover\n                                domain={'subjects'}\n                                kid={'4481'}\n                                placement={'top'}\n                            >\n                                <PopTestComp\n                                    label={'housewife'}\n                                    type={'zelda'}\n                                />\n                            </MandalaPopover>{' '}\n                            The Pequod had now swept so nigh to the stranger,\n                            that Stubb vowed he recognised his cutting\n                            spade-pole entangled in the lines that were knotted\n                            round the tail of one of these whales.{' '}\n                            <MandalaPopover\n                                domain={'subjects'}\n                                kid={'2191'}\n                                placement={'right'}\n                            >\n                                <PopTestComp\n                                    label={'what’s right?'}\n                                    type={'tree'}\n                                />\n                            </MandalaPopover>{' '}\n                        </p>\n                        <p>\n                            Faucibus excepteur modi laboriosam, commodi suscipit\n                            viverra?\n                            <MandalaPopover\n                                domain={'terms'}\n                                kid={'85193'}\n                                placement={'top'}\n                            />{' '}\n                            Duis amet. Suspendisse numquam? Incididunt mollitia,\n                            perspiciatis penatibus.\n                        </p>\n                        <p>Other well-known kmaps:</p>\n                        <ul>\n                            <li>\n                                <a href={base_url.replace('{}', 'places/637')}>\n                                    Lhasa\n                                </a>\n                            </li>\n                            <li>\n                                <a\n                                    href={base_url.replace(\n                                        '{}',\n                                        'subjects/8260'\n                                    )}\n                                >\n                                    Bhutan Cultural Library\n                                </a>\n                            </li>\n                            <li>\n                                <a\n                                    href={base_url.replace('{}', 'terms/85193')}\n                                    className={'bo'}\n                                >\n                                    ཐོད་རྒལ་\n                                </a>\n                            </li>\n                        </ul>\n                    </Col>\n                    <Col md={'8'}>\n                        <button\n                            id=\"showbutt\"\n                            onClick={() => {\n                                const me = document.getElementById('showbutt');\n                                const prel = document.getElementById('precode');\n                                if (prel.style.display == 'none') {\n                                    prel.style.display = 'block';\n                                    me.innerText = 'Hide Kmaps Data';\n                                } else {\n                                    prel.style.display = 'none';\n                                    me.innerText = 'Show Kmaps Data';\n                                }\n                            }}\n                        >\n                            Show Kmaps Data\n                        </button>\n                        <pre\n                            id=\"precode\"\n                            style={{\n                                display: 'none',\n                                border: 'thick outset lightblue',\n                                padding: '10px',\n                                backgroundColor: 'white',\n                                fontFamily: 'verdana',\n                                fontSize: '10pt',\n                            }}\n                        >\n                            {kmapdata}\n                        </pre>\n                    </Col>\n                </Row>\n            </Container>\n            {/* <ReactQueryDevtools initialIsOpen />*/}\n        </>\n    );\n}\n\nfunction PopTestComp(props) {\n    const label = props.label;\n    const imgs = {\n        rose: 'https://www.gstatic.com/webp/gallery3/1.sm.png',\n        fire: 'https://www.gstatic.com/webp/gallery/5.sm.jpg',\n        valley: 'https://www.gstatic.com/webp/gallery/1.sm.jpg',\n        rapids: 'https://www.gstatic.com/webp/gallery/2.sm.jpg',\n        peppers: 'https://homepages.cae.wisc.edu/~ece533/images/peppers.png',\n        zelda: 'https://homepages.cae.wisc.edu/~ece533/images/zelda.png',\n        tree: 'https://www.gstatic.com/webp/gallery/4.sm.jpg',\n        error:\n            'https://cdn.freshdesignweb.com/wp-content/uploads/site/Free-404-Error-Page-Responsive-website-Template.jpg',\n    };\n    const imgtype = props.type in imgs ? props.type : 'error';\n\n    return (\n        <div className={'inline'}>\n            <span\n                style={{\n                    fontStyle: 'italic',\n                    color: 'blue',\n                    paddingRight: '2px',\n                }}\n            >\n                {label}\n            </span>\n            <img\n                src={imgs[imgtype]}\n                style={{\n                    height: '80px',\n                    display: 'inline',\n                }}\n            />\n        </div>\n    );\n}\n","import React, { useEffect, useState } from 'react';\nimport Button from 'react-bootstrap/Button';\nimport Modal from 'react-bootstrap/Modal';\n\n/**\n * A component to show external links in situ with a React-Bootstrap modal. The modal shows the content in an\n * IFrame and has a \"Go\" and \"Done\" button. \"Go\" opens the url in a new window. \"Done\" and the X in the upper\n * right corner closes the modal. The component takes the following properties/attributes:\n *    url: The url in question\n *    gourl: (optional) the url to link to if the \"Go\" If a site has a different url for embedding\n *           in an IFrame than when on it's own page. (For instance, YouTube uses \"/embed/\" in its path\n *           when videos are embedded, though that case is built into the code here)\n *     text: The content/text for the link to open the modal, e.g. \"Watch my video!\"\n *    title: (optional) text for an optional title attribute for the link\n * @param props\n * @returns {JSX.Element}\n * @constructor\n */\nexport function MandalaModal(props) {\n    let myurl = props.url;\n    let gotourl = props.gourl ? props.gourl : myurl;\n    if (myurl.indexOf('youtube.com') > -1) {\n        myurl = myurl.replace('watch?v=', 'embed/');\n        if (myurl.indexOf('&t') > -1) {\n            myurl = myurl.replace('&t', '?start');\n            myurl = myurl.substring(0, myurl.length - 1);\n        }\n    }\n\n    const mytext = props.text;\n    const title = props.title ? props.title : 'External Link';\n\n    const [show, setShow] = useState(false);\n    const handleClose = () => setShow(false);\n    const handleShow = () => setShow(true);\n\n    return (\n        <>\n            <a\n                className={'mandala-modal'}\n                data-original-url={myurl}\n                href={'#'}\n                onClick={handleShow}\n            >\n                {mytext}\n            </a>\n\n            <Modal\n                size={'xl'}\n                show={show}\n                onHide={handleClose}\n                backdrop=\"static\"\n                keyboard={false}\n            >\n                <Modal.Header closeButton>\n                    <Modal.Title>External Link: “{title}”</Modal.Title>\n                </Modal.Header>\n                <Modal.Body>\n                    <iframe className={'mdlmodal'} src={myurl}></iframe>\n                </Modal.Body>\n                <Modal.Footer>\n                    <a href={gotourl} target={'_blank'}>\n                        <Button variant=\"success\">Go</Button>\n                    </a>\n                    <Button variant=\"primary\" onClick={handleClose}>\n                        Done\n                    </Button>\n                </Modal.Footer>\n            </Modal>\n        </>\n    );\n}\n","import React from 'react';\nimport { useQuery, queryCache } from 'react-query';\nimport axios from 'axios';\nimport jsonpAdapter from '../logic/axios-jsonp';\n// import { ReactQueryDevtools } from 'react-query-devtools';\n\nconst solrurls = {\n    assets: process.env.REACT_APP_SOLR_KMASSETS + '/select',\n    terms: process.env.REACT_APP_SOLR_KMTERMS + '/select',\n};\n\n/**\n * A async function to perform a solr query provided a query object. The query object needs to have the following properties:\n *      index: (assets|terms),\n *      params: name-value pairs for params for the query\n * For an example, see the useAsset hook\n *\n * @param _\n * @param query\n * @returns {Promise<any>}\n */\nconst getSolrData = async (_, { query }) => {\n    if (!(query.index in solrurls) || !query.params) {\n        console.warn(\n            'The query object sent to useSolr() did not have proper index or params values: ',\n            query\n        );\n        return false;\n    }\n\n    let myparams = query.params;\n    if (!('wt' in myparams)) {\n        myparams['wt'] = 'json';\n    }\n\n    const request = {\n        adapter: jsonpAdapter,\n        callbackParamName: 'json.wrf',\n        url: solrurls[query.index],\n        params: myparams,\n    };\n    const { data } = await axios.request(request);\n    const retdata = data && data.response ? data.response : data;\n\n    return retdata;\n};\n\n/**\n * UseSolr : hook for solr queries\n *\n * @param qkey\n * @param queryobj\n * @returns {any}\n */\nexport function useSolr(qkey, queryobj) {\n    // console.log(\"useSolr: qkey = \", qkey, \" queryobj = \", queryobj);\n    const res = useQuery([qkey, { query: queryobj }], getSolrData);\n    // console.log(\"useSolr: res = \", res);\n    if (res && res.data) {\n        res.data['status'] = res.status; // Add the result status ('loading', 'success') to the data object returned. Used in GenAssetContext\n        return res.data;\n    }\n    return false;\n}\n\n/**\n * UseSolr : hook for solr queries\n *\n * @param qkey\n * @param queryobj\n * @param depvar\n * @returns {any}\n */\nexport function useSolrEnabled(qkey, queryobj, depvar) {\n    const res = useQuery([qkey, { query: queryobj }], getSolrData, {\n        enabled: depvar,\n    });\n    if (res && res.data) {\n        res.data['status'] = res.status;\n        return res.data;\n    }\n    return false;\n}\n\n/**\n * Example of chained, dependent queries with the useSolr() and useSolrEnabled() hook.\n * Finds record for place with header \"Lhasa\" and ADM3, then with its kmap ID finds all\n * assets tagged with that place.\n *\n * @param props\n * @returns {JSX.Element}\n * @constructor\n */\nfunction TestComp(props) {\n    const testquery = {\n        index: 'terms',\n        params: {\n            q: 'header:Lhasa AND tree:places AND feature_types:ADM3',\n            rows: 1,\n        },\n    };\n    const res1 = useSolr('tqry', testquery);\n    let { numFound, start, docs } = res1\n        ? res1\n        : { numFound: 0, start: 0, docs: [] };\n    const kmapid = docs && docs.length > 0 ? docs[0].id : false;\n\n    const q2 = {\n        index: 'assets',\n        params: {\n            q: 'kmapid:' + kmapid,\n            fl: 'id,uid',\n            rows: 25,\n        },\n    };\n    const results = useSolrEnabled('newtsq', q2, res1);\n\n    let nf = '?';\n    let adocs = [];\n    if (results) {\n        console.log('res data', results);\n        nf = results.numFound;\n        adocs = JSON.stringify(results.docs, null, 2);\n    }\n    return (\n        <>\n            <p>\n                Lhasa's kmid is: {kmapid}. Found {nf} assets connected with it:{' '}\n            </p>\n            <pre>{adocs}</pre>\n        </>\n    );\n}\n","import React, { useEffect, useState } from 'react';\nimport ReactHtmlParser, { convertNodeToElement } from 'react-html-parser';\nimport { MandalaPopover } from './MandalaPopover';\nimport { MandalaModal } from './MandalaModal';\nimport { useSolr, useSolrEnabled } from '../../hooks/useSolr';\nimport $ from 'jquery';\n\n/**\n * The transform function sent to ReactHtmlParse for converting raw HTML into React Components\n * Used to:\n *    1) convert old popover html to MandalaPopover component and\n *    2) ferret out links in the HTML and if they are internal to mandala convert them to\n *       properly pathed internal links in same window using MandalaLink and MandalaPathDecoder\n *       or if external, either display in modal if the site permits it (using MandalaModal)\n *       or, if not, then opens in a new window with target attribute.\n *\n * @param node\n * @param index\n */\nfunction transform(node, index) {\n    // Process Popover Links in Mandala Markup\n    if (node.attribs && node.attribs['class'] === 'kmap-tag-group') {\n        const kmpdom = node.attribs['data-kmdomain'];\n        const kmpid = node.attribs['data-kmid'];\n        return <MandalaPopover domain={kmpdom} kid={kmpid} />;\n    }\n    // Process popover icon imgs to convert to mandala popovers\n    else if (\n        node.name === 'img' &&\n        node.attribs &&\n        node.attribs['class'] &&\n        node.attribs['class'] === 'popover-icon' &&\n        node.attribs['onmouseenter']\n    ) {\n        let mtchs = node.attribs['onmouseenter'].match(\n            /(places|subjects|terms)\\-(\\d+)/\n        );\n        if (mtchs) {\n            node.prev.data = '';\n            return <MandalaPopover domain={mtchs[1]} kid={mtchs[2]} />;\n        } else {\n            return null;\n        }\n    }\n\n    // Find text preceding popover icon and remove it, since MandalaPopover provides its own text by default\n    else if (\n        node.type === 'text' &&\n        node.next &&\n        node.next.attribs &&\n        node.next.attribs['class'] &&\n        node.next.attribs['class'] === 'popover-icon'\n    ) {\n        // In Bill's code text preceded by two spaces\n        return ReactHtmlParser('&nbsp;&nbsp;');\n    }\n\n    // Process External Links in Mandala Markup to turn into Modals or Internal links TODO: Process internal Mandala links\n    else if (\n        node.name &&\n        node.name === 'a' &&\n        node.attribs &&\n        node.attribs['href']\n    ) {\n        let linkurl = node.attribs['href'];\n        let mandalaid =\n            typeof node.attribs['data-mandala-id'] === 'undefined'\n                ? false\n                : node.attribs['data-mandala-id'];\n\n        let linkcontents = [];\n        for (let n in node.children) {\n            linkcontents.push(\n                convertNodeToElement(node.children[n], index, transform)\n            );\n        }\n        let mytitle = node.attribs['title'] ? node.attribs['title'] : false;\n        if (mytitle === false) {\n            mytitle =\n                typeof linkcontents[0] === 'string'\n                    ? linkcontents[0].split(':')[0]\n                    : 'No title';\n        }\n        const blocked = isBlockedUrl(linkurl);\n\n        if (linkurl[0] === '#') {\n            return;\n        } else if (mandalaid) {\n            return <MandalaLink mid={mandalaid} contents={linkcontents} />;\n        } else if (\n            !linkurl.includes('https://mandala') &&\n            (linkurl[0] === '/' || linkurl.includes('shanti.virginia.edu'))\n        ) {\n            const path = linkurl.replace(/https?\\:\\/\\//, '').split('?')[0];\n            let pathparts = path.split('/');\n            const domain = pathparts[0].includes('.shanti.virginia')\n                ? pathparts.shift()\n                : false;\n            const mtch =\n                domain && typeof domain == 'string'\n                    ? domain.match(/(audio-video|images|sources|texts|visuals)/)\n                    : false;\n            // if only one part to the path, it's most likely not a resource but a Drupal page/view so must use modal\n            // or if a mandala app name is not in domain.\n            if (pathparts.length == 1 || !mtch) {\n                return (\n                    <MandalaModal\n                        url={linkurl}\n                        title={mytitle}\n                        text={linkcontents}\n                    />\n                );\n            }\n            //const app = mtch[0];\n            const asset_path = pathparts.join('/');\n            return (\n                <MandalaPathDecoder\n                    mpath={asset_path}\n                    url={linkurl}\n                    title={mytitle}\n                    contents={linkcontents}\n                />\n            );\n        } else if (blocked) {\n            return (\n                <a href={linkurl} target={'_blank'}>\n                    {linkcontents}\n                </a>\n            );\n        } else if (linkurl.search(/(subjects|places|terms)\\/\\d+/) == -1) {\n            // Don't process links in popovers\n            return (\n                <MandalaModal\n                    url={linkurl}\n                    title={mytitle}\n                    text={linkcontents}\n                />\n            );\n        }\n    }\n}\n\n/**\n * a function that determines which urls are allowed to show in modal windows instead of new window\n *\n * @param lnkurl\n * @returns {boolean} : returns true if blocked from showing in modal\n */\nfunction isBlockedUrl(lnkurl) {\n    // ToDo: Check if there's a way to ping a url to see if it allows Iframing?\n    // List of allowed domains for modal popups\n    const allowed = ['.virginia.edu', 'youtube.com', 'vimeo.com'];\n    for (let n in allowed) {\n        let domstr = allowed[n];\n        if (lnkurl.includes(domstr)) {\n            return false;\n        }\n    }\n    return true;\n}\n\n/**\n * Custom function to converts HTML from a Mandala App API into React Component using the MandalaPopover component for Popovers\n *\n * @param props\n * @returns {*}\n * @constructor\n */\nexport function HtmlWithPopovers(props) {\n    const htmlInput = props.markup ? props.markup : '<div></div>';\n    const options = {\n        decodeEntities: true,\n        transform,\n    };\n\n    return <>{ReactHtmlParser(htmlInput, options)}</>;\n}\n\n/**\n * General implementation of ReactHTMLParser that allows one to call it with a custom options including a custom\n * transformer or no options. Does not process Mandala Popovers.\n *\n * @param props\n * @returns {JSX.Element}\n * @constructor\n */\nexport function HtmlCustom(props) {\n    const htmlInput = props.markup ? props.markup : '<div></div>';\n    const options = props.options ? props.options : {};\n    if (options && !options.decodeEntities) {\n        options.decodeEntities = true;\n    }\n    return <>{ReactHtmlParser(htmlInput, options)}</>;\n}\n\nfunction MandalaLink(props) {\n    const mid = props.mid;\n    const children = props.contents;\n    let newurl = process.env.PUBLIC_URL + '/';\n    if (mid.includes('-collection-')) {\n        newurl += mid.replace('-collection-', '-collection/');\n    } else {\n        newurl += mid.replace(/\\-/g, '/').replace('audio/video', 'audio-video');\n    }\n    return (\n        <a href={newurl} data-mandala-id={mid}>\n            {children}\n        </a>\n    );\n}\n\n/**\n * Functional Component for in-Mandala links attempt to search for alias in SOLR and if found\n * returns a link within react to app/id.\n *\n * @param props\n * @returns {JSX.Element}\n * @constructor\n */\nfunction MandalaPathDecoder(props) {\n    const asset_path = props.mpath;\n    const qobj = {\n        index: 'assets',\n        params: {\n            q: 'url_html:\"' + asset_path + '\"',\n            fl: 'asset_type,id',\n        },\n    };\n    const asset = useSolr(asset_path, qobj);\n    if (asset && asset.docs && asset.docs.length > 0) {\n        const { asset_type, id } = asset.docs[0];\n        if (asset_type && id) {\n            const newpath =\n                process.env.PUBLIC_URL + '/' + asset_type + '/' + id;\n            return (\n                <a\n                    href={newpath}\n                    title={props.title}\n                    data-original-url={props.url}\n                >\n                    {props.contents}\n                </a>\n            );\n        }\n    }\n    return (\n        <MandalaModal\n            url={props.url}\n            title={props.title}\n            text={props.contents}\n        />\n    );\n}\n\nexport function getRandomKey(txt) {\n    const suff = txt ? txt : Math.floor(Math.random() * 10 ** 15).toString(16);\n    return Math.floor(Math.random() * 10 ** 15).toString(16) + suff;\n}\n","import React, { useEffect, useState } from 'react';\nimport useStatus from '../../hooks/useStatus';\nimport axios from 'axios';\nimport jsonpAdapter from '../../logic/axios-jsonp';\nimport { Tabs, Tab } from 'react-bootstrap';\nimport './AVViewer.css';\nimport $ from 'jquery';\nimport { FeatureDeck } from '../common/FeatureDeck';\nimport { convertNodeToElement } from 'react-html-parser';\nimport { HtmlWithPopovers, HtmlCustom } from '../common/MandalaMarkup';\n\n/**\n * AudioVideoViewer is called from ContentMain.js and is wrapped in a MdlAssetContext that supplies it with a SOLR\n * record for the AV asset being viewed. It creates a single div#av-viewer inside of the #u-wrapContent__searchResults div\n *\n * The AudioVideoViewer has two children representing the two rows of the Bootstrap container:\n *      1. AudioVideoPlayer: This component defined below displays the video play and transcript in a single row,\n *      2. AudioVideoMeta: This component also defined below displays a row with the tabbed metadata information for the video.\n *\n * The AudioVideoMeta displays two tabs: an info tab with the fields labels and information and a related AV assets tab\n * which has a gallery of related AV assets.\n *\n * @param props\n * @returns {JSX.Element}\n * @constructor\n * @author ndg8f\n */\nexport function AudioVideoViewer(props) {\n    const id = props.id;\n    const kmasset = props.mdlasset;\n    const nodejson = props.nodejson;\n    const sui = props.sui;\n    const base_path = process.env.PUBLIC_URL;\n    const ismain = props.ismain ? props.ismain : false; // set to true when the av viewer is the main component on the page\n\n    const [playerDrawn, setPlayerDrawn] = useState(false);\n    const status = useStatus();\n\n    // Do Status Stuff (Title and Breadcrumbs)\n    if (kmasset && ismain) {\n        status.setType('audio-video');\n        // Set the Title\n        const mytitle =\n            kmasset.title && kmasset.title.length > 0 ? kmasset.title[0] : '';\n        status.setHeaderTitle(mytitle);\n\n        // Set the Breadcrumbs\n        let c = 2;\n        let bcrumbs = [\n            <a key=\"bc1\" href={base_path + '/audio-video'}>\n                Audio-Video\n            </a>,\n        ];\n        if (\n            kmasset.collection_title_path_ss &&\n            kmasset.collection_title_path_ss.length > 0\n        ) {\n            for (\n                var bcn = 0;\n                bcn < kmasset.collection_title_path_ss.length;\n                bcn++\n            ) {\n                c++;\n                const colltitle = kmasset.collection_title_path_ss[bcn];\n                const collpath =\n                    base_path +\n                    '/' +\n                    kmasset.collection_uid_path_ss[bcn].replace(\n                        'audio-video-collection-',\n                        'audio-video-collection/'\n                    );\n                let bc = (\n                    <a key={'bc' + c} href={collpath}>\n                        {colltitle}\n                    </a>\n                );\n                bcrumbs.push(bc);\n            }\n            c++;\n            const mytitle =\n                kmasset.title && kmasset.title.length > 0\n                    ? kmasset.title[0]\n                    : kmasset.caption;\n            let selfbc = (\n                <a key={'bc' + c} className={'self'} name={'selflink'}>\n                    {mytitle}\n                </a>\n            );\n            bcrumbs.push(selfbc);\n            status.setSubTitle(bcrumbs);\n        }\n    }\n\n    // TODO: is this necessary? Are there situations where it's better to hide the extra content? Need to hide if there is no extra content.\n    useEffect(() => {\n        $('body').on('click', 'a.sui-avMore2', function () {\n            $('#sui-avlang').toggle();\n            this.text = this.text == 'SHOW MORE' ? 'SHOW LESS' : 'SHOW MORE';\n        });\n        $('#l-site__wrap').addClass('av');\n    }, []);\n\n    // Effect to Draw AV player once kmasset and nodejson return\n    useEffect(() => {\n        if (kmasset && nodejson) {\n            // Should only redraw if kmasset and nodejson change but redrawns on some clicks\n            // So created a state variable playerDrawn so it doesn't redraw the player\n            if (!playerDrawn) {\n                sui.av.DrawPlayer(kmasset, nodejson);\n                window.sui = sui;\n                setPlayerDrawn(true);\n            }\n        }\n    }, [kmasset, nodejson]); // Depend on kmasset and nodejson\n\n    // Return the av-viewer div with div for Bill's drawing of AV player and AV metadata\n    return (\n        <div id={'av-viewer'}>\n            <div id={'sui-av'}>Loading ...</div>\n            <AudioVideoMeta id={id} asset={kmasset} sui={sui} node={nodejson} />\n        </div>\n    );\n}\n\n/**\n * A component to show two bootstrap tabs for \"Details\" and \"Related\". The Details tab is populated by Bill's code audiovideo.js\n * A need function, DrawMetaNew has been added to that code that takes and element ID and draws the combined meta data\n * in that element. Previously Bill had different tabs for different types of metadata, but with the addition of the\n * related tab, these were combined into \"Details\" as on the Drupal site.\n *\n * The Related tab is populated by an ajax (axios) call to the environment's Drupal Audio Video site, an endpoint for a gallery\n * of thumbnails using a \"more like this\" solr search in AV's custom solr index. The url is {base}/services/mlt/{nid}.\n * The API has been updated to return json when the parameter 'wt=json' is added. This returns a list of thumbnail divs\n * in HTML markup. Each of these is processed with the AudioVideoMltTile component below\n *\n * @param props\n * @returns {JSX.Element}\n * @constructor\n */\nfunction AudioVideoMeta(props) {\n    const kmasset = props.asset;\n    const node = props.node;\n    const sui = props.sui;\n    const metamarkup =\n        kmasset && node ? sui.av.DrawMetaNew(kmasset, node) : 'Loading ...';\n    const [tabkey, setTabkey] = useState('details');\n    useEffect(() => {\n        $('.c-columnContent__main').scrollTop(0); // on smaller screens need to scroll down to get to related av items so when clicked scroll to top of div\n        setTabkey('details'); // Select and show the details tab when a new item is shown\n    }, [kmasset]);\n    return (\n        <div id=\"av-meta-row\">\n            <Tabs\n                id=\"av-meta-tabs\"\n                activeKey={tabkey}\n                onSelect={(k) => setTabkey(k)}\n            >\n                <Tab eventKey=\"details\" title=\"DETAILS \">\n                    <div id={'meta-details'}>\n                        <HtmlWithPopovers markup={metamarkup} />\n                    </div>\n                </Tab>\n                <Tab eventKey=\"related\" title=\"RELATED \">\n                    <AudioVideoRelated asset={kmasset} node={node} />\n                </Tab>\n            </Tabs>\n        </div>\n    );\n}\n\n/**\n * Component to populate the AV Related tab below the video and transcript. Calls the API to get the list from Drupal\n * Then iterates through it creating a AudioVideoMltTile component for each.\n *\n * @param props\n * @returns {JSX.Element}\n * @constructor\n */\nfunction AudioVideoRelated(props) {\n    const kmasset = props.asset;\n    const node = props.node;\n    const id =\n        node && node.nid ? node.nid : kmasset && kmasset.id ? kmasset.id : '';\n    const [mlt, setMlt] = useState([]);\n    const url =\n        process.env.REACT_APP_DRUPAL_AUDIO_VIDEO +\n        '/services/mlt/' +\n        id +\n        '?wt=json';\n    // Effect uses Axios to call the API url above to get the More Like This list\n    useEffect(() => {\n        axios({\n            url: url,\n            adapter: jsonpAdapter,\n        })\n            .then(function (response) {\n                setMlt(response.data);\n            })\n            .catch(function (error) {\n                setMlt([]);\n            });\n    }, [id]);\n    return (\n        <div id={'meta-mlt'}>\n            <FeatureDeck\n                docs={mlt}\n                title={'Related AV Assets'}\n                inline={false}\n            />\n        </div>\n    );\n}\n","import React, { useEffect } from 'react';\nimport useStatus from '../../hooks/useStatus';\n\nexport function AudioVideoHome(props) {\n    const status = useStatus();\n\n    useEffect(() => {\n        status.clear();\n        status.setHeaderTitle('Audio Video Home');\n    });\n\n    return <> Audio Video Home: Not much here yet.. </>;\n}\n\nexport default AudioVideoHome;\n","import { useSolr } from '../../hooks/useSolr';\nimport $ from 'jquery';\nimport React, { useEffect } from 'react';\nimport { Link } from 'react-router-dom';\n\nexport function ImageCarousel(props) {\n    const solrdoc = props.solrdoc;\n    const atype = solrdoc?.asset_type;\n    const coll_id = solrdoc?.collection_nid;\n    const querySpecs = {\n        index: 'assets',\n        params: {\n            q: `asset_type:${atype} AND collection_nid:${coll_id}`,\n            fl: ['id', 'title', 'url_thumb'],\n            rows: 10000,\n        },\n    };\n\n    const resource = useSolr('collitems', querySpecs);\n\n    const centerCarousel = () => {\n        clearTimeout(window.centerCarousel);\n        window.centerCarousel = setTimeout(function () {\n            if ($('.thumb.current').length === 0) {\n                return;\n            }\n            const scrollval = Math.floor(\n                $('.thumb.current').get(0).offsetLeft -\n                    $('#image-carousel').get(0).offsetWidth / 2\n            );\n            $('#image-carousel').scrollLeft(scrollval);\n        }, 10);\n    };\n    useEffect(() => {\n        if ($('#image-carousel').length > 0) {\n            setTimeout(function () {\n                centerCarousel();\n            }, 1000);\n        }\n    }, [$('#image-carousel')]);\n\n    if (\n        typeof solrdoc === 'undefined' ||\n        typeof resource.docs === 'undefined'\n    ) {\n        return null;\n    }\n\n    let carouseldivs = resource.docs;\n    carouseldivs.sort(function (a, b) {\n        if (a.id === b.id) {\n            return 0;\n        }\n        return a.id < b.id ? -1 : 1;\n    });\n\n    const myindex = carouseldivs.findIndex(function (item) {\n        return item.id == solrdoc.id;\n    });\n    const imgnum = 30;\n    const showst = myindex > imgnum ? myindex - imgnum : 0;\n    const showend =\n        myindex + imgnum < carouseldivs.length - 1\n            ? myindex + imgnum\n            : carouseldivs.length - 1;\n    const showdivs = carouseldivs.slice(showst, showend);\n\n    return (\n        <div id=\"image-carousel\" className={'c-image__carousel'}>\n            {showdivs.map((item, index) => (\n                <div\n                    key={'cs-' + index}\n                    id={'carousel-slide-' + index}\n                    className={\n                        'thumb' + (item.id === solrdoc.id ? ' current' : '')\n                    }\n                >\n                    <Link to={item.id}>\n                        <img src={item.url_thumb} onLoad={centerCarousel} />\n                    </Link>\n                </div>\n            ))}\n        </div>\n    );\n}\n","import React from 'react';\nimport { Link } from 'react-router-dom';\nimport { MandalaPopover } from './MandalaPopover';\nimport { Col, Container, Row, Button } from 'react-bootstrap';\n\nexport function CollectionField(props) {\n    const solrdoc = props.solrdoc;\n    const assettype = solrdoc.assettype;\n    if (typeof solrdoc === 'undefined') {\n        return;\n    }\n    const collurl = assettype + '-collection/' + solrdoc.collection_nid;\n    const colltitle = solrdoc.collection_title;\n    return (\n        <>\n            <span className=\"u-icon__collections\"></span>\n            <Link to={collurl}>{colltitle}</Link>\n            <span className=\"u-visibility\">Public</span>\n        </>\n    );\n}\n\n/**\n * Utility component that takes a nodejson object from an asset API returning Drupal json and displays\n * the three common fields: field_subjects, field_places, field_terms\n *\n * TODO: Allow user to pass alternative names for fields\n *\n * @param props\n * @returns {JSX.Element}\n * @constructor\n */\nexport function KmapsFields(props) {\n    const nodejson = props.nodejson;\n    if (!nodejson || typeof nodejson === 'undefined') {\n        return null;\n    }\n    const kcolls_field_name = props.collfield\n        ? props.collfield\n        : 'field_kmap_collections';\n    const kcolls = nodejson[kcolls_field_name]?.und?.map((item, n) => {\n        const mykey = 'kmcolls-' + item.domain + '-' + item.id + '-' + n;\n        return (\n            <MandalaPopover key={mykey} domain={item.domain} kid={item.id} />\n        );\n    });\n    const sub_field_name = props.subjectfield\n        ? props.subjectfield\n        : 'field_subjects';\n    const subjects = nodejson[sub_field_name]?.und?.map((item, n) => {\n        const mykey = 'kmsubj-' + item.domain + '-' + item.id + '-' + n;\n        return (\n            <MandalaPopover key={mykey} domain={item.domain} kid={item.id} />\n        );\n    });\n    const places = nodejson.field_places?.und?.map((item, n) => {\n        const mykey = 'kmplc-' + item.domain + '-' + item.id + '-' + n;\n        return (\n            <MandalaPopover key={mykey} domain={item.domain} kid={item.id} />\n        );\n    });\n    const termsorig = nodejson.field_terms\n        ? nodejson.field_terms\n        : nodejson.field_kmap_terms;\n    let terms = termsorig?.und?.map((item, n) => {\n        const mykey = 'kmterm-' + item.domain + '-' + item.id + '-' + n;\n        return (\n            <MandalaPopover key={mykey} domain={item.domain} kid={item.id} />\n        );\n    });\n    const kcollclass = !kcolls || kcolls.length === 0 ? ' d-none' : '';\n    const subjclass = !subjects || subjects.length === 0 ? ' d-none' : '';\n    const placeclass = !places || places.length === 0 ? ' d-none' : '';\n    const termsclass = !terms || terms.length === 0 ? ' d-none' : '';\n    return (\n        <>\n            <div className={'c-kmaps__collections' + kcollclass}>\n                <span className=\"u-icon__collections\" title=\"Collections\" />{' '}\n                {kcolls}{' '}\n            </div>\n            <div className={'c-kmaps__subjects' + subjclass}>\n                <span className=\"u-icon__subjects\" title=\"Subjects\" />{' '}\n                {subjects}{' '}\n            </div>\n            <div className={'c-kmaps__places' + placeclass}>\n                <span className=\"u-icon__places\" title=\"Places\" /> {places}{' '}\n            </div>\n            <div className={'c-kmaps__terms' + termsclass}>\n                <span className=\"u-icon__terms\" title=\"Terms\" /> {terms}{' '}\n            </div>\n        </>\n    );\n}\n\n// TODO: Actually use the react history object here\nconst backbutton = () => {\n    window.history.back();\n    setTimeout(function () {\n        window.location.reload();\n    }, 1000);\n};\n\n/**\n * The Component for when an asset page is not found.\n * TODO: Could be broadened to other not-found contexts.\n *\n * @param props\n * @returns {JSX.Element}\n * @constructor\n */\nexport function NotFoundPage(props) {\n    let atype = props.type;\n    if (atype[atype.length - 1] === 's') {\n        atype = atype.substr(0, atype.length - 1);\n    }\n    if ('aeiou'.includes(atype[0])) {\n        atype = 'an ' + atype;\n    } else {\n        atype = 'a ' + atype;\n    }\n    const aid = props.id;\n\n    return (\n        <div className={'c-not-found'}>\n            <Container fluid>\n                <Row className=\"justify-content-md-center\">\n                    <Col lg={'auto'}>\n                        <img\n                            className={'logo'}\n                            src={'/mandala-om/img/logo-shanti.png'}\n                            alt={'mandala logo'}\n                        />\n                        <h1>Page Not Found!</h1>\n                        <p>\n                            Sorry, {atype} with ID, {aid}, does not exist.\n                            <br />\n                            If you followed a link to an item, you may have the\n                            wrong item ID,\n                            <br />\n                            or the item may have been deleted or is private.\n                        </p>\n                        <Button variant=\"primary\" href=\"#\" onClick={backbutton}>\n                            Back\n                        </Button>\n                    </Col>\n                </Row>\n            </Container>\n        </div>\n    );\n}\n","import { Col, Row } from 'react-bootstrap';\nimport { CollectionField, KmapsFields } from '../common/utilcomponents';\nimport { HtmlCustom } from '../common/MandalaMarkup';\nimport React, { useState } from 'react';\n\nconst IMAGE_FIELDS = [\n    'field_image_digital|Only Digital|info',\n    'field_image_color|Color|info',\n    'field_image_quality|Quality|info',\n    'field_image_rotation|Rotation|info',\n    'field_physical_size|Physical Size|arrows',\n    'field_image_capture_device|Capture Device|camera',\n    'field_image_materials|Materials|th',\n    'field_image_enhancement|Enhancement|plus-square-o',\n    'location_constructed|Location|places',\n    'copyright_statement|Copyright|copyright',\n    'field_license_url|License|info',\n    'field_aperture|Aperture|info',\n    'field_exposure_bias|Exposure Bias|info',\n    'field_flash_settings|Flash Settings|info',\n    'field_focal_length|Focal Length|info',\n    'field_iso_speed_rating|ISO Speed|info',\n    'field_lens|lens|info',\n    'field_light_source|Light Source|info',\n    'field_metering_mode|Metering Mode|info',\n    'field_noise_reduction|Noise Reduction|info',\n    'field_organization_name|Organization|info',\n    'field_original_filename|Original File Name|info',\n    'field_project_name|Project|info',\n    'field_sensing_method|Sensing Method|info',\n    'field_sponsor_name|Sponsor|info',\n    'field_spot_feature|Spot Feature|info',\n];\n\nexport function ImageMetadata(props) {\n    const solrdoc = props.solrdoc;\n    const nodejson = props.nodejson;\n    const sizestr = props.sizestr ? props.sizestr : '';\n    const title = nodejson?.title;\n\n    const [photographer, setPhotographer] = useState('');\n\n    if (nodejson) {\n        nodejson['copyright_statement'] = constructCopyright(nodejson);\n        nodejson['location_constructed'] = constructLocation(nodejson);\n    }\n\n    const imgdescs = nodejson?.field_image_descriptions?.und\n        ? nodejson.field_image_descriptions.und\n        : [];\n\n    const capkey = 'ir-caption-main-' + Math.floor(Math.random() * 3333333);\n    return (\n        <>\n            <Row className={'l-top'}>\n                <Col className={'l-first col-sm-12 col-md-6'}>\n                    <h5 className={'c-image__colhead'}>Mandala Collections</h5>\n                    <div>\n                        <CollectionField solrdoc={solrdoc} />\n                    </div>\n                </Col>\n                <Col className={'col-sm-12 col-md-6'}>\n                    <h5 className={'c-image__colhead'}>Classifications</h5>\n                    <div className={'c-kmaps-list'}>\n                        <KmapsFields nodejson={nodejson} />\n                    </div>\n                </Col>\n            </Row>\n            <Row className={'l-meta'}>\n                <Col className={'l-first col-sm-12 col-md-6'}>\n                    <ImageRow\n                        key={capkey}\n                        cls={'c-image__caprow'}\n                        icon={'images'}\n                        label={'Caption'}\n                        value={title}\n                    />\n\n                    <hr />\n\n                    {/* Image creators had \"setMain={setPhotographer}\" but can't set parent state from child */}\n                    <ImageCreators json={nodejson?.field_image_agents} />\n                    <ImageRow\n                        key={'ir-uploader'}\n                        cls={'u-data'}\n                        icon={'agents'}\n                        label={'Uploader'}\n                        value={solrdoc.node_user_full_s}\n                        date={processDate(nodejson.created, 'ts')}\n                    />\n                    <ImageRow\n                        key={'ir-image-type'}\n                        cls={'u-data'}\n                        icon={'square-o'}\n                        label={'Type'}\n                        value={nodejson?.field_image_type?.und[0].value}\n                        valclass={'text-capitalize'}\n                    />\n                    <ImageRow\n                        key={'ir-image-size'}\n                        cls={'u-data'}\n                        icon={'arrows'}\n                        label={'size'}\n                        value={sizestr}\n                    />\n                    <hr />\n                    {imgdescs.map((desc, dn) => {\n                        return (\n                            <ImageDescription\n                                key={'im-desc-' + dn}\n                                data={imgdescs[dn]}\n                                defaultauth={photographer}\n                            />\n                        );\n                    })}\n                </Col>\n                <Col className={'l-second col-sm-12 col-md-6'}>\n                    {IMAGE_FIELDS.map((fdstr, i) => {\n                        let pts = fdstr.split('|');\n                        if (pts.length < 3) {\n                            do {\n                                pts.push('');\n                            } while (pts.length < 3);\n                        }\n                        return (\n                            <ImageInfoField\n                                key={pts[0]}\n                                fieldName={pts[0]}\n                                label={pts[1]}\n                                icon={pts[2]}\n                                nodejson={nodejson}\n                            />\n                        );\n                    })}\n                </Col>\n            </Row>\n        </>\n    );\n}\n\nfunction constructCopyright(node) {\n    let holder = false;\n    let stmt = false;\n    let crdate = false;\n    let crstring = '';\n    if (node) {\n        if (\n            node.field_copyright_holder.und &&\n            node.field_copyright_holder.und.length > 0\n        ) {\n            holder = node.field_copyright_holder.und[0].value;\n        }\n        if (\n            node.field_copyright_statement.und &&\n            node.field_copyright_statement.und.length > 0\n        ) {\n            stmt = node?.field_copyright_statement?.und[0].value;\n        }\n        if (\n            node.field_copyright_date.und &&\n            node.field_copyright_date.und.length > 0\n        ) {\n            crdate = new Date(node?.field_copyright_date?.und[0].value);\n            crdate = crdate.getFullYear();\n        }\n        if (crdate && crdate.toString().length > 0) {\n            crdate = crdate + '. ';\n        }\n        if (holder && holder.length > 0) {\n            holder = holder + ',  ';\n        }\n        if (stmt) {\n            crstring = holder + crdate + '|' + stmt;\n        }\n    }\n    return {\n        und: [{ value: crstring }],\n    };\n}\n\nfunction constructLocation(node) {\n    let long = node?.field_longitude?.und\n        ? node?.field_longitude?.und[0].value\n        : false;\n    let lat = node?.field_latitude?.und\n        ? node?.field_latitude?.und[0].value\n        : false;\n    let alt = node?.field_altitude?.und\n        ? node?.field_altitude?.und[0].value\n        : false;\n    let location = false;\n    if (node && lat && long) {\n        if (!long || !lat || !alt) {\n            return {\n                und: [],\n            };\n        }\n        if (!isNaN(long * 1)) {\n            if (long > 0) {\n                long = '+' + long;\n            } else {\n                long = '-' + long;\n            }\n        }\n\n        if (!isNaN(lat)) {\n            if (lat > 0) {\n                lat = '+' + lat;\n            } else {\n                lat = '-' + lat;\n            }\n        }\n        if (!isNaN(alt)) {\n            if (alt > 0) {\n                alt = '+' + alt;\n            } else {\n                alt = '-' + alt;\n            }\n        }\n        location = long + ' ' + lat + ' ' + alt;\n    }\n    return {\n        und: [{ value: location }],\n    };\n}\n\nfunction ImageRow(props) {\n    const myclass = props.cls ? props.cls : '';\n    const icon = props.icon ? props.icon : 'info';\n    const label = props.label ? props.label : '';\n    const labclass = props.labclass ? ' ' + props.labclass : '';\n    const value = props.value ? props.value : '';\n    const valclass = props.valclass ? ' ' + props.valclass : '';\n    const mydate = props.date ? ' (' + props.date + ')' : '';\n    const mykey =\n        'ir-' +\n        label.toLowerCase().replace(' ', '-') +\n        Math.floor(Math.random() * 888888);\n    return (\n        <Row className={myclass} key={mykey}>\n            <Col key={mykey + '-c1'}>\n                <span className={'u-icon__' + icon} />{' '}\n                <span className={'u-label' + labclass}>{label}</span>{' '}\n            </Col>\n            <Col className={'u-value' + valclass} key={mykey + '-c2'}>\n                {value}\n                {mydate}\n            </Col>\n        </Row>\n    );\n}\n\nfunction processDate(dstr, dtype) {\n    if (!dstr || dstr === '') {\n        return null;\n    }\n    let mydate = new Date(dstr);\n    if (dtype && dtype === 'ts') {\n        mydate = new Date(dstr * 1000);\n    }\n    return mydate.toLocaleString().split(',')[0];\n}\n\nfunction ImageCreators(props) {\n    const data = props?.json;\n    if (\n        !data ||\n        typeof data === 'undefined' ||\n        !data.und ||\n        data.und.length === 0\n    ) {\n        return (\n            <ImageRow\n                cls={'u-data'}\n                icon={'agents'}\n                label={'Creator'}\n                value={'Unknown'}\n            />\n        );\n    }\n    return (\n        <>\n            {data.und.map((item, n) => {\n                const mydate =\n                    item?.field_agent_dates?.und &&\n                    item.field_agent_dates.und.length > 0\n                        ? processDate(item.field_agent_dates.und[0].value)\n                        : '';\n                {\n                    /* doesn't work\n                if (\n                    item.field_agent_role.und[0].value.toLocaleLowerCase() === 'photographer'\n                ) {\n                    props.setMain(item.title);\n                }\n                */\n                }\n                let mykey =\n                    item.field_agent_role.und[0].value.toLowerCase() +\n                    item.title.toLowerCase();\n                mykey = mykey.replace(' ', '-');\n                return (\n                    <ImageRow\n                        key={mykey}\n                        cls={'u-data'}\n                        icon={'agents'}\n                        label={item.field_agent_role.und[0].value.toUpperCase()}\n                        value={item.title}\n                        date={mydate}\n                    />\n                );\n            })}\n        </>\n    );\n}\n\nfunction ImageDescription(props) {\n    const desc = props.data;\n    const defaultauth = props.defaultauth;\n    const descdate = processDate(desc.created, 'ts');\n    const author =\n        desc?.field_author?.und && desc.field_author.und.length > 0\n            ? desc.field_author.und[0].value\n            : defaultauth;\n    const clsstr = author === '' ? 'byline noauthor' : 'byline';\n    return (\n        <div className={'o-desc'}>\n            <h5 className={'o-desc__title'}>{desc.title}</h5>\n            <p className={'o-desc__' + clsstr}>\n                {author} ({descdate})\n            </p>\n            <HtmlCustom markup={desc.field_description.und[0].value} />\n        </div>\n    );\n}\n\nfunction ImageInfoField(props) {\n    const node = props.nodejson;\n    const field_name = props.fieldName;\n    const icon = props.icon;\n    const label = props.label;\n    if (!node[field_name]?.und) {\n        return null;\n    }\n    let value = node[field_name]?.und[0].value;\n    if (field_name === 'location_constructed' && !value) {\n        return null;\n    }\n    if (value.substr(0, 4) === 'http') {\n        value = (\n            <a href={value} target={'_blank'}>\n                {value}\n            </a>\n        );\n    }\n    if (field_name === 'field_image_digital') {\n        value = value === '0' ? 'No' : 'Yes';\n    }\n    if (field_name === 'field_image_rotation') {\n        value += '°';\n    }\n    let rowclass = 'u-data';\n    // Special return for copyright statement to put person and date above with full-column-width description below\n    if (field_name === 'copyright_statement') {\n        let valpts = value.split('|');\n        if (valpts[0] === '') {\n            return null;\n        }\n        while (valpts.length < 2) {\n            valpts.push('');\n        }\n        return (\n            <>\n                <Row className={'o-desc'}>\n                    <Col>\n                        <span className={'u-icon__' + icon} />{' '}\n                        <span className={'u-label'}>{label}</span>{' '}\n                    </Col>\n                    <Col className={'u-value'}>{valpts[0]}</Col>\n                </Row>\n                <Row className={'o-desc'}>\n                    <Col>{valpts[1]}</Col>\n                </Row>\n            </>\n        );\n    }\n    if (\n        field_name === 'field_original_filename' ||\n        field_name === 'field_license_url'\n    ) {\n        value = <span className={'t-overwrap-any'}>{value}</span>;\n    }\n    return (\n        <ImageRow\n            cls={rowclass}\n            icon={icon}\n            label={label.toUpperCase()}\n            value={value}\n        />\n    );\n}\n","import React, { useEffect, useState } from 'react';\nimport { Container, Row, Col } from 'react-bootstrap';\nimport $ from 'jquery';\nimport OpenSeadragon from 'openseadragon';\n\nexport function ImagesOSDViewer(props) {\n    const manifest = props.manifest;\n    const rotation = props.rotation;\n    const defaultzoom = !rotation || rotation === 0 ? 0 : 1;\n    const [osdviewer, setOSDViewer] = useState(false);\n    useEffect(() => {\n        if (manifest && rotation && $('#osdviewer').length === 1) {\n            $('#osdviewer').html('');\n            const viewer = OpenSeadragon({\n                id: 'osdviewer',\n                prefixUrl: '/mandala-om/seadragon/images/',\n                tileSources: manifest,\n                //showNavigator: true,\n                degrees: rotation,\n                showRotationControl: true,\n                // Enable touch rotation on tactile devices\n                /*\n                gestureSettingsTouch: {\n                    pinchRotate: true,\n                },*/\n                defaultZoomLevel: defaultzoom,\n                minZoomImageRatio: 0.1,\n                maxZoomPixelRatio: 1.8,\n                maxZoomLevel: 10,\n                minZoomLevel: 0.5,\n            });\n            setOSDViewer(viewer);\n        }\n    }, [manifest, rotation]);\n\n    return (\n        <div id={'osdviewer'} className={'c-osdviewer'}>\n            Loading ...\n        </div>\n    );\n}\n","import React, { useEffect, useState } from 'react';\nimport useStatus from '../../hooks/useStatus';\nimport { Container, Row, Col } from 'react-bootstrap';\nimport { Viewer } from 'react-iiif-viewer'; // see https://www.npmjs.com/package/react-iiif-viewer\nimport { ImageCarousel } from './ImageCarousel';\nimport { ImageMetadata } from './ImageMetadata';\nimport $ from 'jquery';\nimport './images.scss';\nimport { ImagesOSDViewer } from './ImagesOSDViewer';\n\n/**\n * Compontent that creates the Image Viewer page, including:\n *      1. Main Image which is an instance of the SeaDragon IIIF viewer (Viewer)\n *      2. Title and Byline\n *      3. Carousel of all images in the main images collection (ImageCarousel)\n *      4. Metadata about the image\n *\n * @param props\n * @returns {JSX.Element}\n * @constructor\n * @author ndg8f (2020-09-02)\n */\nexport function ImagesViewer(props) {\n    //console.log(props);\n    const solrdoc = props.mdlasset;\n    const nodejson = props.nodejson;\n    const ismain = props.ismain;\n\n    const status = useStatus();\n\n    const nid = props?.id || solrdoc?.id || nodejson?.nid || false;\n\n    // usEffect Sets the title in the header and reformats the Seadragon viewer buttons for fullscreen and zoom\n    useEffect(() => {\n        // Setting title in header and other status options\n        if (solrdoc && ismain) {\n            status.clear();\n            status.setHeaderTitle(\n                solrdoc?.title || solrdoc?.caption || 'ImageViewer'\n            );\n        }\n        // Updating button controls for fullscreen and zoom\n        const iiifview = $('.react-iiif-viewer');\n        if (iiifview.length > 0) {\n            const iiifchild = iiifview.children();\n            if (iiifchild.length > 2) {\n                $(iiifchild[1]).addClass('zoom');\n                const zoomin = $(iiifchild[1]).children().eq(0);\n                zoomin.addClass('in');\n                zoomin.html('<span class=\"u-icon__zoom-in\"></span>');\n                const zoomout = $(iiifchild[1]).children().eq(1);\n                zoomout.addClass('out');\n                zoomout.html('<span class=\"u-icon__zoom-out\"></span>');\n\n                $(iiifchild[2]).addClass('fullscreen');\n                if ($('#expand-proxy').length === 0) {\n                    $(iiifchild[2])\n                        .children('button')\n                        .eq(0)\n                        .prepend(\n                            '<span id=\"expand-proxy\" class=\"u-icon__enlarge\"></span>'\n                        );\n                }\n            }\n        }\n    }, [solrdoc]);\n\n    const arrowClick = function (e) {\n        const $this = $(e.target);\n        const curr = $('.thumb.current');\n        const dir = $this.parent().hasClass('before') ? 'prev' : 'next';\n        const newcurr =\n            dir === 'prev'\n                ? curr.prev('div').find('a')\n                : curr.next('div').find('a');\n        try {\n            $(newcurr).get(0).click();\n        } catch (e) {}\n    };\n\n    // JSX Markup for the ImagesViewer component\n    if (solrdoc) {\n        const creator = Array.isArray(solrdoc.creator)\n            ? solrdoc.creator.join(', ')\n            : solrdoc.creator;\n        const sizestr = solrdoc.img_width_s + ' x ' + solrdoc.img_height_s;\n        const rotation = nodejson?.field_image_rotation?.und[0]\n            ? nodejson.field_image_rotation.und[0].value\n            : false;\n\n        return (\n            <div className={'c-image'}>\n                <Container fluid className={'c-image__context'}>\n                    <Col className={'c-image__viewer'}>\n                        <Row className={'c-image__viewer-row'}>\n                            <Col className={'page-control before'}>\n                                <span\n                                    className={'u-icon__arrow3-left'}\n                                    onClick={arrowClick}\n                                ></span>\n                            </Col>\n                            <Col>\n                                <ImagesOSDViewer\n                                    manifest={solrdoc.url_iiif_s}\n                                    rotation={rotation}\n                                />\n                            </Col>\n                            <Col className={'page-control after'}>\n                                <span\n                                    className={'u-icon__arrow3-right'}\n                                    onClick={arrowClick}\n                                ></span>\n                            </Col>\n                        </Row>\n                        <div className={'c-image__caption'}>\n                            <h1 className={'c-image__title'}>\n                                <span className={'u-icon__images'}></span>\n                                {solrdoc.title}\n                            </h1>\n                            <div className={'c-image__byline'}>\n                                <span className={'author'}>{creator}</span>|\n                                <span className={'size'}>{sizestr}</span>\n                            </div>\n                        </div>\n                        <ImageCarousel solrdoc={solrdoc} />\n                    </Col>\n                </Container>\n                <Container className={'c-image__metadata'}>\n                    <ImageMetadata\n                        q\n                        solrdoc={solrdoc}\n                        nodejson={nodejson}\n                        sizestr={sizestr}\n                    />\n                </Container>\n            </div>\n        );\n    } else {\n        return <>Loading...</>;\n    }\n}\n","import React, { useEffect } from 'react';\nimport useStatus from '../../hooks/useStatus';\nexport function ImagesHome(props) {\n    const status = useStatus();\n\n    useEffect(() => {\n        status.clear();\n        status.setHeaderTitle('Images Home');\n    });\n\n    return <> Images Home: Not much here yet.. </>;\n}\n\nexport default ImagesHome;\n","import _ from 'lodash';\nimport $ from 'jquery';\nimport { BsCheckCircle, BsMap, ImStack } from 'react-icons/all';\nimport React from 'react';\n\nexport function buildNestedDocs(docs, child_type, path_field) {\n    path_field = path_field ? path_field : child_type + '_path_s';\n\n    const base = {};\n    docs = _.filter(docs, (x) => {\n        return x.block_child_type === child_type;\n    });\n\n    // console.log(\"buildNestedDocs: \", docs)\n\n    _.forEach(docs, (doc, i) => {\n        // console.log(\"buildNestedDocs: i=\" +i);\n        // console.log(\"buildNestedDocs: pathField = \" + path_field);\n        const path = doc[path_field].split('/');\n        // console.log(\"buildNestedDocs path = \" + path);\n        doc.order = i;\n        // console.log(\"buildNestedDocs path.length == \" + path.length);\n        if (path.length === 1) {\n            // this is a \"root doc\", push it on the base list\n            base[path[0]] = doc;\n        } else {\n            // this is a \"nested doc\"\n            // this is a \"nested doc\"\n\n            // check for each \"ancestor\"\n            // create  \"fake ancestor\", if it doesn't exist\n            // add the doc to its parent in _nestedDoc_ field\n            //      created _nestedDoc_ field if it doesn't exist\n            //      if it already exists (it might have been faked earlier), populate fields\n            // console.log(\"buildNestedDocs: nested path = \", path);\n            var curr = base;\n            for (let i = 0; i < path.length; i++) {\n                // console.log(\"buildNestedDocs segment: \" + path.slice(0, i + 1).join(\"/\"));\n                if (!curr[path[i]]) {\n                    curr[path[i]] = {};\n                }\n                if (i === path.length - 1) {\n                    curr[path[i]] = doc;\n                }\n                if (!curr[path[i]]._nested_) {\n                    curr[path[i]]._nested_ = {};\n                }\n                curr = curr[path[i]]._nested_;\n            }\n        }\n    });\n    // console.log(\"buildNestedDocs:\", base);\n    return base;\n}\n\n/**\n * Generic function to normalize links in document's html from Mandala APIs\n * This needs to be called from UseEffect once html has been inserted.\n * It is called from kmaps-app/src/context/MdlAssetContext.js\n */\nexport function normalizeLinks(asset_type) {\n    if (typeof asset_type == 'undefined') {\n        asset_type = 'mandala';\n    }\n    let aels = [];\n    // Mandala Assets inserted in text that have the attribute \"data-mandala-id\"\n    const mandala_items = document.querySelectorAll('[data-mandala-id]');\n    _.forEach(mandala_items, function (el) {\n        const mid = el.getAttribute('data-mandala-id');\n        const new_url = '/mandala-om/' + mid.replace('-', '/');\n        aels = el.getElementsByTagName('a');\n        _.forEach(aels, function (ael) {\n            ael.setAttribute('href', new_url);\n            ael.setAttribute('target', '_self');\n        });\n    });\n\n    // Update links to external sources so they are either internal or disabled (currently all disabled)\n    aels = document.querySelectorAll('a');\n    _.forEach(aels, function (el) {\n        const href = el.getAttribute('href');\n        if (href) {\n            if (href.indexOf('shanti_texts/node_ajax_text') > -1) {\n                return;\n            } else if (href.indexOf('/content') === 0) {\n                // All /content/... links are in the same app\n                el.setAttribute('data-asset-type', asset_type);\n                el.setAttribute('data-url', href);\n                el.setAttribute('href', '#');\n                el.removeAttribute('target');\n                el.classList.add('extlink');\n            } else if (href.indexOf('.shanti.virginia.edu') > -1) {\n                // Links to .shanti.virginia.edu. Disable for now\"\n                el.setAttribute('data-url', href);\n                el.removeAttribute('href');\n                el.setAttribute('href', '#');\n                el.removeAttribute('target');\n                el.classList.add('extlink');\n            }\n        }\n    });\n}\n\n/**\n *\n * @param sel\n */\nexport function addBoClass(sel) {\n    const els =\n        'h1, h2, h3, h4, h5, h6, h7, div, p, blockquote, li, span, label, th, td, a, b, strong, i, em, u, s, dd, dl, dt, figure';\n    const repat = /[a-zA-Z0-9\\,\\.\\:\\;\\-\\s]/g; // the regex patter to strip latin and other characters from string\n\n    const ellist =\n        typeof sel === 'undefined' || sel === 'all' ? $(els) : $(sel).find(els);\n\n    // Iterate through such elements\n    ellist.each(function () {\n        //var etxt = $.trim($(this).text());  // get the text of the element\n        var etxt = $(this).clone().children().remove().end().text(); // See https://stackoverflow.com/a/8851526/2911874\n        etxt = etxt.replace(repat, ''); // strip of irrelevant characters\n        var cc1 = etxt.charCodeAt(0); // get the first character code\n        // If it is within the Tibetan Unicode Range\n        if (cc1 > 3839 && cc1 < 4096) {\n            // If it does not already have .bo\n            if (!$(this).hasClass('bo') && !$(this).parents().hasClass('bo')) {\n                $(this).addClass('bo'); // Add .bo\n            }\n        }\n    });\n}\n\nexport function grokId(id) {\n    const [nid] = id.match(/(\\d+)$/);\n    return nid;\n}\n\nexport function fitDimensions(maxHeight, maxWidth, imgHeight, imgWidth) {\n    const targetProportions = maxHeight / maxWidth;\n    const imageProportions = imgHeight / imgWidth;\n    let targetHeight = 0;\n    let targetWidth = 0;\n    if (targetProportions < imageProportions) {\n        // height constrained\n        targetHeight = maxHeight;\n        targetWidth = Math.floor(imgWidth * (maxHeight / imgHeight));\n    } else {\n        // width constrained\n        targetWidth = maxWidth;\n        targetHeight = Math.floor(imgHeight * (maxWidth / imgWidth));\n    }\n    return { height: targetHeight, width: targetWidth };\n}\n\nexport function selectIcon(type) {\n    const ICON_MAP = {\n        'audio-video': (\n            <span className={'facetItem icon u-icon__audio-video'} />\n        ),\n        texts: <span className={'facetItem icon u-icon__texts'} />,\n        'texts:pages': <span className={'facetItem icon u-icon__texts'} />,\n        images: <span className={'facetItem icon u-icon__images'} />,\n        sources: <span className={'facetItem icon u-icon__sources'} />,\n        visuals: <span className={'facetItem icon u-icon__visuals'} />,\n        places: <span className={'facetItem icon u-icon__places'} />,\n        subjects: <span className={'facetItem icon u-icon__subjects'} />,\n        terms: <span className={'facetItem icon u-icon__terms'} />,\n        collections: (\n            <span className={'facetItem'}>\n                <ImStack />\n            </span>\n        ),\n        asset_type: (\n            <span className={'facetItem'}>\n                <BsCheckCircle />\n            </span>\n        ),\n        users: <span className={'facetItem icon u-icon__community'} />,\n        creator: <span className={'facetItem icon u-icon__agents'} />,\n        languages: <span className={'facetItem icon u-icon__comments-o'} />,\n        feature_types: (\n            <span className={'facetItem'}>\n                <BsMap />\n            </span>\n        ),\n        associated_subjects: (\n            <span className={'facetItem icon u-icon__essays'} />\n        ),\n        perspective: <span className={'facetItem icon u-icon__file-picture'} />,\n        search: <span className={'facetItem icon u-icon__search'} />,\n    };\n\n    return ICON_MAP[type];\n}\n","import React, { useEffect, useState } from 'react';\nimport useStatus from '../../hooks/useStatus';\nimport {\n    Container,\n    Col,\n    Row,\n    Spinner,\n    Collapse,\n    Tabs,\n    Tab,\n} from 'react-bootstrap';\nimport { HtmlWithPopovers, getRandomKey } from '../common/MandalaMarkup';\nimport { addBoClass } from '../common/utils';\nimport './TextsViewer.sass';\nimport $ from 'jquery';\n\n/**\n * Text Viewer Component: The parent component for viewing a text. Gets sent the asset information as a prop\n * called \"mdlasset\" from MdlAssetContext.js. When there is asset information, it creates a bootstrap container\n * with one row that contains a TextBody component and a TextTabs component (Both defined in this file).\n *\n * Uses State and Effect to keep track of which section(s) is/are visible in the scrolling body and passes this\n * information to the TextTabs component so it can highlight the active part of the TOC.\n *\n * State Variables:\n *      text_sections => an array of objects about the sections of the text each object has:\n *          el : the jQuery element\n *          id : the html ID value for the section <div>\n *          title : the title for that section\n *          top: the offset top of the element within its container\n *          bottom: the offset top of the next element or 1000000 if last element\n *\n *      section_showing => a simple array of strings which are IDs for the sections visible in the\n *                         main body's viewport.\n *\n * @param props\n * @returns {*}\n * @constructor\n */\nexport function TextsViewer(props) {\n    const nodejson = props.nodejson ? props.nodejson : '';\n    const kmasset = props.mdlasset ? props.mdlasset : '';\n    const tid = nodejson ? nodejson.nid : '';\n    const title = nodejson ? nodejson.title : '';\n    const ismain = props.ismain ? props.ismain : false;\n\n    const [text_sections, setSections] = useState([]);\n    const [section_showing, setSectionShowing] = useState([\n        'shanti-texts-' + tid,\n    ]);\n    const [alt_viewer_url, setAltViewerUrl] = useState(''); // alt_viewer has url for alt view to show if showing or empty string is hidden\n\n    const status = useStatus();\n\n    // Effect to change banner and title if the viewer is the main component\n    useEffect(() => {\n        if (ismain) {\n            status.setType('texts');\n            const mytitle = kmasset.title ? kmasset.title : 'Loading ...';\n            if (mytitle) {\n                status.setHeaderTitle(mytitle);\n            }\n        }\n    }, [kmasset]);\n\n    // Add Custom Body Class for Text component (one time) and timeout to show not found div\n    useEffect(() => {\n        // add class \"texts\" to the main div for CSS styles\n        $('.l-site__wrap').addClass('texts');\n\n        // Show not found div if it still exists after 10 seconds.\n        setTimeout(function () {\n            $('.not-found-msg').removeClass('d-none');\n        }, 10000);\n    }, []);\n\n    // Setting text_sections variable with array of sections in text for TOC highlighting on scrolling and\n    // also highlights first TOC link\n    useEffect(() => {\n        // Set the text section state var if empty. Only need to do once on load\n        if (\n            text_sections.length == 0 &&\n            $('#shanti-texts-body .shanti-texts-section').length > 0\n        ) {\n            // Get all sections in text\n            const sections_tmp = $(\n                '#shanti-texts-body .shanti-texts-section'\n            ).toArray();\n\n            // Map Section array to an array of standardized objects with el, id, title, and getTop() function\n            const sections_new = $.map(sections_tmp, function (s, n) {\n                const sel = $(s);\n                let nexttop = 1000000;\n                if (n < sections_tmp.length + 1) {\n                    const nxtoffset = $(sections_tmp[n + 1]).offset();\n                    if (nxtoffset && nxtoffset.top) {\n                        nexttop = nxtoffset.top - 145;\n                    }\n                }\n                return {\n                    el: sel,\n                    id: sel.attr('id'),\n                    title: $.trim(sel.children().eq(0).text()),\n                    getTop: function () {\n                        return this.el.offset().top;\n                    },\n                };\n            });\n            // Set Sections state to array of section objects\n            setSections(sections_new);\n\n            // Highlight first link in TOC\n            const myhash = window.location.hash;\n            const mytochash = myhash.replace(\n                'shanti-texts-',\n                'shanti-texts-toc-'\n            );\n            let firstlink = $('.shanti-texts-toc > ul > li.first > a');\n            if (\n                myhash &&\n                $('.shanti-texts-toc > ul  a' + mytochash).length === 1\n            ) {\n                firstlink = $('.shanti-texts-toc > ul  a' + mytochash);\n                $(myhash).get(0).scrollIntoView();\n            }\n            firstlink.addClass('toc-selected');\n        }\n    }); // End of sections effect\n\n    /**\n     * Handle scroll of the main text window to determine which sections are in viewport (i.e. showing)\n     * Update state var section_showing (an array of section IDs showing) to pass to TOC for highlighting\n     * This is passed to TextBody as prop called \"listener\" (Is that an unwise choice of variable name?)\n     *\n     * @param e : not used event object (remove?)\n     */\n    const handleScroll = (e) => {\n        const mytop = 90;\n        const mybottom = mytop + $('#shanti-texts-body').height();\n        let vissect = [];\n        $('.toc-selected').removeClass('toc-selected');\n        $.each(text_sections, function (m) {\n            const s = text_sections[m];\n            const nxts =\n                m < text_sections.length - 1 ? text_sections[m + 1] : false;\n            const stop = s.getTop();\n            const nxttop = nxts ? nxts.getTop() : 10000000;\n            if (\n                (stop > mytop && stop < mybottom) ||\n                (stop < mytop && nxttop > mytop)\n            ) {\n                vissect.push(s.id);\n                const lnkid = '#' + s.id.replace('texts-', 'texts-toc-');\n                $(lnkid).addClass('toc-selected');\n            }\n        });\n        setSectionShowing(vissect);\n    };\n\n    // Declare output variable with loading markup (Not used because overwritten\n    let output = (\n        <>\n            <Container className={'astviewer texts'} fluid>\n                <Row id={'shanti-texts-container'}>\n                    <div className=\"loading\">\n                        <Spinner\n                            as=\"div\"\n                            animation=\"border\"\n                            size=\"sm\"\n                            role=\"status\"\n                            aria-hidden=\"true\"\n                        ></Spinner>\n                        Loading text...\n                    </div>\n                    <div className={'not-found-msg d-none'}>\n                        <h1>Text Not Found!</h1>\n                        <p className={'error'}>\n                            Could not find the requested text: {props.id}\n                        </p>\n                    </div>\n                </Row>\n            </Container>\n        </>\n    );\n\n    // Set output to return. If there's an asset, then output with text BS Container with one BS Row\n    // Row contains: TextBody (main part of text) and Text Tabs (Collapsible tabs on right side including TOC)\n    if (nodejson && nodejson.nid) {\n        //console.log(\"Currast\", currast);\n        if (nodejson.bibl_summary === '') {\n            nodejson.bibl_summary = '<div>Description is loading!</div>';\n        }\n        output = (\n            <>\n                <Container className={'astviewer texts'} fluid>\n                    <Row id={'shanti-texts-container'}>\n                        <TextBody\n                            id={nodejson.nid}\n                            alias={nodejson.alias}\n                            markup={nodejson.full_markup}\n                            listener={handleScroll}\n                        />\n                        <TextTabs\n                            toc={nodejson.toc_links}\n                            meta={nodejson.bibl_summary}\n                            links={nodejson.views_links}\n                            title={title}\n                            sections={section_showing}\n                            altChange={setAltViewerUrl}\n                        />\n                    </Row>\n                </Container>\n                <TextsAltViewer\n                    title={title}\n                    url={alt_viewer_url}\n                    altChange={setAltViewerUrl}\n                />\n                {/* <ReactQueryDevtools initialIsOpen /> */}\n            </>\n        );\n    }\n    return output;\n}\n\n/**\n *\n * @param props\n * @returns {*}\n * @constructor\n */\nfunction TextBody(props) {\n    const txt_link = props.alias;\n\n    // Adjust CSS for Texts only\n    useEffect(() => {\n        $(\n            '.l-content__wrap, #l-content__main,.astviewer, .astviewer.texts #shanti-texts-container'\n        ).css('height', 'inherit');\n    }, []);\n\n    useEffect(() => {\n        addBoClass('#l-content__main');\n    });\n\n    return (\n        <Col id={'shanti-texts-body'} onScroll={props.listener}>\n            <div className={'link-external mandala-edit-link'}>\n                <a\n                    href={txt_link}\n                    target={'_blank'}\n                    title={'View Text in Mandala'}\n                >\n                    <span className={'icon u-icon__external'}></span>\n                </a>\n            </div>\n            <HtmlWithPopovers markup={props.markup} />\n        </Col>\n    );\n}\n\n/**\n *\n * @param props\n * @returns {*}\n * @constructor\n */\nfunction TextTabs(props) {\n    /*const parser = new Parser();\n    const toc_code = parser.parse(props.toc);*/\n    const info_icon = <span className={'shanticon shanticon-info'}></span>;\n    const collapse_icon = (\n        <span className={'shanticon shanticon-circle-right'}></span>\n    );\n    const [open, setOpen] = useState(true);\n    const [icon, setIcon] = useState(collapse_icon);\n    const toggle_col = () => {\n        setOpen(!open);\n    };\n    const update_icon = () => {\n        let new_icon = open ? collapse_icon : info_icon;\n        setIcon(new_icon);\n    };\n\n    const tabshtml = $(props.links);\n    const htmllinks = tabshtml.find('a');\n    const linkscomp = htmllinks.map((n, item) => {\n        let href = $(item).attr('href');\n        if (!href.includes('http')) {\n            href = process.env.REACT_APP_DRUPAL_TEXTS + href;\n        }\n        const mytxt = $(item).text();\n        const mykey = getRandomKey(mytxt);\n        return (\n            <tr className=\"shanti-texts-field nothing\" key={mykey}>\n                <td colSpan=\"2\" className=\"shanti-texts-field-content\">\n                    <a\n                        href=\"#\"\n                        data-href={href}\n                        onClick={() => {\n                            props.altChange(href);\n                        }}\n                    >\n                        {mytxt}\n                    </a>\n                </td>\n            </tr>\n        );\n    });\n    const title = props.title;\n\n    return (\n        <>\n            <div id={'sidecolumn-ctrl'}>\n                <a\n                    onClick={toggle_col}\n                    aria-controls=\"txtsidecol\"\n                    aria-expanded=\"open\"\n                    className={'sidecol-toggle'}\n                >\n                    {icon}\n                </a>\n            </div>\n            <Collapse in={open} onExited={update_icon} onEnter={update_icon}>\n                <Col id={'shanti-texts-sidebar'} md={4}>\n                    <Tabs\n                        id={'shanti-texts-sidebar-tabs'}\n                        className={'nav-justified'}\n                    >\n                        <Tab\n                            eventKey={'text_toc'}\n                            title={'Contents'}\n                            className={'shanti-texts-toc'}\n                        >\n                            <div className={'shanti-texts-record-title'}>\n                                <a href={'#shanti-top'}>{props.title}</a>\n                            </div>\n                            <HtmlWithPopovers\n                                markup={props.toc}\n                                app={'texts'}\n                            />\n                        </Tab>\n                        <Tab eventKey={'text_bibl'} title={'Description'}>\n                            <HtmlWithPopovers\n                                markup={props.meta}\n                                app={'texts'}\n                            />\n                        </Tab>\n                        <Tab eventKey={'text_links'} title={'Views'}>\n                            <div className=\"shanti-texts-record-title\">\n                                {title}\n                            </div>\n                            <h6>Alternative Formats</h6>\n                            <div>\n                                <table className=\"shanti-texts-record-table table\">\n                                    <tbody>{linkscomp}</tbody>\n                                </table>\n                            </div>\n                        </Tab>\n                    </Tabs>\n                </Col>\n            </Collapse>\n        </>\n    );\n}\n\n/**\n * Text Alt viewer provides the IFrame to show the alternative views in an Iframe\n *\n * @param props\n * @returns {*}\n * @constructor\n */\nfunction TextsAltViewer(props) {\n    const iframe_url = props.url ? props.url : '';\n    const clname = iframe_url ? 'hidden' : 'shown';\n    const text_title = props.title ? props.title : '';\n    const iframe = iframe_url ? (\n        <iframe src={iframe_url} className={'full-page-frame'} />\n    ) : (\n        ' '\n    );\n    return (\n        <div id={'text-alt-viewer'} className={clname}>\n            <div className={'close-iframe'}>\n                <a\n                    href=\"#\"\n                    title={'Back to ' + text_title}\n                    onClick={() => {\n                        props.altChange('');\n                    }}\n                >\n                    <span className={'icon shanticon-cancel'}></span>\n                </a>\n            </div>\n            {iframe}\n        </div>\n    );\n}\n","import React, { useEffect } from 'react';\nimport useStatus from '../../hooks/useStatus';\n\nexport function TextsHome(props) {\n    const status = useStatus();\n\n    useEffect(() => {\n        status.clear();\n        status.setHeaderTitle('Texts Home');\n    });\n\n    return <> Texts Home: Not much here yet.. </>;\n}\n\nexport default TextsHome;\n","import React, { useEffect } from 'react';\nimport useStatus from '../hooks/useStatus';\n\nexport function SourcesViewer(props) {\n    const status = useStatus();\n\n    useEffect(() => {\n        if (!props.inline) {\n            console.log(props);\n            status.clear();\n            status.setHeaderTitle('Sources Viewer For A Better Tomorrow');\n            status.setType('sources');\n        }\n    });\n\n    return (\n        <div className={'Sources legacy'}>\n            NOT YET IMPLEMENTED Sources{' '}\n            <pre>{JSON.stringify(props.kmasset)}</pre>\n        </div>\n    );\n}\n","import React, { useEffect } from 'react';\nimport useStatus from '../hooks/useStatus';\n\nexport function SourcesHome(props) {\n    const status = useStatus();\n\n    useEffect(() => {\n        status.clear();\n        status.setHeaderTitle('Sources Home');\n    });\n\n    return <> Sources Home: Not much here yet.. </>;\n}\n\nexport default SourcesHome;\n","import React from 'react';\n\nexport class VisualsViewer extends React.Component {\n\n    constructor(props) {\n        super(props);\n\n        console.error(typeof props.sui);\n        if (typeof props.sui !== 'object') {\n            throw new Error(\"sui must be passed as a property to the component!\");\n        }\n\n        if (typeof props.sui.pages !== 'object') {\n            throw new Error(\"sui.pages must be passed as part of the sui passed to the constructor!\");\n        }\n\n        this.sui = props.sui;\n        this.props = props;\n    }\n\n    componentDidMount() {\n    }\n\n    componentDidCatch(error, errorInfo) {\n    }\n\n    componentWillUnmount() {\n    }\n\n    componentDidUpdate(prevProps, prevState, snapshot) {\n    }\n\n    shouldComponentUpdate(nextProps, nextState, nextContext) {\n        return nextProps.id\n    }\n\n    render() {\n        return <div class={\"VISUALS legacy\"} >VISUALS LEGACY { JSON.stringify(this.props) }</div>\n    }\n\n\n}","import React, { useEffect } from 'react';\nimport useStatus from '../hooks/useStatus';\n\nexport function VisualsHome(props) {\n    const status = useStatus();\n\n    useEffect(() => {\n        status.clear();\n        status.setHeaderTitle('Visuals Home');\n    });\n\n    return <> Visuals Home: Not much here yet.. </>;\n}\n\nexport default VisualsHome;\n","import jQuery from 'jquery';\n// the semi-colon before function invocation is a safety net against concatenated\n// scripts and/or other plugins which may not be closed properly.\nvar kmapsSolrUtils = (function ($, window, document, undefined) {\n    var SOLR_ROW_LIMIT = 2000;\n\n    // undefined is used here as the undefined global variable in ECMAScript 3 is\n    // mutable (ie. it can be changed by someone else). undefined isn't really being\n    // passed in so we can ensure the value of it is truly undefined. In ES5, undefined\n    // can no longer be modified.\n\n    // window and document are passed through as local variables rather than global\n    // as this (slightly) quickens the resolution process and can be more efficiently\n    // minified (especially when both are regularly referenced in your plugin).\n\n    // Create the defaults once\n    var pluginName = 'kmapsSolrUtils',\n        defaults = {\n            termIndex: 'http://localhost/solr/kmterms_dev',\n            assetIndex: 'http://localhost/solr/kmassets_dev',\n            featureId: 'places-1',\n            domain: 'places',\n            perspective: 'general',\n            view: 'roman.scholar',\n            tree: 'places',\n            featuresPath: '/features/%%ID%%',\n        },\n        Plugin = {};\n\n    Plugin.init = function (options) {\n        var plugin = this;\n        var solrUtil = jQuery.extend(true, {}, plugin);\n        solrUtil.settings = $.extend({}, defaults, options);\n        return solrUtil;\n    };\n    Plugin.getDirectDescendantCount = function () {\n        var plugin = this;\n        var dfd = $.Deferred();\n        var relatedCountsUrl =\n            plugin.settings.termIndex +\n            '/select?q={!child of=block_type:parent}id:' +\n            plugin.settings.featureId +\n            '&group=true&group.field=block_child_type&group.limit=0&wt=json&json.wrf=?';\n        $.ajax({\n            type: 'GET',\n            url: relatedCountsUrl,\n            dataType: 'jsonp',\n            timeout: 90000,\n            error: function (e) {\n                console.error(e);\n            },\n            beforeSend: function () {},\n            success: function (data) {\n                var updates = {};\n                $.each(data.grouped.block_child_type.groups, function (x, y) {\n                    var block_child_type = y.groupValue;\n                    var rel_count = y.doclist.numFound;\n                    updates[block_child_type] = rel_count;\n                });\n                dfd.resolve(updates['related_' + plugin.settings.domain]);\n            },\n        });\n        return dfd.promise();\n    };\n    Plugin.addPlacesSummaryItems = function addPlacesSummaryItems(\n        feature_label,\n        featuresPath,\n        group_key,\n        data\n    ) {\n        var plugin = this;\n        var container = $(\n            '.' + plugin.settings.domain + '-in-' + plugin.settings.domain\n        );\n\n        var feature_name = feature_label;\n        for (var key in data[group_key]) {\n            //parent,child, other\n            var feature_block = jQuery('<div></div>').addClass('feature-block');\n            var header = jQuery('<h6></h6>')\n                .html(feature_name + ' ' + key)\n                .addClass('dontend');\n            feature_block.append(header);\n            var relation_subject_list = jQuery(\n                '<ul class=\"collapsibleList\"></ul>'\n            );\n            var relation_subjects_ordered = Object.keys(\n                data[group_key][key]\n            ).sort();\n            var relation_subjects_count = 0;\n            for (var relation_subject in relation_subjects_ordered) {\n                relation_subjects_count++;\n                relation_subject = relation_subjects_ordered[relation_subject];\n                var relation = jQuery('<li></li>');\n                var feature_list = jQuery('<ul></ul>');\n                var feature_count = 0;\n                var sortedFeatures = data[group_key][key][relation_subject];\n                for (var feature_index in sortedFeatures) {\n                    var feature_item = jQuery('<li class=\"dontsplit\"></li>');\n                    var currNode = sortedFeatures[feature_index];\n                    var currNodeID = currNode[\n                        'related_' + plugin.settings.domain + '_id_s'\n                    ].replace(plugin.settings.domain + '-', '');\n                    var currItem = jQuery(\n                        '<a href=' +\n                            featuresPath.replace('%%ID%%', currNodeID) +\n                            '>' +\n                            currNode[\n                                'related_' +\n                                    plugin.settings.domain +\n                                    '_header_s'\n                            ] +\n                            '</a>'\n                    );\n                    var pop_container = jQuery(\n                        '<span class=\"popover-kmaps\" data-id=\"' +\n                            plugin.settings.domain +\n                            '-' +\n                            currNodeID +\n                            '\"><span class=\"popover-kmaps-tip\"></span><span class=\"icon shanticon-menu3\"></span></span>'\n                    );\n                    feature_item.append(currItem);\n                    feature_item.append(jQuery(pop_container));\n                    feature_list.append(feature_item);\n                    feature_count++;\n                }\n                var relation_title = jQuery('<div class=\"dontsplit\"></div>');\n                relation_title.append(\n                    jQuery('<span class=\"glyphicon\"></span> ')\n                );\n                relation_title.append(\n                    relation_subject + ' (' + feature_count + ')'\n                );\n                relation.append(relation_title);\n                relation.append(feature_list);\n                if (feature_count == 1) {\n                    relation.addClass('dontsplit');\n                }\n                relation_subject_list.append(relation);\n            }\n            feature_block.append(relation_subject_list);\n            if (relation_subjects_count == 1 && feature_count == 1) {\n                feature_block.addClass('dontsplit');\n            }\n            container.append(feature_block);\n        }\n    };\n    Plugin.getPlacesSummaryElements = function getPlacesSummaryElements() {\n        var plugin = this;\n        var dfd = $.Deferred();\n        var SOLR_ROW_LIMIT = 200;\n        var fieldList = [\n            'header',\n            'id',\n            'uid',\n            'related_' + plugin.settings.domain + '_feature_type_s',\n            'related_' + plugin.settings.domain + '_relation_label_s',\n            'related_kmaps_node_type',\n            'related_' + plugin.settings.domain + '_feature_types_t',\n            'related_' + plugin.settings.domain + '_id_s',\n            'related_' + plugin.settings.domain + '_header_s',\n        ].join(',');\n        if (plugin.settings.domain == 'places') {\n            fieldList += ',related_subjects_t';\n        }\n        var getSummaryElementsUrl =\n            plugin.settings.termIndex +\n            '/select?' +\n            '&q=' +\n            '{!child of=block_type:parent}id:' +\n            plugin.settings.featureId +\n            '&fl=' +\n            fieldList +\n            '&rows=' +\n            SOLR_ROW_LIMIT +\n            '&indent=true' +\n            '&wt=json' +\n            '&json.wrf=?' +\n            '&sort=related_' +\n            plugin.settings.domain +\n            '_header_s+asc';\n        $.ajax({\n            url: getSummaryElementsUrl,\n            dataType: 'jsonp',\n            jsonp: 'json.wrf',\n        }).done(function (data) {\n            var response = data.response;\n            if (response.numFound > 0) {\n                var result = response.docs.reduce(function (\n                    acc,\n                    currentNode,\n                    index\n                ) {\n                    var node_type = currentNode['related_kmaps_node_type'];\n                    if (node_type === undefined) {\n                        node_type = 'other';\n                    }\n                    if (acc[node_type] === undefined) {\n                        acc[node_type] = [];\n                    }\n                    var relation_label =\n                        currentNode[\n                            'related_' +\n                                plugin.settings.domain +\n                                '_relation_label_s'\n                        ];\n                    if (relation_label === undefined) {\n                        return acc;\n                    }\n                    if (acc[node_type][relation_label] === undefined) {\n                        acc[node_type][relation_label] = [];\n                    }\n                    for (var related_feature_type_key in currentNode[\n                        'related_' + plugin.settings.domain + '_feature_types_t'\n                    ]) {\n                        var related_feature_type =\n                            currentNode[\n                                'related_' +\n                                    plugin.settings.domain +\n                                    '_feature_types_t'\n                            ][related_feature_type_key];\n                        if (\n                            acc[node_type][relation_label][\n                                related_feature_type\n                            ] === undefined\n                        ) {\n                            acc[node_type][relation_label][\n                                related_feature_type\n                            ] = {};\n                        }\n                        var node_id =\n                            currentNode[\n                                'related_' + plugin.settings.domain + '_id_s'\n                            ];\n                        acc[node_type][relation_label][related_feature_type][\n                            node_id\n                        ] = currentNode;\n                    }\n                    return acc;\n                },\n                []);\n                dfd.resolve(result);\n            } else {\n                dfd.resolve([]);\n            }\n        });\n        return dfd.promise();\n    };\n    Plugin.addSubjectsSummaryItems = function addSubjectsSummaryItems(\n        feature_label,\n        featuresPath,\n        group_key,\n        data\n    ) {\n        var plugin = this;\n        var container = $(\n            '.' + plugin.settings.domain + '-in-' + plugin.settings.domain\n        );\n\n        var feature_name = feature_label;\n        for (var key in data[group_key]) {\n            //parent,child, other\n            var feature_block = jQuery('<div></div>').addClass('feature-block');\n            var header = jQuery('<h6></h6>')\n                .addClass('dontend')\n                .append(jQuery('<span class=\"glyphicon\"></span> '));\n            header.append(feature_name + ' ' + key);\n            var relation_subject_list = jQuery(\n                '<ul style=\"list-stype:none;\" class=\"collapsibleList\"></ul>'\n            );\n            var relation_subject_item = jQuery(\n                '<li class=\"collapsible_list_header\"></li>'\n            );\n            relation_subject_item.append(header);\n            var related_subject_list = jQuery('<ul></ul>');\n            var feature_count = 0;\n            var sortedFeatures = data[group_key][key];\n            for (var related_subject_index in sortedFeatures) {\n                var relation = jQuery('<li class=\"dontsplit\"></li>');\n                var currNode = sortedFeatures[related_subject_index];\n                var currNodeID = currNode[\n                    'related_' + plugin.settings.domain + '_id_s'\n                ].replace(plugin.settings.domain + '-', '');\n                relation.append(\n                    '<a href=' +\n                        featuresPath.replace('%%ID%%', currNodeID) +\n                        '>' +\n                        currNode[\n                            'related_' + plugin.settings.domain + '_header_s'\n                        ] +\n                        '</a>'\n                );\n                var pop_container = jQuery(\n                    '<span class=\"popover-kmaps\" data-id=\"' +\n                        plugin.settings.domain +\n                        '-' +\n                        currNodeID +\n                        '\"><span class=\"popover-kmaps-tip\"></span><span class=\"icon shanticon-menu3\"></span></span>'\n                );\n                relation.append(jQuery(pop_container));\n                related_subject_list.append(relation);\n                feature_count++;\n            }\n            relation_subject_item.append(related_subject_list);\n            relation_subject_list.append(relation_subject_item);\n            if (feature_count == 1) {\n                relation_subject_list.addClass('dontsplit');\n            }\n            feature_block.append(relation_subject_list);\n            container.append(feature_block);\n        }\n    };\n    Plugin.getSubjectsSummaryElements = function getSubjectsSummaryElements() {\n        var plugin = this;\n        var dfd = $.Deferred();\n        var SOLR_ROW_LIMIT = 200;\n        var fieldList = [\n            'header',\n            'id',\n            'related_' + plugin.settings.domain + '_feature_type_s',\n            'related_' + plugin.settings.domain + '_relation_label_s',\n        ].join(',');\n        if (plugin.settings.domain == 'places') {\n            fieldList += ',related_subjects_t';\n        }\n        var getSummaryElementsUrl =\n            plugin.settings.termIndex +\n            '/select?' +\n            '&q=' +\n            '{!child of=block_type:parent}id:' +\n            plugin.settings.featureId +\n            '&fl=related_' +\n            plugin.settings.domain +\n            '_feature_types_t,uid,related_' +\n            plugin.settings.domain +\n            '_id_s,related_' +\n            plugin.settings.domain +\n            '_header_s' +\n            ',' +\n            fieldList +\n            '&rows=' +\n            SOLR_ROW_LIMIT +\n            '&indent=true' +\n            '&wt=json' +\n            '&json.wrf=?' +\n            '&sort=related_' +\n            plugin.settings.domain +\n            '_header_s+asc';\n        $.ajax({\n            url: getSummaryElementsUrl,\n            dataType: 'jsonp',\n            jsonp: 'json.wrf',\n        }).done(function (data) {\n            var response = data.response;\n            if (response.numFound > 0) {\n                var result = response.docs.reduce(function (\n                    acc,\n                    currentNode,\n                    index\n                ) {\n                    var node_type = currentNode['related_kmaps_node_type'];\n                    if (node_type === undefined) {\n                        node_type = 'other';\n                    }\n                    if (acc[node_type] === undefined) {\n                        acc[node_type] = [];\n                    }\n                    var relation_label =\n                        currentNode[\n                            'related_' +\n                                plugin.settings.domain +\n                                '_relation_label_s'\n                        ];\n                    if (relation_label === undefined) {\n                        return acc;\n                    }\n                    if (acc[node_type][relation_label] === undefined) {\n                        acc[node_type][relation_label] = [];\n                    }\n                    var node_id =\n                        currentNode[\n                            'related_' + plugin.settings.domain + '_id_s'\n                        ];\n                    acc[node_type][relation_label][node_id] = currentNode;\n                    return acc;\n                },\n                []);\n                dfd.resolve(result);\n            } else {\n                dfd.resolve([]);\n            }\n        });\n        return dfd.promise();\n    };\n    //Popup functions\n    Plugin.getNodeInfo = function getNodeInfo(currentFeatureId, featuresPath) {\n        var plugin = this;\n        const dfd = $.Deferred();\n        var nodeinfo = [];\n        nodeinfo['always'] = 'present';\n        const fieldList = [\n            'ancestors_' + plugin.settings.perspective,\n            'ancestor_ids_' + plugin.settings.perspective,\n            'ancestor_ids_closest_' + plugin.settings.perspective,\n            'ancestors_closest_' + plugin.settings.perspective,\n        ].join(',');\n        var url =\n            plugin.settings.termIndex +\n            '/select?q=id:' +\n            currentFeatureId +\n            '&fl=header,' +\n            fieldList +\n            '*&wt=json&json.wrf=?';\n        $.ajax({\n            url: url,\n            dataType: 'jsonp',\n            jsonp: 'json.wrf',\n            error: function (e) {\n                console.error(e);\n                dfd.resolve([]);\n            },\n            beforesend: function () {},\n            success: function (data) {\n                if (data.response.docs.length > 0) {\n                    var doc = data.response.docs[0];\n                    var ancestorskey =\n                        'ancestor_ids_' + plugin.settings.perspective;\n                    var ancestorsnamekey =\n                        'ancestors_' + plugin.settings.perspective;\n                    if (doc[ancestorskey] === undefined) {\n                        ancestorskey =\n                            'ancestor_ids_closest_' +\n                            plugin.settings.perspective;\n                        ancestorsnamekey =\n                            'ancestors_closest_' + plugin.settings.perspective;\n                    }\n                    nodeinfo['ancestors'] =\n                        doc[ancestorskey] === undefined\n                            ? ''\n                            : doc[ancestorskey].reduce(function (\n                                  acc,\n                                  val,\n                                  index\n                              ) {\n                                  var currancestor =\n                                      \"<a href='\" +\n                                      featuresPath.replace('%%ID%%', val) +\n                                      \"'>\" +\n                                      doc[ancestorsnamekey][index] +\n                                      '</a>';\n                                  acc += '/' + currancestor;\n                                  return acc;\n                              },\n                              '');\n                    nodeinfo['title'] =\n                        '<strong>' + doc['header'] + '</strong>';\n                    dfd.resolve(nodeinfo);\n                }\n            },\n        });\n        return dfd.promise();\n    };\n    Plugin.getNodeCaptions = function getNodeCaptions(key) {\n        var plugin = this;\n        const dfd = $.Deferred();\n        // Update counts from asset index\n        var nodeCaptionsUrl =\n            plugin.settings.termIndex +\n            '/select?q=id:' +\n            key +\n            '&fl=caption_*&wt=json&json.wrf=?';\n        $.ajax({\n            type: 'GET',\n            url: nodeCaptionsUrl,\n            dataType: 'jsonp',\n            jsonp: 'json.wrf',\n            timeout: 90000,\n            error: function (e) {\n                console.error(e);\n                dfd.resolve([]);\n            },\n            success: function (data) {\n                var updates = {};\n                if (data.response.docs.length > 0) {\n                    $.each(data.response.docs[0], function (x, y) {\n                        var caption_key = x;\n                        if (caption_key != null) {\n                            updates[caption_key] = y[0];\n                        }\n                    });\n                }\n                dfd.resolve(updates);\n            },\n        });\n        return dfd.promise();\n    };\n    Plugin.getNodeAssetCount = function getNodeAssetCount(\n        key,\n        project_filter,\n        title\n    ) {\n        var plugin = this;\n        const dfd = $.Deferred();\n        // Update counts from asset index\n        var assetCountsUrl =\n            plugin.settings.assetIndex +\n            '/select?q=kmapid:' +\n            key +\n            project_filter +\n            '&start=0&facets=on&group=true&group.field=asset_type&group.facet=true&group.ngroups=true&group.limit=0&wt=json&json.wrf=?';\n        $.ajax({\n            type: 'GET',\n            url: assetCountsUrl,\n            dataType: 'jsonp',\n            jsonp: 'json.wrf',\n            timeout: 90000,\n            error: function (e) {\n                console.error(e);\n                dfd.resolve([]);\n            },\n            success: function (data) {\n                var updates = {};\n                // extract the group counts -- index by groupValue\n                $.each(data.grouped.asset_type.groups, function (x, y) {\n                    var asset_type = y.groupValue;\n                    var asset_count = y.doclist.numFound;\n                    updates[asset_type] = asset_count;\n                });\n                dfd.resolve(updates);\n            },\n        });\n        return dfd.promise();\n    };\n    Plugin.getNodeRelatedCount = function getNodeRelatedCount(\n        key,\n        project_filter,\n        title\n    ) {\n        var plugin = this;\n        const dfd = $.Deferred();\n        var relatedCountsUrl =\n            plugin.settings.termIndex +\n            '/select?q={!child of=block_type:parent}id:' +\n            key +\n            project_filter +\n            '&wt=json&indent=true&group=true&group.field=block_child_type&group.limit=0&wt=json&json.wrf=?';\n        $.ajax({\n            type: 'GET',\n            url: relatedCountsUrl,\n            dataType: 'jsonp',\n            jsonp: 'json.wrf',\n            timeout: 90000,\n            error: function (e) {\n                console.error(e);\n                dfd.resolve([]);\n            },\n            success: function (data) {\n                var updates = {};\n\n                // extract the group counts -- index by groupValue\n                $.each(data.grouped.block_child_type.groups, function (x, y) {\n                    var block_child_type = y.groupValue;\n                    var rel_count = y.doclist.numFound;\n                    updates[block_child_type] = rel_count;\n                });\n\n                dfd.resolve(updates);\n            },\n        });\n        return dfd.promise();\n    };\n    Plugin.getNodeSubjectsRelatedPlacesCount = function getNodeSubjectsRelatedPlacesCount(\n        key,\n        title\n    ) {\n        var plugin = this;\n        const dfd = $.Deferred();\n        var subjectsRelatedPlacesCountQuery =\n            plugin.settings.termIndex +\n            '/select?indent=on&q={!parent%20which=block_type:parent}related_subject_uid_s:' +\n            key +\n            '&wt=json&json.wrf=?&group=true&group.field=tree&group.limit=0';\n\n        $.ajax({\n            type: 'GET',\n            url: subjectsRelatedPlacesCountQuery,\n            dataType: 'jsonp',\n            jsonp: 'json.wrf',\n            timeout: 90000,\n            error: function (e) {\n                console.error(e);\n                dfd.resolve([]);\n            },\n            success: function (data) {\n                var updates = {};\n                // extract the group counts -- index by groupValue\n                $.each(data.grouped.tree.groups, function (x, y) {\n                    var tree = y.groupValue;\n                    var rel_count = y.doclist.numFound;\n                    updates['related_' + tree] = rel_count;\n                });\n                dfd.resolve(updates);\n            },\n        });\n        return dfd.promise();\n    };\n    // END - Popup functions\n    // Relations tree functions\n    Plugin.getAncestorPath = function getAncestorPath() {\n        var plugin = this;\n        const dfd = $.Deferred();\n        var url =\n            plugin.settings.termIndex +\n            '/select?' +\n            '&q=' +\n            'id:' +\n            plugin.settings.domain +\n            '-' +\n            plugin.settings.featureId +\n            '&fl=level_' +\n            plugin.settings.perspective +\n            '_i,ancestor_id_' +\n            plugin.settings.perspective +\n            '_path' +\n            '&fq=tree:' +\n            plugin.settings.tree +\n            '&indent=true' +\n            '&wt=json' +\n            '&json.wrf=?' +\n            '&rows=' +\n            SOLR_ROW_LIMIT +\n            '&limit=' +\n            SOLR_ROW_LIMIT;\n        $.ajax({\n            url: url,\n            dataType: 'jsonp',\n            jsonp: 'json.wrf',\n        })\n            .done(function (data) {\n                const response = data.response;\n                if (response.numFound < 1) {\n                    dfd.resolve([]);\n                } else {\n                    const path =\n                        response.docs[0][\n                            'ancestor_id_' +\n                                plugin.settings.perspective +\n                                '_path'\n                        ];\n                    const level =\n                        response.docs[0][\n                            'level_' + plugin.settings.perspective + '_i'\n                        ];\n                    dfd.resolve([data]);\n                }\n            })\n            .fail(function (data) {\n                dfd.resolve([]);\n            });\n        return dfd.promise();\n    };\n    Plugin.getFullAncestorTree = function getFullAncestorTree(options) {\n        const plugin = this;\n        var loadDescendants = options['descendants']\n            ? !!options['descendants']\n            : false;\n        var loadOnlyDirectAncestors = options['directAncestors']\n            ? options['directAncestors']\n            : false;\n        var sortBy = options['sortBy'] ? options['sortBy'] : 'header_ssort+ASC';\n        var extraFields = options['extraFields'] ? options['extraFields'] : [];\n        var nodeMarkerPredicates = options['nodeMarkerPredicates']\n            ? options['nodeMarkerPredicates']\n            : [];\n        const dfd = $.Deferred();\n        const head = plugin.settings.view.blank\n            ? 'header'\n            : 'header:name_' + plugin.settings.view;\n        const fieldList =\n            head +\n            [\n                'id',\n                'ancestor_id_' + plugin.settings.perspective + '_path',\n                'level_' + plugin.settings.perspective + '_i',\n            ]\n                .concat(extraFields)\n                .join(',');\n        var url = plugin.settings.termIndex + '/select?';\n        if (!loadOnlyDirectAncestors) {\n            if (plugin.settings.featureId) {\n                url += '&q=' + 'id:' + plugin.settings.featureId;\n            } else {\n                url += '&q=*';\n                url += '&df=header';\n                url +=\n                    '&fq=level_' + plugin.settings.perspective + '_i:[1 TO 1]';\n            }\n        } else {\n            //TODO: if we want direct ancestors use the method getAncestorTree\n        }\n        url +=\n            '&fl=' +\n            fieldList +\n            '&fq=tree:' +\n            plugin.settings.tree +\n            '&indent=true' +\n            '&wt=json' +\n            '&json.wrf=?' +\n            '&rows=' +\n            SOLR_ROW_LIMIT +\n            '&limit=' +\n            SOLR_ROW_LIMIT;\n        $.ajax({\n            url: url,\n            dataType: 'jsonp',\n            jsonp: 'json.wrf',\n        }).done(function (data) {\n            const response = data.response;\n            const buildAncestorTree = async function buildAncestorTree(\n                doc,\n                children\n            ) {\n                var ancestorsKey =\n                    'ancestor_id_' + plugin.settings.perspective + '_path';\n                var ancestorNodes = doc[ancestorsKey].split('/');\n                if (\n                    doc['level_' + plugin.settings.perspective + '_i'] ===\n                    undefined\n                ) {\n                    var lastElementIndex = ancestorNodes.length - 1;\n                    plugin.settings.featureId =\n                        plugin.settings.domain +\n                        '-' +\n                        ancestorNodes[lastElementIndex];\n                }\n\n                if (ancestorNodes === undefined) {\n                    return [];\n                }\n\n                const recursiveAncestors = async function (acc, val, index) {\n                    var ancestorsSiblings = [];\n                    var currentIndexInAncestorList = -1;\n                    var siblings = [];\n                    if (index != 0) {\n                        const ancestorVal = ancestorNodes[index - 1];\n                        const descendantsLevel = index + 1;\n                        siblings = await plugin.getDescendantsInPath(\n                            ancestorNodes.slice(0, index).join('/'),\n                            descendantsLevel,\n                            sortBy,\n                            extraFields,\n                            nodeMarkerPredicates\n                        );\n                    } else if (index == 0) {\n                        //Get all root nodes, nodes in level 1\n                        siblings = await plugin.getDescendantsInPath(\n                            '*',\n                            1,\n                            sortBy,\n                            extraFields,\n                            nodeMarkerPredicates\n                        );\n                    }\n                    for (var i in siblings) {\n                        var sib = siblings[i];\n                        if (sib.key == plugin.settings.domain + '-' + val) {\n                            if (acc) {\n                                sib.children = [].concat(acc);\n                            }\n                            sib.expanded = loadDescendants;\n                            if (sib.key == plugin.settings.featureId) {\n                                sib.active = true;\n                                sib.lazy = true;\n                                sib.backColor = '#eaeaea';\n                            }\n                            break;\n                        }\n                    }\n                    return siblings;\n                };\n                var resultTree = children;\n                for (var i = ancestorNodes.length - 1; i >= 0; i--) {\n                    resultTree = await recursiveAncestors(\n                        resultTree,\n                        ancestorNodes[i],\n                        i\n                    );\n                }\n                return resultTree;\n            };\n            if (response.numFound > 0) {\n                var doc = response.docs[0];\n                if (loadDescendants && plugin.settings.featureId) {\n                    var ancestorsKey =\n                        'ancestor_id_' + plugin.settings.perspective + '_path';\n                    var currentLevelTag =\n                        'level_' + plugin.settings.perspective + '_i';\n                    var ancestorNodes = doc[ancestorsKey].split('/');\n                    var currentLevel = doc[currentLevelTag];\n                    if (doc[currentLevelTag] === undefined) {\n                        currentLevel = ancestorNodes.length;\n                    }\n                    const featureChildren = plugin.getDescendantsInPath(\n                        doc[ancestorsKey],\n                        currentLevel + 1,\n                        sortBy,\n                        extraFields,\n                        nodeMarkerPredicates\n                    );\n                    featureChildren.then(function (children) {\n                        var ancestorTree = buildAncestorTree(doc, children);\n                        ancestorTree.then(function (ancestorTree) {\n                            dfd.resolve(ancestorTree);\n                        });\n                    });\n                } else {\n                    if (response.numFound >= 1) {\n                        var ancestorTree = buildAncestorTree(doc);\n                        ancestorTree.then(function (ancestorTree) {\n                            dfd.resolve(ancestorTree);\n                        });\n                    } else {\n                        const roots = plugin.getDescendantsInPath(\n                            '*',\n                            1,\n                            sortBy,\n                            extraFields,\n                            nodeMarkerPredicates\n                        );\n                        roots.then(function (roots) {\n                            dfd.resolve(roots);\n                        });\n                    }\n                }\n            } else {\n                dfd.resolve([]);\n            }\n        });\n        return dfd.promise();\n    };\n    Plugin.getDescendantsInPath = function getDescendantsInPath(\n        path,\n        level,\n        sortBy,\n        extraFields = [],\n        nodeMarkerPredicates = []\n    ) {\n        const plugin = this;\n        const dfd = $.Deferred();\n        var fieldList = [\n            'header:name_' + plugin.settings.view,\n            'id',\n            'ancestor_id_' + plugin.settings.perspective + '_path',\n            'ancestor_ids_' + plugin.settings.perspective,\n            'ancestors_' + plugin.settings.perspective,\n            'ancestor_id_closest_' + plugin.settings.perspective + '_path',\n            'ancestors_closest_' + plugin.settings.perspective,\n            'level_' + plugin.settings.perspective + '_i',\n            'related_' + plugin.settings.domain + '_feature_type_s',\n            'related_' + plugin.settings.domain + '_relation_label_s',\n        ]\n            .concat(extraFields)\n            .join(',');\n        if (plugin.settings.domain == 'places') {\n            fieldList += ',related_subjects_t';\n        }\n        var url =\n            plugin.settings.termIndex +\n            '/select?' +\n            //child count\n            '&q=' +\n            path +\n            '&sort=' +\n            sortBy +\n            '&df=ancestor_id_' +\n            plugin.settings.perspective +\n            '_path' +\n            '&fq=level_' +\n            plugin.settings.perspective +\n            '_i:[' +\n            level +\n            '+TO+' +\n            (level + 1) +\n            ']' +\n            '&fq={!tag=children}level_' +\n            plugin.settings.perspective +\n            '_i:[' +\n            level +\n            '+TO+' +\n            (level + 0) +\n            ']' +\n            '&facet.mincount=2' +\n            '&facet.limit=-1' +\n            '&facet.field={!ex=children}ancestor_id_' +\n            plugin.settings.perspective +\n            '_path' +\n            //end child count\n            '&fl=' +\n            fieldList +\n            '&facet=true' +\n            '&wt=json' +\n            '&limit=' +\n            SOLR_ROW_LIMIT +\n            '&indent=true' +\n            '&wt=json' +\n            '&json.wrf=?' +\n            '&rows=' +\n            SOLR_ROW_LIMIT;\n        $.ajax({\n            url: url,\n            dataType: 'jsonp',\n            jsonp: 'json.wrf',\n        }).done(function (data) {\n            const response = data.response;\n            const facetCount =\n                data.facet_counts.facet_fields[\n                    'ancestor_id_' + plugin.settings.perspective + '_path'\n                ];\n            var facetHash = {};\n            for (var i = 0; i < facetCount.length; i = i + 2) {\n                facetHash[facetCount[i]] = facetCount[i + 1];\n            }\n            if (response.numFound > 0) {\n                const result = response.docs.reduce(function (\n                    acc,\n                    currentNode,\n                    index\n                ) {\n                    const regex = new RegExp(plugin.settings.domain + '-(.*)');\n                    const match = currentNode['id'].match(regex);\n                    var key = !match\n                        ? ''\n                        : match[1] === undefined\n                        ? ''\n                        : match[1];\n                    var feature_type = '';\n                    var ancestorsKey =\n                        'ancestor_ids_' + plugin.settings.perspective;\n                    var ancestorsNameKey =\n                        'ancestors_' + plugin.settings.perspective;\n                    if (currentNode[ancestorsKey] === undefined) {\n                        ancestorsKey =\n                            'ancestor_ids_closest_' +\n                            plugin.settings.perspective;\n                        ancestorsNameKey =\n                            'ancestors_closest_' + plugin.settings.perspective;\n                    }\n                    var marks = [];\n                    if (nodeMarkerPredicates.length > 0) {\n                        nodeMarkerPredicates.forEach(function (marker, index) {\n                            //marker['field'] marker['value'] marker['operation'] marker['mark']\n                            if (marker['operation'] == '==') {\n                                if (\n                                    JSON.stringify(\n                                        currentNode[marker['field']]\n                                    ) == JSON.stringify(marker.value)\n                                ) {\n                                    marks.push(marker['mark']);\n                                }\n                            } else if (marker['operation'] == 'includes') {\n                                if (\n                                    currentNode[marker['field']].includes(\n                                        marker['value']\n                                    )\n                                ) {\n                                    marks.push(marker['mark']);\n                                }\n                            } else if (marker['operation'] == '!includes') {\n                                if (\n                                    !currentNode[marker['field']]?.includes(\n                                        marker['value']\n                                    )\n                                ) {\n                                    marks.push(marker['mark']);\n                                }\n                            }\n                        });\n                    }\n                    const child = {\n                        title: currentNode['header'],\n                        displayPath: '', //currentNode[ancestorsNameKey].join(\"/\"),\n                        key: plugin.settings.domain + '-' + key,\n                        expanded: false,\n                        lazy: true,\n                        href: plugin.settings.featuresPath.replace(\n                            '%%ID%%',\n                            key\n                        ),\n                        marks: marks,\n                    };\n                    if (\n                        facetHash[\n                            currentNode[\n                                'ancestor_id_' +\n                                    plugin.settings.perspective +\n                                    '_path'\n                            ]\n                        ] === undefined\n                    ) {\n                        child.lazy = false;\n                    }\n                    return acc !== undefined ? acc.concat([child]) : [child];\n                },\n                []);\n                dfd.resolve(result);\n            } else {\n                dfd.resolve([]);\n            }\n        });\n        return dfd.promise();\n    };\n    Plugin.getAncestorTree = function getAncestorTree(options) {\n        const plugin = this;\n        var loadDescendants = options['descendants']\n            ? !!options['descendants']\n            : false;\n        var loadOnlyDirectAncestors = options['directAncestors']\n            ? !!options['directAncestors']\n            : false;\n        var fullDetail = options['descendantsFullDetail']\n            ? !!options['descendantsFullDetail']\n            : false;\n        var sortBy = options['sortBy'] ? options['sortBy'] : 'header_ssort+ASC';\n        var extraFields = options['extraFields'] ? options['extraFields'] : [];\n        var nodeMarkerPredicates = options['nodeMarkerPredicates']\n            ? options['nodeMarkerPredicates']\n            : [];\n        const dfd = $.Deferred();\n        const fieldList = [\n            'header:name_' + plugin.settings.view,\n            'id',\n            'ancestor_id_' + plugin.settings.perspective + '_path',\n            'ancestor_ids_' + plugin.settings.perspective,\n            'ancestors_' + plugin.settings.perspective,\n            'ancestors_closest_' + plugin.settings.perspective,\n            'ancestor_id_closest_' + plugin.settings.perspective + '_path',\n            'ancestor_ids_closest_' + plugin.settings.perspective,\n            'level_' + plugin.settings.perspective + '_i',\n        ]\n            .concat(extraFields)\n            .join(',');\n        var url = plugin.settings.termIndex + '/select?';\n        if (loadOnlyDirectAncestors) {\n            if (plugin.settings.featureId) {\n                url += '&q=' + 'id:' + plugin.settings.featureId;\n            } else {\n                url += '&q=*';\n                url += '&df=header';\n                url +=\n                    '&fq=level_' + plugin.settings.perspective + '_i:[1 TO 1]';\n            }\n        } else {\n            //TODO: if we want all ancestors use the method getFullAncestorTree\n        }\n        url +=\n            '&fl=' +\n            fieldList +\n            '&fq=tree:' +\n            plugin.settings.tree +\n            '&indent=true' +\n            '&wt=json' +\n            '&json.wrf=?' +\n            '&rows=' +\n            SOLR_ROW_LIMIT +\n            '&limit=' +\n            SOLR_ROW_LIMIT +\n            '&sort=' +\n            sortBy;\n        $.ajax({\n            url: url,\n            dataType: 'jsonp',\n            jsonp: 'json.wrf',\n        }).done(function (data) {\n            const response = data.response;\n            const buildTree = function buildTree(doc, children) {\n                var ancestorsKey =\n                    'ancestor_ids_' + plugin.settings.perspective;\n                var ancestorsNameKey =\n                    'ancestors_' + plugin.settings.perspective;\n                if (doc[ancestorsKey] === undefined) {\n                    ancestorsKey =\n                        'ancestor_ids_closest_' + plugin.settings.perspective;\n                    ancestorsNameKey =\n                        'ancestors_closest_' + plugin.settings.perspective;\n                }\n                const result =\n                    doc[ancestorsKey] === undefined\n                        ? []\n                        : doc[ancestorsKey].reduceRight(function (\n                              acc,\n                              val,\n                              index\n                          ) {\n                              const node = {\n                                  title:\n                                      '<strong>' +\n                                      doc[ancestorsNameKey][index] +\n                                      '</strong>',\n                                  key: plugin.settings.domain + '-' + val,\n                                  expanded: true,\n                                  href: plugin.settings.featuresPath.replace(\n                                      '%%ID%%',\n                                      val\n                                  ),\n                                  lazy: true,\n                                  displayPath: doc[ancestorsNameKey].join('/'),\n                                  //[].concat to handle the instance when the children are sent as an argument\n                                  children:\n                                      acc === undefined ? null : [].concat(acc),\n                              };\n                              if (node.key === plugin.settings.featureId) {\n                                  node.active = true;\n                                  node.backColor = '#eaeaea';\n                              }\n                              return node;\n                          },\n                          children);\n                return [result];\n            };\n            if (response.numFound > 0) {\n                var doc = response.docs[0];\n                if (loadDescendants && plugin.settings.featureId) {\n                    const featureChildren = plugin.getDescendantTree(\n                        plugin.settings.featureId,\n                        fullDetail,\n                        sortBy,\n                        extraFields,\n                        nodeMarkerPredicates\n                    );\n                    featureChildren.then(function (value) {\n                        dfd.resolve(buildTree(doc, value));\n                    });\n                } else {\n                    if (response.numFound > 1) {\n                        var ancestorTree = [];\n                        for (var i = 0; i < response.numFound; i++) {\n                            doc = response.docs[i];\n                            var builtTree = buildTree(doc);\n                            ancestorTree = ancestorTree.concat(buildTree(doc));\n                        }\n                        dfd.resolve(ancestorTree);\n                    } else {\n                        dfd.resolve(buildTree(doc));\n                    }\n                }\n            } else {\n                dfd.resolve([]);\n            }\n        });\n        return dfd.promise();\n    };\n    Plugin.getDescendantTree = function getDescendantTree(\n        featureId,\n        fullDetail,\n        sortBy,\n        extraFields = [],\n        nodeMarkerPredicates = []\n    ) {\n        const plugin = this;\n        fullDetail = fullDetail || false;\n        const dfd = $.Deferred();\n        var fieldList = [\n            'header:name_' + plugin.settings.view,\n            'id',\n            'ancestor_id_' + plugin.settings.perspective + '_path',\n            'ancestors_' + plugin.settings.perspective,\n            'ancestor_id_closest_' + plugin.settings.perspective + '_path',\n            'ancestor_ids_closest_' + plugin.settings.perspective,\n            'caption_eng',\n            'related_' + plugin.settings.domain + '_feature_type_s',\n            'related_' + plugin.settings.domain + '_relation_label_s',\n        ]\n            .concat(extraFields)\n            .join(',');\n        if (plugin.settings.domain == 'places') {\n            fieldList += ',related_subjects_t';\n        }\n        var sortByQuery = sortBy\n            ? sortBy\n            : 'related_' + plugin.settings.domain + '_header_s+ASC';\n        var url =\n            plugin.settings.termIndex +\n            '/select?' +\n            //V3 child count\n            '&q=' +\n            '{!child of=block_type:parent}id:' +\n            featureId +\n            '&fl=child_count:[subquery],uid,related_' +\n            plugin.settings.domain +\n            '_id_s,related_' +\n            plugin.settings.domain +\n            '_header_s' +\n            ',' +\n            fieldList +\n            '&expand=true' +\n            '&child_count.fq=related_kmaps_node_type:child' +\n            '&child_count.fl=uid' +\n            '&child_count.rows=' +\n            '0' +\n            \"&child_count.q={!child of='block_type:parent'}{!term f=uid v=$row.related_\" +\n            plugin.settings.domain +\n            '_id_s}' +\n            '&fq=related_kmaps_node_type:' +\n            'child' +\n            '&fq=' +\n            '{!collapse field=related_' +\n            plugin.settings.domain +\n            '_id_s}' +\n            //end of V3\n            '&wt=json' +\n            '&limit=' +\n            SOLR_ROW_LIMIT +\n            '&indent=true' +\n            '&wt=json' +\n            '&json.wrf=?' +\n            '&sort=' +\n            sortByQuery +\n            '&rows=' +\n            SOLR_ROW_LIMIT;\n        $.ajax({\n            url: url,\n            dataType: 'jsonp',\n            jsonp: 'json.wrf',\n        }).done(function (data) {\n            const response = data.response;\n            if (response.numFound > 0) {\n                const result = response.docs.reduce(function (\n                    acc,\n                    currentNode,\n                    index\n                ) {\n                    const regex = new RegExp(plugin.settings.domain + '-(.*)');\n                    const match = currentNode[\n                        'related_' + plugin.settings.domain + '_id_s'\n                    ].match(regex);\n                    var key = !match\n                        ? ''\n                        : match[1] === undefined\n                        ? ''\n                        : match[1];\n                    var feature_type = '';\n                    if (plugin.settings.domain == 'places') {\n                        const expanded_docs =\n                            data.expanded[\n                                currentNode[\n                                    'related_' +\n                                        plugin.settings.domain +\n                                        '_id_s'\n                                ]\n                            ];\n                        const expanded = expanded_docs\n                            ? expanded_docs.docs[0] || []\n                            : [];\n                        var related_subjects_s = expanded['related_subjects_t']\n                            ? expanded['related_subjects_t'].join(',') + ': '\n                            : '';\n                        feature_type = related_subjects_s;\n                        if (related_subjects_s == '') {\n                            feature_type =\n                                currentNode[\n                                    'related_' +\n                                        plugin.settings.domain +\n                                        '_feature_type_s'\n                                ];\n                            feature_type = feature_type\n                                ? feature_type + ': '\n                                : ' ';\n                        }\n                    }\n                    var ancestorsKey =\n                        'ancestor_ids_' + plugin.settings.perspective;\n                    var ancestorsNameKey =\n                        'ancestors_' + plugin.settings.perspective;\n                    if (currentNode[ancestorsKey] === undefined) {\n                        ancestorsKey =\n                            'ancestor_ids_closest_' +\n                            plugin.settings.perspective;\n                        ancestorsNameKey =\n                            'ancestors_closest_' + plugin.settings.perspective;\n                    }\n                    var title =\n                        '<strong>' +\n                        currentNode[\n                            'related_' + plugin.settings.domain + '_header_s'\n                        ] +\n                        '</strong>';\n                    if (fullDetail) {\n                        title +=\n                            ' (' +\n                            feature_type +\n                            currentNode[\n                                'related_' +\n                                    plugin.settings.domain +\n                                    '_relation_label_s'\n                            ] +\n                            ')';\n                    }\n                    const child = {\n                        title: title,\n                        displayPath: '', //currentNode[ancestorsNameKey].join(\"/\"),\n                        key: plugin.settings.domain + '-' + key,\n                        expanded: false,\n                        lazy: true,\n                        href: plugin.settings.featuresPath.replace(\n                            '%%ID%%',\n                            key\n                        ),\n                    };\n                    if (currentNode['child_count'] !== undefined) {\n                        if (currentNode['child_count']['numFound'] === 0) {\n                            child.lazy = false;\n                        }\n                    }\n                    return acc !== undefined ? acc.concat([child]) : [child];\n                },\n                []);\n                dfd.resolve(result);\n            } else {\n                dfd.resolve([]);\n            }\n        });\n        return dfd.promise();\n    };\n\n    // END - Relations tree functions\n    return Plugin;\n})(jQuery, window, document);\n\nexport default kmapsSolrUtils;\n","import jQuery from 'jquery';\n/*\n *  Project: UVa KMaps\n *  Description: Plugin to handle the fancyTree implementation with Solr\n *  Author: djrc2r\n */\n\n// the semi-colon before function invocation is a safety net against concatenated\n// scripts and/or other plugins which may not be closed properly.\n(function ($, window, document, undefined) {\n    var SOLR_ROW_LIMIT = 2000;\n    var DEBUG = false;\n\n    // undefined is used here as the undefined global variable in ECMAScript 3 is\n    // mutable (ie. it can be changed by someone else). undefined isn't really being\n    // passed in so we can ensure the value of it is truly undefined. In ES5, undefined\n    // can no longer be modified.\n\n    // window is passed through as local variable rather than global\n    // as this (slightly) quickens the resolution process and can be more efficiently\n    // minified (especially when both are regularly referenced in your plugin).\n\n    // Create the defaults once\n    var pluginName = 'kmapsRelationsTree',\n        defaults = {\n            termIndex: 'http://localhost/solr/kmterms_dev',\n            assetIndex: 'http://localhost/solr/kmassets_dev',\n            tree: 'places',\n            featuresPath: '/features/%%ID%%',\n            domain: 'places',\n            featureId: 1,\n            perspective: 'pol.admin.hier',\n            descendants: false,\n            directAncestors: true,\n            descendantsFullDetail: true,\n            sortBy: 'header_ssort+ASC',\n            initialScrollToActive: false,\n            displayPopup: false,\n            mandalaURL:\n                'https://mandala.shanti.virginia.edu/%%APP%%/%%ID%%/%%REL%%/nojs',\n            solrUtils: {}, //requires solr-utils.js library\n            language: 'eng',\n            extraFields: [],\n            nodeMarkerPredicates: [], //A predicate is: {field:, value:, operation: 'eq', mark: 'nonInteractive'}\n        };\n\n    // The actual plugin constructor\n    function Plugin(element, options) {\n        this.element = element;\n\n        // jQuery has an extend method which merges the contents of two or\n        // more objects, storing the result in the first object. The first object\n        // is generally empty as we don't want to alter the default options for\n        // future instances of the plugin\n        this.options = $.extend({}, defaults, options);\n\n        this._defaults = defaults;\n        this._name = pluginName;\n\n        this.init();\n    }\n\n    Plugin.prototype = {\n        init: function () {\n            const plugin = this;\n            var options = {\n                descendants: plugin.options.descendants,\n                directAncestors: plugin.options.directAncestors,\n                descendantsFullDetail: plugin.options.descendantsFullDetail,\n                sortBy: plugin.options.sortBy,\n                extraFields: plugin.options.extraFields,\n                nodeMarkerPredicates: plugin.options.nodeMarkerPredicates,\n            };\n            // Place initialization logic here\n            // You already have access to the DOM element and the options via the instance,\n            // e.g., this.element and this.options\n            $(plugin.element).fancytree({\n                extensions: ['filter', 'glyph'],\n                source: plugin.getAncestorTree(options),\n                init: function (event, data) {\n                    if (plugin.options.initialScrollToActive) {\n                        plugin.scrollToActiveNode();\n                    }\n                },\n                glyph: {\n                    preset: 'awesome5',\n                    map: {\n                        doc: '',\n                        docOpen: '',\n                        error: 'fas fa-exclamation-circle',\n                        expanderClosed: 'fas fa-plus-circle',\n                        expanderLazy: 'fas fa-plus-circle',\n                        // expanderLazy: \"glyphicon glyphicon-expand\",\n                        expanderOpen: 'fas fa-minus-circle',\n                        // expanderOpen: \"glyphicon glyphicon-collapse-down\",\n                        folder: '',\n                        folderOpen: '',\n                        loading: 'fas fa-spinner',\n                        //              loading: \"icon-spinner icon-spin\"\n                    },\n                },\n                activate: function (event, data) {\n                    var node = data.node,\n                        orgEvent = data.originalEvent;\n                    if (node.data.marks.includes('nonInteractiveNode')) {\n                        node.toggleExpanded();\n                    } else {\n                        if (node.data.href) {\n                            plugin.options.history.push(\n                                node.data.href.replace(\n                                    process.env.REACT_APP_PUBLIC_URL,\n                                    ''\n                                )\n                            );\n                        }\n                    }\n                },\n                lazyLoad: function (event, data) {\n                    data.result = plugin.getDescendantTree(\n                        data.node.key,\n                        data.node.getKeyPath(),\n                        plugin.options.sortBy\n                    );\n                },\n                createNode: function (event, data) {\n                    data.node.span.childNodes[2].innerHTML =\n                        '<span id=\"ajax-id-' +\n                        data.node.key +\n                        '\">' +\n                        data.node.title +\n                        ' ' +\n                        (data.node.data.path || '') +\n                        '</span>';\n\n                    var path = ''; //plugin.makeStringPath(data);\n                    var elem = data.node.span;\n                    //var key = plugin.options.domain +\"-\" + data.node.key;\n                    var key = data.node.key;\n                    var title = data.node.title;\n                    var caption = data.node.data.caption;\n                    var theIdPath = data.node.data.path;\n                    //var displayPath = data.node.data.displayPath;\n                    var displayPath = data.node\n                        .getParentList(true, true)\n                        .reduce(function (parentPath, ancestor) {\n                            var title_match = ancestor.title;\n                            var current_title = '';\n                            if (title_match != null) {\n                                current_title = title_match[0];\n                            }\n                            var current_link =\n                                \"<a href='\" +\n                                ancestor.data.href +\n                                \"'>\" +\n                                current_title +\n                                '</a>';\n                            if (parentPath == '') {\n                                return current_link;\n                            }\n                            return parentPath + '/' + current_link;\n                        }, '');\n                    if (plugin.options.displayPopup) {\n                        var pop_container = $(\n                            '<span class=\"popover-kmaps\" data-app=\"places\" data-id=\"' +\n                                key +\n                                '\"><span class=\"popover-kmaps-tip\"></span><span class=\"icon shanticon-menu3\"></span></span>'\n                        );\n                        $(elem).append($(pop_container));\n                        $(pop_container).kmapsPopup({\n                            featuresPath: plugin.options.featuresPath,\n                            domain: plugin.options.domain,\n                            featureId: '',\n                            mandalaURL: plugin.options.mandalaURL,\n                            solrUtils: plugin.options.solrUtils,\n                            language: plugin.options.language,\n                        });\n                    }\n                    return data;\n                },\n            });\n\n            function makeStringPath(data) {\n                return $.makeArray(\n                    data.node.getParentList(false, true).map(function (x) {\n                        return x.title;\n                    })\n                ).join('/');\n            }\n        },\n        scrollToActiveNode: async function () {\n            var plugin = this;\n            var tree = $(plugin.element).fancytree('getTree');\n            var active = tree.getActiveNode();\n            if (active) {\n                active.makeVisible().then(function () {\n                    var totalOffset =\n                        $(active.li).offset().top -\n                        $(active.li).closest('.view-wrap').offset().top;\n                    $(active.li).closest('.view-wrap').scrollTop(totalOffset);\n                });\n            }\n        },\n        getAncestorPath: function () {\n            const plugin = this;\n            return plugin.options.solrUtils.getAncestorPath();\n        },\n        getAncestorTree: function (options) {\n            const plugin = this;\n            if (plugin.options.directAncestors) {\n                return plugin.options.solrUtils.getAncestorTree(options);\n            }\n            return plugin.options.solrUtils.getFullAncestorTree(options);\n        },\n        getDescendantTree: function (featureId, keyPath) {\n            const plugin = this;\n            if (!plugin.options.directAncestors) {\n                var ancestorPath = keyPath.split(\n                    '/' + plugin.options.domain + '-'\n                );\n                ancestorPath.shift();\n                return plugin.options.solrUtils.getDescendantsInPath(\n                    ancestorPath.join('/'),\n                    ancestorPath.length + 1,\n                    plugin.options.sortBy,\n                    plugin.options.extraFields,\n                    plugin.options.nodeMarkerPredicates\n                );\n            }\n            return plugin.options.solrUtils.getDescendantTree(\n                featureId,\n                plugin.options.descendantsFullDetail,\n                plugin.options.sortBay,\n                plugin.options.extraFields,\n                plugin.options.nodeMarkerPredicates\n            );\n        },\n    };\n\n    // You don't need to change something below:\n    // A really lightweight plugin wrapper around the constructor,\n    // preventing against multiple instantiations and allowing any\n    // public function (ie. a function whose name doesn't start\n    // with an underscore) to be called via the jQuery plugin,\n    // e.g. $(element).defaultPluginName('functionName', arg1, arg2)\n    $.fn[pluginName] = function (options) {\n        var args = arguments;\n\n        // Is the first parameter an object (options), or was omitted,\n        // instantiate a new instance of the plugin.\n        if (options === undefined || typeof options === 'object') {\n            return this.each(function () {\n                // Only allow the plugin to be instantiated once,\n                // so we check that the element has no plugin instantiation yet\n                if (!$.data(this, 'plugin_' + pluginName)) {\n                    // if it has no instance, create a new one,\n                    // pass options to our plugin constructor,\n                    // and store the plugin instance\n                    // in the elements jQuery data object.\n                    $.data(\n                        this,\n                        'plugin_' + pluginName,\n                        new Plugin(this, options)\n                    );\n                }\n            });\n\n            // If the first parameter is a string and it doesn't start\n            // with an underscore or \"contains\" the `init`-function,\n            // treat this as a call to a public method.\n        } else if (\n            typeof options === 'string' &&\n            options[0] !== '_' &&\n            options !== 'init'\n        ) {\n            // Cache the method call\n            // to make it possible\n            // to return a value\n            var returns;\n\n            this.each(function () {\n                var instance = $.data(this, 'plugin_' + pluginName);\n\n                // Tests that there's already a plugin-instance\n                // and checks that the requested public method exists\n                if (\n                    instance instanceof Plugin &&\n                    typeof instance[options] === 'function'\n                ) {\n                    // Call the method of our plugin instance,\n                    // and pass it the supplied arguments.\n                    returns = instance[options].apply(\n                        instance,\n                        Array.prototype.slice.call(args, 1)\n                    );\n                }\n\n                // Allow instances to be destroyed via the 'destroy' method\n                if (options === 'destroy') {\n                    $.data(this, 'plugin_' + pluginName, null);\n                }\n            });\n\n            // If the earlier cached method\n            // gives a value back return the value,\n            // otherwise return this to preserve chainability.\n            return returns !== undefined ? returns : this;\n        }\n    };\n})(jQuery, window, document);\n","import React, { useEffect, useRef } from 'react';\nimport fancytree from 'jquery.fancytree';\nimport { withRouter } from 'react-router';\nimport { useHistory, useParams } from 'react-router-dom';\nimport 'jquery.fancytree/dist/modules/jquery.fancytree.filter';\nimport 'jquery.fancytree/dist/modules/jquery.fancytree.glyph';\nimport $ from 'jquery';\nimport kmapsSolrUtils from './solr-utils';\nimport './kmaps_relations_tree';\nimport 'jquery.fancytree/dist/skin-awesome/ui.fancytree.css';\nimport './FancyTree.css';\n\nfunction FancyTree({\n    domain,\n    tree,\n    descendants = true,\n    directAncestors = false,\n    displayPopup = false,\n    perspective = 'tib.alpha',\n    view = 'roman.scholar',\n    sortBy = 'position_i+ASC',\n}) {\n    const el = useRef(null);\n    let history = useHistory();\n    let params = useParams();\n\n    useEffect(() => {\n        //Setup solr utils\n        const ks_opts = {\n            termIndex: process.env.REACT_APP_SOLR_KMTERMS,\n            assetIndex: process.env.REACT_APP_SOLR_KMASSETS,\n            featureId: params.id,\n            domain,\n            perspective,\n            mandalaURL:\n                process.env.REACT_APP_PUBLIC_URL +\n                `/${domain}/${domain}-%%ID%%`,\n            featuresPath:\n                process.env.REACT_APP_PUBLIC_URL +\n                `/${domain}/${domain}-%%ID%%`,\n            tree,\n        };\n\n        // console.log('FancyTree: tree=', tree, ' kmapSolrUtil opts = ', ks_opts);\n\n        const solrUtils = kmapsSolrUtils.init(ks_opts);\n\n        const elCopy = $(el.current);\n        const tree_opts = {\n            domain,\n            featureId: params.id,\n            featuresPath:\n                process.env.REACT_APP_PUBLIC_URL +\n                `/${domain}/${domain}-%%ID%%`,\n            perspective,\n            tree,\n            termIndex: process.env.REACT_APP_SOLR_KMTERMS,\n            descendants,\n            descendantsFullDetail: false,\n            directAncestors,\n            displayPopup,\n            mandalaURL:\n                process.env.REACT_APP_PUBLIC_URL +\n                `/${domain}/${domain}-%%ID%%`,\n            solrUtils: solrUtils,\n            view,\n            sortBy,\n            initialScrollToActive: true,\n            // extraFields: ['associated_subject_ids'],\n            // nodeMarkerPredicates: [\n            //     {\n            //         field: 'associated_subject_ids',\n            //         value: 9315,\n            //         operation: '!includes',\n            //         mark: 'nonInteractiveNode',\n            //     },\n            // ],\n            history,\n            params,\n        };\n\n        // console.log('FancyTree: tree=', tree, ' tree_opts = ', tree_opts);\n\n        elCopy.kmapsRelationsTree(tree_opts);\n        return () => {\n            elCopy.fancytree('destroy');\n        };\n    }, []);\n\n    return <div className=\"suiFancyTree view-wrap\" ref={el}></div>;\n}\n\nexport default FancyTree;\n","// inner component\nimport { useStoreActions } from '../../model/StoreModel';\nimport { useHistory } from 'react-router';\nimport * as PropTypes from 'prop-types';\nimport React from 'react';\nimport './HistoryViewer.css';\nimport OverlayTrigger from 'react-bootstrap/OverlayTrigger';\nimport Popover from 'react-bootstrap/Popover';\nimport { selectIcon } from '../common/utils';\n\nfunction SearchCriteriaMini(props) {\n    // console.log(\n    //     'SearchCriteriaMini state = ',\n    //     JSON.stringify(props.location, undefined, 2))\n    const state = props.location?.state;\n    const kmasset = props.location?.kmasset;\n\n    let output = [];\n    if (!state) {\n        return (\n            <>\n                {' '}\n                {selectIcon(kmasset?.asset_type)} {kmasset?.uid}\n            </>\n        );\n    } else {\n        output.push(\n            <div key={props.key}>\n                {selectIcon('search')} \"{state.searchString}\"{' '}\n            </div>\n        );\n\n        for (let i = 0; i < state.filters.length; i++) {\n            const filter = state.filters[i];\n            output.push(\n                <div>\n                    {selectIcon(filter.field)} {filter.label}\n                </div>\n            );\n        }\n\n        return <>{output}</>;\n    }\n}\n\nSearchCriteriaMini.propTypes = { location: PropTypes.any };\n\nexport function HistoryLocation(props) {\n    const { removeLocation } = useStoreActions((actions) => actions.history);\n    const history = useHistory();\n    const renderTooltip = (p) => {\n        return (\n            <Popover {...p} className={'c-HistoryLocation--popover'}>\n                <Popover.Content>\n                    <SearchCriteriaMini\n                        location={props.location}\n                        key={props.location?.key}\n                    />\n                </Popover.Content>\n            </Popover>\n        );\n    };\n\n    const type = props.location.kmasset\n        ? props.location.kmasset?.asset_type\n        : 'search';\n    const loc = props.location?.relTitle ? (\n        <>{JSON.stringify(props.location.relTitle)}</>\n    ) : (\n        <span className={'c-HistoryViewer__title'}>\n            {selectIcon(type)} {props.location?.name}\n            <FacetIcons state={props.location.state} />\n        </span>\n    );\n\n    // console.log('HistoryLocation: location = ', props.location);\n\n    return (\n        <OverlayTrigger\n            placement=\"auto\"\n            delay={{ show: 250, hide: 400 }}\n            overlay={renderTooltip}\n            data-filters={props.location?.state?.filters}\n            popperConfig={{\n                modifiers: [\n                    {\n                        name: 'offset',\n                        options: {\n                            offset: [0, 10],\n                        },\n                    },\n                ],\n            }}\n        >\n            <div\n                className=\"c-HistoryViewer__relatedRecentItem\"\n                onClick={(event) => history.push(props.location)}\n            >\n                {loc}\n                <span\n                    className=\"c-HistoryViewer__removeItem u-icon__cancel-circle icon\"\n                    data-key={props.location.key}\n                    alt={'Remove from list'}\n                    aria-label={'Remove from list'}\n                    onClick={(event) => {\n                        console.log('delete:', event.target.dataset.key);\n                        removeLocation(props.location);\n                        event.stopPropagation();\n                    }}\n                ></span>\n            </div>\n        </OverlayTrigger>\n    );\n}\n\nHistoryLocation.propTypes = { location: PropTypes.any };\n\nfunction FacetIcons(props) {\n    const state = props.state;\n    // console.log('Statey = ', state);\n\n    if (!state) {\n        return null;\n    }\n\n    let filterIcons = [];\n    for (let i = 0; i < state.filters.length; i++) {\n        const filt = state.filters[i];\n        const type = filt.field;\n        const selectedIcon = selectIcon(type);\n        filterIcons.push(selectedIcon);\n    }\n\n    return (\n        <span\n            className={'c-HistoryViewer__filterIcons'}\n            alt={'hooligans of virtue'}\n        >\n            {filterIcons}\n        </span>\n    );\n}\n\nFacetIcons.propTypes = { state: PropTypes.any };\n","import React from 'react';\nimport { useStoreState } from 'easy-peasy';\n\nimport './HistoryViewer.css';\nimport { HistoryLocation } from './HistoryLocation';\n\nexport function HistoryViewer(props) {\n    /*\n    const kmasset = useStoreState((state) => state.kmap.asset);\n*/\n    const historyStack = useStoreState((state) => state.history.historyStack);\n\n    let historyList = [];\n    historyStack.forEach((location, key) => {\n        const isSearch = location.search?.length ? true : false;\n        // console.log(\"HISTORY VIEWER: location = \", location);\n        if (\n            (isSearch && props.mode === 'search') ||\n            (!isSearch && props.mode !== 'search')\n        ) {\n            historyList.unshift(\n                <HistoryLocation key={location.key} location={location} />\n            );\n        }\n    });\n    return <div className=\"c-HistoryViewer\">{historyList}</div>;\n}\n\nexport default HistoryViewer;\n","import React from 'react';\nimport { Link, useRouteMatch } from 'react-router-dom';\nimport FancyTree from '../../FancyTree';\nimport HistoryViewer from '../../History/HistoryViewer';\nimport './RelatedsViewer.scss';\n\nexport function RelatedsViewer(props) {\n    // console.log('Relateds props = ', props);\n\n    const match = useRouteMatch([\n        '/:baseType/:baseUid/related-:type',\n        '/:baseType/:baseUid',\n    ]);\n    // console.log('Relateds match = ', match);\n\n    const loc = match?.params.type || 'home';\n    let locMatch = {};\n    locMatch[loc] = 'selected';\n\n    const baseArgs = {\n        baseType: match?.params.baseType || props.kmap?.tree || 'assets',\n        baseUid: props.id || match?.params.baseUid,\n        relateds: props.relateds,\n    };\n    if (!props.id && !baseArgs.baseUid) {\n        return null;\n    }\n\n    return (\n        <aside className={'l-column__related'}>\n            <div className=\"l-column__related__wrap\">\n                <section className=\"l-related__list__wrap\">\n                    <div className=\"u-related__list__header\">\n                        Related Resources\n                    </div>\n                    <div className=\"c-relatedViewer\">\n                        <Link\n                            id=\"sui-rl-Home\"\n                            to={\n                                '/' + baseArgs.baseType + '/' + baseArgs.baseUid\n                            }\n                            className={`c-related__link--home c-related__item ${locMatch['home']}`}\n                        >\n                            <span className={'icon u-icon__overview'}></span>{' '}\n                            <span>Home</span>\n                        </Link>\n\n                        <RelatedCount\n                            type={'all'}\n                            {...baseArgs}\n                            className={locMatch['mandala']}\n                        />\n                        <RelatedCount\n                            type={'places'}\n                            {...baseArgs}\n                            className={locMatch['places']}\n                        />\n                        <RelatedCount\n                            type={'audio-video'}\n                            {...baseArgs}\n                            className={locMatch['audio-video']}\n                        />\n                        <RelatedCount\n                            type={'images'}\n                            {...baseArgs}\n                            className={locMatch.images}\n                        />\n                        <RelatedCount\n                            type={'sources'}\n                            {...baseArgs}\n                            className={locMatch.sources}\n                        />\n                        <RelatedCount\n                            type={'texts'}\n                            {...baseArgs}\n                            className={locMatch.texts}\n                        />\n                        <RelatedCount\n                            type={'visuals'}\n                            {...baseArgs}\n                            className={locMatch.visuals}\n                        />\n                        <RelatedCount\n                            type={'subjects'}\n                            {...baseArgs}\n                            className={locMatch.subjects}\n                        />\n                        <RelatedCount\n                            type={'terms'}\n                            {...baseArgs}\n                            className={locMatch.terms}\n                        />\n                        <RelatedCount\n                            type={'collections'}\n                            {...baseArgs}\n                            className={locMatch.collections}\n                        />\n                    </div>\n                </section>\n\n                <section className=\"l-history__list__wrap\">\n                    <div className=\"u-related__list__header\">\n                        Recently Viewed\n                    </div>\n                    <HistoryViewer />\n                </section>\n\n                <section className=\"l-terms__tree__wrap\">\n                    <div className=\"u-related__list__header\">Browse Terms</div>\n                    <FancyTree\n                        domain=\"terms\"\n                        tree=\"terms\"\n                        descendants={true}\n                        directAncestors={false}\n                        displayPopup={false}\n                        perspective=\"tib.alpha\"\n                        view=\"roman.scholar\"\n                        sortBy=\"position_i+ASC\"\n                    />\n                </section>\n            </div>\n        </aside>\n    );\n}\n\nfunction RelatedCount(props) {\n    const count = props.relateds?.assets\n        ? props.relateds.assets[props.type]?.count\n        : 0;\n\n    // assign shanticon class according to type.  \"all\" type should get the \"shanticon-logo-shanti\" icon.\n    const iconClass =\n        'icon u-icon__' + (props.type === 'all' ? 'logo-shanti' : props.type);\n\n    // return null if the count doesn't exist or is === 0\n    return count ? (\n        <Link\n            id={'sui-rl-' + props.type}\n            href=\"#\"\n            className={'c-related__item c-related__link--' + props.type}\n            to={\n                '/' +\n                props.baseType +\n                '/' +\n                props.baseUid +\n                '/related-' +\n                props.type +\n                '/default'\n            }\n        >\n            <span className={'u-icon__' + props.type + ' ' + iconClass}></span>\n            <span className={'c-related__item__label'}> {props.type}</span>\n            <span id=\"sui-rln-places\">{count}</span>\n        </Link>\n    ) : null;\n}\n","import React from 'react';\nimport {Parser} from \"html-to-react\";\nimport $ from \"jquery\";\nimport {withRouter} from \"react-router-dom\";\n\nclass LegacyViewer extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.props = props;\n        this.sui = props.sui;\n\n        const id = this.props.id || this.props.match.params.id;\n\n        this.sui.GetKmapFromID(id, (kmasset) => {\n            console.log(\"LegacyViewer: kmasset = \", kmasset );\n            if ( !this.state || !this.state.kmasset || kmasset.uid && kmasset.uid !== this.state.kmasset.uid) {\n                this.state={ kmasset: kmasset, id:id };\n                this.sui.pages.Draw(this.state.kmasset, false);\n                this.props.onStateChange( this.state );\n                console.log(\"LegacyViewer: whoop\")\n            }\n        });\n    }\n\n    render() {\n        const parser = new Parser();  // html-to-jsx parser\n        const viewer = parser.parse($(this.sui.pages.div).html());\n        const relateds = parser.parse($(this.sui.pages.reldiv).html())\n        console.log(\"LegacyViewer VIEWER = \", viewer);\n        console.log(\"LegacyViewer RELDIV = \" + relateds);\n        return <div className={\"legacyviewer\"} >{ viewer }</div>\n    }\n}\n\nexport default withRouter(LegacyViewer);","import React from 'react';\nimport { useEffect, useState } from 'react';\nimport { createPortal } from 'react-dom';\n\nexport function FeatureFoldOutViewer(props) {\n    const [uid, setUid] = useState();\n    const imgUid = props.focus?.alt;\n\n    useEffect(() => {});\n\n    return (\n        <>\n            <center>\n                {props.focus ? <img src={props.focus.original} /> : <></>}\n            </center>\n            <pre>focus = {JSON.stringify(props.focus, undefined, 2)}</pre>\n        </>\n    );\n}\n\nexport function FeatureFoldOutPortal({\n    children,\n    portalRootId,\n    focused,\n    galleryRef,\n}) {\n    const mount = document.getElementById(portalRootId);\n    // console.log('Looking for portalRootId: ', mount);\n    const el = document.createElement('div');\n    useEffect(() => {\n        if (mount) {\n            mount.appendChild(el);\n        }\n        return () => {\n            if (mount) {\n                console.log('mount = ', mount);\n            }\n        };\n    }, [el, mount]);\n    return createPortal(children, el);\n}\n","import React, { useEffect, useRef, useState } from 'react';\nimport Card from 'react-bootstrap/Card';\nimport Accordion from 'react-bootstrap/Accordion';\nimport Button from 'react-bootstrap/Button';\nimport Jumbotron from 'react-bootstrap/Jumbotron';\nimport Container from 'react-bootstrap/Container';\nimport CardDeck from 'react-bootstrap/CardDeck';\nimport CardGroup from 'react-bootstrap/CardGroup';\nimport { FeaturePager } from './FeaturePager/FeaturePager';\nimport { FeatureCard } from './FeatureCard/FeatureCard';\nimport PhotoGallery, { Photo } from 'react-photo-gallery';\nimport ImageGallery from 'react-image-gallery';\n\nimport 'react-image-gallery/styles/css/image-gallery.css';\nimport {\n    FeatureFoldOutViewer,\n    FeatureFoldOutPortal,\n} from './FeatureFoldOutViewer';\n\nconst VIEWER_ID = 'FoldOutViewer';\nconst SELECTED_IMG_CLASS = 'sui-featureGallery-selectedImg';\n\n// The length of the Rows at each Break Point\n// const BP_SIZES = {\n//    sm: 2,\n//    md: 3,\n//    lg: 4,\n//    xl: 6,\n// };\n// utility function to insert breakpoints\n/*\nfunction insertBreakPoints(i, BP_SIZES, ret) {\n    if (i !== 0) {\n        if (i % BP_SIZES.sm === 0) {\n            ret.push(\n                <div\n                    className=\"w-100 d-none d-sm-block d-md-none\"\n                    key={'sm' + i}\n                ></div>\n            );\n        }\n        if (i % BP_SIZES.md === 0) {\n            ret.push(\n                <div\n                    className=\"w-100 d-none d-md-block d-lg-none\"\n                    key={'md' + i}\n                ></div>\n            );\n        }\n        if (i % BP_SIZES.lg === 0) {\n            ret.push(\n                <div\n                    className=\"w-100 d-none d-lg-block d-xl-none\"\n                    key={'lq' + i}\n                ></div>\n            );\n        }\n        if (i % BP_SIZES.xl === 0) {\n            ret.push(\n                <div className=\"w-100 d-none d-xl-block\" key={'xl' + i}></div>\n            );\n        }\n    }\n}\n*/\nexport function FeatureGallery(props) {\n    let insert = document.getElementById(VIEWER_ID);\n    if (!insert) {\n        insert = document.createElement('div');\n        insert.id = VIEWER_ID;\n    }\n    const [focusedFeature, setFocusedFeature] = useState(null);\n\n    const galleryRef = useRef();\n    // const viewerRef = useRef();\n\n    useEffect((x) => {\n        // console.log('FeatureGallery  useEffect: ', x);\n        // console.log('FeatureGallery  galleryRef= ', galleryRef.current);\n        // // console.log(\"FeatureGallery  viewerRef= \", viewerRef.current);\n    });\n\n    // console.log('FeatureGallery');\n    const docs = props.docs;\n\n    let DEBUG_PRE = [];\n    let LIST = [];\n\n    if (docs) {\n        LIST = docs?.map((doc, i) => {\n            const calc_thumb_width = doc.url_thumb_width\n                ? Number(doc.url_thumb_width)\n                : 200;\n            const calc_thumb_height = doc.url_thumb_height\n                ? Number(doc.url_thumb_height)\n                : 200;\n\n            const featureCard = {\n                original: doc.url_large ? doc.url_large : doc.url_thumb,\n                thumbnail: doc.url_thumb,\n                src: doc.url_thumb,\n                width: calc_thumb_width,\n                height: calc_thumb_height,\n                key: doc.uid,\n                alt: doc.uid,\n            };\n            return featureCard;\n        });\n\n        DEBUG_PRE = (\n            <Accordion>\n                <Accordion.Toggle as={Button} eventKey=\"0\">\n                    Full JSON\n                </Accordion.Toggle>\n                <Accordion.Collapse eventKey=\"0\">\n                    <pre>{JSON.stringify(docs, undefined, 1)}</pre>\n                </Accordion.Collapse>\n            </Accordion>\n        );\n    }\n\n    function handleImageClick(evt, chosen) {\n        // console.log('FeatureGallery CLICKED evt= ', evt);\n        // console.log('FeatureGallery CLICKED chosen= ', chosen);\n        // console.log('FeatureGallery CLICKED galleryRef = ', galleryRef);\n        // // console.log(\"FeatureGallery CLICKED viewerRef = \", viewerRef);\n\n        setFocusedFeature(chosen.photo);\n\n        // find the VIEWER by ID\n        let viewer = document.getElementById(VIEWER_ID);\n\n        // if its not to be found, create it.\n        if (!viewer) {\n            viewer = document.createElement('div');\n            viewer.id = VIEWER_ID;\n        }\n        // viewer.innerText = 'VIEWER: ' + chosen.photo.alt;\n\n        // if it already has the uid of the requested image, hide it\n        // otherwise set its width to 100%\n        if (\n            viewer.getAttribute('uid') === chosen.photo.alt &&\n            viewer.className !== 'hidden'\n        ) {\n            viewer.className = 'hidden';\n        } else {\n            viewer.className = 'w-100';\n        }\n\n        // set its uid attribute to the current image uid.\n        viewer.setAttribute('uid', chosen.photo.alt);\n\n        const selector = \"div[photoKey='\" + chosen.photo.alt + \"']\";\n        let domImg = galleryRef.current.querySelector(selector);\n\n        // before = true --> find the beginning of the row otherwise, find the end of the row\n        // might make this dynamic, so that \"high\" rows open downward and \"low\" rows open upward.\n        const before = false;\n\n        // scan the siblings to find the row end (or beginning)\n        const rowtop = domImg.offsetTop;\n        while (domImg.offsetTop === rowtop) {\n            const nextImg = before\n                ? domImg.previousSibling\n                : domImg.nextSibling;\n            if (!nextImg || nextImg.offsetTop !== rowtop) {\n                // stop if you get the end (or beginning) of the row\n                break;\n            }\n            domImg = nextImg; // prepare to look at the next img...\n        }\n\n        // domImg is now the last (or first) image of the same row.\n        // so let's viewer the foldout div\n        if (before) {\n            domImg.before(viewer);\n        } else {\n            domImg.after(viewer);\n        }\n    }\n\n    const gallery = (\n        <>\n            <div ref={galleryRef}>\n                <PhotoGallery\n                    targetRowHeight={200}\n                    photos={LIST}\n                    onClick={handleImageClick}\n                    renderImage={(props) => {\n                        let atts =\n                            props.key === focusedFeature?.alt\n                                ? { className: SELECTED_IMG_CLASS }\n                                : {};\n                        return (\n                            <div photoKey={props.key} {...atts}>\n                                <Photo {...props} />\n                            </div>\n                        );\n                    }}\n                />\n            </div>\n\n            {/* This Component is an HOC that provides a portal container so that the enclosed div (the viewer) can\n                be placed elsewhere-- specifically in the dynamic \"viewer\" div we created above and inserted directly\n                into the DOM */}\n            <FeatureFoldOutPortal\n                portalRootId={VIEWER_ID}\n                focus={focusedFeature}\n            >\n                <FeatureFoldOutViewer focus={focusedFeature} />\n            </FeatureFoldOutPortal>\n        </>\n    );\n\n    // This basic markup.\n    // TODO: Eventually we might not use a pager here and load the data progressively.\n    const output = (\n        <React.Fragment>\n            <FeatureGalleryHeaderLine title={props.title} />\n            <FeaturePager pager={props.pager} />\n            {gallery}\n            <FeaturePager pager={props.pager} />\n\n            <Jumbotron>{DEBUG_PRE}</Jumbotron>\n        </React.Fragment>\n    );\n    return output;\n}\n\nfunction FeatureGalleryHeaderLine(props) {\n    if (props.title) {\n        return <h5 className={'sui-relatedHeader'}>{props.title}</h5>;\n    } else {\n        return null;\n    }\n}\n","import React from 'react';\nimport { FeaturePager } from './FeaturePager/FeaturePager';\nimport _ from 'lodash';\nimport Card from 'react-bootstrap/Card';\nimport Container from 'react-bootstrap/Container';\nimport Accordion from 'react-bootstrap/Accordion';\n// import Button from \"react-bootstrap/Button\";\n\nexport function FeatureList(props) {\n    let LIST = _.map(props.docs, (doc) => {\n        return (\n            <Card className={'p-0 m-1'} key={doc.id}>\n                <Accordion>\n                    <Card.Body className={'p-1'}>\n                        <span\n                            className={'shanticon-' + doc.asset_type + ' icon'}\n                        />{' '}\n                        {doc.title} ({doc.uid})\n                        <Accordion.Toggle\n                            as={'span'}\n                            eventKey=\"0\"\n                            onClick={(x) => {\n                                if (x.target.innerHTML === '(+)') {\n                                    x.target.innerHTML = '(-)';\n                                } else {\n                                    x.target.innerHTML = '(+)';\n                                }\n                            }}\n                        >\n                            (+)\n                        </Accordion.Toggle>\n                        <Accordion.Collapse eventKey=\"0\">\n                            <Card>\n                                <pre>{JSON.stringify(doc, undefined, 2)}</pre>\n                            </Card>\n                        </Accordion.Collapse>\n                    </Card.Body>\n                </Accordion>\n                {/*<Card.Footer><pre>{ JSON.stringify(doc, undefined,2)}</pre></Card.Footer>*/}\n            </Card>\n        );\n    });\n\n    const output = (\n        <div>\n            <Container>\n                <FeaturePager pager={props.pager} />\n                {LIST}\n                <FeaturePager pager={props.pager} />\n            </Container>\n        </div>\n    );\n\n    return (\n        <div>\n            {output}\n            <pre>{JSON.stringify(props, undefined, 2)}</pre>\n        </div>\n    );\n}\n","import * as PropTypes from 'prop-types';\nimport React from 'react';\nimport { selectIcon } from '../views/common/utils';\nimport OverlayTrigger from 'react-bootstrap/OverlayTrigger';\nimport Popover from 'react-bootstrap/Popover';\n\nexport function FacetChoice(props) {\n    function handleFacetAdd() {\n        // console.log(\"DELEGATING Add Click: \", props);\n        props.onFacetClick({ ...props, action: 'add' });\n    }\n\n    function handleFacetRemove(x, y) {\n        // console.log(\"DELEGATING Remove Click: \", props)\n        props.onFacetClick({ ...props, action: 'remove' });\n    }\n\n    const chosen = props.chosen ? 'chosen' : '';\n    const icon = selectIcon(props.facetType);\n\n    const choice =\n        props.mode === 'add' ? (\n            <div\n                onClick={handleFacetAdd}\n                className={'sui-advEditLine ' + chosen}\n            >\n                <span className={props.className}></span> {icon} {props.label}(\n                {props.count}){' '}\n            </div>\n        ) : (\n            <div>\n                <span\n                    onClick={handleFacetRemove}\n                    className={props.className}\n                ></span>{' '}\n                {icon} {props.label}\n            </div>\n        );\n\n    const renderTooltip = (p) => {\n        // console.log(\"renderToolTip: p = \", p);\n        // console.log(\"renderToolTip: props = \", props);\n\n        return (\n            <Popover {...p} className={'c-FacetChoice--popover'}>\n                <Popover.Content>{props.value}</Popover.Content>\n            </Popover>\n        );\n    };\n\n    const wrapped_choice = (\n        <OverlayTrigger\n            placement=\"auto\"\n            delay={{ show: 250, hide: 400 }}\n            overlay={renderTooltip}\n            data-filters={props.location?.state?.filters}\n            popperConfig={{\n                modifiers: [\n                    {\n                        name: 'offset',\n                        options: {\n                            offset: [0, 10],\n                        },\n                    },\n                ],\n            }}\n        >\n            {choice}\n        </OverlayTrigger>\n    );\n\n    return wrapped_choice;\n}\n\nFacetChoice.propTypes = {\n    className: PropTypes.string,\n    value: PropTypes.any,\n    count: PropTypes.any,\n    mode: PropTypes.string,\n    chosen: PropTypes.bool,\n    onFacetClick: PropTypes.func,\n};\n","import React from 'react';\nimport { useStoreActions, useStoreState } from 'easy-peasy';\nimport { FacetChoice } from '../../search/FacetChoice';\nimport Badge from 'react-bootstrap/Badge';\nimport { CSSTransition, TransitionGroup } from 'react-transition-group'; // ES6\n\nexport function FeatureFilters(props) {\n    const filters = useStoreState((state) => state.search.query.filters);\n    const search = useStoreState((state) => state.search);\n\n    const { removeFilters } = useStoreActions((actions) => actions.search);\n\n    function handleFacetClick(...x) {\n        console.log('Received ', x);\n        console.log(' try to remove id = ', x.value);\n        removeFilters([{ id: x[0].value }]);\n    }\n\n    // console.log('FeatureFilters filters = ', filters);\n\n    const removeIconClass = 'sui-advTermRem u-icon__cancel-circle icon';\n\n    const entries =\n        filters?.map((entry) => {\n            // console.log('FeatureFilters x = ', entry);\n            return (\n                <CSSTransition key={entry.id} timeout={1000} classNames=\"item\">\n                    {/*<Badge*/}\n                    {/*    key={entry.id}*/}\n                    {/*    pill*/}\n                    {/*    variant={'secondary'}*/}\n                    {/*    className={'m-2 p-2 pr-3'}*/}\n                    {/*>*/}\n                    <FacetChoice\n                        mode={'remove'}\n                        key={`Remove ${entry.id}`}\n                        className={removeIconClass}\n                        value={entry.id}\n                        labelText={entry.label}\n                        label={entry.label}\n                        facetType={entry.field}\n                        onFacetClick={(msg) => {\n                            handleFacetClick({ ...msg, action: 'remove' });\n                        }}\n                    />\n                    {/*</Badge>*/}\n                </CSSTransition>\n            );\n        }) || [];\n\n    if (entries.length) {\n        entries.unshift(\n            <CSSTransition key=\"label\" timeout={1000} classNames=\"item\">\n                <span>Applied Filters: </span>\n            </CSSTransition>\n        );\n    }\n\n    return (\n        <span>\n            <TransitionGroup className={'sui-facetList-horiz'}>\n                {entries}\n            </TransitionGroup>\n        </span>\n    );\n}\n","import { FeatureGallery } from './FeatureGallery';\nimport React, { useState } from 'react';\nimport { Redirect, useHistory, useParams } from 'react-router';\nimport _ from 'lodash';\nimport { FeatureDeck } from './FeatureDeck';\nimport { FeatureList } from './FeatureList';\nimport ToggleButton from 'react-bootstrap/ToggleButton';\nimport ToggleButtonGroup from 'react-bootstrap/ToggleButtonGroup';\nimport Spinner from 'react-bootstrap/Spinner';\nimport { FeatureFilters } from './FeatureFilters';\n\n// There are three view modes encapsulated by three different components\n//          gallery:    FeatureGallery\n//          list:       FeatureList\n//          deck:       FeatureDeck\n//\n// FeatureCollection decides which view mode to use depending on two different settings\n//  1. viewMode property\n//  2. viewMode path id\n//\n\nconst DEFAULT_VIEWMODE = 'deck'; //  deck or gallery or list\n\nexport function FeatureCollection(props) {\n    const params = useParams();\n    // console.log(\"FeatureCollection: params: \", params);\n    const { viewMode: paramsViewMode } = params;\n    const [viewMode, setViewMode] = useState(DEFAULT_VIEWMODE);\n\n    // let determine the requested viewMode from props or from params.\n    const requestedViewMode = paramsViewMode ? paramsViewMode : props.viewMode;\n\n    // console.log(\"FeatureCollection: props.viewMode = \", props.viewMode);\n    // console.log(\"FeatureCollection: requestedViewMode = \", requestedViewMode);\n    // console.log(\"FeatureCollection: paramsViewMode = \", paramsViewMode);\n\n    if (!_.isEmpty(requestedViewMode) && viewMode !== requestedViewMode) {\n        setViewMode(requestedViewMode);\n    }\n\n    if (viewMode && paramsViewMode && paramsViewMode !== viewMode) {\n        return <Redirect to={viewMode} />;\n    }\n\n    // console.log( \"FeatureCollection: FINAL VIEWMODE = \", viewMode );\n\n    let viewer = <Redirect to={DEFAULT_VIEWMODE} />; // by default, let's redirect to the DEFAULT_VIEWMODE url\n    switch (viewMode) {\n        case 'gallery':\n            viewer = <FeatureGallery {...props} />;\n            break;\n        case 'deck':\n            viewer = <FeatureDeck {...props} />;\n            break;\n        case 'list':\n            viewer = <FeatureList {...props} />;\n            break;\n    }\n\n    return (\n        <div className={'c-buttoneGroup__viewMode__wrap'}>\n            <div className={'c-buttoneGroup__viewMode'}>\n                View Mode:{' '}\n                <FeatureCollectionViewModeSelector viewMode={viewMode} />\n                {props.loadingState && (\n                    <Spinner animation=\"border\" role=\"status\">\n                        <span className=\"sr-only\">Loading...</span>\n                    </Spinner>\n                )}\n            </div>\n\n            {props.showSearchFilters && <FeatureFilters />}\n            {viewer}\n        </div>\n    );\n}\n\nfunction FeatureCollectionViewModeSelector(props) {\n    const history = useHistory();\n    const { viewMode } = props;\n    const deck = { active: `viewMode === \"deck\"` };\n    const gallery = { active: `viewMode === \"gallery\"` };\n    const list = { active: `viewMode === \"list\"` };\n\n    function navigate(viewMode) {\n        // console.log(\"navigating \", viewMode);\n        history.push(viewMode);\n    }\n\n    const deckLabel = <span className={'u-icon__vcard-o icon'}></span>; // card deck\n    const galleryLabel = <span className={'u-icon__image icon'}></span>; // Gallery\n    const listLabel = <span className={'u-icon__list2 icon'}></span>; // List\n    return (\n        <ToggleButtonGroup\n            name={viewMode}\n            value={viewMode}\n            type={'radio'}\n            onChange={(mode) => navigate(mode)}\n        >\n            <ToggleButton name={'viewMode'} value={'deck'} type={'radio'}>\n                {deckLabel}\n            </ToggleButton>\n            <ToggleButton name={'viewMode'} value={'gallery'} type={'radio'}>\n                {galleryLabel}\n            </ToggleButton>\n            <ToggleButton name={'viewMode'} value={'list'} type={'radio'}>\n                {listLabel}\n            </ToggleButton>\n        </ToggleButtonGroup>\n    );\n}\n","import React, { useEffect } from 'react';\nimport { FeatureCollection } from './common/FeatureCollection';\nimport useStatus from '../hooks/useStatus';\nimport { useStoreState } from 'easy-peasy';\nimport qs from 'qs';\nimport { useHistory } from 'react-router';\n\nexport function SearchViewer(props) {\n    const status = useStatus();\n    const history = useHistory();\n    const loadingState = useStoreState((state) => state.search.loadingState);\n    const searchState = useStoreState((state) => state.search);\n\n    // assemble a truncated query string\n    const searchQueryString = qs.stringify(\n        {\n            page: {\n                current: searchState.page.current,\n                rows: searchState.page.rows,\n            },\n            query: {\n                filters: searchState.query.filters,\n                searchText: searchState.query.searchText,\n            },\n        },\n        { allowDots: true }\n    );\n\n    useEffect(() => {\n        // Assemble and Set Header Data\n        const searchText =\n            searchState.query?.searchText?.length > 1\n                ? '\"' + searchState.query.searchText + '\"'\n                : '*';\n        const mod_count = searchState.query?.filters?.length || 0;\n        const searchStateModifiers = mod_count\n            ? ' (+' + mod_count + ' filter' + (mod_count !== 1 ? 's' : '') + ')'\n            : '';\n        status.clear();\n        status.setHeaderTitle(\n            'Search Results: ' + searchText + ' ' + searchStateModifiers\n        );\n        status.setSubTitle('For a Better Tomorrow...');\n    }, [searchQueryString]);\n\n    useEffect(() => {\n        history.replace(`?${searchQueryString}`);\n    }, [searchQueryString]);\n\n    let output = (\n        <FeatureCollection\n            {...props}\n            viewMode={'deck'}\n            loadingState={loadingState}\n            inline={false}\n            showSearchFilters={true}\n        />\n    );\n    return output;\n}\n","import React, { useEffect } from 'react';\nimport useStatus from '../hooks/useStatus';\n\nexport function CollectionsViewer(props) {\n    const status = useStatus();\n\n    useEffect(() => {\n        if (!props.inline) {\n            console.log(props);\n            status.clear();\n            status.setHeaderTitle('Collections Viewer For A Better Tomorrow');\n            status.setType('collections');\n        }\n    });\n\n    return (\n        <div className={'Collections legacy'}>\n            NOT YET IMPLEMENTED Collections LEGACY{' '}\n            <pre>{JSON.stringify(props.kmasset)}</pre>\n        </div>\n    );\n}\n","import React, { useEffect } from 'react';\nimport useStatus from '../hooks/useStatus';\n\nexport function CollectionsHome(props) {\n    const status = useStatus();\n\n    useEffect(() => {\n        status.clear();\n        status.setHeaderTitle('Collections Home');\n    });\n\n    return <> Collections Home: Not much here yet.. </>;\n}\n\nexport default CollectionsHome;\n","import React, { useEffect, useState } from 'react';\nimport { useParams } from 'react-router';\nimport _ from 'lodash';\nimport { useStoreActions, useStoreState } from '../model/StoreModel';\nimport useStatus from '../hooks/useStatus';\nimport Modal from 'react-bootstrap/Modal';\nimport Button from 'react-bootstrap/Button';\n\n/**\n *    Container which injects the kmap and kmasset data, before rendering the its children.\n *\n *    It injects the props:\n *\n *          kmap:  The current fully-populated KMAP data including full solr child data\n *          kmasset:  The current ASSET data\n *\n *          NB:  This will ONLY inject into top-level children.  It is fully expected for these top-level components to manage\n *          passing its props to its children as needed.\n *\n *\n * */\n\nexport default function KmapContext(props) {\n    // console.log('KmapContext: props=', props);\n\n    const status = useStatus();\n\n    // Let's do the Easy Peasy thing\n    const kmapActions = useStoreActions((actions) => actions.kmap);\n    const {\n        firstRelatedsPage,\n        gotoRelatedsPage,\n        lastRelatedsPage,\n        nextRelatedsPage,\n        prevRelatedsPage,\n        setRelatedsPage,\n        setRelatedsPageSize,\n        setUid,\n        update,\n        receiveKmap,\n    } = kmapActions;\n\n    const searchActions = useStoreActions((actions) => actions.search);\n\n    // console.log(\"I'm seeing these kmap actions: \", kmapActions );\n    // console.log(\"I'm seeing these search actions: \", searchActions );\n\n    // Easy Peasy State Mapping\n    const mapped_kmap = useStoreState((state) => state.kmap);\n    const kmapId = useStoreState((state) => state.kmap.uid);\n    const kmasset = useStoreState((state) => state.kmap.asset);\n    const relateds = useStoreState((state) => state.kmap.relateds);\n    const kmap = useStoreState((state) => state.kmap.kmap);\n    const loadingState = useStoreState((state) => state.kmap.loadingState);\n    const relatedPage = useStoreState((state) => state.kmap.relatedsPage?.page);\n    const relatedPageSize = useStoreState(\n        (state) => state.kmap.relatedsPage?.pageSize\n    );\n\n    // Handle cases where the id is \"full\" or numeric  e.g \"places-637\" vs. \"637\"\n    const { id: requestId, relatedType } = useParams();\n    let prefix = '';\n    if (requestId && !requestId.match(/[a-z]\\-\\d+/)) {\n        // console.log('KmapContext: requestId=', requestId);\n        if (props.assetType) {\n            prefix = props.assetType + '-';\n        }\n    }\n    const id = prefix + requestId;\n\n    const pager = {\n        getMaxPage: () => {\n            if (!relateds.assets || !relateds.assets[relatedType]) {\n                return 0;\n            } else {\n                const maxCount = relateds.assets[relatedType].count;\n                const maxPage = Math.floor((maxCount - 1) / relatedPageSize);\n                return maxPage;\n            }\n        },\n        getPage: () => {\n            return relatedPage;\n        },\n        setPage: (pg) => {\n            pg = Number(pg);\n            const maxCount = relateds.assets[relatedType].count;\n            const maxPage = Math.floor(maxCount / relatedPageSize);\n            pg = _.isNaN(pg) ? 0 : pg;\n            if (pg > maxPage) {\n                gotoRelatedsPage(maxPage);\n            } else if (pg < 0) {\n                gotoRelatedsPage(0);\n            } else {\n                gotoRelatedsPage(pg);\n            }\n        },\n        setPageSize: (size) => {\n            size = Number(size);\n            let oldSize = Number(size);\n            let oldPage = Number(relatedPage);\n            size = size < 1 ? 1 : size;\n            size = _.isNaN(size) ? oldSize : size;\n            setRelatedsPageSize(size);\n            let newPage = Math.floor((relatedPageSize / oldSize) * oldPage);\n            // console.log(\"newPage: \" + newPage + \" oldPage: \" + oldPage + \" pageSize = \" + relatedPageSize + \" oldSize = \" + oldSize);\n            newPage = _.isNaN(newPage) ? 0 : newPage;\n            pager.setPage(newPage);\n        },\n        getPageSize: () => {\n            return relatedPageSize;\n        },\n        nextPage: () => {\n            pager.setPage(pager.getPage() + 1);\n        },\n        prevPage: () => {\n            pager.setPage(pager.getPage() - 1);\n        },\n        lastPage: () => {\n            pager.setPage(pager.getMaxPage());\n        },\n        firstPage: () => {\n            pager.setPage(0);\n        },\n    };\n\n    useEffect(() => {\n        if (id) {\n            setUid(id);\n            setRelatedsPage({\n                related_type: relatedType,\n                page: relatedPage,\n                pageSize: relatedPageSize,\n            });\n        }\n    }, [id, relatedType, relatedPage, relatedPageSize]);\n\n    const ret_children = React.Children.map(props.children, (child) => {\n        if (child.type) {\n            const new_child = React.cloneElement(child, {\n                id: id,\n                kmap: kmap,\n                kmasset: kmasset,\n                relateds: relateds,\n                pager: pager,\n            });\n            return new_child;\n        } else {\n            return child;\n        }\n    });\n    return ret_children;\n}\n","import React from 'react';\nimport { useSolr } from './useSolr';\nconst QUERY_KEY = 'kmassets';\n\nconst useAsset = (asset_type, nid) => {\n    const querySpecs = {\n        index: 'assets',\n        params: {\n            q: `asset_type:${asset_type} AND id:${nid}`,\n            rows: 1,\n        },\n    };\n\n    const resource = useSolr(QUERY_KEY, querySpecs);\n    // console.log('useAsset: querySpecs = ', querySpecs);\n    // console.log('useAsset: returning resource = ', resource);\n    return resource;\n};\n\nexport default useAsset;\n","import React from 'react';\nimport { useQuery } from 'react-query';\nimport jsonpAdapter from '../logic/axios-jsonp';\nimport axios from 'axios';\n\nconst QUERY_KEY = 'mndlapi';\n\n/**\n * Function to do an Axios request for a JSON API using jsonp.\n *\n * @param _\n * @param query\n * @returns {Promise<boolean|*>}\n */\nconst getMandalaAPI = async (_, { query }) => {\n    if (query === '') {\n        return false;\n    }\n    const request = {\n        adapter: jsonpAdapter,\n        callbackParamName: 'callback',\n        url: query,\n    };\n\n    const { data } = await axios.request(request);\n    //console.log(\"isloading\", isLoading);\n    const retdata = data && data.response ? data.response : data;\n    return retdata;\n};\n\n/**\n * UseMandala is a hook to call Mandala node data apis in JSON. It was written originally for AV and may need\n * additional code to handle other sites. It takes a solr object returned by the useAsset() hook which queries\n * SOLR for a single asset's record. It uses the useQuery enabled setting to wait for useAsset to return the JSON\n * object from the SOLR qurey. It takes the url_json field from that solr record and uses that to call the\n * API. In AV, the API call ends with `.json`. So it replaces this with `.jsonp?callback=mdldata`. And with that\n * and the useQuery() hook calls the getMandalaAPI() function above. The axios jsonp request assumes the callback\n * parameter name in the url is `callback`.\n *\n * Than Grove, Aug. 26, 2020\n *\n * @param solrobj\n * @returns {unknown}\n */\nconst useMandala = (solrobj) => {\n    let json_url = '';\n    if (solrobj) {\n        if (solrobj.url_json) {\n            json_url = solrobj.url_json;\n        } else if (solrobj.docs && solrobj.docs.length > 0) {\n            json_url = solrobj.docs[0].url_json;\n        }\n    }\n    json_url = json_url.replace(/\\.json$/, '.jsonp?callback=mdldata');\n    const res = useQuery([QUERY_KEY, { query: json_url }], getMandalaAPI, {\n        enabled: json_url,\n    });\n    //console.log(\"use mandala error\", error);\n    return res && res.data ? res.data : false;\n};\n\nexport default useMandala;\n","import React, { useState, useEffect } from 'react';\nimport useStatus from '../hooks/useStatus';\nimport useAsset from '../hooks/useAsset';\nimport useMandala from '../hooks/useMandala';\nimport { NotFoundPage } from '../views/common/utilcomponents';\nimport { useParams } from 'react-router';\n\n/**\n *    Container which injects the SOLR asset data and Mandala JSON data, before rendering an asset component.\n *    It takes a prop \"assetType\" set to the asset type and uses any of the following params:\n *          relId, id, nid\n *\n *    It injects the props into the viewer for that asset type:\n *          id: The integer part of the asset's ID\n *          asset_type: The name of the asset app, e.g. texts, visuals, etc. (necessary to make the api call)\n *          mdlasset:  The current ASSET data in json from Mandala\n *\n *    Uses hooks two hooks:\n *          useAsset: queries SOLR and gets the assets Solr record\n *          useMandala: takes the url_json from the solr record and loads the items json from the Drupal all\n *\n *    It then \"injects\" into that data into the children, the apps particular component, by cloning it with\n *    the prop information.\n *\n *    This is evoked within the ContentMain.js and should wrap the component of the Mandala App in question\n *    As for instance was done for texts:\n *           <MdlAssetContext assetType={'texts'}>\n *               <TextsViewer onStateChange={props.onStateChange}/>\n *           </MdlAssetContext>\n *\n * */\nexport default function GenAssetContext(props) {\n    const asset_type = props.assetType;\n    const [mdlasset, setMdlAsset] = useState(null);\n    const [notfound, setNotFound] = useState(false);\n    const params = useParams();\n    let nid = params.relId || params.id || params.nid; // When ID param is just a number\n    if (nid.indexOf('-') > 1) {\n        // When ID param is something like \"texts-1234\".\n        nid = nid.split('-').pop();\n    }\n\n    const status = useStatus();\n    status.setType(asset_type);\n\n    const solrdata = useAsset(asset_type, nid);\n    const nodejson = useMandala(solrdata);\n\n    useEffect(() => {\n        if (solrdata?.docs && solrdata.docs.length > 0) {\n            setMdlAsset(solrdata.docs[0]);\n        } else if (solrdata.status === 'success') {\n            setNotFound(true);\n        }\n    }, [solrdata]);\n\n    if (notfound) {\n        let header = asset_type;\n        header = header[0].toUpperCase() + header.substr(1).replace('-v', '-V');\n        status.setHeaderTitle(header);\n        return <NotFoundPage type={asset_type} id={nid} />;\n    } else {\n        return React.Children.map(props.children, (child) => {\n            if (child.type) {\n                return React.cloneElement(child, {\n                    asset_type: asset_type,\n                    id: nid,\n                    mdlasset: mdlasset,\n                    nodejson: nodejson,\n                });\n            } else {\n                return child;\n            }\n        });\n    }\n}\n","import { buildNestedDocs } from '../../common/utils';\nimport React from 'react';\nimport _ from 'lodash';\nimport './NameEntry.css';\n\nexport default function TermNames(props) {\n    // console.log(\"calling buildNestedDocs\");\n\n    // TODO: Refactor so that Redux delivers the rebuilt nested docs instead of leaving it up to the Components.\n    const namesTree = buildNestedDocs(\n        props.kmap?._childDocuments_,\n        'related_names'\n    );\n\n    return (\n        <div className=\"sui-nameEntry__wrapper\">\n            <ul className=\"sui-nameEntry first-entry\">\n                <NameEntry names={namesTree} />\n            </ul>\n        </div>\n    );\n}\n\n/* NameEntry recursively draws the Name Tree\n *   expects: props.names = tree built by buildNestedDocs()\n *\n * Perhaps this should parameterized...?\n *\n */\nexport function NameEntry(props) {\n    let outlist = [];\n\n    console.log('NameEntry: props.names=', props.names);\n    Object.entries(props.names).map(([id, entry]) => {\n        outlist.push(\n            <li id={id} key={id} className=\"sui-nameEntry\">\n                <span className=\"sui-nameEntry-header\">\n                    {entry.related_names_header_s}\n                </span>\n                <span className=\"sui-nameEntry-meta\">\n                    <span className=\"sui-nameEntry-language\">\n                        {entry.related_names_language_s}\n                    </span>\n                    <span className=\"sui-nameEntry-relationship\">\n                        {entry.related_names_relationship_s}\n                    </span>\n                    <span className=\"sui-nameEntry-writing-system\">\n                        {entry.related_names_writing_system_s}\n                    </span>\n                </span>\n                {!_.isEmpty(entry._nested_) && (\n                    <ul>\n                        <NameEntry names={entry._nested_} />\n                    </ul>\n                )}\n            </li>\n        );\n        return true;\n    });\n    const output = <React.Fragment>{outlist}</React.Fragment>;\n    return output;\n}\n","import * as PropTypes from 'prop-types';\nimport React from 'react';\nimport { useHistory, useRouteMatch } from 'react-router';\nimport { Link } from 'react-router-dom';\nimport useAsset from '../../hooks/useAsset';\nimport { grokId } from './utils';\n\nfunction NodeHeader(props) {\n    const history = useHistory();\n    const match = useRouteMatch();\n    const back = props.back || false;\n\n    let { id, relId, relatedType, viewerType, viewMode } = match.params;\n    // console.log('Nodeheader match = ', match);\n    // console.log('NodeHeader id = ', id);\n    // console.log('NodeHeader relId = ', relId);\n    // console.log('Nodeheader viewMode = ', viewMode);\n    // console.log('Nodeheader viewerType = ', viewerType);\n\n    let itemHeader = null;\n\n    if (props.relatedType) {\n        relatedType = props.relatedType;\n    }\n\n    const nid = relId ? grokId(relId) : grokId(id);\n    // console.log(\"NodeHeader calling useAsset with relatedType = \", relatedType, \" nid = \", nid);\n    const relatedData = useAsset(relatedType, nid);\n\n    if (relId && relatedType) {\n        // console.log(\"NodeHeader relatedData = \", relatedData);\n\n        const docs = relatedData?.docs;\n        let caption = null;\n\n        if (docs?.length) {\n            caption =\n                docs[0].caption || docs[0].title ? docs[0].title[0] : null;\n        }\n\n        itemHeader = docs?.length ? (\n            <h5 className={'c-nodeHeader-itemHeader'}>\n                <span className={'icon u-icon__' + docs[0].asset_type}></span>\n                <span className={'c-nodeHeader-itemHeader-subType'}>\n                    {docs[0].asset_subtype}\n                </span>\n                <span className={'c-nodeHeader-itemHeader-caption'}>\n                    {caption}\n                </span>\n            </h5>\n        ) : null;\n        // console.log(\"NodeHeader itemHeader = \", itemHeader);\n    }\n\n    let subHeader =\n        props.subHeader ||\n        (relatedType === 'all'\n            ? 'All Related Items'\n            : viewerType\n            ? 'Related ' + relatedType\n            : null);\n    const nameTibtText = props.kmasset?.name_tibt\n        ? props.kmasset.name_tibt[0]\n        : null;\n    const nameLatinText = props.kmasset?.name_latin\n        ? props.kmasset.name_latin[0]\n        : props.kmasset.title[0];\n    const nameTibtElem = nameTibtText ? (\n        <span className={'sui-nodeTitle-item tibt'}>{nameTibtText} </span>\n    ) : null;\n    const nameLatinElem = nameLatinText ? (\n        <span className={'sui-nodeTitle-item latin'}>{nameLatinText}</span>\n    ) : null;\n\n    return (\n        <div className={'c-nodeHeader'}>\n            {back && (\n                <div className={'c-nodeHeader__backLink__wrap'}>\n                    <Link to={'..'} className={'c-nodeHeader__backLink'}>\n                        <span className={'icon u-icon__arrow-left_2'}>\n                            Return\n                        </span>\n                    </Link>\n                </div>\n            )}\n            <span\n                className={`icon u-icon__${props.kmasset?.asset_type}`}\n            ></span>\n            <span className=\"sui-termTitle sui-nodeTitle\" id=\"sui-termTitle\">\n                {nameTibtElem} {nameLatinElem}\n            </span>{' '}\n            {subHeader && (\n                <span className={'sui-relatedSubHeader'}>{subHeader}</span>\n            )}\n            {itemHeader}\n        </div>\n    );\n}\n\nNodeHeader.propTypes = { kmap: PropTypes.any };\n\nexport default NodeHeader;\n","import { useParams } from 'react-router-dom';\nimport React from 'react';\nimport { FeatureGallery } from './FeatureGallery';\nimport { FeatureCollection } from './FeatureCollection';\n\n// Special case of the FeatureGallery\nexport function RelatedsGallery(props) {\n    const { relatedType: type } = useParams(); // USES PARAMS from React Router  Refactor?\n    const allAssets = props.relateds?.assets;\n    const assets = allAssets ? allAssets[type] : null;\n    const docs = assets?.docs;\n\n    // Give a nice title.\n    const title = type !== 'all' ? `Related ${type}` : 'All Related Items';\n    return (\n        <FeatureCollection\n            docs={docs}\n            pager={props.pager}\n            title={title}\n            viewMode={'gallery'}\n            inline={true}\n        />\n    );\n}\n","import _ from 'lodash';\nimport React, { useRef, useState } from 'react';\nimport './TermAudioPlayer.css';\n\nfunction TermAudioPlayer(props) {\n    const audioRefs = _.filter(props.kmap?._childDocuments_, (x) => {\n        return x.block_child_type === 'terms_recording';\n    });\n\n    const player = useRef();\n    const defRecordingUrl = audioRefs[0]?.recording_url;\n\n    const [audioUrl, setAudioUrl] = useState(defRecordingUrl);\n\n    const option_list = _.map(audioRefs, (x, i) => (\n        <option key={i} value={x.recording_url}>\n            {x.recording_dialect_s}\n        </option>\n    ));\n    const handleSelect = (e) => {\n        setAudioUrl(e.target.value);\n    };\n\n    const playButton = audioUrl ? (\n        <>\n            <button\n                className=\"c-audioPlayer__button\"\n                onClick={() => {\n                    player.current.play();\n                }}\n            >\n                <span className=\"icon u-icon__audio\"></span>\n            </button>\n            <select\n                className=\"c-audioPlayer__select\"\n                onChange={(e) => handleSelect(e)}\n            >\n                {option_list}\n            </select>\n        </>\n    ) : (\n        'No Audio Available'\n    );\n\n    return (\n        <div className=\"c-audioPlayer\">\n            <audio src={audioUrl} ref={(ref) => (player.current = ref)} />\n            <form\n                onSubmit={(event) => {\n                    event.preventDefault();\n                    return false;\n                }}\n            >\n                {playButton}\n            </form>\n        </div>\n    );\n}\n\nexport default TermAudioPlayer;\n","import React from 'react';\nimport _ from 'lodash';\nimport ReactHtmlParser from 'react-html-parser';\nimport './TermEtymology.css';\n\nconst TermEtymology = (props) => {\n    let etymologies = _.pickBy(props.kmap, (value, key) =>\n        /^etymology_\\d+/.test(key)\n    );\n    etymologies = _.reduce(\n        etymologies,\n        (accum, val, key) => {\n            const num = /^etymology_(\\d+)/.exec(key)[1];\n            if (!accum[num]) accum[num] = {};\n            if (key.indexOf('_content_') !== -1) {\n                accum[num]['content'] = val;\n            } else {\n                accum[num]['heading'] = val;\n            }\n            return accum;\n        },\n        {}\n    );\n\n    return (\n        <div className=\"sui-etymology__wrapper\">\n            <div className=\"sui-etymology__content\">\n                {Object.keys(etymologies).map((key) => (\n                    <div key={key} className=\"sui-etymology__content-items\">\n                        <span className=\"sui-etymology__heading\">\n                            {etymologies[key].heading}:{' '}\n                        </span>\n                        <span className=\"sui-etymology__text\">\n                            {ReactHtmlParser(\n                                etymologies[key].content\n                                    .toString()\n                                    .replace(/(<([^>]+)>)/gi, '')\n                            )}\n                        </span>\n                    </div>\n                ))}\n            </div>\n        </div>\n    );\n};\n\nexport default TermEtymology;\n","import React from 'react';\nimport _ from 'lodash';\nimport './TermDefinitionsDetails.css';\n\nconst TermDefinitionsDetails = ({ def }) => {\n    const details = _.reduce(\n        def,\n        (accum, value, key) => {\n            const matches = key.match(\n                /^related_definitions_branch_subjects-(\\d+)_(\\w+)/\n            );\n            if (matches?.length > 0) {\n                accum[matches[1]] = accum[matches[1]] || {};\n                switch (matches[2]) {\n                    case 'header_s':\n                        accum[matches[1]]['header_title'] = value;\n                        break;\n                    case 'subjects_headers_t':\n                        accum[matches[1]]['header_text'] = value;\n                        break;\n                    case 'subjects_uids_t':\n                        accum[matches[1]]['header_uids'] = value;\n                        break;\n                    default:\n                        break;\n                }\n            }\n            return accum;\n        },\n        {}\n    );\n    return (\n        <div className=\"sui-termDefDetailsWrapper\">\n            {Object.keys(details).map((key) => (\n                <div key={key} className=\"sui-termDefDetails__item\">\n                    <span className=\"sui-termDefDetails__title\">\n                        {details[key].header_title}:{' '}\n                    </span>\n                    <span className=\"sui-termDefDetails__text\">\n                        {details[key].header_text.join(', ')}\n                    </span>\n                </div>\n            ))}\n        </div>\n    );\n};\n\nexport default TermDefinitionsDetails;\n","import React from 'react';\nimport './TermDefinitionsPassages.css';\n\nconst TermDefinitionsPassages = () => (\n    <div>No Passage data currently available</div>\n);\n\nexport default TermDefinitionsPassages;\n","import React from 'react';\nimport Button from 'react-bootstrap/Button';\nimport './TermDefinitionsResources.css';\n\nconst TermDefinitionsResources = ({ defID, resCounts }) => {\n    const resources = resCounts[defID];\n    if (!resources) {\n        return (\n            <div className=\"sui-termDefResource__wrapper\">\n                No resources are currently tagged with this definition.\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"sui-termDefResource__wrapper\">\n            <div className=\"sui-termDefResource__header\">\n                Resources tagged with this definition:\n            </div>\n            <div className=\"sui-termDefResource__content\">\n                {Object.keys(resources)\n                    .filter((key) => key !== 'all')\n                    .map((key) => (\n                        <Button key={key} variant=\"outline-dark\" size=\"lg\">\n                            <span className={`u-icon__${key} icon`}></span>\n                            <span className=\"btn-text\">\n                                {key.toUpperCase()}\n                            </span>{' '}\n                            <span className=\"badge badge-light\">\n                                {resources[key]}\n                            </span>\n                        </Button>\n                    ))}\n            </div>\n        </div>\n    );\n};\n\nexport default TermDefinitionsResources;\n","import React from 'react';\nimport Tabs from 'react-bootstrap/Tabs';\nimport Tab from 'react-bootstrap/Tab';\nimport ReactHtmlParser from 'react-html-parser';\nimport _ from 'lodash';\nimport { IconContext } from 'react-icons';\nimport { TiArrowUnsorted } from 'react-icons/ti';\nimport TermDefinitionsDetails from './TermDefinitionsDetails';\nimport TermDefinitionsPassages from './TermDefinitionsPassages';\nimport TermDefinitionsResources from './TermDefinitionsResources';\nimport './TermDefinitions.css';\n\nconst TermDefinitions = (props) => {\n    //Get Resources keyed by definition-id\n\n    // console.log(\"TermDefinitions: props = \", props);\n\n    const relatedDocs = props.kmRelated.assets?.all?.docs || [];\n    const uid = props.kmRelated.uid;\n    const re = new RegExp(`${uid}_definitions-\\\\d+`);\n    const resourceCounts = {};\n    for (const doc of relatedDocs) {\n        for (const kmapid of doc.kmapid) {\n            if (re.test(kmapid)) {\n                resourceCounts[kmapid] = resourceCounts[kmapid] ?? {};\n                resourceCounts[kmapid][doc.asset_type] =\n                    resourceCounts[kmapid][doc.asset_type] + 1 || 1;\n                resourceCounts[kmapid]['all'] =\n                    resourceCounts[kmapid]['all'] + 1 || 1;\n            }\n        }\n    }\n\n    return (\n        <div className=\"sui-termDefinitions_wrapper\">\n            <div className=\"sui-termDefinitions__content\">\n                {_.orderBy(props.mainDefs, (val) => val.order, 'asc').map(\n                    (def, order) => (\n                        <Tabs key={def.id} defaultActiveKey=\"definition\">\n                            <Tab\n                                eventKey=\"definition\"\n                                title={\n                                    <>\n                                        <span className=\"sui-termDefinitions__tabHeading\">\n                                            {`${parseInt(order, 10) + 1}. `}\n                                            Definition{' '}\n                                        </span>\n                                        <IconContext.Provider\n                                            value={{\n                                                style: {\n                                                    verticalAlign: 'middle',\n                                                },\n                                            }}\n                                        >\n                                            <TiArrowUnsorted />\n                                        </IconContext.Provider>\n                                    </>\n                                }\n                            >\n                                {ReactHtmlParser(\n                                    def.related_definitions_content_s\n                                )}\n                                {def.related_definitions_author_s &&\n                                    def.related_definitions_language_s && (\n                                        <div className=\"sui-termDefinitions__extra\">\n                                            <span className=\"sui-termDefinitions__extra-author\">\n                                                Author:\n                                            </span>{' '}\n                                            <span className=\"sui-termDefinitions__extra-author-text\">\n                                                {\n                                                    def.related_definitions_author_s\n                                                }\n                                            </span>{' '}\n                                            |{' '}\n                                            <span className=\"sui-termDefinitions__extra-lang\">\n                                                Language:\n                                            </span>{' '}\n                                            <span className=\"sui-termDefinitions__extra-lang-text\">\n                                                {\n                                                    def.related_definitions_language_s\n                                                }\n                                            </span>\n                                        </div>\n                                    )}\n                            </Tab>\n                            <Tab\n                                eventKey=\"details\"\n                                title={\n                                    <>\n                                        <span className=\"sui-termDefinitions__tabHeading\">\n                                            Details{' '}\n                                        </span>\n                                        <IconContext.Provider\n                                            value={{\n                                                style: {\n                                                    verticalAlign: 'middle',\n                                                },\n                                            }}\n                                        >\n                                            <TiArrowUnsorted />\n                                        </IconContext.Provider>\n                                    </>\n                                }\n                            >\n                                <TermDefinitionsDetails def={def} />\n                            </Tab>\n                            <Tab\n                                eventKey=\"passages\"\n                                title={\n                                    <>\n                                        <span className=\"sui-termDefinitions__tabHeading\">\n                                            Passages (0){' '}\n                                        </span>\n                                        <IconContext.Provider\n                                            value={{\n                                                style: {\n                                                    verticalAlign: 'middle',\n                                                },\n                                            }}\n                                        >\n                                            <TiArrowUnsorted />\n                                        </IconContext.Provider>\n                                    </>\n                                }\n                            >\n                                <TermDefinitionsPassages />\n                            </Tab>\n                            <Tab\n                                eventKey=\"resources\"\n                                title={\n                                    <>\n                                        <span className=\"sui-termDefinitions__tabHeading\">\n                                            Resources (\n                                            {resourceCounts[def.id]?.all || 0}){' '}\n                                        </span>\n                                        <IconContext.Provider\n                                            value={{\n                                                style: {\n                                                    verticalAlign: 'middle',\n                                                },\n                                            }}\n                                        >\n                                            <TiArrowUnsorted />\n                                        </IconContext.Provider>\n                                    </>\n                                }\n                            >\n                                <TermDefinitionsResources\n                                    defID={def.id}\n                                    resCounts={resourceCounts}\n                                />\n                            </Tab>\n                        </Tabs>\n                    )\n                )}\n            </div>\n        </div>\n    );\n};\n\nexport default TermDefinitions;\n","import React from 'react';\nimport ReactHtmlParser from 'react-html-parser';\nimport './TermDictionaries.css';\n\nconst TermDictionaries = ({ definitions }) => {\n    return (\n        <div className=\"sui-termDicts__wrapper\">\n            <div className=\"sui-termDicts__title\">Other Dictionaries</div>\n            <div className=\"sui-termDicts__content\">\n                {Object.keys(definitions).map((key, i) => (\n                    <React.Fragment key={key}>\n                        <div className=\"sui-termDicts__dict-name\">\n                            {i + 1}. {key}\n                        </div>\n                        <ul className=\"sui-termDicts__dict-wrapper\">\n                            {definitions[key].map((dict) => (\n                                <li\n                                    className=\"sui-termDicts__dict\"\n                                    key={dict.id}\n                                >\n                                    {ReactHtmlParser(\n                                        dict.related_definitions_content_s.replace(\n                                            /(<p[^>]+?>|<p>|<\\/p>)/gim,\n                                            ''\n                                        )\n                                    )}\n                                    {dict.related_definitions_language_s && (\n                                        <div className=\"sui-termDicts__dict-extra\">\n                                            <span className=\"sui-termDicts__dict-extra-lang\">\n                                                Language:\n                                            </span>{' '}\n                                            <span className=\"sui-termDicts__dict-extra-lang-text\">\n                                                {\n                                                    dict.related_definitions_language_s\n                                                }\n                                            </span>\n                                        </div>\n                                    )}\n                                </li>\n                            ))}\n                        </ul>\n                    </React.Fragment>\n                ))}\n            </div>\n        </div>\n    );\n};\n\nexport default TermDictionaries;\n","import React from 'react';\nimport { MandalaPopover } from '../../common/MandalaPopover';\nimport './TermsDetails.css';\n\nconst TermsDetails = (props) => {\n    return (\n        <div className=\"sui-termsDetails__wrapper\">\n            <ul className=\"sui-termsDetails__list\">\n                {props.kmAsset?.associated_subject_map_idfacet?.map((asset) => {\n                    const assetSplit = asset.split('|');\n                    const assocSubject = assetSplit[1].split('=');\n                    const subID = assocSubject[1].split('-');\n                    return (\n                        <li className=\"sui-termsDetails__list-item\" key={asset}>\n                            {assetSplit[0].split('=')[0].toUpperCase()}: {` `}\n                            {/*<span className=\"sui-termsDetails__li-subjects\">\n                                {assocSubject[0]}\n                            </span>*/}\n                            <MandalaPopover domain={subID[0]} kid={subID[1]} />\n                        </li>\n                    );\n                })}\n            </ul>\n        </div>\n    );\n};\n\nexport default TermsDetails;\n","import TermAudioPlayer from '../Terms/TermAudioPlayer';\nimport TermEtymology from '../Terms/TermEtymology';\nimport TermDefinitions from '../Terms/TermDefinitions';\nimport TermDictionaries from '../Terms/TermDictionaries';\nimport _ from 'lodash';\nimport * as PropTypes from 'prop-types';\nimport React from 'react';\nimport TermNames from '../Terms/TermNames/TermNames';\nimport TermsDetails from '../Terms/TermsDetails';\nimport { Route } from 'react-router-dom';\nimport Spinner from 'react-bootstrap/Spinner';\n\nexport function TermsInfo(props) {\n    console.log('TermsInfo props = ', props);\n\n    //Get all related Definitions\n    const definitions = _(props.kmap?._childDocuments_)\n        .pickBy((val) => {\n            return val.block_child_type === 'related_definitions';\n        })\n        .groupBy((val) => {\n            return _.get(val, 'related_definitions_source_s', 'main_defs');\n        })\n        .value();\n    if (props.kmap) {\n        return (\n            <>\n                <TermsDetails kmAsset={props.kmasset} />\n                <TermAudioPlayer kmap={props.kmap} />\n                {props.kmap.etymologies_ss && (\n                    <TermEtymology kmap={props.kmap} />\n                )}\n                <TermDefinitions\n                    mainDefs={definitions['main_defs']}\n                    kmRelated={props.kmRelated}\n                />\n                <TermDictionaries\n                    definitions={_.omit(definitions, ['main_defs'])}\n                />\n            </>\n        );\n    } else {\n        return <></>;\n    }\n}\n\nTermsInfo.propTypes = {\n    kmap: PropTypes.any,\n    definitions: PropTypes.any,\n    kmRelated: PropTypes.any,\n};\n","import React, { useState } from 'react';\nimport { KmapLink } from '../common/KmapLink';\nimport Card from 'react-bootstrap/Card';\nimport Modal from 'react-bootstrap/Modal';\nimport Button from 'react-bootstrap/Button';\n\nexport function PlacesInfo(props) {\n    const { kmap, kmasset } = props;\n    let feature_types = 'no feature types';\n\n    if (kmasset.feature_types_idfacet) {\n        feature_types = kmasset.feature_types_idfacet.map((x, i) => {\n            const [label, uid] = x.split('|');\n            console.log('label = ', label);\n            console.log('uid = ', uid);\n\n            return (\n                <li>\n                    <KmapLink key={uid} uid={uid} label={label} />\n                </li>\n            );\n        });\n    }\n\n    return [<h3>Feature Types</h3>, <ul>{feature_types}</ul>];\n}\n","import React from 'react';\n\nexport function SubjectsInfo(props) {\n    const { kmap, kmasset } = props;\n    // console.log('SubjectsInfo: props = ', props);\n    // console.log('SubjectsInfo: kmap = ', kmap);\n    // console.log('SubjectsInfo: kmasset = ', kmasset);\n\n    return (\n        <div>\n            <h2> Yo this is the Subjects joint!</h2>\n            <pre>{JSON.stringify({ ...props, sui: null }, undefined, 2)}</pre>\n        </div>\n    );\n}\n","import axios from 'axios';\nimport jsonpAdapter from './axios-jsonp';\nimport $ from 'jquery';\nimport React from 'react';\n\n$(document).ready(function () {\n    // Use timeout to show not found message because otherwise displays while waiting for JSON to respond\n    window.show_not_found = setTimeout(function () {\n        $('.loading').hide();\n        $('.not-found-msg').show();\n    }, 10000);\n});\n\nexport function getMandalaAssetDataPromise(assettype, id) {\n    const json_call = getMandalaJSONUrl(assettype, id);\n\n    const request = {\n        adapter: jsonpAdapter,\n        callbackParamName: 'json_wrf',\n        url: json_call,\n    };\n    const promise = new Promise((resolve, reject) => {\n        let calldata = false; // getCached(request);\n        if (calldata) {\n            resolve(calldata);\n            return;\n        }\n        axios\n            .request(request)\n            .then((res) => {\n                //console.log('res', res);\n                const apidata = res.data;\n                setCache(request, apidata);\n                resolve(apidata);\n            })\n            .catch((reason) => {\n                reject(reason);\n            });\n    });\n    return promise;\n}\n\nexport function getLegacyAssetPromise(assettype, id) {\n    const json_call = getMandalaSolrUrl(assettype, id);\n\n    const request = {\n        adapter: jsonpAdapter,\n        callbackParamName: 'json.wrf',\n        url: json_call,\n    };\n\n    const promise = new Promise((resolve, reject) => {\n        let data = false; // getCached(request);\n        if (data) {\n            resolve(data);\n            return;\n        }\n        axios\n            .request(request)\n            .then((res) => {\n                const data = res.data.response.docs[0];\n                setCache(request, data);\n                resolve(data);\n            })\n            .catch((reason) => {\n                reject(reason);\n            });\n    });\n    return promise;\n}\n\n// Build the mandala JSON URL based on environment, app, and ID within app\nfunction getMandalaJSONUrl(mapp, mid) {\n    mapp = mapp.replace('-', '_').toLowerCase();\n    const envkey = 'REACT_APP_DRUPAL_' + mapp.toUpperCase();\n    if (!(envkey in process.env)) {\n        console.error(\n            'Drupal App host URL, ' +\n                envkey +\n                ', not found in React environment variables'\n        );\n        return '';\n    }\n    const host = process.env[envkey];\n    let json_call = '';\n    // TODO: Adapt for other apps\n    switch (mapp) {\n        case 'texts':\n            json_call = host + '/shanti_texts/node_json/' + mid;\n            break;\n\n        default:\n            json_call = host;\n    }\n    return json_call;\n}\n\nfunction getMandalaSolrUrl(assettype, id) {\n    const solr_base = process.env.REACT_APP_SOLR_KMASSETS;\n    const solr_url =\n        solr_base +\n        '/select?q=asset_type:' +\n        assettype +\n        '%20AND%20id:' +\n        id +\n        '&wt=json';\n    return solr_url;\n}\n\n// Code copied from searchapi.js where it says:\n//  TODO: Maybe refactor to use declarative caching instead...?\nfunction getCached(request) {\n    let data = null;\n    // TODO: Need explicit cache controls and timeouts, etc.\n    if (sessionStorage) {\n        try {\n            const cached = sessionStorage.getItem(JSON.stringify(request));\n            if (cached) {\n                data = JSON.parse(cached);\n            }\n        } catch (e) {\n            console.log('Ignored sessionStorage error: ', e);\n        }\n    }\n    console.log('getCached: returning: ', data);\n    return data;\n}\n\nfunction setCache(request, data) {\n    if (sessionStorage) {\n        try {\n            sessionStorage.setItem(\n                JSON.stringify(request),\n                JSON.stringify(data)\n            );\n            //console.log(\"Cached: data for \", JSON.stringify(request));\n        } catch (e) {\n            //console.log(\"Ignored sessionStorage error: \", e);\n            // ignore\n        }\n    }\n}\n\nexport function clearCache() {\n    sessionStorage.clear();\n}\n","import React, { useState, useEffect } from 'react';\nimport { useParams } from 'react-router';\nimport {\n    getMandalaAssetDataPromise,\n    getLegacyAssetPromise,\n} from '../logic/assetapi';\n// import { normalizeLinks } from '../views/common/utils';\nimport '../views/css/AssetViewer.css';\nimport useStatus from '../hooks/useStatus';\n\n/**\n *    Container which injects the Mandala asset data, before rendering it.\n *    It injects the props:\n *          id: The integer part of the asset's ID\n *          asset_type: The name of the asset app, e.g. texts, visuals, etc. (necessary to make the api call)\n *          mdlasset:  The current ASSET data in json from Mandala\n *\n *    Uses function getMandalaAssetDataPromise(asset_type, id) to build the JSON call and get the data, which\n *    it then \"injects\" into the children, the apps particular component, by cloning it with the prop information.\n *    When a new app is added the JSON API call must be added to getMandalaAssetDataPromise for that particular\n *    asset type.\n *\n *    This is evoked within the ContentMain.js and should wrap the component of the Mandala App in question\n *    As for instance was done for texts:\n *           <MdlAssetContext assettype={'texts'}>\n *               <TextsViewer onStateChange={props.onStateChange}/>\n *           </MdlAssetContext>\n *\n * */\nexport default function MdlAssetContext(props) {\n    // TODO: need to make env determined according to url\n    // const env = 'dev'; // Acquia Drupal Environment to Call for the JSON API. Set to promises.\n    const [asset_type, setAssetType] = useState(props.assettype);\n    const [mdlasset, setMdlAsset] = useState({});\n    const status = useStatus();\n    const inline = props.inline || false;\n\n    /**\n     * Effect used to normalize links in Asset Pages after loading so that links do not go outside of standalon\n     * function found in ../common/utils.js\n     */\n    useEffect(() => {\n        // normalizeLinks(asset_type);\n    });\n\n    const params = useParams();\n    let id = params.relId || params.id || params.nid; // When ID param is just a number\n    if (id.indexOf('-') > 1) {\n        // When ID param is something like \"texts-1234\".\n        id = id.split('-').pop();\n    }\n\n    if (!props.children) {\n        let output = <h2>No Children?</h2>;\n        return output;\n    } else {\n        let changed = false;\n        // console.log(asset_type)\n        let promises = [];\n        // console.log(\"asset type: \" + asset_type);\n        if (asset_type == 'texts') {\n            promises = [getMandalaAssetDataPromise(asset_type, id)];\n        } else if (asset_type == 'audio-video') {\n            promises = [getLegacyAssetPromise(asset_type, id)];\n        }\n        Promise.allSettled(promises)\n            .then(([mdlasset_result]) => {\n                const {\n                    status: call_status,\n                    value: new_mdlasset,\n                } = mdlasset_result;\n                if (call_status === 'fulfilled') {\n                    if (mdlasset_result) {\n                        if (mdlasset.nid !== new_mdlasset.nid) {\n                            setMdlAsset(new_mdlasset);\n                            changed = true;\n\n                            if (!inline) {\n                                status.clear();\n                                status.setHeaderTitle(new_mdlasset.title);\n                                status.setType(asset_type);\n                                status.setId(new_mdlasset.id);\n                            }\n                        } else if (mdlasset.id !== new_mdlasset.id) {\n                            setMdlAsset(new_mdlasset);\n                            changed = true;\n\n                            if (!inline) {\n                                status.clear();\n                                status.setHeaderTitle(new_mdlasset.title[0]);\n                                status.setType(asset_type);\n                                status.setId(new_mdlasset.id);\n                            }\n                        }\n                    }\n                } else if (call_status == 'rejected') {\n                    setMdlAsset(false);\n                    changed = true;\n                }\n\n                if (changed && props.onStateChange) {\n                    props.onStateChange({\n                        id: id,\n                        asset_type: asset_type,\n                        mdlasset: mdlasset,\n                    });\n                }\n            })\n            .catch((e) => {\n                console.error('oh dear! failure!??? ', e, promises);\n            });\n    }\n\n    const ret_children = React.Children.map(props.children, (child) => {\n        if (child.type) {\n            const new_child = React.cloneElement(child, {\n                id: id,\n                asset_type: asset_type,\n                mdlasset: mdlasset,\n            });\n            return new_child;\n        } else {\n            return child;\n        }\n    });\n    return ret_children;\n}\n","import React, { useEffect, useState } from 'react';\nimport { Redirect, Route, Switch, useRouteMatch } from 'react-router-dom';\nimport _ from 'lodash';\nimport TermNames from '../Terms/TermNames';\nimport 'rc-input-number/assets/index.css';\nimport NodeHeader from '../common/NodeHeader';\nimport { RelatedsGallery } from '../common/RelatedsGallery';\nimport '../Terms/TermsViewer.css';\nimport { TermsInfo } from './TermsInfo';\nimport { PlacesInfo } from './PlacesInfo';\nimport { SubjectsInfo } from './SubjectsInfo';\nimport Modal from 'react-bootstrap/Modal';\nimport Button from 'react-bootstrap/Button';\nimport Card from 'react-bootstrap/Card';\nimport useStatus from '../../hooks/useStatus';\nimport { AudioVideoViewer } from '../AudioVideo/AudioVideoViewer';\nimport MdlAssetContext from '../../context/MdlAssetContext';\nimport GenAssetContext from '../../context/GenAssetContext';\nimport { TextsViewer } from '../Texts/TextsViewer';\nimport { ImagesViewer } from '../Images/ImagesViewer';\nimport { SourcesViewer } from '../SourcesViewer';\nimport { VisualsViewer } from '../VisualsViewer';\nimport { useLocation } from 'react-router';\n\nexport default function KmapsViewer(props) {\n    // console.log('KmapsViewer props = ', props);\n\n    const route = useRouteMatch();\n    const [modalShow, setModalShow] = useState();\n    const status = useStatus();\n\n    const queryParams = new URLSearchParams(useLocation().search);\n    function grokAssetType(route, queryParams) {\n        // console.log(\"grokAssetType props = \", props);\n        // console.log(\"grokAssetType route = \", route  );\n        // console.log(\"grokAssetType queryParams = \", queryParams.get(\"asset_type\")  );\n\n        const asset_type = queryParams.get('asset_type');\n        let viewer = null;\n        switch (asset_type) {\n            case 'images':\n                viewer = (\n                    <ImagesViewer kmasset={props.kmasset} kmap={props.kmap} />\n                );\n                break;\n            case 'audio-video':\n                viewer = <AudioVideoViewer sui={window.sui} />;\n                break;\n            case 'sources':\n                viewer = <SourcesViewer />;\n                break;\n            case 'texts':\n                viewer = <TextsViewer />;\n                break;\n            case 'visuals':\n                viewer = <VisualsViewer />;\n                break;\n            case 'subjects':\n            case 'terms':\n            case 'places':\n                viewer = <KmapsViewer />;\n                break;\n        }\n\n        return {\n            declaredType: asset_type,\n            declaredViewer: viewer,\n        };\n    }\n\n    const { declaredType, declaredViewer } = grokAssetType(route, queryParams);\n\n    useEffect(() => {\n        if (props.kmasset) {\n            status.clear();\n            status.setHeaderTitle(props.kmasset.title);\n            status.setType(props.kmasset.asset_type);\n            const superPath = assemblePath(props.kmap, props.kmasset);\n            status.setPath(superPath);\n            status.setId(props.kmasset?.uid);\n        }\n    }, [props.kmasset?.uid, route]);\n\n    let output = <div className=\"l-content__main__wrap\">Loading...</div>;\n    if (props.kmasset && props.kmasset.asset_type) {\n        output = (\n            <section className=\"l-content__main__wrap\">\n                <div className=\"c-content__main__kmaps\">\n                    {/*<NodeHeader kmasset={props.kmasset} />*/}\n                    <Switch>\n                        <Route\n                            path={\n                                '/:viewerType/:nid/related-audio-video/view/:relId'\n                            }\n                        >\n                            <NodeHeader\n                                {...props}\n                                kmasset={props.kmasset}\n                                relatedType={'audio-video'}\n                                back={'true'}\n                            />\n                            <GenAssetContext assetType={'audio-video'}>\n                                <AudioVideoViewer sui={window.sui} />\n                            </GenAssetContext>\n                        </Route>\n\n                        <Route\n                            path={'/:viewerType/:nid/related-texts/view/:relId'}\n                        >\n                            <NodeHeader\n                                {...props}\n                                kmasset={props.kmasset}\n                                relatedType={'texts'}\n                                back={'true'}\n                            />\n                            <GenAssetContext assetType={'texts'}>\n                                <TextsViewer inline={true} />\n                            </GenAssetContext>\n                        </Route>\n\n                        <Route\n                            path={\n                                '/:viewerType/:nid/related-images/view/:relId'\n                            }\n                        >\n                            <NodeHeader\n                                {...props}\n                                kmasset={props.kmasset}\n                                relatedType={'images'}\n                                back={'true'}\n                            />\n                            <GenAssetContext assetType={'images'}>\n                                <ImagesViewer inline={true} />\n                            </GenAssetContext>\n                        </Route>\n\n                        <Route\n                            path={\n                                '/:viewerType/:nid/related-sources/view/:relId'\n                            }\n                        >\n                            <NodeHeader\n                                {...props}\n                                kmasset={props.kmasset}\n                                relatedType={'sources'}\n                                back={'true'}\n                            />\n                            <MdlAssetContext\n                                assettype={'sources'}\n                                inline={true}\n                            >\n                                <SourcesViewer />\n                            </MdlAssetContext>\n                        </Route>\n\n                        <Route\n                            path={'/:viewerType/:nid/related-all/view/:relId'}\n                        >\n                            <NodeHeader\n                                {...props}\n                                kmasset={props.kmasset}\n                                relatedType={'all'}\n                                back={'true'}\n                            />\n                            <MdlAssetContext\n                                assettype={declaredType}\n                                inline={true}\n                            >\n                                {declaredViewer}\n                            </MdlAssetContext>\n                        </Route>\n\n                        {/* Catch relatedType routes that are not specified above */}\n                        <Redirect\n                            from={\n                                '/:viewerType/:id/related-:relatedType/view/:relId'\n                            }\n                            to={'/:viewerType/:relId'}\n                        />\n\n                        <Route\n                            path={\n                                '/:viewerType/:id/related-:relatedType/:viewMode'\n                            }\n                        >\n                            <NodeHeader {...props} kmasset={props.kmasset} />\n                            <RelatedsGallery {...props} />\n                        </Route>\n\n                        <Route path={'/:viewerType/:id/related-:relatedType'}>\n                            <Redirect to={'./all'} />\n                        </Route>\n\n                        {/* Default or \"Home\" path */}\n                        <Route>\n                            <NodeHeader kmasset={props.kmasset} />\n                            <TermNames kmap={props.kmap} />\n                            <Switch>\n                                {/*    Asset Specific SubViewers*/}\n                                <Route path={'/subjects'}>\n                                    <SubjectsInfo {...props} />\n                                </Route>\n                                <Route path={'/places'}>\n                                    <PlacesInfo {...props} />\n                                </Route>\n                                <Route path={'/terms'}>\n                                    <TermsInfo\n                                        kmasset={props.kmasset}\n                                        kmap={props.kmap}\n                                        kmRelated={props.relateds}\n                                    />\n                                </Route>\n                            </Switch>\n                        </Route>\n                    </Switch>\n                </div>\n\n                <span\n                    className={'sui-showinfo u-icon__info float-right'}\n                    onClick={() => setModalShow(true)}\n                ></span>\n\n                <DetailModal\n                    show={modalShow}\n                    onHide={() => setModalShow(false)}\n                    data={props.kmasset}\n                    scrollable={true}\n                />\n            </section>\n        );\n    }\n\n    return output;\n}\n\nfunction DetailModal(props) {\n    return (\n        <Modal\n            {...props}\n            size=\"lg\"\n            aria-labelledby=\"contained-modal-title-vcenter\"\n            centered\n        >\n            <Modal.Header closeButton>\n                <Modal.Title id=\"contained-modal-title-vcenter\">\n                    JSON DATA\n                </Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <pre>{JSON.stringify(props.data, undefined, 3)}</pre>\n            </Modal.Body>\n            <Modal.Footer>\n                <Button onClick={props.onHide}>Close</Button>\n            </Modal.Footer>\n        </Modal>\n    );\n}\n\n//  assembles a path from the data is has...\nfunction assemblePath(kmap, kmasset) {\n    // console.log(\"assemble kmap = \", kmap);\n    // console.log(\"assemble kmasset = \", kmasset);\n    //\n    let path = [];\n\n    if (kmasset?.ancestor_ids_is && kmasset?.ancestors_txt) {\n        const t = kmasset.asset_type;\n        const ids = kmasset.ancestor_ids_is;\n        const names = kmasset.ancestors_txt;\n\n        for (let i = 0; i < ids.length; i++) {\n            const uid = t + '-' + ids[i];\n            const name = names[i];\n            path.push({\n                uid: uid,\n                name: name,\n            });\n        }\n    } else {\n        console.log(\n            'KmapContext.assembledPath: kmasset does not have ancestor_ids_is or ancestors_txt.'\n        );\n    }\n    return path;\n}\n","import React, { useEffect } from 'react';\nimport useStatus from '../hooks/useStatus';\n\nexport function PlacesHome(props) {\n    const status = useStatus();\n\n    useEffect(() => {\n        status.clear();\n        status.setHeaderTitle('Places Home');\n    });\n\n    return <> Places Home: Not much here yet.. </>;\n}\n\nexport default PlacesHome;\n","import React, { useEffect } from 'react';\nimport useStatus from '../hooks/useStatus';\n\nexport function SubjectsHome(props) {\n    const status = useStatus();\n\n    useEffect(() => {\n        status.clear();\n        status.setHeaderTitle('Subjects Home');\n    });\n\n    return <> Subjects Home: Not much here yet.. </>;\n}\n\nexport default SubjectsHome;\n","import React, { useEffect } from 'react';\nimport useStatus from '../../hooks/useStatus';\n\nexport function TermsHome(props) {\n    const status = useStatus();\n\n    useEffect(() => {\n        status.clear();\n        status.setHeaderTitle('Terms Home');\n    });\n\n    return <> Terms Home: Not much here yet.. </>;\n}\n\nexport default TermsHome;\n","import React from 'react';\nimport { ContentHeader } from './ContentHeader/ContentHeader';\nimport { Switch, Route, Redirect, useRouteMatch } from 'react-router-dom';\nimport { AudioVideoViewer } from '../views/AudioVideo/AudioVideoViewer';\nimport { AudioVideoHome } from '../views/AudioVideo/AudioVideoHome';\nimport { ImagesViewer } from '../views/Images/ImagesViewer';\nimport { ImagesHome } from '../views/Images/ImagesHome';\nimport { TextsViewer } from '../views/Texts/TextsViewer';\nimport { TextsHome } from '../views/Texts/TextsHome';\nimport { SourcesViewer } from '../views/SourcesViewer';\nimport { SourcesHome } from '../views/SourcesHome';\nimport { VisualsViewer } from '../views/VisualsViewer';\nimport { VisualsHome } from '../views/VisualsHome';\nimport { RelatedsViewer } from '../views/Kmaps/RelatedViewer/RelatedsViewer';\nimport LegacyViewer from '../views/LegacyViewer';\nimport { SearchViewer } from '../views/SearchViewer';\nimport { CollectionsViewer } from '../views/CollectionsViewer';\nimport { CollectionsHome } from '../views/CollectionsHome';\nimport { Error404 } from '../App';\nimport KmapContext from '../context/KmapContext';\nimport SearchContext from '../context/SearchContext';\nimport GenAssetContext from '../context/GenAssetContext';\nimport { MandalaPopoverTest } from '../views/common/MandalaPopover';\nimport KmapsViewer from '../views/Kmaps/KmapsViewer';\nimport PlacesHome from '../views/PlacesHome';\nimport SubjectsHome from '../views/SubjectsHome';\nimport TermsHome from '../views/Terms/TermsHome';\n\nexport function ContentMain(props) {\n    // console.log('ContentPanel: props =  ', props);\n\n    let { path } = useRouteMatch();\n    // console.log('ContentMain path = ', path);\n    const title = props.title || 'Untitled';\n    const siteClass = props.site || 'defauit';\n    const left = (\n        <main className=\"l-column__main\">\n            <article id=\"l-column__main__wrap\" className=\"l-column__main__wrap\">\n                <KmapContext>\n                    <ContentHeader\n                        siteClass={siteClass}\n                        title={title}\n                        sui={props.sui}\n                    />\n                </KmapContext>\n                <section id=\"l-content__main\" className=\"l-content__main\">\n                    <Switch>\n                        {/* AUDIO-VIDEO */}\n                        <Route path={`${path}audio-video/:id`}>\n                            <GenAssetContext assetType={'audio-video'}>\n                                <AudioVideoViewer\n                                    sui={props.sui}\n                                    ismain={true}\n                                    /*onStateChange={props.onStateChange}*/\n                                />\n                            </GenAssetContext>\n                        </Route>\n                        <Route path={`${path}audio-video`}>\n                            <AudioVideoHome />\n                        </Route>\n\n                        {/* IMAGES */}\n                        <Route path={`${path}images/:id`}>\n                            <GenAssetContext assetType={'images'}>\n                                <ImagesViewer ismain={true} sui={props.sui} />\n                            </GenAssetContext>\n                        </Route>\n                        <Route path={`${path}images`}>\n                            <ImagesHome />\n                        </Route>\n\n                        {/* TEXTS */}\n                        <Route path={`${path}texts/:id`}>\n                            <GenAssetContext assetType={'texts'}>\n                                <TextsViewer\n                                    ismain={true}\n                                    onStateChange={props.onStateChange}\n                                />\n                            </GenAssetContext>\n                        </Route>\n                        <Route path={`${path}texts`}>\n                            <TextsHome />\n                        </Route>\n\n                        {/* SOURCES */}\n                        <Route path={`${path}sources/:id`}>\n                            <SourcesViewer\n                                id={props.id}\n                                sui={props.sui}\n                                onStateChange={props.onStateChange}\n                            />\n                        </Route>\n                        <Route path={`${path}sources`}>\n                            <SourcesHome />\n                        </Route>\n\n                        {/* VISUALS */}\n                        <Route path={`${path}visuals/:id`}>\n                            <VisualsViewer\n                                id={props.id}\n                                sui={props.sui}\n                                onStateChange={props.onStateChange}\n                            />\n                        </Route>\n                        <Route path={`${path}visuals`}>\n                            <VisualsHome />\n                        </Route>\n\n                        {/* PLACES */}\n                        <Route\n                            path={[\n                                `${path}places/:id/related-:relatedType/:viewMode`,\n                                `${path}places/:id`,\n                            ]}\n                        >\n                            <KmapContext assetType=\"places\">\n                                <RelatedsViewer />\n                                <KmapsViewer\n                                    id={props.id}\n                                    sui={props.sui}\n                                    onStateChange={props.onStateChange}\n                                />\n                            </KmapContext>\n                        </Route>\n                        <Route path={`${path}places`}>\n                            <PlacesHome />\n                        </Route>\n\n                        {/* SUBJECTS */}\n                        <Route\n                            path={[\n                                `${path}subjects/:id/related-:relatedType/:viewMode`,\n                                `${path}subjects/:id`,\n                            ]}\n                        >\n                            <KmapContext assetType=\"subjects\">\n                                <RelatedsViewer />\n                                <KmapsViewer\n                                    id={props.id}\n                                    sui={props.sui}\n                                    onStateChange={props.onStateChange}\n                                />\n                            </KmapContext>\n                        </Route>\n                        <Route path={`${path}subjects`}>\n                            <SubjectsHome />\n                        </Route>\n\n                        {/* TERMS */}\n                        <Route\n                            path={[\n                                `${path}terms/:id/related-:relatedType/:viewMode`,\n                                `${path}terms/:id`,\n                            ]}\n                        >\n                            <KmapContext assetType=\"terms\">\n                                <RelatedsViewer />\n                                <KmapsViewer\n                                    id={props.id}\n                                    sui={props.sui}\n                                    onStateChange={props.onStateChange}\n                                />{' '}\n                            </KmapContext>\n                        </Route>\n                        <Route path={`${path}terms`}>\n                            <TermsHome />\n                        </Route>\n\n                        {/* do we need this route? */}\n                        <Route path={`${path}terms/:id/related-:relatedType`}>\n                            <Redirect to={'./default'} />\n                        </Route>\n\n                        {/* COLLECTIONS */}\n                        <Route path={`${path}collections/:id`}>\n                            <CollectionsViewer\n                                id={props.id}\n                                sui={props.sui}\n                                onStateChange={props.onStateChange}\n                            />\n                        </Route>\n                        <Route path={`${path}collections`}>\n                            <CollectionsHome />\n                        </Route>\n                        <Route path={`${path}search/:viewMode`}>\n                            <SearchContext>\n                                <SearchViewer />\n                            </SearchContext>\n                        </Route>\n                        <Route exact path={`${path}search`}>\n                            <Redirect to={`${path}search/default`} />\n                        </Route>\n\n                        {/* LEGACY VIEWER */}\n                        <Route path={`${path}assets/:id`}>\n                            <RelatedsViewer />\n                            <LegacyViewer\n                                id={props.id}\n                                sui={props.sui}\n                                onStateChange={props.onStateChange}\n                            />\n                        </Route>\n\n                        {/*  POPOVER TEST */}\n                        <Route\n                            path={`${path}poptest/:dom/:kid`}\n                            component={MandalaPopoverTest}\n                        />\n\n                        {/* CATCHALL => 404 */}\n                        <Route path=\"*\">\n                            <Error404 />\n                        </Route>\n                    </Switch>\n                </section>\n            </article>\n        </main>\n    );\n    return left;\n}\n","import React from 'react';\n\nexport function Hamburger(props) {\n    const helpIcon = '\\ue67e';\n    const homeIcon = '\\ue60b';\n    const openclass = props.hamburgerOpen ? 'open' : 'closed';\n    const hamburger = (\n        <div className={`sui-hamburger ${openclass}`} id=\"sui-hamburger\">\n            <span id=\"sui-help\" className=\"sui-hamItem\">\n                {helpIcon}&nbsp;&nbsp;HELP GUIDE\n            </span>\n            <span id=\"sui-home\" className=\"sui-hamItem\">\n                {homeIcon}&nbsp;&nbsp;HOME\n            </span>\n        </div>\n    );\n    return hamburger;\n}\n","import React, { useEffect, useRef, useState } from 'react';\nimport Badge from 'react-bootstrap/Badge';\nimport _ from 'lodash';\nimport * as PropTypes from 'prop-types';\nimport ToggleButtonGroup from 'react-bootstrap/ToggleButtonGroup';\nimport ToggleButton from 'react-bootstrap/ToggleButton';\nimport { useStoreState } from 'easy-peasy';\nimport Spinner from 'react-bootstrap/Spinner';\nimport { FacetChoice } from './FacetChoice';\n\nimport { BsCheckCircle, BsMap } from 'react-icons/bs';\nimport { ImStack } from 'react-icons/im';\n\nimport './FacetBox.scss';\n\nfunction FacetControls(props) {\n    return (\n        <span className={'sui-advEdit-facet-ctrls-btns'}>\n            <ToggleButtonGroup\n                onChange={props.onChange}\n                name={props.name + '_field'}\n                type={'radio'}\n                value={props.value}\n                ref={props.ref}\n            >\n                <ToggleButton\n                    name={props.name + '_field'}\n                    type={'radio'}\n                    value={'count'}\n                    onClick={props.onClick}\n                >\n                    #\n                </ToggleButton>\n                <ToggleButton\n                    name={props.name + '_field'}\n                    type={'radio'}\n                    value={'index'}\n                    onClick={props.onClick}\n                >\n                    A-Z\n                </ToggleButton>\n            </ToggleButtonGroup>\n\n            {props.loadingState && (\n                <Spinner animation=\"border\" role=\"status\">\n                    <span className=\"sr-only\">Loading...</span>\n                </Spinner>\n            )}\n        </span>\n    );\n}\n\nFacetControls.propTypes = {\n    onChange: PropTypes.func,\n    name: PropTypes.string,\n    value: PropTypes.string,\n    ref: PropTypes.any,\n    onClick: PropTypes.func,\n    loadingState: PropTypes.bool,\n};\n\nexport function FacetBox(props) {\n    const inputEl = useRef(null);\n    const sortFieldEl = useRef(null);\n    const [sortField, setSortField] = useState('count');\n    const sortDirectionEl = useRef(null);\n    const [sortDirection, setSortDirection] = useState('desc');\n\n    const [open, setOpen] = useState(false);\n    let chosen_icon = props.icon;\n    const facetType = props.facetType;\n    const facets = props.facets;\n    const chosenFacets = props.chosenFacets || [];\n\n    const loadingState = useStoreState((state) => state.search.loadingState);\n\n    // if the sortField or sortDirection change make sure the send handleNarrowFilter messages\n    useEffect(() => {\n        handleNarrowFilters();\n    }, [sortField, sortDirection]);\n\n    useEffect(() => {\n        inputEl.current.value = '';\n    }, [props.resetFlag]);\n\n    // console.log(\"FacetBox: props = \", props);\n\n    function arrayToHash(array, keyField) {\n        return array.reduce((collector, item) => {\n            collector[item[keyField]] = item;\n            return collector;\n        }, {});\n    }\n\n    const chosenHash = arrayToHash(chosenFacets, 'id');\n\n    function handleNarrowFilters() {\n        if (props.onNarrowFilters) {\n            props.onNarrowFilters({\n                filter: props.facetType,\n                search: inputEl.current.value,\n                sort: sortField + ' ' + sortDirection,\n                limit: inputEl.current?.value?.length ? -1 : null,\n            });\n        }\n    }\n\n    const handleKey = (x) => {\n        // submit on return\n        if (x.keyCode === 13) {\n            handleNarrowFilters();\n        }\n    };\n\n    const handleChange =\n        // To be used for completions if desired\n        _.debounce(() => {\n            console.log('handleChange: ', inputEl.current.value);\n            handleNarrowFilters();\n        }, 500);\n\n    // console.log(\"chosen hash = \", chosenHash);\n    const isChosen = (id) => (chosenHash[id] ? true : false);\n    // console.log(\"FacetBox (\" + facetType + \") chosenHash: \", chosenHash );\n\n    const ICON_MAP = {\n        'audio-video': <span className={'icon u-icon__audio-video'} />,\n        texts: <span className={'icon u-icon__texts'} />,\n        'texts:pages': <span className={'icon u-icon__texts'} />,\n        images: <span className={'icon u-icon__images'} />,\n        sources: <span className={'icon u-icon__sources'} />,\n        visuals: <span className={'icon u-icon__visuals'} />,\n        places: <span className={'icon u-icon__places'} />,\n        subjects: <span className={'icon u-icon__subjects'} />,\n        terms: <span className={'icon u-icon__terms'} />,\n        collections: <ImStack />,\n        //       'recent-searches': '\\ue62e',\n        asset_type: <BsCheckCircle />,\n        users: <span className={'icon u-icon__community'} />,\n        creator: <span className={'icon u-icon__agents'} />,\n        languages: <span className={'icon u-icon__comments-o'} />,\n        feature_types: <BsMap />,\n        associated_subjects: <span className={'icon u-icon__essays'} />,\n        perspective: <span className={'icon u-icon__file-picture'} />,\n    };\n\n    chosen_icon = chosen_icon || ICON_MAP[facetType];\n    // console.log('facetType = ', facetType, ' chosen_icon = ', chosen_icon);\n\n    const icon = chosen_icon;\n    const plus = <span className={'u-icon__plus icon'} />;\n    const minus = <span className={'u-icon__minus icon'} />;\n    const label = props.label || 'UNKNOWN LABEL';\n\n    // console.debug(\"FacetBox: props = \", props);\n\n    function parseEntry(entry, fullEntry) {\n        let label = '';\n        let uid = '';\n        let fullLabel = '';\n\n        if (entry.val.match(/[^=]+\\=[^\\|]+\\|[^=]+.*/)) {\n            // console.log(\"parseEntry SPECIAL CASE!\")\n            const [ref, val] = entry.val.split('|');\n            const [refLabel, refUid] = ref.split('=');\n            const [valLabel, valUid] = val.split('=');\n\n            label = refLabel + ': ' + valLabel;\n            uid = entry.val;\n            fullLabel = label;\n        } else {\n            // console.log(\"FacetBox.parseEntry: \" + JSON.stringify(entry));\n            [label, uid] = entry.val.split('|');\n            label = label ? label : 'undefined';\n            const extra = fullEntry && uid ? <span>({uid})</span> : '';\n            fullLabel = (\n                <span uid={uid}>\n                    {label} {extra}\n                </span>\n            );\n        }\n        return { label: label, fullLabel: fullLabel, value: uid ? uid : label };\n    }\n\n    function chooseIconClass(entry) {\n        let icoclass = entry.val;\n        icoclass = icoclass === 'texts:pages' ? 'file-text-o' : icoclass;\n        return 'u-icon__' + icoclass + ' icon';\n    }\n\n    function parseId(id) {\n        const split = id.split('|');\n        const uid = split[1] ? split[1] : id;\n        return uid;\n    }\n\n    const facetList = _.map(facets?.buckets, (entry) => {\n        // Adjust\n        const iconClass = chooseIconClass(entry);\n        const { label, fullLabel, value } = parseEntry(entry, false);\n        const count = entry.count;\n        const id = facetType + ':' + parseId(entry.val);\n        return (\n            <FacetChoice\n                mode={'add'}\n                key={`${value} ${label} ${facetType}`}\n                className={iconClass}\n                value={value}\n                labelText={label}\n                label={fullLabel}\n                count={count}\n                facetType={facetType}\n                chosen={isChosen(id)}\n                onFacetClick={(msg) => {\n                    props.onFacetClick({\n                        ...msg,\n                        action: isChosen(id) ? 'remove' : 'add',\n                    });\n                }}\n            />\n        );\n    });\n    const chosenList = _.map(props.chosenFacets, (entry) => {\n        const removeIconClass = 'sui-advTermRem u-icon__cancel-circle icon';\n        // console.log(\"Creating removal FacetChoice from \", entry);\n\n        return (\n            <FacetChoice\n                mode={'remove'}\n                key={`Remove ${entry.match} ${label} ${facetType}`}\n                className={removeIconClass}\n                value={entry.match}\n                labelText={entry.label}\n                label={entry.label}\n                facetType={facetType}\n                onFacetClick={(msg) => {\n                    props.onFacetClick({ ...msg, action: 'remove' });\n                }}\n            />\n        );\n    });\n\n    const name = 'sort_' + props.id;\n\n    const handleSortClick = function (e) {\n        if (e.target.name) {\n            // console.log(\"ToggleButton CLICK name=\", e.target.name, \" value=\", e.target.value);\n            // console.log(\"ToggleButton CLICK current sortDirection= \", sortDirection);\n            // console.log(\"ToggleButton CLICK current sortField= \", sortField);\n\n            // We're clicking on the currently selected sort type -- Let's toggle the sort direction\n            if (e.target.value === sortField) {\n                if (sortDirection === 'asc') {\n                    setSortDirection('desc');\n                } else {\n                    setSortDirection('asc');\n                }\n            }\n        }\n    };\n\n    const facetBox = (\n        <div className={'sui-advBox sui-advBox-' + props.id}>\n            <div\n                className={'sui-advHeader'}\n                id={'sui-advHeader-A'}\n                onClick={() => setOpen(!open)}\n            >\n                <span className={'icon'}>{icon}</span>\n                <span>{label}</span>\n                <span id={'sui-advPlus-' + props.id} className={'sui-advPlus'}>\n                    <Badge\n                        pill\n                        variant={facetList.length ? 'primary' : 'secondary'}\n                    >\n                        {facetList.length}\n                    </Badge>{' '}\n                    {open ? minus : plus}\n                </span>\n            </div>\n\n            <div className={'sui-advTerm'} id={'sui-advTerm-' + props.id}>\n                {chosenList}\n            </div>\n            <div\n                className={\n                    'sui-advEdit c-FacetBox--expander ' +\n                    (open ? 'open' : 'closed')\n                }\n                id={'sui-advEdit-' + props.id}\n            >\n                <div className={'sui-advEdit-facet-ctrls'}>\n                    <input\n                        type={'text'}\n                        placeholder=\"Filter this list\"\n                        onChange={handleChange}\n                        defaultValue={''}\n                        onKeyDownCapture={handleKey}\n                        ref={inputEl}\n                    />\n\n                    <FacetControls\n                        onChange={setSortField}\n                        name={name}\n                        value={sortField}\n                        onClick={handleSortClick}\n                        loadingState={loadingState}\n                    />\n                </div>\n\n                <div className={'sui-adv-facetlist overflow-auto'}>\n                    {facetList}\n                </div>\n            </div>\n        </div>\n    );\n    return facetBox;\n}\n\nFacetBox.propTypes = {\n    label: PropTypes.string,\n    chosenIcon: PropTypes.string,\n    facetType: PropTypes.string,\n    filters: PropTypes.array,\n};\n","import React, { useEffect, useRef, useState } from 'react';\nimport Badge from 'react-bootstrap/Badge';\nimport Navbar from 'react-bootstrap/Navbar';\nimport Nav from 'react-bootstrap/cjs/Nav';\nimport NavItem from 'react-bootstrap/NavItem';\nimport NavLink from 'react-bootstrap/NavLink';\nimport ToggleButtonGroup from 'react-bootstrap/ToggleButtonGroup';\nimport ToggleButton from 'react-bootstrap/ToggleButton';\nimport Spinner from 'react-bootstrap/Spinner';\nimport { FacetChoice } from './FacetChoice';\nimport HistoryViewer from '../views/History/HistoryViewer';\nimport { BsArrowCounterclockwise } from 'react-icons/bs';\nimport * as PropTypes from 'prop-types';\nimport _ from 'lodash';\nimport { useStoreState, useStoreActions } from 'easy-peasy';\nimport { Type } from '../model/HistoryModel';\n\nfunction countSearchItems(historyStack) {\n    return historyStack.filter((x) => {\n        return x.search?.length > 0;\n    }).length;\n}\n\nexport function HistoryBox(props) {\n    const inputEl = useRef(null);\n    const sortFieldEl = useRef(null);\n    const [sortField, setSortField] = useState('count');\n    const sortDirectionEl = useRef(null);\n    const [sortDirection, setSortDirection] = useState('desc');\n\n    const [open, setOpen] = useState(false);\n    let chosen_icon = props.icon;\n    const facetType = props.facetType;\n    const facets = props.facets;\n    const chosenFacets = props.chosenFacets || [];\n\n    const loadingState = useStoreState((state) => state.search.loadingState);\n    const historyStack = useStoreState((state) => state.history.historyStack);\n    const { removeType } = useStoreActions((actions) => actions.history);\n\n    // if the sortField or sortDirection change make sure the send handleNarrowFilter messages\n    // useEffect(() => {\n    //     handleNarrowFilters();\n    // }, [sortField, sortDirection]);\n\n    // useEffect(() => {\n    //     inputEl.current.value = '';\n    // }, [props.resetFlag]);\n\n    // console.log(\"HistoryBox: props = \", props);\n\n    function arrayToHash(array, keyField) {\n        return array.reduce((collector, item) => {\n            collector[item[keyField]] = item;\n            return collector;\n        }, {});\n    }\n\n    const chosenHash = arrayToHash(chosenFacets, 'id');\n\n    function handleNarrowFilters() {\n        if (props.onNarrowFilters) {\n            props.onNarrowFilters({\n                filter: props.facetType,\n                search: inputEl.current.value,\n                sort: sortField + ' ' + sortDirection,\n                limit: inputEl.current?.value?.length ? -1 : null,\n            });\n        }\n    }\n\n    const handleKey = (x) => {\n        // submit on return\n        if (x.keyCode === 13) {\n            handleNarrowFilters();\n        }\n    };\n\n    const handleChange =\n        // To be used for completions if desired\n        _.debounce(() => {\n            console.log('handleChange: ', inputEl.current.value);\n            handleNarrowFilters();\n        }, 500);\n\n    // console.log(\"chosen hash = \", chosenHash);\n    const isChosen = (id) => (chosenHash[id] ? true : false);\n    // console.log(\"HistoryBox (\" + facetType + \") chosenHash: \", chosenHash );\n\n    const ICON_MAP = {\n        'audio-video': <span className={'icon u-icon__audio-video'} />,\n        texts: <span className={'u-icon__texts icon'} />,\n        'texts:pages': <span className={'u-icon__texts icon'} />,\n        images: '\\ue62a',\n        sources: '\\ue631',\n        visuals: '\\ue63b',\n        places: '\\ue62b',\n        subjects: '\\ue634',\n        terms: '\\ue635',\n        collections: '\\ue633',\n        'recent-searches': '\\ue62e',\n        asset_type: '\\ue60b',\n        users: '\\ue600',\n        creator: '\\ue600',\n        languages: '\\ue670',\n        feature_types: <span className={'u-icon__explore icon'} />,\n    };\n\n    chosen_icon = chosen_icon || ICON_MAP[facetType];\n    const icon = chosen_icon;\n    const plus = <span className={'u-icon__plus icon'} />;\n    const minus = <span className={'u-icon__minus icon'} />;\n    const label = props.label || 'UNKNOWN LABEL';\n\n    // console.debug(\"HistoryBox: props = \", props);\n\n    function parseEntry(entry, fullEntry) {\n        let label = '';\n        let uid = '';\n        let fullLabel = '';\n\n        if (entry.val.match(/[^=]+\\=[^\\|]+\\|[^=]+.*/)) {\n            // console.log(\"parseEntry SPECIAL CASE!\")\n            const [ref, val] = entry.val.split('|');\n            const [refLabel, refUid] = ref.split('=');\n            const [valLabel, valUid] = val.split('=');\n\n            label = refLabel + ': ' + valLabel;\n            uid = entry.val;\n            fullLabel = label;\n        } else {\n            // console.log(\"HistoryBox.parseEntry: \" + JSON.stringify(entry));\n            [label, uid] = entry.val.split('|');\n            label = label ? label : 'undefined';\n            const extra = fullEntry && uid ? <span>({uid})</span> : '';\n            fullLabel = (\n                <span uid={uid}>\n                    {label} {extra}\n                </span>\n            );\n        }\n        return { label: label, fullLabel: fullLabel, value: uid ? uid : label };\n    }\n\n    function chooseIconClass(entry) {\n        let icoclass = entry.val;\n        icoclass = icoclass === 'texts:pages' ? 'file-text-o' : icoclass;\n        return 'u-icon__' + icoclass + ' icon';\n    }\n\n    function parseId(id) {\n        const split = id.split('|');\n        const uid = split[1] ? split[1] : id;\n        return uid;\n    }\n\n    const historyLength = countSearchItems(historyStack);\n\n    const historyList = <HistoryViewer mode={'search'} />;\n\n    const name = 'sort_' + props.id;\n    const handleResetHistory = () => {\n        console.log('HistoryBox:  RESET HISTORY');\n        removeType(Type.search);\n    };\n    const historyBox = (\n        <div className={'sui-advBox sui-advBox-' + props.id}>\n            <div\n                className={'sui-advHeader'}\n                id={'sui-advHeader-A'}\n                onClick={() => setOpen(!open)}\n            >\n                <span className={'icon'}>\n                    <BsArrowCounterclockwise />\n                </span>\n                <span>{label}</span>\n                <span id={'sui-advPlus-' + props.id} className={'sui-advPlus'}>\n                    <Badge\n                        pill\n                        variant={historyLength ? 'primary' : 'secondary'}\n                    >\n                        {historyLength}\n                    </Badge>{' '}\n                    {open ? minus : plus}\n                </span>\n            </div>\n\n            {/*<div className={'sui-advTerm'} id={'sui-advTerm-' + props.id}>*/}\n            {/*    {chosenList}*/}\n            {/*</div>*/}\n            <div\n                className={'sui-advEdit ' + (open ? 'open' : 'closed')}\n                id={'sui-advEdit-' + props.id}\n            >\n                <Navbar>\n                    <Nav.Item className={'sui-advEdit-facet-ctrls'}>\n                        <input\n                            type={'text'}\n                            placeholder=\"Filter this list\"\n                            onChange={handleChange}\n                            defaultValue={''}\n                            onKeyDownCapture={handleKey}\n                            ref={inputEl}\n                        />\n                    </Nav.Item>\n                    <Navbar.Collapse className=\"justify-content-end\">\n                        <Nav.Link\n                            eventKey=\"resetHistory\"\n                            onClick={handleResetHistory}\n                        >\n                            clear\n                        </Nav.Link>\n                    </Navbar.Collapse>\n                </Navbar>\n\n                <div className={'sui-adv-facetlist overflow-auto'}>\n                    {historyLength ? historyList : 'Search History is empty.'}\n                </div>\n            </div>\n        </div>\n    );\n    return historyBox;\n}\n\nHistoryBox.propTypes = {\n    label: PropTypes.string,\n    chosenIcon: PropTypes.string,\n    facetType: PropTypes.string,\n    filters: PropTypes.array,\n};\n","import { FacetBox } from './FacetBox';\nimport React, { useState } from 'react';\nimport Button from 'react-bootstrap/Button';\nimport ButtonGroup from 'react-bootstrap/ButtonGroup';\nimport Navbar from 'react-bootstrap/Navbar';\nimport Container from 'react-bootstrap/Container';\nimport Nav from 'react-bootstrap/Nav';\nimport { Link, useHistory, useLocation, useRouteMatch } from 'react-router-dom';\nimport Badge from 'react-bootstrap/Badge';\nimport { HistoryBox } from './HistoryBox';\nimport { useStoreState } from 'easy-peasy';\n\nconst SEARCH_PATH = '/search';\n\nexport function SearchAdvanced(props) {\n    const history = useHistory();\n    const query = '';\n    const openclass = props.advanced ? 'open' : 'closed';\n    let [reset, setReset] = useState(0);\n    const historyStack = useStoreState((state) => state.history.historyStack);\n\n    // This tells us whether we are viewing the search results\n    // so that we can give a link to go there (or not).\n    const searchView = useRouteMatch(SEARCH_PATH);\n\n    // console.log(\"SearchAdvance searchView = \", searchView);\n\n    function gotoSearchPage() {\n        if (!searchView) history.push(SEARCH_PATH);\n    }\n\n    function handleFacetChange(msg) {\n        const command = {\n            facetType: msg.facetType,\n            value: msg.value,\n            operator: msg.operator,\n            action: msg.action,\n        };\n        // console.log(\"SearchAdvanced:  handleFacetChange:  received: \", command);\n        const search = props.search;\n        const compound_id = `${msg.facetType}:${msg.value}`;\n\n        if (command.action === null || command.action === 'add') {\n            const new_filter = {\n                id: compound_id,\n                label: msg.labelText,\n                operator: msg.operator,\n                field: msg.facetType,\n                match: msg.value,\n            };\n\n            console.log(\n                'NEW FILTER: ' + JSON.stringify(new_filter, undefined, 2)\n            );\n            search.addFilters([new_filter]);\n        } else if (command.action === 'remove') {\n            search.removeFilters([{ id: compound_id }]);\n        }\n        gotoSearchPage(); // declaratively navigate to search\n    }\n\n    function handleNarrowFilters(narrowFilter) {\n        // console.log('handleNarrowFilters narrowFilter = ', narrowFilter);\n        const search = props.search;\n        search.narrowFilters(narrowFilter);\n    }\n\n    function getChosenFacets(type) {\n        // console.log(\"getChosenFacets: finding in:\", props.search.query.filters)\n        return props.search.query?.filters?.filter((x) => x.field === type);\n    }\n\n    function handleResetFilters() {\n        if (props.search) {\n            props.search.clearFilters();\n        }\n        setReset(reset + 1);\n    }\n\n    function handleResetAll() {\n        if (props.search) {\n            props.search.clearAll();\n        }\n        setReset(reset + 1);\n    }\n\n    function handleResetSuper() {\n        if (props.search) {\n            props.search.superClear();\n        }\n        setReset(reset + 1);\n    }\n\n    // console.log (\"SEARCHY \", props );\n    function closeAdvanced() {\n        if (typeof props.onStateChange === 'function') {\n            props.onStateChange({ advanced: false });\n        } else {\n            console.error(\n                'SearchAdvanced: No onStateChange() function passed in properties!'\n            );\n        }\n    }\n\n    // TODO: review whether the FacetBoxes should be a configured list rather than hand-managed components as they are now.\n    const advanced = (\n        <aside\n            id=\"l-column__search\"\n            className={`l-column__search ${openclass} overflow-auto`}\n        >\n            {typeof props.onStateChange === 'function' && (\n                <Navbar className={'justify-content-end'}>\n                    <Nav.Link onClick={closeAdvanced}>\n                        <span className={'icon shanticon-cancel'}></span>\n                    </Nav.Link>\n                </Navbar>\n            )}\n            <Navbar>\n                {/*<Navbar.Brand href=\"#home\">Navbar with text</Navbar.Brand>*/}\n                <Navbar.Toggle />\n                {!searchView && (\n                    <Link to={SEARCH_PATH}>\n                        {'<<'} Show Results{' '}\n                        <Badge pill variant={'secondary'}>\n                            {props.pager.numFound}\n                        </Badge>\n                    </Link>\n                )}\n                <Navbar.Collapse className=\"justify-content-end\">\n                    <Navbar.Text>Reset: </Navbar.Text>\n                    <Nav.Link\n                        eventKey=\"resetFilters\"\n                        onClick={handleResetFilters}\n                    >\n                        Filters\n                    </Nav.Link>\n                    |\n                    <Nav.Link\n                        eventKey=\"resetAll\"\n                        onMouseOver={(x) => console.log(x)}\n                        onClick={handleResetAll}\n                    >\n                        All\n                    </Nav.Link>\n                </Navbar.Collapse>\n            </Navbar>\n\n            <section>\n                <FacetBox\n                    id=\"asset_type\"\n                    label=\"item type\"\n                    facets={props.facets?.asset_count}\n                    facetType={'asset_type'}\n                    resetFlag={reset}\n                    onFacetClick={handleFacetChange}\n                    onNarrowFilters={handleNarrowFilters}\n                    chosenFacets={getChosenFacets('asset_type')}\n                />\n                <FacetBox\n                    id=\"subjects\"\n                    label=\"related subjects\"\n                    facets={props.facets?.related_subjects}\n                    facetType=\"subjects\"\n                    resetFlag={reset}\n                    onFacetClick={handleFacetChange}\n                    onNarrowFilters={handleNarrowFilters}\n                    chosenFacets={getChosenFacets('subjects')}\n                />\n                <FacetBox\n                    id=\"places\"\n                    label=\"related places\"\n                    facets={props.facets?.related_places}\n                    facetType=\"places\"\n                    resetFlag={reset}\n                    onFacetClick={handleFacetChange}\n                    onNarrowFilters={handleNarrowFilters}\n                    chosenFacets={getChosenFacets('places')}\n                />\n                <FacetBox\n                    id=\"terms\"\n                    label=\"related terms\"\n                    facets={props.facets?.related_terms}\n                    facetType=\"terms\"\n                    resetFlag={reset}\n                    onFacetClick={handleFacetChange}\n                    onNarrowFilters={handleNarrowFilters}\n                    chosenFacets={getChosenFacets('terms')}\n                />\n                <FacetBox\n                    id=\"feature_types\"\n                    label=\"feature types\"\n                    facets={props.facets?.feature_types}\n                    facetType=\"feature_types\"\n                    resetFlag={reset}\n                    onFacetClick={handleFacetChange}\n                    onNarrowFilters={handleNarrowFilters}\n                    chosenFacets={getChosenFacets('feature_types')}\n                />\n\n                <FacetBox\n                    id=\"collections\"\n                    label=\"collections\"\n                    facets={props.facets?.collections}\n                    facetType=\"collections\"\n                    resetFlag={reset}\n                    onFacetClick={handleFacetChange}\n                    onNarrowFilters={handleNarrowFilters}\n                    chosenFacets={getChosenFacets('collections')}\n                />\n                <FacetBox\n                    id=\"languages\"\n                    label=\"languages\"\n                    facets={props.facets?.languages}\n                    facetType=\"languages\"\n                    resetFlag={reset}\n                    onFacetClick={handleFacetChange}\n                    onNarrowFilters={handleNarrowFilters}\n                    chosenFacets={getChosenFacets('languages')}\n                />\n                <FacetBox\n                    id=\"users\"\n                    label=\"users\"\n                    facets={props.facets?.node_user}\n                    facetType=\"users\"\n                    resetFlag={reset}\n                    onFacetClick={handleFacetChange}\n                    onNarrowFilters={handleNarrowFilters}\n                    chosenFacets={getChosenFacets('users')}\n                />\n\n                <FacetBox\n                    id=\"creator\"\n                    label=\"creator\"\n                    facets={props.facets?.creator}\n                    facetType=\"creator\"\n                    resetFlag={reset}\n                    onFacetClick={handleFacetChange}\n                    onNarrowFilters={handleNarrowFilters}\n                    chosenFacets={getChosenFacets('creator')}\n                />\n\n                <FacetBox\n                    id=\"perspective\"\n                    label=\"perspective\"\n                    facets={props.facets?.perspective}\n                    facetType=\"perspective\"\n                    resetFlag={reset}\n                    onFacetClick={handleFacetChange}\n                    onNarrowFilters={handleNarrowFilters}\n                    chosenFacets={getChosenFacets('perspective')}\n                />\n\n                <FacetBox\n                    id=\"associated subjects\"\n                    label=\"Associated Subjects\"\n                    facets={props.facets?.associated_subjects}\n                    facetType=\"associated_subjects\"\n                    resetFlag={reset}\n                    onFacetClick={handleFacetChange}\n                    onNarrowFilters={handleNarrowFilters}\n                    chosenFacets={getChosenFacets('associated_subjects')}\n                />\n\n                <HistoryBox\n                    historyStack={historyStack}\n                    id=\"recent\"\n                    label=\"recent searches\"\n                    facetType=\"recent-searches\"\n                />\n            </section>\n            <div className={'sui-advFooter'}>\n                Show Boolean Controls? &nbsp;\n                <input\n                    type=\"checkbox\"\n                    id=\"sui-showBool\"\n                    defaultChecked={'checked'}\n                ></input>\n            </div>\n        </aside>\n    );\n    return advanced;\n}\n","// HISTORY!\nimport { useHistory } from 'react-router-dom';\nimport React, { useEffect } from 'react';\nimport { useStoreState } from 'easy-peasy';\nimport { useStoreActions } from '../../model/StoreModel';\nimport useAsset from '../../hooks/useAsset';\nimport { useLocation, useRouteMatch } from 'react-router';\nimport * as qs from 'qs';\n\nexport default function HistoryListener() {\n    // const history = useHistory();\n    // const historyStack = useStoreState((state) => state.history.historyStack);\n    // const searchState = useStoreState((state) => state.search);\n    const { setSearchState } = useStoreActions((actions) => actions.search);\n    const { addLocation, clear } = useStoreActions(\n        (actions) => actions.history\n    );\n    const HISTORY_LENGTH = 25;\n    const location = useLocation();\n    const match = useRouteMatch([\n        '/:type/:id/related-:relType/view/:relId',\n        '/:type/:id',\n        '/:type',\n    ]);\n    const searchMatch = useRouteMatch('/search/:mode');\n    const relatedType = match?.params?.relType;\n    const relatedId = match?.params?.relId;\n\n    // console.log(\"Location: \", location);\n\n    function fixId(theId) {\n        if (!theId) {\n            return null;\n        }\n        const [fixedId] = theId.match(/(\\d+)$/) || [];\n        return fixedId;\n    }\n\n    const fixedId = fixId(match?.params.id);\n    const kmasset = useAsset(match?.params.type, fixedId);\n\n    const fixedRelId = fixId(relatedId);\n    const relAsset = useAsset(relatedType, fixedRelId);\n\n    function fixTitle(docs) {\n        let title = null;\n        if (docs?.length) {\n            title = docs[0].title;\n            if (!title) {\n                title = docs[0].caption;\n            }\n        }\n        if (!title) {\n            title = null;\n        }\n        return title;\n    }\n\n    const qObj = qs.parse(location.search, {\n        allowDots: true,\n        ignoreQueryPrefix: true,\n        depth: 5,\n    });\n\n    // console.log(\n    //     'HISTORY LISTENER INIT location.search = ',\n    //     location.search\n    // );\n    // console.log('HISTORY LISTENER INIT qs = ', qObj);\n\n    let ss = {\n        searchString: '',\n        filters: [],\n    };\n\n    if (qObj.query?.searchText?.length) {\n        ss.searchString = qObj.query.searchText;\n    }\n    if (qObj.query?.filters?.length) {\n        ss.filters = qObj.query.filters;\n    }\n    if (qObj.page) {\n        ss.page = {\n            current: Number(qObj.page.current),\n            rows: Number(qObj.page.rows),\n        };\n    }\n    if (qObj.key) {\n        ss.key = qObj.key;\n    }\n\n    // console.log('HISTORY LISTENER INIT setSearchState = ', ss);\n\n    useEffect(() => {\n        if (location.search?.length) {\n            setSearchState(ss);\n        }\n    }, [location.search]);\n\n    useEffect(() => {\n        // console.log('HISTORY LISTENER useEffect(): 3');\n\n        if (searchMatch && ss) {\n            // console.log('HISTORY LISTENER useEffect(): 4');\n\n            let filterNote = '';\n            if (ss.filters?.length > 0) {\n                const plural = ss.filters.length === 1 ? '' : 's';\n                filterNote = ` (+${ss.filters.length} filter${plural})`;\n            }\n\n            const searchLocation = {\n                ...location,\n                name: '\"' + ss.searchString + '\"',\n                pathname: match.url,\n                state: ss,\n            };\n\n            // console.log(\n            //     'HISTORY LISTENER addLocation search = ',\n            //     searchLocation\n            // );\n\n            if (ss.searchString !== '' || ss.filters?.length !== 0) {\n                addLocation(searchLocation);\n            }\n        }\n    }, [location.search]);\n\n    const matchUrl = match?.url || '';\n    const relDocs = relAsset?.docs || [];\n\n    useEffect(() => {\n        // console.log('HISTORY LISTENER useEffect(): 1', location.search);\n        if (kmasset) {\n            if (kmasset.numFound > 0) {\n                // console.log('HISTORY LISTENER: kmasset = ', kmasset);\n\n                // console.log('HISTORY LISTENER useEffect(): 2');\n\n                // Clean up title and related\n                const title = fixTitle(kmasset.docs);\n                const relLabel = fixTitle(relAsset.docs);\n\n                const relTitle = relatedType ? relLabel : null;\n\n                // Create base location\n                const baseLocation = {\n                    ...location,\n                    name: title,\n                    relTitle: relTitle,\n                    pathname: match.url,\n                    asset_type: kmasset?.docs[0].asset_type,\n                    kmasset: kmasset?.docs[0],\n                };\n\n                // console.log(\n                //     'Making history: location = ',\n                //     location,\n                //     ' kmasset = ',\n                //     kmasset,\n                //     ' match.url = ',\n                //     match.url\n                // );\n                addLocation(baseLocation);\n            }\n        }\n    }, [addLocation, kmasset, location, matchUrl, relDocs, relatedType]);\n\n    // useEffect(() => {\n    //     return history.listen((location) => {\n    //         // console.log('History: Location = ', location);\n    //     });\n    // }, [history]);\n\n    return null;\n}\n","import React, { useEffect, useState } from 'react';\nimport {\n    BrowserRouter as Router,\n    Route,\n    Redirect,\n    Switch,\n} from 'react-router-dom';\n\nimport { SiteHeader } from './SiteHeader/SiteHeader';\nimport { Home } from './HomePage/Home';\nimport { ContentMain } from './ContentMain';\nimport { Hamburger } from './MainNavToggle/Hamburger';\n\nimport { SearchBar } from '../search/SearchBar';\nimport { SearchAdvanced } from '../search/SearchAdvanced';\nimport { Error404 } from '../App';\nimport SearchContext from '../context/SearchContext';\nimport { useStoreRehydrated } from 'easy-peasy';\nimport HistoryListener from '../views/History/HistoryListener';\nimport FancyTree from '../views/FancyTree';\nimport Tabs from 'react-bootstrap/Tabs';\nimport Tab from 'react-bootstrap/Tab';\nimport Container from 'react-bootstrap/Container';\nimport { useHistory } from 'react-router';\n\nconst stateDefault = {\n    kmasset: {\n        header: 'Mandala',\n        title: ['Mandala'],\n        uid: 'mandala',\n    },\n};\n\nexport function Main(props) {\n    const [state, setState] = useState(stateDefault);\n    const handleStateChange = (new_state) => {\n        setState({ ...state, ...new_state });\n    };\n    // const storeReady = true;\n    const storeReady = useStoreRehydrated();\n    const loading = <div className={'loading-msg'}>Loading...</div>;\n\n    let stateList = [];\n    if (state.advanced) {\n        stateList.push('u-ToggleState--advanced');\n    }\n    if (state.tree) {\n        stateList.push('u-ToggleState--tree');\n    }\n    if (!state.tree && !state.advanced) {\n        stateList.push('u-ToggleState--off');\n    }\n\n    const searchClasses = stateList.join(' ');\n    const main = (\n        <Router basename={'/mandala-om'}>\n            <div\n                id={'l-site__wrap'}\n                className={`l-site__wrap  ${searchClasses}`}\n            >\n                <HistoryListener />\n                <SiteHeader\n                    advanced={state.advanced}\n                    tree={state.tree}\n                    onStateChange={handleStateChange}\n                />\n                <Hamburger hamburgerOpen={state.hamburgerOpen} />\n\n                <Switch>\n                    <Route path={'/home'}>\n                        <Home />\n                    </Route>\n                    <Route exact path={'/'}>\n                        <Redirect to={'/home'} />\n                    </Route>\n                    <Route path={'/'}>\n                        <ContentMain\n                            site={'mandala'}\n                            mode={'development'}\n                            title={'Mandala'}\n                            sui={props.sui}\n                            kmasset={state.kmasset}\n                            kmap={state.kmap}\n                            onStateChange={handleStateChange}\n                        />\n                    </Route>\n                    <Route path={'*'}>\n                        <Error404 />\n                        <Home />\n                    </Route>\n                </Switch>\n                {/* Commented this out to get Asset Views to work (ndg) */}\n                <SearchContext>\n                    <SearchAdvanced\n                        advanced={state.advanced}\n                        onStateChange={handleStateChange}\n                    />\n                    <TreeNav tree={state.tree} />\n                </SearchContext>\n                <Hamburger hamburgerOpen={state.hamburgerOpen} />\n            </div>\n        </Router>\n    );\n\n    const ret = storeReady ? main : loading;\n    return ret;\n}\n\nfunction TreeNav(props) {\n    const openclass = props.tree ? 'open' : 'closed';\n\n    const tabs = (\n        <aside\n            id=\"l-column__search--treeNav\"\n            className={`l-column__search c-TreeNav--tabs ${openclass} overflow-auto`}\n        >\n            <div>\n                <span\n                    class={\n                        'sacrifical-dummy-element-that-is-not-displayed-for-some-reason'\n                    }\n                ></span>\n                <Tabs defaultActiveKey=\"places\" id=\"kmaps-tab\">\n                    <Tab eventKey=\"places\" title=\"Places\">\n                        <PlacesTree />\n                    </Tab>\n                    <Tab eventKey=\"subjects\" title=\"Subjects\">\n                        <SubjectsTree />\n                    </Tab>\n                    <Tab eventKey=\"terms\" title=\"Terms\">\n                        <TermsTree />\n                    </Tab>\n                </Tabs>\n            </div>\n        </aside>\n    );\n    return tabs;\n}\n\nfunction PlacesTree(props) {\n    return (\n        <FancyTree\n            domain=\"places\"\n            tree=\"places\"\n            descendants={true}\n            directAncestors={false}\n            displayPopup={false}\n            perspective=\"pol.admin.hier\"\n            view=\"roman.scholar\"\n            sortBy=\"position_i+ASC\"\n        />\n    );\n}\n\nfunction TermsTree(props) {\n    return (\n        <FancyTree\n            domain=\"terms\"\n            tree=\"terms\"\n            descendants={true}\n            directAncestors={false}\n            displayPopup={false}\n            perspective=\"tib.alpha\"\n            view=\"roman.scholar\"\n            sortBy=\"position_i+ASC\"\n        />\n    );\n}\n\nfunction SubjectsTree(props) {\n    return (\n        <FancyTree\n            domain=\"subjects\"\n            tree=\"subjects\"\n            descendants={true}\n            directAncestors={false}\n            displayPopup={false}\n            perspective={'gen'}\n            view=\"gen\"\n            sortBy=\"position_i+ASC\"\n        />\n    );\n}\n","import React from 'react';\nimport SearchUI from './legacy/searchui';\nimport Pages from './legacy/pages';\n\n// import './Om.css';\n\n// import {BrowserRouter as Router, Redirect, Route, Switch} from 'react-router-dom';\nimport { Main } from './main/Main';\n\nexport const ADVANCED_LABEL = 'Advanced';\nexport const BASIC_LABEL = 'Basic Search';\n\nclass App extends React.Component {\n    constructor(props) {\n        super();\n\n        if (!window.sui) {\n            window.sui = new SearchUI();\n        }\n        this.sui = window.sui;\n\n        if (!window.sui.pages) {\n            this.sui.pages = window.sui.pages = new Pages(this.sui);\n        }\n    }\n\n    render() {\n        return <Main sui={this.sui} />;\n    }\n}\n\nexport function Error404() {\n    return (\n        <div>\n            <h2>OUCH!</h2>\n            Unknown Path: {window.location.pathname}\n        </div>\n    );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n    window.location.hostname === 'localhost' ||\n        // [::1] is the IPv6 localhost address.\n        window.location.hostname === '[::1]' ||\n        // 127.0.0.0/8 are considered localhost for IPv4.\n        window.location.hostname.match(\n            /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n        )\n);\n\nexport function register(config) {\n    if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n        // The URL constructor is available in all browsers that support SW.\n        const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n        if (publicUrl.origin !== window.location.origin) {\n            // Our service worker won't work if PUBLIC_URL is on a different origin\n            // from what our page is served on. This might happen if a CDN is used to\n            // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n            return;\n        }\n\n        window.addEventListener('load', () => {\n            const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n            if (isLocalhost) {\n                // This is running on localhost. Let's check if a service worker still exists or not.\n                checkValidServiceWorker(swUrl, config);\n\n                // Add some additional logging to localhost, pointing developers to the\n                // service worker/PWA documentation.\n                navigator.serviceWorker.ready.then(() => {\n                    console.log(\n                        'This web app is being served cache-first by a service ' +\n                            'worker. To learn more, visit https://bit.ly/CRA-PWA'\n                    );\n                });\n            } else {\n                // Is not localhost. Just register service worker\n                registerValidSW(swUrl, config);\n            }\n        });\n    }\n}\n\nfunction registerValidSW(swUrl, config) {\n    navigator.serviceWorker\n        .register(swUrl)\n        .then((registration) => {\n            registration.onupdatefound = () => {\n                const installingWorker = registration.installing;\n                if (installingWorker == null) {\n                    return;\n                }\n                installingWorker.onstatechange = () => {\n                    if (installingWorker.state === 'installed') {\n                        if (navigator.serviceWorker.controller) {\n                            // At this point, the updated precached content has been fetched,\n                            // but the previous service worker will still serve the older\n                            // content until all client tabs are closed.\n                            console.log(\n                                'New content is available and will be used when all ' +\n                                    'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n                            );\n\n                            // Execute callback\n                            if (config && config.onUpdate) {\n                                config.onUpdate(registration);\n                            }\n                        } else {\n                            // At this point, everything has been precached.\n                            // It's the perfect time to display a\n                            // \"Content is cached for offline use.\" message.\n                            console.log('Content is cached for offline use.');\n\n                            // Execute callback\n                            if (config && config.onSuccess) {\n                                config.onSuccess(registration);\n                            }\n                        }\n                    }\n                };\n            };\n        })\n        .catch((error) => {\n            console.error('Error during service worker registration:', error);\n        });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n    // Check if the service worker can be found. If it can't reload the page.\n    fetch(swUrl, {\n        headers: { 'Service-Worker': 'script' },\n    })\n        .then((response) => {\n            // Ensure service worker exists, and that we really are getting a JS file.\n            const contentType = response.headers.get('content-type');\n            if (\n                response.status === 404 ||\n                (contentType != null &&\n                    contentType.indexOf('javascript') === -1)\n            ) {\n                // No service worker found. Probably a different app. Reload the page.\n                navigator.serviceWorker.ready.then((registration) => {\n                    registration.unregister().then(() => {\n                        window.location.reload();\n                    });\n                });\n            } else {\n                // Service worker found. Proceed as normal.\n                registerValidSW(swUrl, config);\n            }\n        })\n        .catch(() => {\n            console.log(\n                'No internet connection found. App is running in offline mode.'\n            );\n        });\n}\n\nexport function unregister() {\n    if ('serviceWorker' in navigator) {\n        navigator.serviceWorker.ready.then((registration) => {\n            registration.unregister();\n        });\n    }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.scss';\nimport App from './App';\n// import store from './app/store';\n// import { Provider } from 'react-redux';\nimport * as serviceWorker from './serviceWorker';\nimport { storeModel } from './model/StoreModel';\nimport localForage from 'localforage';\nimport { createStore, StoreProvider, persist } from 'easy-peasy';\nconst store = createStore(persist(storeModel, { storage: localForage }));\n\nReactDOM.render(\n    <React.StrictMode>\n        <StoreProvider store={store}>\n            <App />\n        </StoreProvider>\n    </React.StrictMode>,\n    document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}