(this["webpackJsonpkmaps-app"]=this["webpackJsonpkmaps-app"]||[]).push([[0],{281:function(e,t,a){},312:function(e,t,a){e.exports=a(583)},317:function(e,t,a){},323:function(e,t,a){},324:function(e,t,a){},346:function(e,t){},348:function(e,t){},357:function(e,t){},359:function(e,t){},386:function(e,t){},388:function(e,t){},389:function(e,t){},395:function(e,t){},397:function(e,t){},415:function(e,t){},417:function(e,t){},429:function(e,t){},432:function(e,t){},448:function(e,t,a){},450:function(e,t,a){},451:function(e,t,a){},452:function(e,t,a){},456:function(e,t,a){},457:function(e,t,a){},458:function(e,t,a){},479:function(e,t){},494:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=494},495:function(e,t,a){},496:function(e,t,a){},501:function(e,t,a){},502:function(e,t,a){},534:function(e,t){},561:function(e,t,a){},563:function(e,t,a){},564:function(e,t,a){},565:function(e,t,a){},566:function(e,t,a){},567:function(e,t,a){},568:function(e,t,a){},569:function(e,t,a){},570:function(e,t,a){},571:function(e,t,a){},572:function(e,t,a){},573:function(e,t,a){},583:function(e,t,a){"use strict";a.r(t);var s=a(0),n=a.n(s),i=a(31),r=a.n(i),l=(a(317),a(16)),c=a(17),o=a(63),d=a(62),u=a(2),p=a.n(u),m=function(){function e(t){if(Object(l.a)(this,e),"undefined"===typeof p.a)throw"This libraries requires jQuery";this.defaultState={solrUrl:"https://solrUrl.must.be.set.in.the.state.object",mode:"input",view:"Card",sort:"Alpha",type:"All",page:0,pageSize:100,query:{text:"",places:[],collections:[],languages:[],features:[],subjects:[],terms:[],relationships:[],users:[],assets:[],dateStart:"",dateEnd:"",project_filter:""}},t&&(this.defaultState=p.a.extend(!0,{},this.defaultState,t)),this.facetJSON={asset_counts:{limit:100,type:"terms",field:"asset_type",domain:{excludeTags:"ast"}},places:{limit:300,type:"terms",field:"kmapid_places_idfacet"},subjects:{limit:300,type:"terms",field:"kmapid_subjects_idfacet"},terms:{limit:300,type:"terms",field:"kmapid_terms_idfacet"},features:{limit:300,type:"terms",field:"feature_types_idfacet"},languages:{limit:300,type:"terms",field:"node_lang"},collections:{limit:300,type:"terms",field:"collection_idfacet"},collection_nid:{limit:300,type:"terms",field:"collection_nid"},collection_uid:{limit:300,type:"terms",field:"collection_uid_s"},asset_subtype:{limit:300,type:"terms",field:"asset_subtype",facet:{parent_type:{limit:1,type:"terms",field:"asset_type"}}},node_user:{limit:300,type:"terms",field:"user_name_full_s"},creator:{limit:300,type:"terms",field:"creator"}},this.facetAdvancedJSON={related:{domain:{blockChildren:"block_type:parent"},type:"terms",field:"related_subjects_relation_code_s",limit:-1,facet:{related_subject:{type:"terms",field:"related_subjects_id_s",limit:-1,facet:{related_subject_name:{type:"terms",field:"related_subjects_header_s",limit:1}}}}}}}return Object(c.a)(e,[{key:"allAssets",value:function(){return[{id:"audio-video",title:"audio-video",bool:"OR"},{id:"images",title:"images",bool:"OR"},{id:"texts",title:"images",bool:"OR"},{id:"visuals",title:"visuals",bool:"OR"},{id:"sources",title:"sources",bool:"OR"},{id:"subjects",title:"subjects",bool:"OR"},{id:"places",title:"places",bool:"OR"},{id:"terms",title:"terms",bool:"OR"}]}},{key:"createBasicQuery",value:function(e,t,a){var s=this.allAssets();e=p.a.extend(!0,{},this.defaultState,e);var n={};if(t&&t.length>0)for(var i=0;i<t.length;i++){var r=t[i],l=this.facetJSON[r];l?n[r]=l:console.error("Warning: ignoring unknown facet: "+r)}p.a.isEmptyObject(n)&&(console.log("no currentFacets so using ALL facets"),n=this.facetJSON);var c=[];if(a&&a.length>0)for(var o=0;o<a.length;o++){var d=a[o].split(":"),u=d[0],m=d[1],h=this.facetJSON[u].field+":*"+m+"*";c.push(h)}var f=e.query.text||"";f=f.replace(/ /g,"\\ ").replace("(","\\(").replace(")","\\)").replace(":","\\:").replace("+","\\+").replace("-","\\-").replace('"','\\"').replace("?","\\?");var g=e.page||0,v=e.pageSize||100;c.length>0&&(v=0);var _=f.length?f+"*":"*",b=f.length?"*"+f+"*":"*",y=f+"/";"undefined"!==p.a.type(f)&&0!==f.length||(f=b=y="*");var E=g*v,k=[];if(e.query.places&&e.query.places.length&&k.push(this.buildFq(e.query.places,"kmapid")),e.query.subjects&&e.query.subjects.length&&k.push(this.buildFq(e.query.subjects,"kmapid")),e.query.terms&&e.query.terms.length&&k.push(this.buildFq(e.query.terms,"kmapid")),e.query.features&&e.query.features.length&&k.push(this.buildFq(e.query.features,"feature_types_ss","title")),e.query.collections&&e.query.collections.length&&k.push(this.buildFq(e.query.collections,"collection_uid_s","id")),e.query.languages&&e.query.languages.length&&k.push(this.buildFq(e.query.languages,"node_lang","title")),e.query.assets&&e.query.assets.length){for(var w=0;w<e.query.assets.length;w++)"all"===e.query.assets[w].id&&(e.query.assets=s);k.push(this.buildFq(e.query.assets,"asset_type","id","ast"))}e.query.users&&e.query.users.length&&k.push(this.buildFq(e.query.users,"node_user","title")),e.query.creators&&e.query.creators.length&&k.push(this.buildFq(e.query.creators,"creator","title")),e.project_filter&&e.project_filter.length&&k.push(e.project_filter);var x="";e.query.kmapid&&(x=e.query.kmapid);var T={q:"( title:${xact}^100 title:${slashy}^100 names_txt:${xact}^90 title:${starts}^80 names_txt:${starts}^70 title:${search}^10 caption:${search} summary:${search} names_txt:${search})",xact:f,starts:_,search:b,slashy:y},j={q:"(uid:${kmapid}^100 kmapid:${kmapid})",kmapid:x};"*"!==f&&""!==f||(T={q:"*"});var S=x.length?j:T,N=p.a.extend({},{fl:"*",wt:"json",start:E,rows:v,facet:"on","json.facet":JSON.stringify(n),echoParams:"explicit",indent:"true"},S),O=e.solrUrl,A=new URLSearchParams(N);for(w=0;w<k.length;w++)A.append("fq",k[w]);for(var C=0;C<c.length;C++)A.append("fq",c[C]);return new URL(O+"?"+A.toString())}},{key:"createKmapQuery",value:function(e,t,a,s){var n=this.allAssets();s=s||10,a=a||0;var i=t?[{id:t,title:t,bool:"OR"}]:n;return this.createBasicQuery({page:a,pageSize:s,query:{kmapid:e,assets:i}},["asset_counts"])}},{key:"createAssetsByCollectionQuery",value:function(e,t,a){return this.createBasicQuery({page:t,pageSize:a,query:{collections:[{title:e,id:e,bool:"OR"}]}})}},{key:"buildFq",value:function(e,t,a,s){a||(a="id");for(var n=s?"{!tag="+s+"}":"",i="",r=0;r<e.length;r++){var l=e[r],c=l[a],o="";"AND"===l.bool?o="+":"NOT"===l.bool?o="-":"OR"===l.bool?o="":console.error("Unknown operator = "+l.bool+" : "+JSON.stringify(l)),i+=" "+o+'"'+c+'"'}return n+t+":("+i+")"}},{key:"createAdvancedFacetQuery",value:function(e){(e=p.a.extend(!0,{},this.defaultState,e)).solrUrl="https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmterms_dev/select";var t=e.query.text||"",a=e.page||0,s=e.pageSize||100,n=t+"*",i="*"+t+"*",r=t+"/";"undefined"!==p.a.type(t)&&0!==t.length||(t=i=r="*");var l={q:"( header:${xact}^100 header:${slashy}^100 header:${starts}^80 header:${search}^10)",xact:t,starts:n,search:i,slashy:r,fl:"*,[child parentFilter=block_type:parent]",wt:"json",start:a,rows:s,facet:"on","json.facet":JSON.stringify(this.facetAdvancedJSON),echoParams:"explicit",indent:"true"},c=e.solrUrl,o=new URLSearchParams(l);return new URL(c+"?"+o.toString())}},{key:"buildQuery",value:function(e,t,a,s,n,i){""===(a=a.replace(/^\//,"").replace(/\s\//," "))&&(a="*");var r="level_i",l="ancestor_id_path";"terms"===t&&(r="level_tib.alpha_i",l="ancestor_id_tib.alpha_path");for(var c={child_counts:{limit:300,mincount:2,type:"terms",field:l,domain:{excludeTags:"hoot"}}},o=i||["header","id","ancestor*","caption_eng","position*",r].join(","),d=[],u=n+1;u>s;u--){var p=a.split("/").slice(0,u-1).join("/"),m=p.length?" AND "+l+":"+p:"";d.push("("+r+":"+(u-1)+m+")")}var h=d.join(" ");return e+"/select?df="+l+"&q="+a.split("/").slice(0,s).join("/")+"&wt=json&indent=true&limit=2000&facet=true&fl="+o+"&indent=true&fq=tree:"+t+"&fq="+r+":["+s+"+TO+"+(n+1)+"]&fq={!tag=hoot}"+h+"&facet.mincount=2&facet.limit=-1&sort="+r+"+asc,position_i+asc,header+asc&facet.sort="+l+"+ASC&facet.field={!ex=hoot}"+l+"&json.facet="+JSON.stringify(c)+"&wt=json&json.wrf=?&rows=2000"}},{key:"buildAssetQuery",value:function(e){return this.createBasicQuery(e)}}]),e}(),h=function(){function e(t,a){Object(l.a)(this,e),this.sui=this,this.curResults="",this.numItems=0,this.AND="AND",this.OR="OR",this.NOT="NOT",this.ss={},this.site=t,this.facets={},this.facets.assets={type:"list",icon:"&#xe60b",mode:null,data:[]},this.facets.places={type:"tree",icon:"&#xe62b",mode:null,data:[]},this.facets.features={type:"tree",icon:"&#xe638",mode:null,data:[]},this.facets.subjects={type:"tree",icon:"&#xe634",mode:null,data:[]},this.facets.terms={type:"tree",icon:"&#xe635",mode:null,data:[]},this.facets.collections={type:"list",icon:"&#xe633",mode:null,data:[]},this.facets.languages={type:"tree",icon:"&#xe670",mode:null,data:[]},this.facets.users={type:"input",icon:"&#xe600",mode:null,data:[]},this.assets={},this.assets.all={c:"#5b66cb",g:"&#xe60b"},this.assets.places={c:"#6faaf1",g:"&#xe62b"},this.assets["audio-video"]={c:"#58aab4",g:"&#xe648"},this.assets.images={c:"#b49c59",g:"&#xe62a"},this.assets.sources={c:"#5a57ad",g:"&#xe631"},this.assets.texts={c:"#8b5aa1",g:"&#xe636"},this.assets.visuals={c:"#6e9456",g:"&#xe63b"},this.assets.subjects={c:"#cc4c39",g:"&#xe634"},this.assets.terms={c:"#a2733f",g:"&#xe635"},this.assets.collections={c:"#5b66cb",g:"&#xe633"},this.searches=[],this.showBool=!1,this.showSearch=!1,this.noTop="CU"==t,p()("<link/>",{rel:"stylesheet",type:"text/css",href:"searchui.css"}).appendTo("head"),this.solrId=a?"_prod":"_dev",this.solrBase="https://"+(a?"ss395824":"ss251856")+"-us-east-1-aws.measuredsearch.com/solr/",this.ss.solrUrl=this.solrBase+"kmassets"+(a?"":"_dev")+"/select",this.ss.mode="input",this.ss.view="Card",this.ss.sort="Alpha",this.ss.page=0,this.ss.pageSize=100,this.ss.site="Mandala",this.ss.numResults=0,this.solrUtil=new m({solrUrl:this.ss.solrUrl}),this.ClearQuery()}return Object(c.a)(e,[{key:"Draw",value:function(e){e&&(this.ss.mode=e),this.DrawResults()}},{key:"ShowAdvanced",value:function(e){throw new Error("ShowAdvanced")}},{key:"ShowHamburger",value:function(){p()("#sui-hamburger").html("<span id='sui-help' class='sui-hamItem'>&#xe67e&nbsp;&nbsp;HELP GUIDE</span>\n\t\t<span id='sui-home' class='sui-hamItem'>&#xe60b&nbsp;&nbsp;HOME</span>".replace(/\t|\n|\r/g,"")),p()("#sui-hamburger").slideToggle(),p()("#sui-home").on("click",(function(){alert("DrawLandingPage()")})),p()("#sui-help").on("click",(function(){window.open("//confluence.its.virginia.edu/display/KB/Mandala+Suite+of+Tools","_blank")})),p()("#sui-hamburger").on("click",(function(){p()("#sui-hamburger").slideUp()}))}},{key:"SetState",value:function(e){var t=window.location.href.split("#")[0];window.history.pushState("#"+e,"Mandala",t+(e?"#"+e:""))}},{key:"PageRouter",value:function(e){var t,a=this,s=this.sui;window.location.href.split("#")[0];if(t=e.match(/#p=(.+)/))t=t[1].toLowerCase(),i(),this.alert("======== PAGEROUTER: "+e+" Handling p: Drawing "+t),this.log("\tPAGEROUTER: calling pages.Draw() with id="+t),this.GetKmapFromID(t,(function(e){a.log("\tPAGEROUTER: calling pages.Draw() with kmap="+e.uid),a.pages.Draw(e,!0)}));else if(t=e.match(/#r=(.+)/)){i();var n=t[1].replace(/\%20/g," ").split("=");this.pages.relatedId=n[0],this.pages.relatedType=n[2],this.alert("======== PAGEROUTER: "+e+" Handling r: calling getKmapFromID with id = "+n[3]+" this.pages.relatedId="+this.pages.relatedId+" this.pages.relatedType="+this.pages.relatedType),this.GetKmapFromID(n[3],(function(e){a.pages.relatedBase=e,a.pages.DrawRelatedResults(e,!0)}))}else(t=e.match(/#s=(.+)/))&&(i(),t=t[1].replace(/\%20/g," "),this.ParseQuerystring(t),this.alert("======== PAGEROUTER: "+e+" Handling s: Parsing querystring: "+t+" set ss.query.text to "+ss.query.text),p()("#sui-search").val(this.ss.query.text),this.Query(!0));function i(){s.ss.mode="simple",s.ss.page=0,p()("#sui-legacy").scrollTop(0),p()("#c-columnContent__main").scrollTop(0),p()("#plc-infoDiv").remove(),p()("#l-content__main").css({width:"100%",display:"inline-block"}),p()("#sui-adv").css({display:"none"}),p()("#sui-legacy").css({display:"block"}),s.DrawHeader(!0),s.DrawFooter()}}},{key:"SerializeQuery",value:function(e){var t,a,s="";for(a in this.ss.query.assets=[this.ss.query.assets[0]],e.query)if("text"==a&&e.query[a])s+="".concat(a,":").concat(e.query[a],"=");else for(t=0;t<e.query[a].length;++t)s+="".concat(a,":").concat(e.query[a][t].title,":").concat(e.query[a][t].id,":").concat(e.query[a][t].bool,"=");return s.slice(0,-1)}},{key:"ParseQuerystring",value:function(e){var t,a,s,n=e.split("=");for(this.ClearQuery(),this.ss.query.assets=[],t=0;t<n.length;++t)n[t].match(/^text/)?this.ss.query.text=n[t].substr(5):(s={title:(a=n[t].split(":"))[1],id:a[2],bool:a[3]},this.ss.query[a[0]].push(s));this.ss.query.assets=[this.ss.query.assets[0]]}},{key:"ClearQuery",value:function(){p()("#sui-search").val(""),this.pages&&(this.pages.relatedBase=this.pages.relatedId=""),this.ss.page=0,this.ss.query={text:"",places:[],collections:[],languages:[],features:[],subjects:[],terms:[],relationships:[],users:[],assets:[{title:"All",id:"all",bool:"AND"}],termPerspective:"",subjectPerspective:"",placePerspective:"",view:""}}},{key:"Query",value:function(e,t){var a,s=this;if(this.LoadingIcon(!0,64),t){var n=JSON.parse(JSON.stringify(this.ss));n.query={text:"",places:[],assets:[{id:this.pages.relatedType,bool:"AND"}],languages:[],features:[],subjects:[],terms:[],relationships:[],users:[],perspectives:[],collections:[{title:"all",id:t,bool:"AND"}]},a=this.solrUtil.buildAssetQuery(n)}else a="related"==this.ss.mode?this.solrUtil.createKmapQuery(this.pages.relatedId.toLowerCase(),this.pages.relatedType.toLowerCase(),this.ss.page,this.ss.pageSize):this.solrUtil.buildAssetQuery(this.ss);"related"==this.ss.mode||e||this.SetState("s="+this.SerializeQuery(this.ss)),p()("#sui-relatedAssets").remove(),this.ActiveSearch()&&(this.searches.filter((function(e,t){JSON.stringify(e.query)===JSON.stringify(s.ss.query)&&s.searches.splice(t,1)})),this.searches.push(JSON.parse(JSON.stringify(this.ss)))),p.a.ajax({url:a,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){s.curResults=s.MassageKmapData(e.response.docs),s.ParseFacetData(e),s.LoadingIcon(!1),s.DrawResults()})).fail((function(e){s.LoadingIcon(!1),s.Popup("Query error")}))}},{key:"GetKmapFromID",value:function(e,t){var a=this,s=this.ss.solrUrl+"?q=uid:"+e.toLowerCase()+"&wt=json";p.a.ajax({url:s,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){try{e=a.MassageKmapData(e.response.docs[0])}catch(s){e.error=s}t(e)})).fail((function(e){console.log(e)}))}},{key:"GetDefinitionAssets",value:function(e,t){var a=this,s=this.ss.solrUrl+"?q=kmapid:"+e.toLowerCase()+"&wt=json";p.a.ajax({url:s,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){e=a.MassageKmapData(e.response.docs),t(e)})).fail((function(e){console.log(e)}))}},{key:"GetRelatedFromID",value:function(e,t){var a=this;this.log("GetRelatedFromID() called with arguments");var s="".concat(this.solrBase,"kmterms").concat(this.solrId,"/query");s+="?child_count.fq=related_kmaps_node_type:child&child_count.fl=uid&fq=!related_kmaps_node_type:parent",s+="&child_count.rows=0&fl=child_count:[subquery],*&child_count.q={!child%20of='block_type:parent'}",s+="{!term%20f=uid%20v=$row.related_subjects_id_s}&rows=2000&q=id:"+e+"%20OR%20{!child%20of=block_type:parent}id:"+e+"%20&sort=block_type%20DESC,%20related_subjects_header_s%20ASC",this.log("SOLR QUERY GetRelatedFromID():  query = "+s),p.a.ajax({url:s,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){a.log("GetRelatedFromID() returns "+e),t(e.response.docs)})).fail((function(e){console.log(e)}))}},{key:"GetRelatedPlaces",value:function(e,t){var a=this;this.LoadingIcon(!0,64);var s=this.solrUtil.createKmapQuery(e,"places",0,1e4);p.a.ajax({url:s,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){e=a.MassageKmapData(e.response.docs),a.LoadingIcon(!1),t(e)})).fail((function(e){console.log(e),a.LoadingIcon(!1),a.Popup("Related query error")}))}},{key:"GetChildNamesFromID",value:function(e,t,a){var s="".concat(this.solrBase,"kmterms").concat(this.solrId,"/select?fl=uid%2C%5Bchild%20childFilter%3Did%3A").concat(e,"-").concat(t,"_names-*%20parentFilter%3Dblock_type%3Aparent%5D&q=uid%3A").concat(e,"-").concat(t,"&wt=json&rows=300");p.a.ajax({url:s,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){a(e.response.docs)})).fail((function(e){console.log(e)}))}},{key:"GetChildDataFromID",value:function(e,t){var a="".concat(this.solrBase,"kmterms").concat(this.solrId,"/query?q=uid:").concat(e,"&wt=json&fl=*,[child%20parentFilter=block_type:parent%20limit=300]");p.a.ajax({url:a,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){t(e.response.docs[0])})).fail((function(e){console.log(e)}))}},{key:"GetTreeChildren",value:function(e,t,a){var s=this.sui,n="".concat(this.solrBase,"kmterms").concat(this.solrId),i=Math.max(t.split("/").length+1,2);"features"!=e&&"languages"!=e||(e="subjects");var r=s.solrUtil.buildQuery(n,e,t,i,i);p.a.ajax({url:r,dataType:"jsonp"}).done((function(e){a(e)})).fail((function(e){console.log(e)}))}},{key:"GetAudioFromID",value:function(e,t){p.a.getJSON("//terms.kmaps.virginia.edu/slices/"+e+"/recordings",(function(e){var a,s=[];try{for(a=0;a<e.recordings.length;++a)s.push(e.recordings[a].audio_file);t(s)}catch(n){}})).fail((function(e){console.log(e)}))}},{key:"GetJSONFromKmap",value:function(e,t){var a=this,s=e.url_json;s&&(s=(s=s.replace(/images.shanti.virginia.edu/i,"images-dev.shanti.virginia.edu")).replace(/https:|http:/i,""),s+="?callback=myfunc",("audio-video"==e.asset_type||e.subcollection_uid_ss)&&(s=s.replace(/.json/i,".jsonp")),p.a.ajax({url:s,dataType:"jsonp",error:function(e){a.Popup("JSON access error")}}).done((function(e){t(e)})))}},{key:"MassageKmapData",value:function(e){var t,a;for(t=0;t<e.length;++t)(a=e[t]).asset_subtype&&(a.asset_subtype=a.asset_subtype.charAt(0).toUpperCase()+a.asset_subtype.slice(1)),a.url_thumb&&(a.url_thumb=a.url_thumb.replace(/images-test/i,"images")),"places"==a.asset_type&&(a.ancestors_txt&&a.ancestors_txt.length&&a.ancestors_txt.splice(0,1),a.ancestor_ids_is&&a.ancestor_ids_is.length&&a.ancestor_ids_is.splice(0,1)),"texts"==a.asset_type?a.url_thumb="gradient.jpg":a.url_thumb||(a.url_thumb="gradient.jpg"),a.display_label&&(a.title=a.display_label);return e}},{key:"ParseFacetData",value:function(e){var t,a,s,n,i=0;for(a in this.assets)this.assets[a].n=0;if(e&&e.facets&&e.facets.asset_counts&&e.facets.asset_counts.buckets){for(n=e.facets.asset_counts.buckets,t=0;t<n.length;++t)s=n[t].val,this.assets[s]&&(this.assets[s].n=n[t].count),i+=n[t].count;this.ss.numResults=this.assets.all.n=i}}},{key:"QueryFacets",value:function(e,t){var a=this;if("users"!=e&&"relationships"!=e){this.LoadingIcon(!0,64);var s=this.solrUtil.createBasicQuery(this.ss,["assets"==e?"languages":e]);p.a.ajax({url:s,dataType:"jsonp",jsonp:"json.wrf"}).done((function(t){var s,n,i;if(a.LoadingIcon(!1),t.facets[e])for(n=t.facets[e].buckets,a.facets[e].data=[],s=0;s<Math.min(300,n.length);++s)i=n[s].val.split("|"),a.facets[e].data.push({title:i[0],id:i[1],n:n[s].count});a.ResetFacetList(e)}))}}},{key:"DrawResults",value:function(e){if(this.log("DrawResults() called",arguments),p()("#c-columnContent__main").scrollTop(0),p()("#sui-legacy").scrollTop(0),p()("#sui-legacy").css({"background-image":""}),p()("#sui-legacy").css({display:"block"}),p()("#plc-infoDiv").remove(),"related"==this.ss.mode?this.numItems=this.assets[this.pages.relatedType].n:this.numItems=this.assets[this.ss.query.assets[0].id].n,"input"==this.ss.mode)return p()("#sui-header").css({display:"none"}),p()("#sui-header").css({display:"inline-block","background-color":"#4d59ca"}),p()("#sui-content").css({display:"block",width:"100%"}),p()("#sui-adv").css({display:"none"}),void p()("#sui-legacy").css({display:"none"});"simple"==this.ss.mode?(p()("#sui-content").css({width:"100%"}),p()("#sui-adv").css({display:"none"}),p()("#sui-content").slideDown(),p()("#sui-content").css({width:p()("#l-site__wrap").width()})):"advanced"==this.ss.mode&&(p()("#sui-adv").css({display:"block"}),p()("#sui-content").css({width:p()("#l-site__wrap").width()-p()("#sui-adv").width()})),p()("#sui-mode").prop({title:"advanced"==this.ss.mode?"Basic search":"Advanced search"}),p()("#sui-mode").html("advanced"==this.ss.mode?"BASIC<br>SEARCH":"ADVANCED<br>SEARCH"),p()("#sui-header").css({display:"block"}),e||(this.DrawHeader(),this.DrawItems(),this.DrawFooter())}},{key:"DrawHeader",value:function(){var e=this;if("related"!=this.ss.mode){var t=Math.floor(this.numItems/this.ss.pageSize),a=this.ss.page*this.ss.pageSize+1,s=Math.min(a+this.ss.pageSize,this.numItems),n="<span style='vertical-align:-10px'>".concat(this.ss.query.assets[0].title.toUpperCase()," search results &nbsp; <span style='font-size:12px'> (").concat(a,"-").concat(s,") of ").concat(this.numItems,"\t\n\t\t<div style='float:right;font-size:11px;margin:12px -48px 0 0'>\n\t\t\t<div id='sui-page1T' class='sui-resDisplay' title='Go to first page'>&#xe63c</div>\n\t\t\t<div id='sui-pagePT' class='sui-resDisplay' title='Go to previous page'>&#xe63f</div>\n\t\t\t<div class='sui-resDisplay'> PAGE <input type='text' id='sui-typePageT' \n\t\t\tstyle='border:0;border-radius:4px;width:30px;text-align:center;vertical-align:1px;font-size:10px;padding:2px'\n\t\t\ttitle='Enter page, then press Return'> OF ").concat(t+1,"</div>\n\t\t\t<div id='sui-pageNT' class='sui-resDisplay' title='Go to next page'>&#xe63e</div>\n\t\t\t<div id='sui-pageLT' class='sui-resDisplay' title='Go to last page'>&#xe63d</div>\n\t\t\t</div>");p()("#c-content__header__main").html(n.replace(/\t|\n|\r/g,"")),p()("#sui-header").css("background-color","#888"),p()("#sui-typePageT").val(this.ss.page+1),p()("[id^=sui-page]").css("color","#fff"),0==this.ss.page&&(p()("#sui-page1T").css("color","#ddd"),p()("#sui-pagePT").css("color","#ddd")),this.ss.page==t&&(p()("#sui-pageNT").css("color","#ddd"),p()("#sui-pageLT").css("color","#ddd")),p()("#sui-page1T").on("click",(function(){e.ss.page=0,e.Query()})),p()("#sui-pagePT").on("click",(function(){e.ss.page=Math.max(e.ss.page-1,0),e.Query()})),p()("#sui-pageNT").on("click",(function(){e.ss.page=Math.min(e.ss.page+1,t),e.Query()})),p()("#sui-pageLT").on("click",(function(){e.ss.page=t,e.Query()})),p()("#sui-typePageT").on("change",(function(){var a=p()("#sui-typePageT").val();isNaN(a)||(e.ss.page=Math.max(Math.min(a-1,t),0)),e.Query()}))}}},{key:"DrawFooter",value:function(){var e=this,t=Math.floor(this.numItems/this.ss.pageSize);"related"!=this.ss.mode&&p()("#sui-footer").css("background-color","#888");var a="\n\t\t<div style='float:left;font-size:18px'>\n\t\t\t<div id='sui-viewModeList' class='sui-resDisplay' title='List view'>&#xe61f</div>\n\t\t\t<div id='sui-viewModeGrid' class='sui-resDisplay' title='Grid view'>&#xe61b</div>\n\t\t\t<div id='sui-viewModeCard' class='sui-resDisplay' title='Card view'>&#xe673</div>\n\t\t</div>\t\n\t\t<div style='display:inline-block;font-size:11px'>\n\t\t\t<div id='sui-page1' class='sui-resDisplay' title='Go to first page'>&#xe63c</div>\n\t\t\t<div id='sui-pageP' class='sui-resDisplay' title='Go to previous page'>&#xe63f</div>\n\t\t\t<div class='sui-resDisplay'> PAGE <input type='text' id='sui-typePage' \n\t\t\tstyle='border:0;border-radius:4px;width:30px;text-align:center;vertical-align:1px;font-size:10px;padding:2px'\n\t\t\ttitle='Enter page, then press Return'> OF ".concat(t+1,"</div>\n\t\t\t<div id='sui-pageN' class='sui-resDisplay' title='Go to next page'>&#xe63e</div>\n\t\t\t<div id='sui-pageL' class='sui-resDisplay' title='Go to last page'>&#xe63d</div>\n\t\t\t</div>\t\n\t\t<div style='float:right;font-size:16px;'>\n\t\t\t<div id='sui-viewSortAlpha' class='sui-resDisplay' title='Sort alphabetically'>&#xe652</div>\n\t\t\t<div id='sui-viewSortDate'  class='sui-resDisplay' title='Sort by date'>&#xe60c</div>\n\t\t\t<div id='sui-viewSortAuthor' class='sui-resDisplay' title='Sort by author'>&#xe600</div>\n\t\t\t</div>");p()("#sui-footer").html(a.replace(/\t|\n|\r/g,"")),p()("#sui-typePage").val(this.ss.page+1),p()("[id^=sui-viewMode]").css("color","#ddd"),p()("#sui-viewMode"+this.ss.view).css("color","#fff"),p()("[id^=sui-viewMode]").on("click",(function(t){e.ss.view=t.currentTarget.id.substring(12),e.DrawResults()})),p()("[id^=sui-viewSort]").css("color","#ddd"),p()("#sui-viewSort"+this.ss.sort).css("color","#fff"),p()("[id^=sui-viewSort]").on("click",(function(t){e.ss.sort=t.currentTarget.id.substring(12),"Alpha"==e.ss.sort?e.curResults.sort((function(e,t){return e.title[0]>t.title[0]?1:e.title[0]<t.title[0]?-1:0})):"Date"==e.ss.sort?e.curResults.sort((function(e,t){return e.timestamp>t.timestamp?1:e.timestamp<t.timestamp?-1:0})):"Author"==e.ss.sort&&e.curResults.sort((function(e,t){return e.node_user>t.node_user?1:e.node_user<t.node_user?-1:0})),e.DrawResults()})),p()("[id^=sui-page]").css("color","#fff"),0==this.ss.page&&(p()("#sui-page1").css("color","#ddd"),p()("#sui-pageP").css("color","#ddd")),this.ss.page==t&&(p()("#sui-pageN").css("color","#ddd"),p()("#sui-pageL").css("color","#ddd")),p()("#sui-page1").on("click",(function(){e.ss.page=0,e.Query()})),p()("#sui-pageP").on("click",(function(){e.ss.page=Math.max(e.ss.page-1,0),e.Query()})),p()("#sui-pageN").on("click",(function(){e.ss.page=Math.min(e.ss.page+1,t),e.Query()})),p()("#sui-pageL").on("click",(function(){e.ss.page=t,e.Query()})),p()("#sui-typePage").on("change",(function(){var a=p()("#sui-typePage").val();isNaN(a)||(e.ss.page=Math.max(Math.min(a-1,t),0)),e.Query()}))}},{key:"DrawItems",value:function(){var e,t=this,a="";for(p()("#sui-legacy").css({"background-color":"List"==this.ss.view?"#fff":"#ddd"}),"related"==this.ss.mode?p()("#sui-legacy").css({"padding-left":"204px",width:"calc(100% - 216px"}):p()("#sui-legacy").css({"padding-left":"12px",width:"calc(100% - 24px"}),e=0;e<this.curResults.length;++e)"Card"==this.ss.view?a+=this.DrawCardItem(e):"Grid"==this.ss.view?a+=this.DrawGridItem(e):a+=this.DrawListItem(e);this.curResults.length||(a="<br><br><br><div style='text-align:center;color:#666'>Sorry, there were no items found<br>Try broadening your search</div>"),p()("#sui-legacy").html(a.replace(/\t|\n|\r/g,"")),"related"==this.ss.mode&&this.pages.DrawRelatedAssets(),p()(".sui-itemIcon").on("click",(function(e){var a=e.currentTarget.id.substring(13);return e.originalEvent.metaKey?window.open("#p="+t.curResults[a].uid,"_blank"):t.SendMessage("page="+t.curResults[a].url_html,t.curResults[a]),!1})),p()("[id^=sui-itemPic-]").on("click",(function(e){var a=e.currentTarget.id.substring(12);return e.originalEvent.metaKey?window.open("#p="+t.curResults[a].uid,"_blank"):t.SendMessage("page="+t.curResults[a].url_html,t.curResults[a]),!1})),p()(".sui-gridInfo").on("mouseover",(function(e){var a=e.currentTarget.id.substring(13),s=t.curResults[a],n="";if(s.title&&(n+="<strong>"+s.title+"</strong><br><br>"),n+=t.assets[s.asset_type].g+"&nbsp;&nbsp;"+s.asset_type.toUpperCase(),s.asset_subtype&&(n+=" / "+s.asset_subtype),n+="<br>",s.creator&&(n+="<p>&#xe600&nbsp;&nbsp;"+s.creator.join(", ")+"</p>"),s.summary||s.caption){var i=s.summary||s.caption;i.length>80&&(i=i.substr(0,80)+"..."),n+="<p><div style='display:inline-block;background-color:#ccc;width:4px;height:18px;margin:2px 10px 0 5px;vertical-align:-4px'></div>&nbsp;<i>"+i+"</i></p>"}s.summary&&(n+="<p style='font-family:serif;'>"+s.summary+"</p>");var r=p()("#"+e.currentTarget.id).offset();t.Popup(n,20,Math.max(8,r.left-220),r.top+24)})),p()(".sui-gridInfo").on("mouseout",(function(e){p()("#sui-popupDiv").remove()})),p()("[id^=sui-itemTitle-]").on("click",(function(e){var a=e.currentTarget.id.substring(14);return e.originalEvent.metaKey?window.open("#p="+t.curResults[a].uid,"_blank"):t.SendMessage("page="+t.curResults[a].url_html,t.curResults[a]),!1})),p()(".sui-itemPlus").on("click",(function(e){t.ShowItemMore(e.currentTarget.id.substring(13))}))}},{key:"DrawListItem",value:function(e){var t,a=this.curResults[e],s="<div class='sui-item'>";if(s+="<div class='sui-itemPlus' id='sui-itemPlus-"+e+"'>&#xe669</div>",s+="<div class='sui-itemIcon' id='sui-itemIcon-"+e+"' style='background-color:"+this.assets[a.asset_type].c+"'>",s+="<a class='sui-noA' href='#p="+a.uid+"'><span style='color:#fff'>"+this.assets[a.asset_type].g+"</span></a></div>",s+="<div class='sui-itemTitle' id='sui-itemTitle-"+e+"'>",s+="<a class='sui-noA' href='#p="+a.uid+"'>"+a.title+"</a></div>",a.feature_types_ss&&(s+="<span style='color:"+this.assets[a.asset_type].c+"'>&nbsp;&bull;&nbsp;</span>",s+="<div class='sui-itemFeature'>&nbsp;"+a.feature_types_ss.join(", ")+"</div>"),s+="<div class='sui-itemId'>"+a.uid,a.collection_title&&(s+="<div style='text-align:right;margin-top:2px;'>&#xe633&nbsp;"+a.collection_title+"</div>"),s+="</div>",a.ancestors_txt&&a.ancestors_txt.length>1){for(s+="<div class='sui-itemTrail'>",t=0;t<a.ancestors_txt.length;++t)s+="<span class='sui-itemAncestor' onclick='sui.SendMessage(\"page=",s+="https://mandala.shanti.virginia.edu/"+a.asset_type+"/",s+=a.ancestor_ids_is[t+1]+"/overview/nojs#search,"+this.curResults[e]+")'>",s+="<a href='#p="+a.uid+"'>"+a.ancestors_txt[t]+"</a></span>",t<a.ancestors_txt.length-1&&(s+=" > ");s+="</div>"}return(s+="<div class='sui-itemMore' id='sui-itemMore-"+e+"'></div>")+"</div>"}},{key:"ShowItemMore",value:function(e){var t,a,s,n=this,i="";if(p()("#sui-itemMore-"+e).html())p()("#sui-itemMore-"+e).slideUp(400,(function(){p()("#sui-itemMore-"+e).html("")}));else{if((a=this.curResults[e]).url_thumb.match(/gradient.jpg/)||(i+="<img src='"+a.url_thumb+"' class='sui-itemPic' id='sui-itemPic-"+e+"'>"),i+="<div class='sui-itemInfo'>",i+=this.assets[a.asset_type].g+"&nbsp;&nbsp;"+a.asset_type.toUpperCase(),a.asset_subtype&&(i+=" / "+a.asset_subtype),a.creator&&(i+="<br>&#xe600&nbsp;&nbsp;"+a.creator.join(", ")),(a.summary||a.caption)&&((s=a.summary||a.caption).length>137&&(s=s.substr(0,137)+"..."),i+="<br><div style='display:inline-block;background-color:#ccc;width:4px;height:18px;margin:2px 10px 0 5px;vertical-align:-4px'></div>&nbsp;<i>"+s+"</i>"),i+="</div>",a.summary&&(i+="<br><div style='font-family:serif'>"+a.summary+"</div>"),a.kmapid_strict&&a.kmapid_strict.length){var r=[],l=[];for(i+="<div style='margin-bottom:12px'>",t=0;t<a.kmapid_strict.length;++t)a.kmapid_strict[t].match(/subjects/i)?l.push(t):a.kmapid_strict[t].match(/places/i)&&r.push(t);if(i+="<div style='float:left;min-width:200px;'><span style='color:"+this.assets.places.c+"'>",i+="<br><strong>"+this.assets.places.g+"</strong></span>&nbsp;RELATED PLACES",r.length)for(t=0;t<r.length;++t)i+="<br>",a.kmapid_strict_ss&&(i+="<span class='sui-itemRelated'>"+a.kmapid_strict_ss[r[t]]+"</span>"),i+="&nbsp;<span style='font-size:10px;margin-right:40px'>("+a.kmapid_strict[r[t]]+")</span>";if(i+="</div>",i+="<div><span style='display:inline-block;color:"+this.assets.subjects.c+"'>",i+="<br><strong>"+this.assets.subjects.g+"</strong></span>&nbsp;RELATED SUBJECTS",l.length)for(t=0;t<l.length;++t)i+="<br>",a.kmapid_strict_ss&&(i+="<span class='sui-itemRelated'>"+a.kmapid_strict_ss[l[t]]+"</span>"),i+="&nbsp;<span style='font-size:10px'>("+a.kmapid_strict[l[t]]+")</span>";i+="</div></div>"}p()("#sui-itemMore-"+e).html(i),p()("#sui-itemMore-"+e).slideDown(),p()("[id^=sui-itemPic]").on("click",(function(e){var t=e.currentTarget.id.substring(12);n.SendMessage("page="+n.curResults[t].url_html,n.curResults[t])}))}}},{key:"DrawGridItem",value:function(e){var t="<div class='sui-grid'>",a=this.curResults[e];return t+="<a href='#p="+a.uid+"'>",t+="<img src='"+a.url_thumb+"' class='sui-gridPic' id='sui-itemPic-"+e+"'></a>",a.url_thumb.match(/gradient.jpg/)&&(t+="<div class='sui-gridGlyph' style='color:".concat(this.assets[a.asset_type].c,"'>\n\t\t\t ").concat(this.assets[a.asset_type].g,"\n\t\t\t <p style='font-size:12px;margin-top:0'>").concat(a.title,"</p>\n\t\t\t </div>")),(t+="<div id='sui-gridInfo-"+e+"' class='sui-gridInfo'>&#xe67f</div>")+"</div>"}},{key:"DrawCardItem",value:function(e){var t=this.curResults[e],a="&#xe633",s="#9e894d",n=t.collection_title,i="<div class='sui-card'>";i+="<div style='width:100%;height:100px;overflow:hidden;display:inline-block;margin:0;padding:0'>",i+="<a href='#p="+t.uid+"'>",i+="<img src='"+t.url_thumb+"' class='sui-cardPic' id='sui-itemPic-"+e+"'></a></div>";var r=this.assets[t.asset_type].g;return"Audio"==t.asset_subtype?r="&#xe60a":"Video"==t.asset_subtype&&(r="&#xe62d"),i+="<div class='sui-cardType'>"+r+"</div>",t.url_thumb.match(/gradient.jpg/)&&(i+="<div class='sui-cardGlyph' style='color:".concat(this.assets[t.asset_type].c,"'>").concat(this.assets[t.asset_type].g,"</div>")),i+="<div class='sui-cardInfo'><div class='sui-cardTitle' id='sui-itemTitle-"+e+"'",t.ancestors_txt&&t.ancestors_txt.length>2&&(i+="title='"+t.ancestors_txt.join("/")+"'"),i+="><strong>"+t.title+"</strong><br></div>",i+="<div style='border-top:.5px solid "+s+";height:1px;width:100%;margin:6px 0 6px 0'></div>",t.ancestors_txt&&t.ancestors_txt.length>1&&(i+="&#xe638&nbsp;&nbsp;"+t.ancestors_txt[0]+"/...<br>",i+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.../"+t.ancestors_txt[t.ancestors_txt.length-2]+"<br>"),t.feature_types_ss&&(i+="&#xe62b&nbsp;&nbsp;"+t.feature_types_ss.join(", ")+"<br>"),t.data_phoneme_ss&&(i+="&#xe635&nbsp;&nbsp;"+t.data_phoneme_ss.join(", ")+"<br>"),t.creator&&(i+="&#xe600&nbsp;&nbsp;"+t.creator[0]+"<br>"),t.duration_s&&(i+="&#xe61c&nbsp;&nbsp;"+t.duration_s+"<br>"),t.timestamp&&(i+="&#xe60c&nbsp;&nbsp;"+t.timestamp.substr(0,10)+"<br>"),t.name_tibt&&(i+="=&nbsp;&nbsp;"+t.name_tibt+"<br>"),i+="</div>",n||(n=t.asset_type,a=this.assets[t.asset_type].g),i+="<div class='sui-cardFooter' style='background-color:"+s+"'>"+a+"&nbsp;&nbsp;",(i+="<span style='font-size:11px;vertical-align:2px'>"+n+"<span></div>")+"</div>"}},{key:"DrawAdvanced",value:function(){this.log("searchui.DrawAdvanced() short circuit")}},{key:"DrawFacetItems",value:function(e,t){"assets"!=e||this.curResults||this.Query(),"recent"==e?this.RecentSearches():"input"==this.facets[e].type?this.DrawInput(e,t):"tree"==this.facets[e].type?this.ActiveSearch()?this.DrawFacetList(e,t):this.DrawFacetTree(e,t):this.DrawFacetList(e,t)}},{key:"ActiveSearch",value:function(e){var t,a=!1;for(t in this.ss.query.text.length&&!e&&(a=!0),this.facets)this.ss.query[t].length&&"assets"!=t&&(a=!0);return a}},{key:"DrawInput",value:function(e){var t=this;if("none"==p()("#sui-advEdit-"+e).css("display")){this.facets[e].mode="input";var a="<input id='sui-advInput-".concat(e,"' placeholder='Type here'  \n\t\tstyle='width:90px;border:1px solid #999;border-radius:12px;font-size:11px;padding-left:6px'>\n\t\t<div class='sui-advEditNums'> <span id='sui-advListNum'>").concat(934,"</span> ").concat(e,"</div>");p()("#sui-advEdit-"+e).html(a+"</div>".replace(/\t|\n|\r/g,"")),p()("#sui-advEdit-"+e).slideDown(),p()("#sui-advInput-"+e).on("change",(function(a){a.target.id.split("-");t.AddNewFilter(p()("#sui-advInput-"+e).val(),e+"-0","AND",e)}))}else p()("#sui-advEdit-"+e).slideUp()}},{key:"RecentSearches",value:function(){var e=this;if("none"==p()("#sui-advEdit-recent").css("display")){var t,a,s,n="<i>Click below to recall a previous search</i><hr><div class='sui-advEditList'>";for(t=this.searches.length-1;t>=0;t--){for(s in n+="<div class='sui-advEditLine' style='width:100%' id='sui-recSrc-".concat(t,"' "),n+="title='"+this.searches[t].query.assets[0].title.toUpperCase(),n+=" "+this.searches[t].query.text,this.facets)if(this.searches[t].query[s].length&&"assets"!=s)for(a=0;a<this.searches[t].query[s].length;++a)n+=" "+this[this.searches[t].query[s][a].bool]+" "+this.searches[t].query[s][a].title;for(s in s=this.searches[t].query.assets[0].id,n+="'><span style='color:".concat(this.assets[s].c,"'>").concat(this.assets[s].g," </span>"),n+=this.searches[t].query.text,this.facets)this.searches[t].query[s].length&&"assets"!=s&&(n+=" + "+this.facets[s].icon);n+="</div>"}p()("#sui-advEdit-recent").html(n+"</div>".replace(/\t|\n|\r/g,"")),p()("[id^=sui-recSrc-]").off("click"),p()("[id^=sui-recSrc-]").on("click",(function(t){var a=t.target.id.substr(11);e.ss.query=JSON.parse(JSON.stringify(e.searches[a].query)),p()("#sui-search").val(e.ss.query.text),e.DrawAdvanced(),e.Query()})),p()("#sui-advEdit-recent").slideDown()}else p()("#sui-advEdit-recent").slideUp()}},{key:"ResetFacetList",value:function(e){var t,a,s=this,n="";if("assets"==e){var i=this.facets.assets.data=[];for(a in this.assets)i.push({title:a.charAt(0).toUpperCase()+a.slice(1),id:a,n:this.assets[a].n})}var r=Math.min(300,this.facets[e].data.length);for(p()("[id^=sui-advEditLine-]").remove(),t=0;t<r;++t)void 0==(a=this.facets[e].data[t].n)&&(a=""),a>1e3&&(a=Math.floor(a/1e3)+"K"),n+="<div class='sui-advEditLine' id='sui-advEditLine-".concat(t,"'>"),"assets"==e&&(n+="<span style='color:".concat(this.assets[this.facets[e].data[t].id].c,"'>").concat(this.assets[this.facets[e].data[t].id].g,"</span> &nbsp;")),n+="".concat(this.facets[e].data[t].title," (").concat(a,")"),"assets"!=e&&(n+=this.pages.AddPop(this.facets[e].data[t].id,!0)),n+="</div>";p()("#sui-advEditList-"+e).html("</div>"+n.replace(/\t|\n|\r/g,"")),p()("[id^=sui-advEditLine-]").off("click"),p()("[id^=sui-advEditLine-]").on("click",(function(t){var a=t.target.id.split("-"),n=s.facets[e].data;s.showSearch&&"assets"!=e?s.GetKmapFromID(n[a[2]].id,(function(e){s.SendMessage("page="+n[a[2]].url,e)})):s.AddNewFilter(n[a[2]].title,n[a[2]].id,"AND",e)})),p()("#sui-advListNum").html(r<300?r:"300+")}},{key:"DrawFacetList",value:function(e,t,a){var s,n=this,i=0;if(t||"none"==p()("#sui-advEdit-"+e).css("display")){this.QueryFacets(e),this.facets[e].mode="list";var r="<input id='sui-advEditFilter-".concat(e,"' placeholder='Filter this list' value='").concat(a||"","' \n\t\tstyle='width:90px;border:1px solid #999;border-radius:12px;font-size:11px;padding-left:6px'> &nbsp; ");"tree"==this.facets[e].type&&(r+="<div class='sui-advEditBut' id='sui-advListMap-".concat(e,"' title='Tree view'>&#xe638</div> | \n\t\t\t<div class='sui-advEditBut' id='sui-advTreeMap-").concat(e,"' title='List view'>&#xe61f</div>\n\t\t\t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;")),"assets"!=e&&(r+="<div class='sui-advEditBut' id='sui-advEditSort-".concat(e,"' title='Sort'>&#xe652</div>")),r+="<div class='sui-advEditNums'> <span id='sui-advListNum'></span> ".concat(e),r+="</div><hr style='border: .5px solid #a4baec'>\n\t\t<div class='sui-advEditList' id='sui-advEditList-".concat(e,"'></div>"),p()("#sui-advEdit-"+e).html(r.replace(/\t|\n|\r/g,"")),p()("#sui-advEdit-"+e).slideDown(),p()("#sui-advTreeMap-"+e).css({color:"#668eec"}),p()("[id^=sui-advEditFilter-]").off("click"),p()("#sui-advEditFilter-"+e).on("keydown",(function(t){var a,i=Math.min(300,n.facets[e].data.length),r=p()("#sui-advEditFilter-"+e).val();for(t.keyCode>31&&t.keyCode<91&&(r+=t.key),8==t.keyCode&&r.length&&(r=r.slice(0,-1)),r=RegExp(r,"i"),s=0;s<i;++s)(a=p()("#sui-advEditLine-"+s)).text().match(r)?a.css("display","block"):a.css("display","none")})),p()("[id^=sui-advEditSort-]").off("click"),p()("#sui-advEditSort-"+e).on("click",(function(){r="";var t,a,s=n.facets[e].data,l=Math.min(300,s.length);if(!(i=1-i)){for(p()("#sui-advEditList-"+e).empty(),t=0;t<l;++t)(a=n.facets[e].data[t].n)>1e3&&(a=Math.floor(a/1e3)+"K"),r+="<div class='sui-advEditLine' id='sui-advEditLine-".concat(t,"'>"),r+="".concat(s[t].title," (").concat(a,")").concat(n.pages.AddPop(s[t].id,!0),"</div>");return p()("#sui-advEditList-"+e).html(r),void p()("#sui-advEditSort-"+e).css("color","#666")}var c=p()(".sui-advEditLine");c.sort((function(e,t){var a=p()(e).text(),s=p()(t).text();return a>s?1:a<s?-1:0})),p()("#sui-advEditList-"+e).html(c),p()("#sui-advEditSort-"+e).css("color","#668eec")})),p()("[id^=sui-advListMap-]").off("click"),p()("#sui-advListMap-"+e).on("click",(function(){n.DrawFacetTree(e,1,p()("#sui-advEditFilter-"+e).val())})),p()("#sui-advEditList-"+e).css("max-height",p()("#l-site__wrap").height()-p()("#sui-advTerm-"+e).offset().top-p()("#sui-advTerm-"+e).height()-102+"px")}else p()("#sui-advEdit-"+e).slideUp()}},{key:"AddNewFilter",value:function(e,t,a,s){var n=this.ss.query[s];if(!n.filter((function(t){return t.title==e})).length){t&&(t=t.replace(/languages-|features-/i,"subjects-"));var i=n.length;n.push({}),n[i].title=e,n[i].id=t?t.replace(/collections-/,""):"",n[i].bool=a,"assets"==s&&(this.ss.query.assets=[{title:e,id:t,bool:a}]),this.ss.page=0,this.DrawAdvanced(),this.Query()}}},{key:"DrawFacetTree",value:function(e,t,a){var s=this;if(t||"none"==p()("#sui-advEdit-"+e).css("display")){this.facets[e].mode="tree",this.curTree=e;var n="#sui-tree"+e,i="<input id='sui-advTreeFilter' placeholder='Filter this list' value='".concat(a||"","' \n\t\tstyle='width:90px;border:1px solid #999;border-radius:12px;font-size:11px;padding-left:6px'> &nbsp; \n\t\t<div class='sui-advEditBut' id='sui-advListMap-").concat(e,"' title='Tree view'>&#xe638</div> | \n\t\t<div class='sui-advEditBut' id='sui-advTreeMap-").concat(e,"' title='List view'>&#xe61f</div>");i+="<hr style='border: .5px solid #a4baec'>\n\t\t<div id='sui-tree".concat(e,"' class='sui-tree'></div>"),p()("#sui-advEdit-"+e).html(i.replace(/\t|\n|\r/g,"")),"places"==e?this.LazyLoad(n,null,e,13735):"features"==e?this.LazyLoad(n,null,e,20):"languages"==e?this.LazyLoad(n,null,e,301):this.GetTopRow(n,e),p()("#sui-advListMap-"+e).css({color:"#668eec"}),p()("[id^=sui-advTreeMap-]").off("click"),p()("#sui-advTreeMap-"+e).on("click",(function(){s.DrawFacetList(e,1,p()("#sui-advTreeFilter").val())})),p()("[id^=sui-advTreeFilter-]").off("click"),p()("#sui-advTreeFilter").on("keydown",(function(t){s.DrawFacetList(e,1,p()("#sui-advTreeFilter").val()),p()("#sui-advEditFilter-"+e).focus()})),p()(".sui-advViewTreePage").off("click"),p()(".sui-advViewTreePage").on("click",(function(e){var t=e.target.id.split("-");s.GetKmapFromID(t[1]+"-"+t[2],(function(e){sui.SendMessage("",e)})),e.stopPropagation()})),p()(n).css("max-height",p()("#l-site__wrap").height()-p()("#sui-advTerm-"+e).offset().top-p()("#sui-advTerm-"+e).height()-102+"px"),p()("#sui-advEdit-"+e).slideDown()}else p()("#sui-advEdit-"+e).slideUp()}},{key:"GetTopRow",value:function(e,t){var a,s,n=this,i=e.match(/sui-btree-/)?"b":"",r=[],l="<ul>";for(s in"terms"==t?(r.ka=1,r.kha=14263,r.ga=24465,r.nga=45101,r.ca=51638,r.cha=55178,r.ja=62496,r.nya=66477,r.ta=73101,r.tha=80697,r.da=87969,r.na=105631,r.pa=114065,r.pha=120048,r.ba=127869,r.ma=142667,r.tsa=154251,r.tsha=158451,r.dza=164453,r.wa=166888,r.zha=167094,r.za=172249,r["'a"]=177092,r.ya=178454,r.ra=185531,r.la=193509,r.sha=199252,r.sa=204036,r.ha=215681,r.a=219022):"subjects"==t&&(r.Administration=5550,r.Architecture=6669,r.Collections=2823,r["Community Services Project Types"]=5553,r.Contemplation=5806,r["Cultural Landscapes"]=8868,r["Cultural Regions"]=305,r.Event=2743,r.General=6793,r["Geographical Features"]=20,r.Grammars=5812,r["Higher Education Digital Tools"]=6404,r["Historical Periods"]=5807,r["Human Relationships"]=306,r["Language Tree"]=301,r["Literary Genres"]=5809,r["Material Objects"]=2693,r["Mesoamerican Studies"]=6664,r["Oral Genres"]=5808,r["Organizations and Organizational Units"]=2688,r.Politics=7174,r.Profession=6670,r["Religious Sects"]=302,r["Religious Systems"]=5810,r.Ritual=5805,r.Scripts=192,r["Teaching Resources"]=6844,r["Text Typologies"]=4833,r["Tibet and Himalayas"]=6403,r["Zoologies (Biological and Spiritual)"]=5813),r)l+="<li class='parent'><a id='"+i+(a=t+"-"+r[s])+"'",l+="' data-path='"+r[s]+"'>"+s,l+=this.pages.AddPop(a,!0),l+="</a></li>";p()(e).html(l+"</ul>"),p()(".sui-tree li > a").off(),p()(".sui-tree li > a").on("click",(function(t){!function(t,a){var s=p()(t.parent()).hasClass("parent")?20:0;if(a.offsetX<s)1==t.parent().children().length?n.LazyLoad(e,t,n.curTree):(t.parent().toggleClass("active"),t.parent().children("ul").slideToggle("fast"));else if(a.clientX<200||n.showSearch)n.pages.relatedBase=n.pages.relatedId="","related"==n.ss.mode&&(n.ss.mode=n.ss.lastMode),sui.GetKmapFromID(n.curTree+"-"+a.target.id.split("-")[1],(function(e){sui.SendMessage("",e)}));else{var i=p()("#"+a.target.id).text();sui.AddNewFilter(i,n.curTree+"-"+a.target.id.split("-")[1],"AND",n.curTree)}}(p()(this),t)}))}},{key:"LazyLoad",value:function(e,t,a,s){var n,i=this,r=this.sui,l=this;if(s||1==t.parent().children().length){var c=e.match(/sui-btree-/)?"b":"";n=s?""+s:""+t.data().path,this.GetTreeChildren(a,n,(function(n){var o,d,u,m="",h="<ul>";for("terms"==a?n.facet_counts&&n.facet_counts.facet_fields&&n.facet_counts.facet_fields["ancestor_id_tib.alpha_path"]&&(m=n.facet_counts.facet_fields["ancestor_id_tib.alpha_path"].join()):n.facet_counts&&n.facet_counts.facet_fields&&n.facet_counts.facet_fields.ancestor_id_path&&(m=n.facet_counts.facet_fields.ancestor_id_path.join()),d=0;d<n.response.docs.length;++d)o=n.response.docs[d],u=new RegExp("/"+o.id.split("-")[1]),h+="<li",(m&&m.match(u)||s)&&(h+=" class='parent'"),h+="><a id='"+c+o.id,h+="terms"==a?"' data-path='"+o["ancestor_id_tib.alpha_path"]+"'>":"' data-path='"+o.ancestor_id_path+"'>",h+=o.header,h+=i.pages.AddPop(o.id,!0),h+="</a></li>";n.response.docs.length&&(s?p()(e).html(h+"</ul>"):(t.after(h+"</ul>"),t.parent().toggleClass("active"),t.parent().children("ul").slideToggle("fast")),p()(".sui-tree li > a").off(),p()(".sui-tree li > a").on("click",(function(t){!function(t,a){var s=p()(t.parent()).hasClass("parent")?20:0;if(a.offsetX<s)1==t.parent().children().length?l.LazyLoad(e,t,l.curTree):(t.parent().toggleClass("active"),t.parent().children("ul").slideToggle("fast"));else if(a.clientX<200||l.showSearch)l.pages.relatedBase=l.pages.relatedId="","related"==l.ss.mode&&(l.ss.mode=l.ss.lastMode),r.GetKmapFromID(l.curTree+"-"+a.target.id.split("-")[1],(function(e){r.SendMessage("",e)}));else{var n=p()("#"+a.target.id).text();r.AddNewFilter(n,l.curTree+"-"+a.target.id.split("-")[1],"AND",l.curTree)}}(p()(this),t)}))),p()(".sui-advViewTreePage").off("click"),p()(".sui-advViewTreePage").on("click",(function(e){var t=e.target.id.split("-");i.GetKmapFromID(t[1]+"-"+t[2],(function(e){r.SendMessage("",e)})),e.stopPropagation()}))}))}}},{key:"GeoLocate",value:function(){sui.plc.Draw("","",[{lat:36.6251,lon:-118.085,lab:"Lhasa",ui:"subjects-6061"},{lat:37.6251,lon:-119.085,lab:"Lhasa2",ui:"subjects-6060"}])}},{key:"LoadingIcon",value:function(e,t){if(e){var a="<img src='img/loading.gif' width='"+t+"' ";a+="id='sui-loadingIcon' style='position:absolute;top:calc(50% - "+t/2+"px);left:calc(50% - "+t/2+"px);z-index:5000'>",p()("#l-site__wrap").append(a)}else p()("[id^=sui-loadingIcon]").remove()}},{key:"SendMessage",value:function(e,t){this.pages.Draw(t)}},{key:"Popup",value:function(e,t,a,s){var n="";p()("#sui-popupDiv").remove(),n+="<div id='sui-popupDiv' class='sui-gridPopup' style='left:"+a+"px;top:"+s+"px'>",n+=e+"</div>",p()("#l-site__wrap").append(n),p()("#sui-popupDiv").fadeIn(500).delay(t?1e3*t:3e3).fadeOut(500)}},{key:"ShortenString",value:function(e,t,a){return"object"==typeof e&&(e=e[0]),e&&e.length>t&&(e=a?e.substr(0,(t-3)/2)+"..."+e.slice((t-3)/-2):e.substr(0,t-3)+"..."),e}},{key:"GetCookie",value:function(e){var t,a,s=e+"=",n=decodeURIComponent(document.cookie).split(";");for(t=0;t<n.length;t++){for(a=n[t];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(s))return a.substring(s.length,a.length)}return""}},{key:"SetCookie",value:function(e,t){var a=new Date;a.setTime(a.getTime()+31536e6),a=a.toUTCString(),document.cookie="".concat(e,"=").concat(t,"; expires=").concat(a,";")}},{key:"log",value:function(e,t,a){t&&console.dir(t),a&&alert(e,t)}},{key:"alert",value:function(e,t){this.log(e,t,!1)}}]),e}(),f=function(){function e(t){if(Object(l.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.sui=t,this.app=null,this.kmap=null,this.extent=null,this.showing=!1,p()("<link/>",{rel:"stylesheet",type:"text/css",href:"https://js.arcgis.com/4.12/esri/themes/light/main.css"}).appendTo("head"),this.div=t.pages.div,this.content=["","...loading","...loading"],this.content2=["<br>","<br>"],this.popovers=null}return Object(c.a)(e,[{key:"Draw",value:function(e,t,a){var s=this.sui;this.popovers=a,p()("#sui-legacy").css({"padding-left":"12px",width:"calc(100% - 24px"}),this.kmap=e,this.DrawMetadata(t),s.LoadingIcon(!0,64);var n={container:"plc-main",map:null,baseMap:"hybrid",kml:null,mapView:null,sceneView:null,activeView:null,opt:76,bookmarks:null,legend:null,layers:null,basePick:null,sketch:null,center:[91.1721,29.6524],zoom:12,tilt:80,reqs:["esri/Map","esri/WebMap","esri/views/MapView","esri/views/SceneView","esri/Graphic","esri/layers/FeatureLayer","esri/layers/KMLLayer","esri/core/watchUtils","esri/geometry/Extent"],div:this.div};this.app=n,1&n.opt&&n.reqs.push("esri/widgets/ScaleBar"),2&n.opt&&n.reqs.push("esri/widgets/Search"),8&n.opt&&n.reqs.push("esri/widgets/BasemapGallery"),16&n.opt&&n.reqs.push("esri/widgets/LayerList"),32&n.opt&&n.reqs.push("esri/widgets/Legend"),64&n.opt&&(n.reqs.push("esri/widgets/Sketch"),n.reqs.push("esri/layers/GraphicsLayer")),128&n.opt&&n.reqs.push("esri/widgets/Bookmarks")}},{key:"GeoLocate",value:function(){var e="";this.extent=null;var t=this;try{for(var a=this.kmap.ancestors_txt.length-1;a>0;--a)e+=this.kmap.ancestors_txt[a]+"%20";1==this.kmap.ancestors_txt.length&&(e=this.kmap.ancestors_txt[0]);var s="//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/findAddressCandidates?f=pjson&SingleLine="+e;p.a.ajax({url:s,dataType:"jsonp"}).done((function(e){t.extent=e.candidates[0].extent,t.extent.spatialReference=e.spatialReference.wkid,t.showing&&t.app.GoToExtent(t.extent)}))}catch(n){}}},{key:"DrawContent",value:function(){var e=this,t=this.sui,a="<div id='sui-topCon' style='margin-left:192px'>";this.kmap.caption&&(a+="<div style='margin:5px 0 13px 0' class='sui-sourceText'>"+this.kmap.caption+"</div>"),a+=t.pages.DrawTabMenu(["MAP","NAMES","LOCATION"]),a+="</div><div class='plc-main' id='plc-main' ></div>",p()(this.div).html(a.replace(/\t|\n|\r|/g,"")),p()("#plc-main").css("height",.667*p()("#sui-main").height()+"px"),p()("[id^=sui-tabTab]").on("click",(function(t){e.ShowTab(t.currentTarget.id.substring(10))}))}},{key:"DrawMetadata",value:function(e){var t=this,a=this.sui;if(this.popovers)return p()(this.div).html("<div class='plc-main' id='plc-main'></div>"),void p()("#plc-main").css({margin:0,width:"100%",height:p()("#sui-legacy").height()+"px"});this.GeoLocate(),this.DrawContent(),this.ShowTab(e||0),a.pages.DrawRelatedAssets(this.kmap),a.GetChildNamesFromID("places",this.kmap.id,(function(e){var a,s,n,i=[],r="<div style='display:inline-block;width:50%'><br>\n\t\t\t<div style='font-weight:bold;color:#6faaf1;margin-bottom:8px'>NAMES</div>";if(e&&e[0]&&e[0]._childDocuments_&&e[0]._childDocuments_.length){for(a=0;a<e[0]._childDocuments_.length;++a)s=e[0]._childDocuments_[a],(n={}).lab=s.related_names_header_s,n.lang=s.related_names_language_s,n.rel=s.related_names_relationship_s,n.write=s.related_names_writing_system_s,n.ety=s.related_names_etymology_s,n.path=s.related_names_path_s,n.tab=s.related_names_level_i-1,i.push(n);i.sort((function(e,t){return e.path>t.path?1:e.path<t.path?-1:0}))}for(a=0;a<i.length;++a)r+="<div style='margin-left:".concat(16*i[a].tab,"px'>"),a&&(r+="&bull; "),r+="<strong>".concat(i[a].lab," </strong>&nbsp; (").concat(i[a].lang,", ").concat(i[a].write,", ").concat(i[a].rel,")</div>");for(r+="<br></div><div style='display:inline-block;width:calc(50% - 24px);vertical-align:top;border-left:1px solid #ccc; padding-left:12px;margin-top:22px'>\n\t\t\t<div style='font-weight:bold;color:#6faaf1;margin-bottom:8px'>ETYMOLOGY</div>",a=0;a<i.length;++a)i[a].ety&&(r+="<div>Etymology for <strong>".concat(i[a].lab,"</strong>: &nbsp; ").concat(i[a].ety,"</div>"));r+="</div><br>",t.content[1]=r.replace(/\t|\n|\r|/g,"")})),a.GetRelatedFromID(this.kmap.uid,(function(e){e[0].illustration_external_url&&e[0].illustration_external_url?(p()("#sui-relatedImg").addClass("sui-relatedImg"),p()("#sui-relatedImg").prop("src",e[0].illustration_external_url[0])):e[0].illustration_mms_url&&e[0].illustration_mms_url[0]&&(p()("#sui-relatedImg").addClass("sui-relatedImg"),p()("#sui-relatedImg").prop("src",e[0].illustration_mms_url[0])),t.AddRelatedTabs(),t.AddRelatedPlaces(t.kmap,e,t.content2,0),t.AddRelatedSubjects(t.kmap,e)}))}},{key:"ShowTab",value:function(e){var t=this.sui,a=this;p()("[id^=sui-tabTab]").css({"background-color":"#999",color:"#fff"}),p()("#sui-tabContent").css({display:"block","background-color":"#eee"}),p()("#sui-tabTab"+e).css({"background-color":"#eee",color:"#000"}),p()("#sui-tabTab"+e).css({"background-color":"#eee",color:"#000"}),0==e?p()("#plc-main").slideDown():p()("#plc-main").slideUp(),e>2?p()("#sui-topCon").html(this.content[e]):p()("#sui-tabContent").html(this.content[e]),4==e&&(p()("#sui-tabContent").css({display:"block","background-color":"#eee"}),p()("#sui-tabTabB0").css({"background-color":"#eee",color:"#000"}),p()("#sui-tabTabB0").css({"background-color":"#eee",color:"#000"}),p()("#sui-tabContent").html(this.content2[0]),p()("[id^=sui-spLab-]").on("click",(function(e){return!1})),p()("[id^=sui-spDot-]").on("click",(function(e){var s=e.currentTarget.id.substring(10);"null"!=s&&t.pages.AddRelBranch(a.kmap.asset_type,s,p()(this)),p()(this).html("&ndash;"),p()(this).parent().find("ul").slideToggle()}))),p()("#sui-spLab-"+this.kmap.uid).css({"font-weight":"bold","text-decoration":"underline"})}},{key:"AddRelatedTabs",value:function(){var e=this,t=this.sui,a=this,s=function(e){var t,a="";for(t=0;t<e.length;++t)a+="<div class='sui-tabTab' id='sui-tabTabB".concat(t,"' style='width:calc(").concat(100/e.length,"% - 2px)'>").concat(e[t],"&nbsp;&#xe609</div>");return(a+="<div class='sui-tabContent' id='sui-tabContent'></div>").replace(/\t|\n|\r|/g,"")}(["PLACE CONTEXT","RELATED PLACES"]);this.content[4]=s.replace(/\t|\n|\r|/g,""),p()("[id^=sui-tabTabB]").on("click",(function(s){var n=s.currentTarget.id.substring(11);p()("[id^=sui-spDot-]").off("click"),p()("[id^=sui-spItem-]").off("click"),p()("[id^=sui-togCat-]").off("click"),p()("[id^=sui-spCatUL-]").off("click"),p()("[id^=sui-tabTabB]").css({"background-color":"#999",color:"#fff"}),p()("#sui-tabContent").css({display:"block","background-color":"#eee"}),p()("#sui-tabTabB"+n).css({"background-color":"#eee",color:"#000"}),p()("#sui-tabTabB"+n).css({"background-color":"#eee",color:"#000"}),p()("#sui-tabContent").html(e.content2[n]),p()("[id^=sui-spDot-]").on("click",(function(e){var s=p()(this).parent().find("ul")[0],n=e.currentTarget.id.substring(10);"null"!=n&&t.pages.AddRelBranch(a.kmap.asset_type,n,p()(this)),p()(this).html("none"==p()(s).css("display")?"&ndash;":"+"),p()(this).parent().find("ul").slideToggle()})),p()("[id^=sui-spLab-]").on("click",(function(e){return!1})),p()("[id^=sui-spItem-]").on("click",(function(e){return!1})),p()("[id^=sui-spCatUL-]").slideDown(),p()("[id^=sui-spCat-]").on("click",(function(e){var t=e.currentTarget.id.substring(9);"none"==p()("#sui-spCatUL"+t).css("display")?p()("#sui-spCatUL"+t).slideDown():p()("#sui-spCatUL"+t).slideUp()})),p()("[id^=sui-spSub-]").on("click",(function(e){var t=e.currentTarget.id.substring(9);"none"==p()("#sui-spSubUL"+t).css("display")?p()("#sui-spSubUL"+t).slideDown():p()("#sui-spSubUL"+t).slideUp()})),p()("#sui-togCatA").on("click",(function(){p()("[id^=sui-spCatUL-]").slideDown()})),p()("#sui-togCatN").on("click",(function(){p()("[id^=sui-spCatUL-]").slideUp()}))}))}},{key:"AddRelatedPlaces",value:function(e,t,a){var s=this.sui,n=0,i=0;t[0].ancestors&&t[0].ancestors.length>2&&(i=t[0].ancestors.length-2);var r="<br><div class='sui-spHead'>Places related to ".concat(e.title,"</div>\n\t\t<div style='max-width:900px'>\n\t\t<strong>").concat(e.title[0],"</strong> has <strong>").concat(i,"</strong> superordinate places and<strong> TBD </strong> immediately subordinate places. \n\t\tYou can browse these subordinate places as well as its superordinate categories with the tree below. \n\t\tSee the RELATED PLACES tab if you instead prefer to view only its immediately subordinate places grouped together in useful ways, \n\t\tas well as places non-hierarchically related to it.</div><br>\n\t\t<ul class='sui-spLin' id='sui-spRows'>");if("subjects"!=e.asset_type){if(t[0].ancestors){for(n=0;n<t[0].ancestors.length-1;++n)r+="<ul style='list-style-type:none'>",r+=s.pages.AddRelTreeLine(t[0].ancestors[n+1],t[0].ancestor_uids_generic[n+1],"&ndash;",null);s.GetTreeChildren(e.asset_type,t[0].ancestor_id_path,(function(e){var n,i,l,c,o,d=[];try{d=e.facets.child_counts.buckets}catch(u){}for(e=e.response.docs,n=0;n<e.length;++n){for(o="",c=null,l=new RegExp(e[n].id.split("-")[1]),i=0;i<d.length;++i)d[i].val.match(l)&&(c="+",o=d[i].val);r+="<ul style='list-style-type:none'>",r+=s.pages.AddRelTreeLine(e[n].header,e[n].id,c,o)+"</li></ul>"}for(n=0;n<t[0].ancestors.length;++n)r+="</li></ul>";a[0]=r.replace(/\t|\n|\r/g,"")+"</ul><br>"})),this.AddRelatedContext(e,t,a)}}else a[0]=r.replace(/\t|\n|\r/g,"")+"</ul><br>"}},{key:"AddRelatedContext",value:function(e,t,a){var s,n,i=this.sui,r=[],l=0;for(n=0;n<t.length;++n)"related_places"==t[n].block_child_type&&"Earth"!=t[n].related_places_header_s&&(++l,r[t[n].related_places_relation_label_s]||(r[t[n].related_places_relation_label_s]=[]),r[t[n].related_places_relation_label_s].push({title:t[n].related_places_header_s,sub:t[n].related_places_feature_type_s,id:t[n].related_uid_s}));var c=Object.keys(r).sort((function(e,t){return e.length>t.length?-1:1}))[0],o="<br><div class='sui-spHead'>Places related to ".concat(e.title,"</div>\n\t\t\t<div style='max-width:900px'>\n\t\t\t<strong>").concat(e.title[0],"</strong> has <strong>","TBD","</strong> other place").concat(l>1?"s":""," directly related to it, which is presented here. \n\t\t\tSee the PLACE CONTEXT tab if you instead prefer to browse all subordinate and superordinate places for ").concat(e.title[0],".</div>\n\t\t\t<p><a class='sui-advEditBut' id='sui-togCatA'>Expand all</a> / <a class='sui-advEditBut' id='sui-togCatN'>Collapse all</a>\n\t\t\t</p><div style='width:100%'><div style='width:50%;display:inline-block'>");for(s in o+=d(c)+"</div><div style='display:inline-block;width:50%;vertical-align:top'>",r)s!=c&&(o+=d(s));function d(t){var a="xxx";r[t]=r[t].sort((function(e,t){return e.sub<t.sub?-1:1}));var s="<div id='sui-spCat-".concat(t.replace(/ /g,"_"),"' \n\t\t\t\tclass='sui-spCat' style='background-color:").concat(i.assets[e.asset_type].c,"'> ").concat(e.title," ").concat(t,"</div>\n\t\t\t\t<ul id='sui-spCatUL-").concat(t.replace(/ /g,"_"),"'><ul>");for(n=0;n<r[t].length;++n)a!=r[t][n].sub&&(a=r[t][n].sub,s+="</ul><div class='sui-spSubCat'>",s+="<div style='background-color:#999' class='sui-spDot' id='sui-spSub-"+r[t][n].id+"'>&ndash;</div>",s+="<strong>"+a+"</strong></div>",s+="<ul id='sui-spSubUL-"+r[t][n].id+"' style='list-style-type:none'>"),s+="<li style='list-style-type:none'><a class='sui-noA' id='sui-spItem-"+r[t][n].id,s+="' href='#p="+r[t][n].id+"'>",s+=r[t][n].title+"</a>"+i.pages.AddPop(r[t][n].id)+"</li>";return s+"</ul></ul>"}o+="</div></div>",a[1]=o.replace(/\t|\n|\r/g,"")+"</ul><br>"}},{key:"AddRelatedSubjects",value:function(e,t){var a,s,n=this.sui,i=[],r="<div style='width:50%;vertical-align:top'>\n\t\t\t<div class='sui-spHead'>Subjects related to ".concat(e.title,"</div>");if(e.feature_types_ss&&e.feature_types_ss.length){for(r+="<div class='sui-spCat' style='background-color:#6faaf1'>\n\t\t\tFeature Types</div>\n\t\t\t<div style='margin-left:24px'>",a=0;a<e.feature_types_ss.length;++a)r+="<li>"+e.feature_types_idfacet[a].split("|")[0]+n.pages.AddPop(e.feature_types_idfacet[a].split("|")[1])+"</li>";r+="</div><br>"}for(a=0;a<t.length;++a)"related_subjects"==t[a].block_child_type&&(s=t[a].related_subjects_display_string_s,t[a].related_subjects_time_units_t&&t[a].related_subjects_time_units_t[0]&&(s+=" (".concat(t[a].related_subjects_time_units_t[0],")")),i.push({title:s,id:t[a].related_subjects_id_s}));if(i.length)for(r+="<div class='sui-spCat' style='background-color:#6faaf1'>\n\t\t\t\tRelated subjects</div>\n\t\t\t\t<div style='margin-left:24px'>",a=0;a<i.length;++a)r+="<li>"+i[a].title+n.pages.AddPop(i[a].id)+"</li>";r+="</div>",this.content[3]=r.replace(/\t|\n|\r|/g,"")}}]),e}(),g=function(){function e(t){if(Object(l.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.sui=t,this.div=t.pages.div,this.content=["...loading","...loading","...loading"],this.inPlay=!1,this.curTransSeg=-1,this.transRes=null,this.scrollStart=0,this.handScroll=!1,this.mouseDown=!1,this.playEnd=0,this.kmap=null}return Object(c.a)(e,[{key:"DrawPlayer",value:function(e,t){var a,s,n=this,i=this.sui,r=(p()("#sui-av"),"");this.inPlay=!1;p()(this.div).width();this.kmap=e,"undefined"!=typeof window.kWidget&&window.kWidget.destroy("sui-kplayer");var l='<div id="av-player-row" class="row avplayer"><div id=\'sui-viewerSide\' class="av col">';t.field_video&&t.field_video.und?r=t.field_video.und[0].entryid:t.field_video&&t.field_video.en?r=t.field_video.en[0].entryid:t.field_audio&&t.field_audio.und?r=t.field_audio.und[0].entryid:t.field_audio&&t.field_audio.en&&(r=t.field_audio.en[0].entryid),l+="<div class='sui-vPlayer' id='sui-kplayer'>\n        <img src=\"https://cfvod.kaltura.com/p/".concat("381832","/sp/").concat("381832","00/thumbnail/entry_id/").concat(r,'/version/100301/width/560/height/0" fill-height"></div>'),l+="<div style='display:inline-block;width:300px;margin-left:16px'>\n                <div title='Published'>&#xe60c&nbsp;&nbsp;&nbsp;",t.field_year_published&&t.field_year_published.en?l+=i.pages.FormatDate(t.field_year_published.en[0].value):e.node_created&&(l+=i.pages.FormatDate(e.node_created,"short")),l+="</div>",l+="<div title='Duration'>&#xe61c&nbsp;&nbsp;&nbsp;".concat(e.duration_s,"</div>"),l+="<div title='Uploader'>&#xe673&nbsp;&nbsp;&nbsp;".concat(e.node_user_full_s,"</div>"),l+="</div><div style='display:inline-block;vertical-align:top;width:calc(100% - 320px)'>";try{if(e.collection_title){var c=i.pages.GetPublicUrlPath("audio-video")+"audio-video-collection/"+e.id;l+="&#xe633&nbsp;&nbsp;&nbsp;\n                <a title='Collection' id='sui-avCol' href='".concat(c,"'>").concat(e.collection_title,"</a>")}}catch(_){}try{for(var o=[],d=["Creator","Director","Producer"],u=0;u<e.creator.length;u++){var m=e.creator_role_ss&&e.creator_role_ss.length>u?e.creator_role_ss[u]:"none";d.includes(m)&&o.push(i.pages.WrapInLangSpan(e.creator[u],!0)+" ("+m+")")}0===o.length&&(o=e.creator),l+="<div title='Creators'>&#xe600&nbsp;&nbsp;&nbsp;"+o.join(", ")+"</div>"}catch(_){}l+="<div title='Visibility'>&#xe67c&nbsp;&nbsp;&nbsp;Public</div>";var h=e.summary?e.summary:e.caption?e.caption:"",f=i.pages.GetLangCode(h);if(f.length>0&&(f=" u-"+f),l+="</div><hr>\n        <p class='sui-sourceText".concat(f,"'>").concat(h,"</p>"),t.field_pbcore_description&&t.field_pbcore_description.und&&t.field_pbcore_description.und.length){l+="<div class='sui-avMore1'><a class='sui-avMore2'>\n            SHOW MORE</a></div>",l+="<div id='sui-avlang' style='display:none'>";var g="";for(a=0;a<t.field_pbcore_description.und.length;++a)try{if((s=t.field_pbcore_description.und[a]).field_description.und[0].value.length>0){var v=i.pages.WrapInLangSpan(s.field_description.und[0].value);g+="<strong>".concat(s.field_language.und[0].value.toUpperCase(),"</strong>\n                            ").concat(v)}}catch(_){}l+=g+"</div>",0==g.length&&(l=l.replace("class='sui-avMore2'","class='sui-avMore2 hidden'"))}l+="</div>",p()("#sui-av").html(l.replace(/\t|\n|\r/g,"")),p()("#sui-av").addClass("processed"),this.DrawTranscript(e,"#sui-trans"),l="//cdnapi.kaltura.com/p/".concat("381832","/sp/").concat("381832","00/embedIframeJs/uiconf_id/").concat("31832371","/partner_id/").concat("381832"),p.a.ajax({url:l,dataType:"script"}).done((function(e){window.kWidget.embed({targetId:"sui-kplayer",wid:"_381832",uiconf_id:"31832371",entry_id:r,flashvars:{autoPlay:!1},params:{wmode:"transparent"}}),window.kWidget.addReadyCallback((function(){var e=document.getElementById("sui-kplayer");"object"===typeof e&&"function"===typeof e.kBind&&(e.kBind("doPlay.__tests__",(function(){p()("#sui-transTab1").html("&#xe681"),n.inPlay=!0,n.PlayAV()})),e.kBind("doPause.__tests__",(function(){p()("#sui-transTab1").html("&#xe641"),n.inPlay=!1,n.playEnd=0,clearInterval(n.transTimer)})))}))})),i.LoadingIcon(!1),"undefined"!=typeof window.kWidget&&window.kWidget.embed({entry_id:r})}},{key:"DrawMetaNew",value:function(e,t){var a,s,n,i,r=this.sui,l="";try{e.title&&(l+="<p title='Title'><strong>TITLE</strong>&nbsp;&nbsp;"+e.title+"</p>")}catch(v){}try{e.collection_title&&(l+="<p title='Collection'><strong>COLLECTION</strong>&nbsp;&nbsp;"+e.collection_title+"</p>")}catch(v){}try{if(t.field_subcollection_new.und.length>0){for(l+="<p><strong>SUBCOLLECTION</strong>&nbsp;&nbsp;",a=0;a<t.field_subcollection_new.und.length;++a)l+=t.field_subcollection_new.und[a].header+r.pages.AddPop(t.field_subcollection_new.und[a].domain+"-"+t.field_subcollection_new.und[a].id)+"&nbsp;&nbsp; ";l+="</p>"}}catch(v){}try{if(t.field_subject.und.length>0){for(l+="<p><strong>SUBJECT</strong>&nbsp;&nbsp;",a=0;a<t.field_subject.und.length;++a)l+=t.field_subject.und[a].header+r.pages.AddPop(t.field_subject.und[a].domain+"-"+t.field_subject.und[a].id)+"&nbsp;&nbsp; ";l+="</p>"}}catch(v){}try{if(t.field_location.und.length>0){for(l+="<p><strong>REFERENCED PLACES</strong>&nbsp;&nbsp;",a=0;a<t.field_location.und.length;++a)l+=t.field_location.und[a].header+r.pages.AddPop(t.field_location.und[a].domain+"-"+t.field_location.und[a].id)+"&nbsp;&nbsp; ";l+="</p>"}}catch(v){}try{l+="<p><strong>RECORDING LOCATION</strong>&nbsp;&nbsp;"+t.field_recording_location_new.und[0].header+r.pages.AddPop(t.field_recording_location_new.und[0].domain+"-"+t.field_recording_location_new.und[0].id)+"</p>"}catch(v){}try{l+="<p><strong>LANGUAGE</strong>&nbsp;&nbsp;"+t.field_language_kmap.und[0].header+r.pages.AddPop(t.field_language_kmap.und[0].domain+"-"+t.field_language_kmap.und[0].id)+"</p>"}catch(v){}try{if(t.field_kmap_terms.und.length>0){for(l+="<p><strong>TERMS</strong>&nbsp;&nbsp;",a=0;a<t.field_kmap_terms.und.length;++a)l+=t.field_kmap_terms.und[a].header+r.pages.AddPop(t.field_kmap_terms.und[a].domain+"-"+t.field_kmap_terms.und[a].id)+"&nbsp;&nbsp; ";l+="</p>"}}catch(v){}try{l+="<p><strong>COPYRIGHT OWNER</strong>&nbsp;&nbsp;"+t.field_copyright_owner.en[0].value+"</p>"}catch(v){}try{l+="<p><strong>YEAR PUBLISHED</strong>&nbsp;&nbsp;"+t.field_year_published.en[0].value+"</p>"}catch(v){}try{l+="<p><strong>RIGHTS SUMMARY</strong>&nbsp;&nbsp;"+t.field_pbcore_rights_summary.en[0].value+"</p>"}catch(v){}try{l+="<p><strong>UPLOADED</strong>&nbsp;&nbsp;"+e.timestamp.substr(0,10)+" by "+e.node_user_full_s+"</p>"}catch(v){}if(t.field_pbcore_creator&&t.field_pbcore_creator.und&&t.field_pbcore_creator.und.length)try{var c,o={},d="";for(a=0;a<t.field_pbcore_creator.und.length;++a)c=(s=t.field_pbcore_creator.und[a]).field_creator_role.und[0].value.toLowerCase(),d=r.pages.WrapInLangSpan(s.field_creator.und[0].value),c in o?o[c].push(d):o[c]=[d];for(c in o){var u=o[c].length>1?c+"s":c;l+="<p><strong>".concat(u.toUpperCase(),"</strong>&nbsp;&nbsp;").concat(o[c].join(", "),"</p>")}}catch(v){console.error(v)}if(t.field_pbcore_contributor&&t.field_pbcore_contributor.und&&t.field_pbcore_contributor.und.length)try{var p,m,h={},f="";for(a=0;a<t.field_pbcore_contributor.und.length;++a)m=(p=(s=t.field_pbcore_contributor.und[a]).field_contributor_role.und[0].value.toLowerCase()).indexOf("assistant")>-1?"":"CONTRIBUTING",f=r.pages.WrapInLangSpan(s.field_contributor.und[0].value),p in h?h[p].push(f):h[p]=[f];for(p in h){var g=h[p].length>1?p+"s":p;l+="<p><strong>".concat(m," ").concat(g.toUpperCase(),"</strong>&nbsp;&nbsp;").concat(h[p].join(", "),"</p>")}}catch(v){}try{l+="<p><strong>PUBLISHER</strong>&nbsp;&nbsp;"+t.field_pbcore_publisher.und[0].field_publisher.und[0].value+"</p>"}catch(v){}try{l+="<p><strong>DATA ENTRY</strong>&nbsp;&nbsp;"+e.node_user_full_s+"</p>"}catch(v){}if(t.field_pbcore_instantiation&&t.field_pbcore_instantiation.und&&t.field_pbcore_instantiation.und.length)for(a in t.field_pbcore_instantiation.und[0]){i=t.field_pbcore_instantiation.und[0][a],n=a.replace(/field_/,"").replace(/_/g," ");try{l+="<p><strong>".concat(n.toUpperCase(),"</strong>&nbsp;&nbsp;<span>").concat(i.und[0].value.replace(/(<([^>]+)>)/gi,""),"</span></p>")}catch(v){}}try{l+="<p><strong>FORMAT ID</strong>&nbsp;&nbsp;"+t.field_video.und[0].entryid+"</p>"}catch(v){}return"<div>"+(l+="<p><strong>FORMAT ID SOURCE</strong>&nbsp;&nbsp;(Kaltura.com)</p>")+"</div>"}},{key:"Draw",value:function(e){}},{key:"DrawMetaData",value:function(e,t){var a,s,n,i,r=this.sui,l="";try{e.title&&(l+="<p title='Title'><strong>TITLE</strong>&nbsp;&nbsp;"+e.title+"</p>")}catch(c){}try{e.collection_title&&(l+="<p title='Collection'><strong>COLLECTION</strong>&nbsp;&nbsp;"+e.collection_title+"</p>")}catch(c){}try{if(t.field_subcollection_new.und.length>0){for(l+="<p><strong>SUBCOLLECTION</strong>&nbsp;&nbsp;",a=0;a<t.field_subcollection_new.und.length;++a)l+=t.field_subcollection_new.und[a].header+r.pages.AddPop(t.field_subcollection_new.und[a].domain+"-"+t.field_subcollection_new.und[a].id)+"&nbsp;&nbsp; ";l+="</p>"}}catch(c){}try{for(l+="<p><strong>SUBJECT</strong>&nbsp;&nbsp;",a=0;a<t.field_subject.und.length;++a)l+=t.field_subject.und[a].header+r.pages.AddPop(t.field_subject.und[a].domain+"-"+t.field_subject.und[a].id)+"&nbsp;&nbsp; ";l+="</p>"}catch(c){}try{l+="<p><strong>RECORDING LOCATION</strong>&nbsp;&nbsp;"+t.field_recording_location_new.und[0].header+r.pages.AddPop(t.field_recording_location_new.und[0].domain+"-"+t.field_recording_location_new.und[0].id)+"</p>"}catch(c){}try{l+="<p'><strong>LANGUAGE</strong>&nbsp;&nbsp;"+t.field_language_kmap.und[0].header+r.pages.AddPop(t.field_language_kmap.und[0].domain+"-"+t.field_language_kmap.und[0].id)+"</p>"}catch(c){}try{l+="<p><strong>TERMS</strong>&nbsp;&nbsp;"+t.field_terms.und[0].header+"</p>"}catch(c){}try{l+="<p><strong>COPYRIGHT OWNER</strong>&nbsp;&nbsp;"+t.field_copyright_owner.en[0].value+"</p>"}catch(c){}try{l+="<p><strong>YEAR PUBLISHED</strong>&nbsp;&nbsp;"+t.field_year_published.en[0].value+"</p>"}catch(c){}try{l+="<p><strong>RIGHTS SUMMARY</strong>&nbsp;&nbsp;"+t.field_pbcore_rights_summary.en[0].value+"</p>"}catch(c){}try{l+="<p><strong>UPLOADED</strong>&nbsp;&nbsp;"+e.timestamp.substr(0,10)+" by "+e.node_user_full_s+"</p>"}catch(c){}if(this.content[0]="<div style='height:2px'/>"+l+"<br>",l="",t.field_pbcore_creator&&t.field_pbcore_creator.und&&t.field_pbcore_creator.und.length)for(a=0;a<t.field_pbcore_creator.und.length;++a){i=t.field_pbcore_creator.und[a];try{l+="<p><strong>".concat(i.field_creator_role.und[0].value.toUpperCase(),"</strong>&nbsp;&nbsp;").concat(r.pages.WrapInLangSpan(i.field_creator.und[0].value),"</p>")}catch(c){}}if(t.field_pbcore_contributor&&t.field_pbcore_contributor.und&&t.field_pbcore_contributor.und.length)for(a=0;a<t.field_pbcore_contributor.und.length;++a){i=t.field_pbcore_contributor.und[a];try{l+="<p><strong>CONTRIBUTING ".concat(i.field_contributor_role.und[0].value.toUpperCase(),"</strong>&nbsp;&nbsp;").concat(i.field_contributor.und[0].value,"</p>")}catch(c){}}try{l+="<p><strong>PUBLISHER</strong>&nbsp;&nbsp;"+t.field_pbcore_publisher.und[0].field_publisher.und[0].value+"</p>"}catch(c){}try{l+="<p><strong>DATA ENTRY</strong>&nbsp;&nbsp;"+e.node_user_full_s+"</p>"}catch(c){}if(this.content[1]="<div style='height:2px'/>"+l+"<br>",l="",t.field_pbcore_instantiation&&t.field_pbcore_instantiation.und&&t.field_pbcore_instantiation.und.length)for(a in t.field_pbcore_instantiation.und[0]){n=t.field_pbcore_instantiation.und[0][a],s=a.replace(/field_/,"").replace(/_/g," ");try{l+="<p><strong>".concat(s.toUpperCase(),"</strong>&nbsp;&nbsp;").concat(n.und[0].value,"</p>")}catch(c){}}try{l+="<p><strong>FORMAT ID</strong>&nbsp;&nbsp;"+t.field_video.und[0].entryid+"</p>"}catch(c){}l+="<p><strong>FORMAT ID SOURCE</strong>&nbsp;&nbsp;(Kaltura.com)</p>",this.content[2]="<div style='height:2px'/>"+l+"<br>"}},{key:"DrawTranscript",value:function(e,t){var a,s,n,i=this,r={};if(e.trid_i){this.curTransSeg=-1,r.ts_content_rus="Russian",r.content_bod="Tibetan",r.dzo_bod="Dzongkha",r.ts_content_sgt="Brokpake",r.ts_content_kjz="Bumthangkha",r.ts_content_tgf="Chalikha",r.ts_content_cgk="Chocangacakha",r.ts_content_dka="Dakpakha",r.ts_content_dzl="Dzalakha",r.ts_content_goe="Gongduk",r.ts_content_xkz="Kurtop",r.ts_content_kru="Kuruz",r.ts_content_lkh="Lakha",r.ts_content_lya="Layakha",r.ts_content_lep="Lepcha",r.ts_content_lhp="Lhokpu",r.ts_content_luk="Lunanakha",r.ts_content_npb="Nupbikha",r.ts_content_neh="Mangdekha",r.ts_content_ole="Olekha",r.ts_content_tsj="Tshangla",r.ts_content_xkf="Khengkha",r.ts_content_wylie="Wylie",r.ts_content_gyal="Gyalsumdo",r.ts_content_gvr="Gurung",r.ts_content_npa="Nar Phu",r.ts_content_nmm="Manange",r.ts_content_kte="Nubri",r.ts_content_tsum="Tsum",r.ts_content_nep="Nepali",r.ts_content_eng="English",r.ts_content_zho="Chinese",r.ts_content_und="Unknown",r.ts_content_gloss="Morpheme glossing";var l={languages:{},speakers:{},segs:[],layout:"Normal",rev:0,speaker:""},c="https://ss251856-us-east-1-aws.measuredsearch.com/solr/av_test/select?indent=on&q=is_trid:"+e.trid_i+"&wt=json&start=0&rows=1000";p.a.ajax({url:c,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){for(e.response.docs.sort((function(e,t){return e.fts_start>t.fts_start?1:-1})),a=0;a<e.response.docs.length;++a){for(var t in s=e.response.docs[a],n={start:s.fts_start,end:s.fts_end,dur:s.fts_duration},s.ss_speaker_bod&&(l.speakers[s.ss_speaker_bod]=1,n.speaker=s.ss_speaker_bod),n.lang=s.ss_language?s.ss_language:"",r)s[t]&&(n[r[t]]=s[t],l.languages[r[t]]=1);l.segs.push(n)}l.segs.length&&(i.transRes=l,p()(i.div).width()>700&&p()("#sui-viewerSide").width(.5*p()(i.div).width()),0===p()("#av-trscrpt-wrapper").length&&i.DrawTranscriptMenu(),i.DrawTransContent())}))}}},{key:"DrawTranscriptMenu",value:function(){var e=this,t=this.transRes,a=navigator.userAgent.includes("Chrome")?"chrome":navigator.userAgent.includes("Firefox")?"firefox":"safari",s="<div id='av-trscrpt-wrapper' class='col'>\n            <div class='av-trscrpt-ctrls row'>\n                <div id='sui-transTab0' class='sui-transTab col' title='Options'>&#xe66f&#xe609</div>\n                <div id='sui-transTab1' class='sui-transTab col' title='Play/Pause'>&#xe641</div>\n                <div id='sui-transTab2' class='sui-transTab col' title='Previous line'>&#xe602</div>\n                <div id='sui-transTab3' class='sui-transTab col' title='Same line'>&#xe632</div>\n                <div id='sui-transTab4' class='sui-transTab col' title='Next line'>&#xe604</div>\n                <div id='sui-transTab5' class='sui-transTab col' style='border:none' title='Search transcript'>&#xe623</div>\n                <div id='sui-transSrc' class='sui-transSrc'>\n                    <div class=\"transSrcWrap ".concat(a,"\">\n                        <div class=\"navigator\">\n                            <div class=\"navwrapper\" style=\"display: none;\">\n                                <div id='sui-transSrcB' style='display:inline-block;color:#fff;font-size:20px;cursor:pointer' title='Previous result'>&#xe640</div>\n                                <div id='sui-transSrcN' style='display:inline-block;color:#fff;margin:0 16px;font-size:12px;cursor:pointer;vertical-align:4px'>0 of 0</div>\n                                <div id='sui-transSrcF' style='display:inline-block;color:#fff;font-size:20px;cursor:pointer' title='Previous result'>&#xe641</div>\n                            </div>\n                        </div>\n                        <div id='sui-transSrcGo' class='sui-search4'>\n                            <input type='text' id='sui-transSrcInp' class='sui-search2' size='40' placeholder='Search this transcript'/>\n                            <span class=\"icon shanticon-magnify search\"></span>\n                            <span class=\"icon shanticon-cancel clear\" style=\"display: none;\"></span>\n                            <button class=\"search\"><span class=\"icon shanticon-angle-right\"></span></button>\n                        </div>\n                        \x3c!--\n                        <div id='sui-transSrcGo' class='sui-search4'>&#xe623</div> &lt;!&ndash; style='float:right;margin:12px 16px 0 0' &ndash;&gt;\n                            <div class='sui-search1'> &lt;!&ndash; style='float:right;margin-top:12px' &ndash;&gt;\n                                <input type='text' id='sui-transSrcInp' class='sui-search2' placeholder='Search this transcript'>\n                                <div id='sui-clear' class='sui-search3'>&#xe610</div>\n                            </div>\n                        </div>--\x3e\n                    </div>\n                <div id='sui-transOps' class='sui-transOps'></div>\n            </div>\n            <div id='sui-trans' class='sui-trans row'></div>\n\t\t</div>");p()("#av-player-row").append(s.replace(/\t|\n|\r/g,""));var n=0,i=[];function r(e){var t=window.sui;"undefined"==typeof e&&(e=t.av.transhits),p()(".srchit").each((function(){var e=p()(this).text();p()(this).replaceWith(e)})),e.map((function(e){var t=p()("#sui-transBox-"+e+" span").html(),a=p()("#sui-transSrcInp").val();t=t.replace(new RegExp(a,"g"),'<span class="srchit">'.concat(a,"</span>")),p()("#sui-transBox-"+e+" span").html(t)}));var a=e.length?n+1:0;e.length>0&&p()(".transSrcWrap .navwrapper").show(),p()("#sui-transSrcN").html(a+" of "+e.length),e.length&&(t.av.curTransSeg=e[n],t.av.HighlightSeg(t.av.curTransSeg,void 0))}for(var l in p()("#sui-transSrcGo button.search").on("click",(function(){var e,a,s;if(i=[],n=0,p()("#sui-transSrcInp").val()){for(a=RegExp(p()("#sui-transSrcInp").val(),"i"),e=0;e<t.segs.length;++e)for(s in t.languages)t.segs[e][s]&&t.segs[e][s].match(a)&&i.push(e);window.sui.av.transhits=i}r(i),p()("#sui-transSrcGo .icon.clear").show()})),p()("#sui-transSrcInp").on("change",(function(){p()("#sui-transSrcGo button.search").trigger("click")})),p()("#sui-transSrcB").on("click",(function(){console.log("Prev: "+n,i.length),n=n>0?Math.max(0,n-1):i.length-1,r()})),p()("#sui-transSrcF").on("click",(function(){console.log("Next: "+n,i.length),n=n<i.length-1?Math.min(i.length-1,n+1):0,r()})),p()("div#sui-transSrcGo .icon.clear").on("click",(function(){p()(".srchit").each((function(){var e=p()(this).text();p()(this).replaceWith(e)})),p()("#sui-transSrcInp").val(""),p()("div#sui-transSrcGo .icon.clear, .transSrcWrap .navwrapper").hide()})),s="<div class='sui-transRow'>Transcript options<span class='sui-transCheck trans-opts-close'>&#xe60f</span></div>\n\t\t<div class='sui-transLab'>LANGUAGES</div>",t.languages)s+="<div class='sui-transRow' id='sui-transLan-"+l+"'>- "+l+"<span id='sui-transLang-"+l+"' class='sui-transCheck' style='color:#58aab4'>&#xe60e</span></div>";s+="<div class='sui-transLab'>SPEAKERS</div>\n\t\t<div class='sui-transRow'>- Tibetan<span id='sui-transS1' class='sui-transCheck' style='color:#58aab4'>&#xe60e</span></div>\t\n\t\t<div class='sui-transLab'>LAYOUTS</div>\n\t\t<div class='sui-transRow' id='sui-transMinR'>- Minimal<span id='sui-transMin' class='sui-transCheck'>&#xe60e</span></div>\n\t\t<div class='sui-transRow' id='sui-transRevR'>- Reversed<span id='sui-transRev' class='sui-transCheck'>&#xe60e</span></div>\n\t\t<div class='sui-transLab'>DOWNLOADS</div>\n\t\t<div class='sui-transRow' id='sui-transStr'->- SRT file<span class='sui-transCheck' style='color:#58aab4'>&#xe616</span></div>",p()("#sui-transOps").html(s.replace(/\t|\n|\r/g,"")),p()("#sui-transStr").on("click",(function(){e.SaveStrFile()})),p()("[id^=sui-transLan-]").on("click",(function(t){var a=e.transRes,s=t.currentTarget.id.substring(13);a.languages[s]=1-a.languages[s],p()("#sui-transLang-"+s).css("color",a.languages[s]?"#58aab4":"#ccc"),e.transRes=a,e.DrawTransContent()})),p()("#sui-transMinR").on("click",(function(){var t=e.transRes;t.layout="Minimal"==t.layout?"Normal":"Minimal",p()("#sui-transMin").css("color","Minimal"==t.layout?"#58aab4":"#ccc"),e.transRes=t,e.DrawTransContent()})),p()("#sui-transRevR").on("click",(function(){var t=e.transRes;t.rev=t.rev?0:1,p()("#sui-transRev").css("color",t.rev?"#58aab4":"#ccc"),e.transRes=t,e.DrawTransContent()})),p()("#sui-transTab0").on("click",(function(){p()("#sui-transOps").slideToggle("fast")})),p()(".sui-transCheck.trans-opts-close").on("click",(function(){p()("#sui-transOps").slideToggle("fast")})),p()("#sui-transTab5").on("click",(function(){p()("#sui-transSrc").slideToggle("fast"),p()("#av-trscrpt-wrapper #sui-trans").hasClass("searchshown")?p()("#av-trscrpt-wrapper #sui-trans").removeClass("searchshown"):p()("#av-trscrpt-wrapper #sui-trans").addClass("searchshown")})),p()("#sui-transTab1").on("click",(function(t){t.preventDefault(),clearInterval(e.transTimer),e.inPlay?p()("#sui-kplayer")[0].sendNotification("doPause"):(e.PlayAV(),p()("#sui-kplayer")[0].sendNotification("doPlay"))})),p()("#sui-transTab2").on("click",(function(t){t.preventDefault();var a=e.transRes;e.curTransSeg=Math.max(e.curTransSeg-1,0),e.PlayAV(a.segs[e.curTransSeg].start,a.segs[e.curTransSeg].end),p()("#sui-kplayer")[0].sendNotification("doPlay")})),p()("#sui-transTab3").on("click",(function(a){a.preventDefault(),e.PlayAV(t.segs[e.curTransSeg].start,t.segs[e.curTransSeg].end),p()("#sui-kplayer")[0].sendNotification("doPlay")})),p()("#sui-transTab4").on("click",(function(a){a.preventDefault(),e.curTransSeg=Math.min(e.curTransSeg+1,t.segs.length-1),e.PlayAV(t.segs[e.curTransSeg].start,t.segs[e.curTransSeg].end),p()("#sui-kplayer")[0].sendNotification("doPlay")}))}},{key:"SaveStrFile",value:function(){var e,t,a,s=this.transRes,n="";for(t=0;t<s.segs.length;++t){for(e in a=s.segs[t],n+="".concat(t+1,"\n").concat(a.start,",000 --\x3e ").concat(a.end,",000\n").concat(a.speaker?">> "+a.speaker+"\n":""),s.languages)s.segs[t][e]&&s.languages[e]&&(n+=s.segs[t][e]+"\n");n+="\n"}var i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(n)),i.setAttribute("download","transcript-"+this.kmap.id+".str"),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}},{key:"DrawTransContent",value:function(){var e,t,a=this,s="",n=this,i=this.transRes;if("Minimal"==i.layout)for(e=0;e<i.segs.length;++e){for(t in s+="<div class='sui-transMinSeg' id='sui-transMinSeg-".concat(e,"'>\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t<div style='float:").concat(i.rev?"right":"left",";font-size:18px;'>\n\t\t\t\t").concat(i.segs[e].speaker?i.segs[e].speaker+"<br>":"","\n\t\t\t\t<div class='sui-transMinPlay' id='sui-transPlay-").concat(e,"' title='Play line ").concat(this.SecondsToTimecode(i.segs[e].start),"'>&#xe680</div> \n\t\t\t\t</div>\n\t\t\t\t<div class='sui-transMinBox' id='sui-transMinBox-").concat(e,"'\n\t\t\t\tstyle='margin:").concat(i.rev?"0 150px 0 0":"0  0 0 150px","'>"),i.languages)i.segs[e][t]&&i.languages[t]&&(s+=i.segs[e][t]+"<hr style='margin:0;border-top:1px dashed #eee'>");s+="</div></div>"}else for(e=0;e<i.segs.length;++e){for(t in s+="<div class='sui-transSeg' id='sui-transSeg-".concat(e,"'>\n\t\t\t\t<div style='float:").concat(i.rev?"right":"left",";font-size:18px;'>\n\t\t\t\t").concat(i.segs[e].speaker?i.segs[e].speaker+"<br>":"","\n\t\t\t\t<div class='sui-transPlay' id='sui-transPlay-").concat(e,"' \n\t\t\t\ttitle='Play line'>&#xe680\n\t\t\t\t<span style='margin-left:24px;font-size:12px;vertical-align:4px'>\n\t\t\t\t").concat(this.SecondsToTimecode(i.segs[e].start),"</span></div></div> \n\t\t\t\t<div class='sui-transBox' id='sui-transBox-").concat(e,"'\n\t\t\t\tstyle='margin:").concat(i.rev?"0 150px 0 0":"0  0 0 150px","'>"),i.languages)i.segs[e][t]&&i.languages[t]&&(s+=sui.pages.WrapInLangSpan(i.segs[e][t])+"<hr style='margin:0;border-top:1px dashed #eee'>");s+="</div></div>"}p()("#sui-trans").html(s.replace(/\t|\n|\r/g,"")),p()("#sui-trans").on("mousedown",(function(){a.mouseDown=!0})),p()("#sui-trans").on("mouseup",(function(){a.mouseDown=!1})),p()("#sui-trans").on("scroll",(function(){n.handScroll=!0,n.mouseDown||(clearTimeout(p.a.data(this,"scrollTimer")),p.a.data(this,"scrollTimer",setTimeout((function(){n.handScroll=!1}),250)))})),p()("[id^=sui-transPlay-]").on("click",(function(e){a.curTransSeg=e.currentTarget.id.substring(14),a.PlayAV(i.segs[a.curTransSeg].start,i.segs[a.curTransSeg].end),p()("#sui-kplayer")[0].sendNotification("doPlay")}))}},{key:"PlayAV",value:function(e,t){var a,s=this,n=this.transRes;clearInterval(this.transTimer),this.scrollStart=p()("#sui-trans").scrollTop(),void 0!=e&&p()("#sui-kplayer")[0].sendNotification("doSeek",e),t&&(this.playEnd=t),this.transTimer=setInterval((function(t){if("function"===typeof p()("#sui-kplayer")[0].evaluate){var i=p()("#sui-kplayer")[0].evaluate("{video.player.currentTime}");if(s.playEnd&&i>=s.playEnd)return clearInterval(s.transTimer),p()("#sui-kplayer")[0].sendNotification("doPause"),void(s.playEnd=0);for(a=0;a<n.segs.length;++a)if(i>=n.segs[a].start&&i<n.segs[a].end){s.curTransSeg=a;break}s.curTransSeg>0&&s.HighlightSeg(s.curTransSeg,e)}}),100)}},{key:"HighlightSeg",value:function(e,t){var a=p()("#sui-trans".concat("Minimal"==this.transRes.layout?"Min":"","Seg-").concat(e)).position().top-p()("#sui-trans".concat("Minimal"==this.transRes.layout?"Min":"","Seg-0")).position().top;void 0==t&&p()("#sui-trans").scrollTop(a),p()("[id^=sui-transSeg-]").css("background-color","#ddd"),p()("[id^=sui-transMinSeg-]").css("border-color","#fff"),p()("[id^=sui-transMinSeg-]").css("background-color","#fff"),p()("#sui-transMinSeg-"+e).css("border-color","#999"),p()("#sui-transMinSeg-"+e).css("background-color","#eee"),p()("#sui-transSeg-"+e).css("background-color","#aaa")}},{key:"TimecodeToSeconds",value:function(e){var t=0,a=0,s=(""+e).split(":"),n=s[0];return 2==s.length?(n=s[1],a=s[0]):3==s.length&&(n=s[2],a=s[1],t=s[0]),Number(3600*t)+Number(60*a)+Number(n)}},{key:"SecondsToTimecode",value:function(e){var t,a="";return(t=Math.floor(e/3600))&&(a+=t+":"),(t=Math.floor(e/60))<10&&(a+="0"),a+=t+":",(t=Math.floor(e%60))<10&&(a+="0"),a+=t}}]),e}(),v=function(){function e(t){Object(l.a)(this,e),this.sui=t,this.div=t.pages.div,this.content=["...loading","...loading"],this.content2=["<br>","<br>"],this.kmap=null,this.relatedPlaceData=null,this.relatedSubjectData=null}return Object(c.a)(e,[{key:"Draw",value:function(e,t){console.error("subjects.Draw() called "),console.dir(arguments);var a=this.sui;this.kmap=e,p()("#sui-legacy").css({"padding-left":"12px",width:"calc(100% - 24px"}),this.GetSubjectData(e),this.DrawContent(e,t),a.pages.DrawRelatedAssets(e)}},{key:"DrawContent",value:function(e,t){var a=this,s=this.sui,n="<div class='sui-subjects' id='sui-subConDiv'>\n\t\t<div><span class='sui-subIcon'>".concat(s.assets[e.asset_type].g,"</span>\n\t\t<span class='sui-subText'>").concat(e.title[0],"</span>\n\t\t<hr style='border-top: 1px solid ").concat(s.assets[e.asset_type].c,"'>");e.caption&&(n+="<p id='sui-spCap'>"+e.caption+"</p></div>"),1==t?n="<div style='margin-left:192px'>"+s.pages.DrawTabMenu(["SUBJECT CONTEXT","RELATED SUBJECTS"]):2==t&&(n="<div id='sui-topCon' style='margin-left:216px'>"+this.GetPlaceData(e)),p()(this.div).html(n+"</div>".replace(/\t|\n|\r/g,"")),p()("[id^=sui-tabTab]").on("click",(function(e){var t=e.currentTarget.id.substring(10);a.ShowTab(t)}))}},{key:"ShowTab",value:function(e){var t=this;p()("[id^=sui-spLab-]").off("click"),p()("[id^=sui-spDot-]").off("click"),p()("[id^=sui-spItem-]").off("click"),p()("[id^=sui-togCat-]").off("click"),p()("[id^=sui-spCatUL-]").off("click"),p()("[id^=sui-tabTab]").css({"background-color":"#999",color:"#fff"}),p()("#sui-tabContent").css({display:"block","background-color":"#eee"}),p()("#sui-tabTab"+e).css({"background-color":"#eee",color:"#000"}),p()("#sui-tabContent").html(this.content[e]),0==e?(p()("#sui-spLab-"+this.kmap.uid).css({"font-weight":"bold","text-decoration":"underline"}),p()("[id^=sui-spLab-]").on("click",(function(e){return!1})),p()("[id^=sui-spDot-]").on("click",(function(e){var a=e.currentTarget.id.substring(10);"null"!=a&&sui.pages.AddRelBranch(t.kmap.asset_type,a,p()(this)),p()(this).html("&ndash;"),p()(this).parent().find("ul").slideToggle()}))):1==e&&(p()("[id^=sui-spItem-]").on("click",(function(e){return!1})),p()("[id^=sui-spCatUL-]").slideDown(),p()("[id^=sui-spCat-]").on("click",(function(e){var t=e.currentTarget.id.substring(9);"none"==p()("#sui-spCatUL"+t).css("display")?p()("#sui-spCatUL"+t).slideDown():p()("#sui-spCatUL"+t).slideUp()})),p()("#sui-togCatA").on("click",(function(){p()("[id^=sui-spCatUL-]").slideDown()})),p()("#sui-togCatN").on("click",(function(){p()("[id^=sui-spCatUL-]").slideUp()})))}},{key:"GetPlaceData",value:function(e){var t=this;return sui.GetRelatedPlaces(e.uid,(function(e){t.relatedPlaceData=e,t.DrawRelatedPlaces("tree",1)})),"Loading..."}},{key:"DrawRelatedPlaces",value:function(e,t){var a,s,n,i=this,r=[],l=this.relatedPlaceData,c=this.kmap,o="<br><div class='sui-spHead'>Places related to ".concat(c.title,"</div>\n\t\t<p style='color:#666'>\n\t\t<input id='sui-rpSearch' placeholder='&nbsp;Search places' \n\t\tstyle='width:100px;border:1px solid #999;border-radius:12px;padding-left:8px'> &nbsp;\n\t\t<span class='sui-advEditBut' style='color:").concat("tree"==e?"#668eec":"#666","' \n\t\tid='sui-rpTree' title='Tree view'>&#xe638</span> | \n\t\t<span class='sui-advEditBut' style='color:").concat("tree"!=e?"#668eec":"#666","'\n\t\tid='sui-rpList' title='List view'>&#xe61f</span>");if("tree"!=e){for(s=p()("#sui-footer").offset().top-p()("#sui-legacy").offset().top-150,o+=" | <span class='sui-advEditBut' id='sui-rpSort' title='Sort'>\n\t\t\t".concat(1==t?"&#xe653":"&#xe652","</span>\t\t\n\t\t\t</p><div class='sui-rpList' style='height:").concat(s,"px'>"),l=l.sort((function(e,a){return e.title<a.title?-t:t})),a=0;a<l.length;++a)o+="<div id='sui-rpLine-".concat(a,"' style='width:300px' title='").concat(l[a].ancestors_txt.join("/"),"'>").concat(l[a].title,"</div>");return p()("#sui-topCon").html(o+"</div>"),p()("#sui-rpTree").on("click",(function(){i.DrawRelatedPlaces("tree",t)})),p()("#sui-rpSort").on("click",(function(){i.DrawRelatedPlaces("list",-1*t)})),void p()("#sui-rpSearch").on("keydown",(function(e){var t,s=p()("#sui-rpSearch").val();for(e.keyCode>31&&e.keyCode<91&&(s+=e.key),8==e.keyCode&&s.length&&(s=s.slice(0,-1)),s=RegExp(s,"i"),a=0;a<l.length;++a)(t=p()("#sui-rpLine-"+a)).text().match(s)?t.css("display","block"):t.css("display","none")}))}o+=" | <span class='sui-advEditBut' style='vertical-align:0' \n\t\tid='sui-togCatA' title='Expand all'<strong>&#x2295</strong></span> | \n\t\t<span class='sui-advEditBut' style='vertical-align:0'\n\t\tid='sui-togCatN' title='Collapse all'><strong>&#x2296</strong></span> \n\t\t</p><div style='width:100%'><div style='display:inline-block'>\n\t\t<ul style='list-style-type:none;margin-left:-24px'>";var d=l.length;for(a=0;a<d;++a)for(n="places-",s=0;s<l[a].ancestor_ids_is.length;++s)n+=l[a].ancestor_ids_is[s]+"-",r.push({lab:l[a].ancestors_txt[s],level:s,id:n.slice(0,-1),uid:"places-"+l[a].ancestor_ids_is[s]}),r[r.length-1].parent=n.split("-").slice(0,-2).pop();for(r=r.sort((function(e,t){return e.id<t.id?-1:1})),a=r[r.length-1],(r=r.filter((function(e,t){try{return e.id!=r[t+1].id}catch(a){}}))).push(a),d=r.length,a=0;a<d;++a)0==r[a].level&&(o+=h(r[a].lab,r[a].id,r[a].id,"&ndash;"));for(p()("#sui-topCon").html(o+"</ul></div>"),p()("#sui-rpList").on("click",(function(){i.DrawRelatedPlaces("list",t)})),p()("#sui-rpSearch").on("keyup",(function(){var e=p()("#sui-rpSearch").val();i.DrawRelatedPlaces("list",t),p()("#sui-rpSearch").val(e),p()("#sui-rpSearch").focus(),p()("#sui-rpSearch").trigger("keydown",{keyCode:13})})),a=0;a<d;++a)r[a].n=u(r[a].id);for(a=0;a<d;++a)0==r[a].level&&m(r[a].id,1);function u(e){var t,a=0;for(e=e.split("-").pop(),t=0;t<d;++t)r[t].parent==e&&++a;return a}function m(e,t){var a,s,n="";for(a=0;a<d;++a)r[a].id.match(e)&&r[a].level==t&&(s=r[a].n>0?"+":"&bull;",n="<ul style='list-style-type:none;display:none;padding:2px 0 0 24px'>",n+=h(r[a].lab,r[a].id,r[a].uid,s),n+="</ul>",p()("#sui-rpDot-"+e).parent().parent().append(n),m(r[a].id,t+1))}function h(e,t,a,s){var n="<li>";return n+="&bull;"!=s?"<div class='sui-spDot' id='sui-rpDot-".concat(t,"'>").concat(s,"</div>"):"<div class='sui-spDot' id='sui-rpDot-".concat(t,"' style='display:none;color:#5b66cb'><strong>&bull;</div>&bull;&nbsp;&nbsp;"),n+="<a class='sui-noA' href='#p=".concat(a,"'>").concat(e,"</strong>").concat(sui.pages.AddPop(a),"</a>")}p()("#sui-topCon").find("li").each((function(){(s=p()(this).parent().find("li").find("b").length)&&!p()(this).find("b").length&&p()(this).find("img").before("("+s/2+") ")})),p()("[id^=sui-rpDot-]").off("click"),p()("[id^=sui-rpDot-]").on("click",(function(e){var t=p()(this).parent().parent(),a=p()(this).html();p()(this).html("+"==a?"&ndash;":"+"),p()(t).children("ul").slideToggle()})),p()("#sui-togCatA").on("click",(function(){var e,t;for(e=0;e<d;++e)t=p()("#sui-rpDot-"+r[e].id).parent(),p()("#sui-rpDot-"+r[e].id).html("&ndash;"),t.parent().css("display","block"),t.css("display","block")})),p()("#sui-togCatN").on("click",(function(){var e,t;for(e=0;e<d;++e)"&bull;"!=(t=p()("#sui-rpDot-"+r[e].id)).html()&&t.html("+"),t.parent().parent().css("display","none"),r[e].level<3&&(r[e].level<2&&t.html("&ndash;"),t.parent().parent().css("display","block"))})),p()("#sui-togCatN").trigger("click")}},{key:"GetSubjectData",value:function(e){var t=this;this.sui.GetRelatedFromID(e.uid,(function(a){var s,n,i=0,r="<table>";if(a){if(t.relatedSubjectData=a,a[0].summary_eng&&a[0].summary_eng[0]&&p()("#sui-spCap").html(a[0].summary_eng[0]),e.names_txt&&e.names_txt.length)for(n=0;n<e.names_txt.length;++n)e.names_txt[n].match(/lang="bo"/i)&&(r+="<tr><td style='color:#000099;font-size:20px'><strong>"+e.names_txt[n]+"</strong>&nbsp;&nbsp;&nbsp;</td><td span='2'><i>Dzongkha, Tibetan script, Original</i></td></tr>");for(n=0;n<a.length;++n)"related_names"==(s=a[n]).block_child_type&&(i||(s.related_names_level_i=0),r+="<tr><td style='padding-left:".concat(16*s.related_names_level_i,"px'>\n\t\t\t\t").concat(i++?">&nbsp;":"","\n\t\t\t\t<strong>").concat(s.related_names_header_s,"&nbsp;&nbsp;&nbsp;</strong></td><td>\n\t\t\t\t<i>").concat(s.related_names_language_s,", ").concat(s.related_names_writing_system_s,", ").concat(s.related_names_relationship_s,"\n\t\t\t\t</i></td></tr>"));r+="</table><br>",p()("#sui-subConDiv").append(r.replace(/\t|\n|\r/g,"")),t.AddRelatedSubjects(e,a),t.AddSubjectContext(e,a)}}))}},{key:"AddRelatedSubjects",value:function(e,t){var a,s,n=0,i=[],r=t.length;for(s=0;s<r;++s)"related_subjects"==t[s].block_child_type&&(i[t[s].related_subjects_relation_label_s]||(i[t[s].related_subjects_relation_label_s]=[]),i[t[s].related_subjects_relation_label_s].push({title:t[s].related_subjects_header_s,id:t[s].related_uid_s}));var l=Object.keys(i).sort((function(e,t){return e.length>t.length?-1:1}))[0],c="<br><div class='sui-spHead'>Subjects related to ".concat(e.title,"</div>\n\t\t<div>\n\t\t").concat(e.title[0],"</strong> has <strong>~|~</strong> other subject").concat(r>1?"s":""," directly related to it, which is presented here. \n\t\tSee the SUBJECT CONTEXT tab if you instead prefer to browse all subordinate and superordinate categories for ").concat(e.title[0],".</div>\n\t\t<p><a class='sui-advEditBut' id='sui-togCatA'>Expand all</a> / <a class='sui-advEditBut' id='sui-togCatN'>Collapse all</a>\n\t\t</p><div style='width:100%'><div style='width:50%;display:inline-block'>");for(a in c+=o(l)+"</div><div style='display:inline-block;width:50%;vertical-align:top'>",i)a!=l&&(c+=o(a));function o(t){if(!i||!i[t])return"</ul>";i[t]=i[t].sort((function(e,t){return e.title<t.title?-1:1}));var a="<div id='sui-spCat-"+t.replace(/ /g,"_")+"' class='sui-spCat'>"+e.title+" "+t+"</div><ul id='sui-spCatUL-"+t.replace(/ /g,"_")+"' style='display:none'>";for(s=0;s<i[t].length;++s)a+="<li><a class='sui-noA' id='sui-spItem-"+i[t][s].id,a+="' href='#p="+i[t][s].id+"'>",a+=i[t][s].title+"</a>"+sui.pages.AddPop(i[t][s].id)+"</li>",++n;return a+"</ul>"}c=(c+="</div></div>").replace(/~\|~/,n),this.content[1]=c}},{key:"AddSubjectContext",value:function(e,t){var a,s=this,n=this.sui,i=0,r=0;for(a=0;a<t.length;++a)r+=t[a].child_count.numFound;r="(TBD)";var l="<br><div class='sui-spHead'>Subjects related to ".concat(e.title,"</div>\n\t\t<div>\n\t\t<strong>").concat(e.title[0],"</strong> has <strong> ").concat(t[0].ancestors.length-1," </strong>superordinate subjects \n\t\tand <strong> ").concat(r," </strong>subordinate subjects. \n\t\tYou can browse these subordinate subjects as well as its superordinate categories with the tree below. \n\t\tSee the RELATED SUBJECTS tab if you instead prefer to view only its immediately \n\t\tsubordinate subjects grouped together in useful ways, as well as subjects non-hierarchically related to it.</div><br>\n\t\t<ul class='sui-spLin' id='sui-spRows'>");for(i=0;i<t[0].ancestors.length;++i)l+="<ul style='list-style-type:none'>",l+=n.pages.AddRelTreeLine(t[0].ancestors[i],t[0].ancestor_uids_generic[i],"&ndash;",null);n.GetTreeChildren(e.asset_type,t[0].ancestor_id_path,(function(e){var a,r,c,o,d,u=[];try{u=e.facets.child_counts.buckets}catch(p){}for(e=e.response.docs,a=0;a<e.length;++a){for(d="",o=null,c=new RegExp(e[a].id.split("-")[1]),r=0;r<u.length;++r)u[r].val.match(c)&&(o="+",d=u[r].val);l+="<ul style='list-style-type:none'>",l+=n.pages.AddRelTreeLine(e[a].header,e[a].id,o,d)+"</li></ul>"}for(l=l.replace(/~~/,i+e.length),a=0;a<t[0].ancestors.length;++a)l+="</li></ul>";s.content[0]=l.replace(/\t|\n|\r/g,"")+"</ul><br>",s.ShowTab(0)}))}}]),e}(),_=function(){function e(t){if(Object(l.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.sui=t,this.div=t.pages.div}return Object(c.a)(e,[{key:"Draw",value:function(e){var t,a,s,n=this,i=this.sui,r=e.url_thumb_height/e.url_thumb_width;p()(this.div).width();for(e.url_thumb&&(e.url_thumb=e.url_thumb.replace(/images-test/i,"images")),t=0;t<i.curResults.length;++t)e.id==i.curResults[t].id&&(s=t);var l="<div class='sui-imagesBox' id='sui-imagesBox' style='margin:".concat("related"==i.ss.mode?"-12px 0 0 0":"-12px -12px 0 -12px","'>\n\t\t<div id='sui-picEnlarge' style='cursor:pointer;font-size:18px' title='Click to enlarge and pan'>&#xe650</div></p>\n\t\t<div id='sui-imageDiv' class='sui-imageDiv' >\n\t\t\t<img id='sui-thisPic' src='").concat(e.url_thumb.replace(/200,200/,"2000,2000"),"' style='width:100%'> \n\t\t</div><br>\n\t\t<div><span style='max-width:900px;font-size:20px;vertical-align:-2px;color:#ccc'>&#xe62a&nbsp;&nbsp;").concat(e.title[0],"</span></div>\n\t\t<div style='color:#ccc;margin-bottom:24px'>").concat(e.creator,"&nbsp;&nbsp;|&nbsp;&nbsp;").concat(e.img_width_s," x ").concat(e.img_height_s," px</div>\n\t\t<div class='sui-imageGal'id='sui-imageGal'>");for(t=0;t<s;++t)"images"==i.curResults[t].asset_type&&(l+="<div class='sui-pageThumb'><img id='sui-pageThumb-".concat(t,"' src='").concat(i.curResults[t].url_thumb,"' style='height:100%'></div>"));for(l+="<div class='sui-pageThumb' style=' border-color:#fff'><img id='sui-pageThumb-".concat(s,"' src='").concat(e.url_thumb,"' style='height:100%'></div>"),t=s+1;t<i.curResults.length;++t)"images"==i.curResults[t].asset_type&&(l+="<div class='sui-pageThumb'><img id='sui-pageThumb-".concat(t,"' src='").concat(i.curResults[t].url_thumb,"' style='height:100%'></div>"));l+="</div></div>",i.GetJSONFromKmap(e,(function(e){f(e)})),p()(this.div).html(l.replace(/\t|\n|\r/g,"")),i.pages.DrawRelatedAssets();var c,o=[],d=[],u=[];try{for(t=0;t<e.kmapid_strict.length;++t)if(e.kmapid_strict[t].match(/places/)&&o.push(e.kmapid_strict_ss[t]+i.pages.AddPop(e.kmapid_strict[t])),e.kmapid_strict[t].match(/subjects/)&&d.push(e.kmapid_strict_ss[t]+i.pages.AddPop(e.kmapid_strict[t])),e.kmapid_strict[t].match(/terms/)){c=e.kmapid_strict_ss[t];var m=RegExp(e.kmapid_strict[t]+"_definitions-(d*)","g");if(m=e.kmapid.join().match(m)){for(c+="<span><i><sup> (",a=1;a<=m.length;++a)c+=a,a<m.length&&(c+=",");c+=")</sup></i></span>"}c+=i.pages.AddPop(e.kmapid_strict[t]),u.push(c)}}catch(g){}if(l="<br><table class='sui-imageMid'>\n\t\t\t<tr class='sui-pageLab' style='font-size:16px;padding-bottom:4px'><td style='width:50%'>MANDALA COLLECTIONS</td><td>CLASSIFICATION</td></tr>\n\t\t\t<tr class='sui-pageLab' style='padding-bottom:8px'><td>&#xe633&nbsp;&nbsp;<i>",e.collection_title?l+="".concat(e.collection_title).concat(i.pages.AddPop(e.collection_uid_s)):l+="None",l+="</td><td><i>",d.length){for(l+="<span style='color:#cc4c39'>&#xe634</span>&nbsp;&nbsp",t=0;t<d.length;++t)l+=d[t]+", ";l=l.slice(0,-2)+"<br>"}if(o.length){for(l+="<span style='color:#6faaf1'>&#xe62b</span>&nbsp;&nbsp",t=0;t<o.length;++t)l+=o[t]+", ";l=l.slice(0,-2)+"<br>"}if(u.length){for(l+="<span style='color:#a2733f'>&#xe635</span>&nbsp;&nbsp",t=0;t<u.length;++t)l+=u[t]+", ";l=l.slice(0,-2)+"<br>"}l+="</td></tr></i></table>";var h=this.DrawItem;function f(a){l+="<div class='sui-images'>",l+="<div style='width:calc(49% - 24px);display:inline-block;margin-right:16px;vertical-align:top;height:100%;'><table style='width:100%'>";try{l+=h(i.assets[e.asset_type].g,"CAPTION",e.caption,"Untitled")}catch(g){}l+="<tr><td colspan='2'><hr></td></tr>";try{l+=h("&#xe600","CREATOR",e.creator)}catch(g){}try{l+=h("&#xe66d","TYPE",a.field_image_type.und[0].value.charAt(0).toUpperCase()+a.field_image_type.und[0].value.slice(1))}catch(g){}try{l+=h("&#xe665","SIZE",e.img_width_s+" x "+e.img_height_s+" px")}catch(g){}l+="<tr><td colspan='2'><hr></td></tr>";try{for(l+="<p class='sui-pageLab'>",t=0;t<a.field_image_descriptions.und.length;++t)l+=a.field_image_descriptions.und[t].title+"<br>";l+="</p>"}catch(g){}try{l+=h("&#xe600",a.field_image_agents.und[0].field_agent_role.und[0].value.toUpperCase(),a.field_image_agents.und[0].title+" ("+i.pages.FormatDate(a.field_image_agents.und[0].field_agent_dates.und[0].value)+")")}catch(g){}try{l+="</table><p>",l+=a.field_image_descriptions.und[0].field_description.und[0].value+"<br></p>"}catch(g){}l+="</div><div style='width:49%;display:inline-block;vertical-align:top;border-left:1px solid #ddd;padding-left:16px'><br><table style='width:100%'>";try{l+=h("&#xe67f","ONLY DIGITAL",a.field_image_digital.und[0].value?"Yes":"No")}catch(g){}try{l+=h("&#xe67f","COLOR",a.field_image_color.und[0].value?"Yes":"No")}catch(g){}try{l+=h("&#xe67f","QUALITY",a.field_image_quality.und[0].value)}catch(g){}try{l+=h("&#xe67f","ROTATION",a.field_image_rotation.und[0].value+"&deg;")}catch(g){}try{l+=h("&#xe665","PHYSICAL&nbsp;SIZE",a.field_physical_size.und[0].value)}catch(g){}try{l+=h("&#xe659","CAPURE&nbsp;DEVICE",a.field_image_capture_device.und[0].value)}catch(g){}try{l+=h("&#xe65f","MATERIALS",a.field_image_materials.und[0].value)}catch(g){}try{l+=h("&#xe66c","ENHANCEMENT",a.field_image_enhancement.und[0].value)}catch(g){}try{l+="<tr><td>&#xe62B&nbsp;&nbsp;<span class='sui-pageLab'>LOCATION</span>:</td><td>"+a.field_longitude.und[0].value+"&nbsp;&nbsp;&nbsp;"+a.field_latitude.und[0].value+"</td></tr>"}catch(g){}try{l+=h("&copy;","COPYRIGHT&nbsp;HOLDER",a.field_copyright_holder.und[0].value)}catch(g){}try{l+=h("&copy;","COPYRIGHT&nbsp;STATEMENT",a.field_copyright_statement.und[0].value)}catch(g){}try{l+=h("&#xe614","ORIGINAL&nbsp;FILE",a.field_original_filename.und[0].value)}catch(g){}try{l+=h("&#xe678","TECHNICAL&nbsp;NOTES",a.field_technical_notes.und[0].value)}catch(g){}try{l+=h("&#xe639","UPLOADED&nbsp;BY",e.node_user_full_s)}catch(g){}try{l+=h("&#xe67f","LICENSE","<a style='font-weight:400' target='_blank' href='"+a.field_license_url.und[0].value+"'>"+a.field_license_url.und[0].value+"</a>")}catch(g){}var s=e.img_height_s/e.img_width_s;l+="</table><p class='sui-pageLab' style='cursor:pointer' onclick='$(\"#sui-dlOps\").toggle()'>\n\t\t\t\t&#xe616&nbsp;&nbsp;<a>DOWNLOAD IMAGE</a>\n\t\t\t\t\t<div id='sui-dlOps' style='display:none;margin-left:24px;font-size:12px'>\t\t\t\n\t\t\t\t\t<a target='_blank' href='".concat(e.url_thumb.replace(/200,200/,e.img_width_s+","+e.img_width_s),"'\n\t\t\t\t\tstyle='display:inline-block;cursor:pointer'>Original (").concat(e.img_width_s,"x").concat(e.img_height_s,")</a><br>\n\t\t\t\t\t<a target='_blank' href='").concat(e.url_thumb.replace(/200,200/,"1200,1200"),"'\n\t\t\t\t\tstyle='display:inline-block;cursor:pointer'>Large (1200x").concat(1200*s,"))</a><br>\n\t\t\t\t\t<a target='_blank' href='").concat(e.url_thumb.replace(/200,200/,"800,800"),"'\n\t\t\t\t\tstyle='display:inline-block;cursor:pointer'>Medium (800x").concat(800*s,")</a><br>\n\t\t\t\t\t<a target='_blank' href='").concat(e.url_thumb.replace(/200,200/,"400,400"),"'\n\t\t\t\t\tstyle='display:inline-block;cursor:pointer'>Small (400x").concat(400*s,')</a>\n\t\t\t\t\t<p><i>Right-click and select "Download/Save Linked File"</i></p>\n\t\t\t\t\t</div>\n\t\t\t\t</p></div></div></div>'),p()(i.pages.div).append(l.replace(/\t|\n|\r/g,"")),p()("#sui-imgCol").on("click",(function(){return i.GetKmapFromID(e.collection_uid_s,(function(e){i.SendMessage("",e)})),!1}))}p()("[id^=sui-pageThumb-]").on("click",(function(e){var t=e.currentTarget.id.split("-")[2];i.pages.Draw(i.curResults[t])})),p()("#sui-picEnlarge").on("click",(function(){var e,t,a,s,i=p()("#sui-legacy")[0],l=p()(n.div).width()/2*r;if(p()("#sui-imagesBox").css({"padding-top":"12px"}),p()("#sui-imageDiv").css({width:"100%",height:p()("#sui-legacy").height()+"px"}),p()("#sui-picEnlarge").html().match(/Zoom/))return p()("#sui-picEnlarge").html("&#xe650"),p()("#sui-thisPic").offset(p()("#sui-imageDiv").offset()),p()("#sui-imageDiv").css({width:"50%",height:l+"px"}),p()("#sui-imagesBox").css({"padding-top":"60px"}),void(i.onmousedown=i.onwheel=null);p()("#sui-picEnlarge").html("Zoom &nbsp; &#xe651  &nbsp; out "),p()("#sui-thisPic").css("width","auto"),i.style.cursor="grab",i.onwheel=function(t){(t=t||window.event).preventDefault(),e=p()("#sui-thisPic").offset(),p()("#sui-thisPic").offset({left:(t.deltaX?t.deltaX:0)/5+e.left,top:(t.deltaY?t.deltaY:0)/3+e.top})},i.onmousedown=function(n){(n=n||window.event).preventDefault(),e=n.pageX,t=n.pageY,a=p()("#sui-thisPic").offset().left,s=p()("#sui-thisPic").offset().top,i.onmousemove=function(n){(n=n||window.event).preventDefault();var i=n.pageX-e,r=n.pageY-t;p()("#sui-thisPic").offset({left:a+i,top:s+r})},i.onmouseup=function(e){i.onwheeel=i.onmouseup=i.onmousemove=null}}}))}},{key:"DrawItem",value:function(e,t,a,s,n,i){var r,l="<tr><td>";if(null==a||void 0==a||""==a)return"";if(e&&(l+=e+"&nbsp;&nbsp;"),l+="<span class='sui-pageLab'",i&&(l+=" style='font-weight:600'"),l+=">"+t+":&nbsp;&nbsp;</span>",l+="</td><td><span class='",l+=(n||"sui-pageVal")+"'>","object"==typeof a)for(r=0;r<a.length;++r)a[r].header?l+=a[r].header:a[r].value?l+=a[r].value:a[r].val?l+=a[r].val:a[r].title?l+=a[r].title:l+=a[r],r!=a.length-1&&(l+=", ");else l+=a&&!a.match(/undefined/)?a:s;return l+"</span></td></tr>"}}]),e}(),b=function(){function e(t){if(Object(l.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.sui=t,this.div=t.pages.div,this.content=["...loading","...loading","...loading"]}return Object(c.a)(e,[{key:"Draw",value:function(e){var t=this;console.error("texts.Draw()");var a=this.sui,s=this;p()(".shanti-texts-section-content").length||p()("<link/>",{rel:"stylesheet",type:"text/css",href:"https://texts-dev.shanti.virginia.edu/sites/all/themes/shanti_sarvaka_texts/css/shanti_texts.css"}).appendTo("head");var n=e.url_ajax.replace(/node_ajax/i,"node_embed")+"?callback=pfunc";p()(this.div).html();p()(this.div).html("<div id='sui-textCon' class='sui-texts'></div>\n\t\t<div style='display:inline-block;width:calc(34% + 3px);margin-left:-8px;vertical-align:top'>\n\t\t<div class='sui-textTop' id='sui-textTop'>\n\t\t\t<div class='sui-textTab' id='sui-textTab0'>CONTENTS</div>\n\t\t\t<div class='sui-textTab' id='sui-textTab1'>DESCRIPTION</div>\n\t\t\t<div class='sui-textTab' id='sui-textTab2'>VIEWS</div>\n\t\t</div>\n\t\t<div class='sui-textContent' id='sui-textContent'></div></div>".replace(/\t|\n|\r/g,"")),a.LoadingIcon(!0,64),p.a.ajax({url:n,dataType:"jsonp"}).done((function(n){a.LoadingIcon(!1),p()("#sui-textCon").html(n),p()("#shanti-texts-container").height(p()("#c-columnContent__main").height()-80),p()("#shanti-texts-body").height(p()("#sui-content").height()-110),t.content[0]=p()("#shanti-texts-toc").html(),p()("#shanti-texts-sidebar").remove(),r(0),p()("#shanti-texts-container").append("xxxxxxxxxxxxx<br><br>"),p()(".kmap-tag-group").each((function(){var e=p()(this).data("kmdomain"),t=e+"-"+p()(this).data("kmid"),s='<span style=\'font-family:"Open Sans",shanticon;color:'.concat(a.assets[e].c,"'>\n\t\t\t\t\t").concat(a.assets[e].g,"&nbsp;</span>\n\t\t\t\t\t").concat(p()(this.children[0]).text(),"\n\t\t\t\t\t").concat(a.pages.AddPop(t),"&nbsp;&nbsp;");p()(this.children[0]).html(s.replace(/\t|\n|\r/g,""))}));var i="<p><strong>ALTERNATIVE FORMATS</strong></p>\n\t\t\t<p>&nbsp;&nbsp;&nbsp;&nbsp;<a target='_blank' href='https://texts.shanti.virginia.edu/book_pubreader/".concat(e.id,"'>&#xe678&nbsp;&nbsp;View in PubReader</a></p>\n\t\t\t<p>&nbsp;&nbsp;&nbsp;&nbsp;<a target='_blank' href='https://texts.shanti.virginia.edu/shanti_texts/voyant/").concat(e.id,"'>&#xe678&nbsp;&nbsp;View in Voyant</a></p>\n\t\t\t<p>&nbsp;&nbsp;&nbsp;&nbsp;<a target='_blank' href='https://texts.shanti.virginia.edu/shanti_texts/node_ajax_text/").concat(e.id,"'>&#xe678&nbsp;&nbsp;View as raw text</a></p>");function r(t){p()("#sui-textContent").html("<div class='sui-sourceText' style='font-size:18px;color:#000'>"+e.title+"<div><hr>"),p()("[id^=sui-textTab]").css({"background-color":"#eee"}),p()("#sui-textTab"+t).css({"background-color":"#fff"}),p()("#sui-textContent").append(s.content[t]),p()("#sui-txtCol").off("click"),p()("#sui-txtCol").on("click",(function(){return a.GetKmapFromID(e.collection_uid_s,(function(e){a.SendMessage("",e)})),!1}))}t.content[2]=i.replace(/\t|\n|\r/g,""),a.GetJSONFromKmap(e,(function(s){var n,r="";r+="<table style='width:100%'>";try{i="<a title='Collection' id='sui-txtCol' href='#p=".concat(e.collection_uid_s,"'>").concat(e.collection_title,"</a>").concat(a.pages.AddPop(e.collection_uid_s)),e.collection_title&&(r+=t.DrawItem("&#xe633","COLLECTION",i))}catch(l){}r+=t.DrawItem("&#xe67c","VISIBILITY","Public - accessible to all site users"),e.summary&&(r+="<tr><hr><td colspan='2' style='max-width:"+p()("#c-columnContent__main").width()/4+"px'>"+e.summary+"<hr><td></tr>");try{r+=t.DrawItem("&#xe600","AUTHOR",s.field_book_author.und,"","sui-pageLab")}catch(l){}try{r+=t.DrawItem("&#xe675","EDITOR",s.field_book_editor.und,"","sui-pageLab")}catch(l){}try{r+=t.DrawItem("&#xe633","YEAR&nbsp;PUBLISHED",s.field_dc_date_publication_year.und[0].value.substr(0,4),"sui-pageLab")}catch(l){}try{r+=t.DrawItem("&#xe633","ORIGINAL&nbsp;YEAR PUBLISHED",s.field_dc_date_orginial_year.und[0].value.substr(0,4),"sui-pageLab")}catch(l){}if(s.field_kmap_places&&s.field_kmap_places.und){for(r+="<tr><td style='vertical-align:top'><span class='sui-pageLab'>&#xe62b&nbsp;&nbspPLACES:</td><td>",n=0;n<s.field_kmap_places.und.length;++n)r+=s.field_kmap_places.und[n].header,r+=a.pages.AddPop(s.field_kmap_places.und[n].domain+"-"+s.field_kmap_places.und[n].id),n<s.field_kmap_places.und.length-1&&(r+="<br>");r+="</td></tr>"}if(s.field_kmap_subjects&&s.field_kmap_subjects.und){for(r+="<tr><td style='vertical-align:top'><span class='sui-pageLab'>&#xe634&nbsp;&nbspPLACES:</td><td>",n=0;n<s.field_kmap_subjects.und.length;++n)r+=s.field_kmap_subjects.und[n].header,r+=a.pages.AddPop(s.field_kmap_subjects.und[n].domain+"-"+s.field_kmap_subjects.und[n].id),n<s.field_kmap_subjects.und.length-1&&(r+="<br>");r+="</td></tr>"}if(s.field_kmap_terms&&s.field_kmap_terms.und){for(r+="<tr><td style='vertical-align:top'><span class='sui-pageLab'>&#xe635&nbsp;&nbspTERMS:</td><td>",n=0;n<s.field_kmap_terms.und.length;++n)r+=s.field_kmap_terms.und[n].header,r+=a.pages.AddPop(s.field_kmap_termss.und[n].domain+"-"+s.field_kmap_terms.und[n].id),n<s.field_kmap_terms.und.length-1&&(r+="<br>");r+="</td></tr>"}try{r+=t.DrawItem("&#xe674","TRANSLATOR",s.field_book_translator.und,"sui-pageLab")}catch(l){}try{r+=t.DrawItem("&#xe670","LANGUAGE",s.field_dc_language_original.und,"sui-pageLab")}catch(l){}try{r+=t.DrawItem("&copy;","RIGHTS",s.field_dc_rights_general.und,"sui-pageLab")}catch(l){}r+="</table>",t.content[1]=r.replace(/\t|\n|\r/g,"");try{t.content[2]+="<p>&nbsp;&nbsp;&nbsp;&nbsp;<a target='_blank' href='"+s.field_pdf_version.und[0].url+"'>&#xe678&nbsp;&nbsp;View as PDF</a></p>"}catch(l){}})),p()("[id^=sui-textTab]").on("click",(function(e){r(e.currentTarget.id.substring(11))}))}))}},{key:"DrawItem",value:function(e,t,a,s,n,i){var r,l="<tr><td>";if(null==a||void 0==a||""==a)return"";if(e&&(l+=e+"&nbsp;&nbsp;"),l+="<span class='sui-pageLab'",i&&(l+=" style='font-weight:600'"),l+=">"+t+":&nbsp;&nbsp;</span>",l+="</td><td><span class='",l+=(n||"sui-pageVal")+"'>","object"==typeof a)for(r=0;r<a.length;++r)a[r].header?l+=a[r].header:a[r].value?l+=a[r].value:a[r].val?l+=a[r].val:a[r].title?l+=a[r].title:l+=a[r],r!=a.length-1&&(l+=", ");else l+=a&&!a.match(/undefined/)?a:s;return l+"</span></td></tr>"}}]),e}(),y=function(){function e(t){if(Object(l.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.sui=t,this.div=t.pages.div}return Object(c.a)(e,[{key:"Draw",value:function(e){var t=this.sui,a="<div class='sui-sources' id='sui-sources'>\n\t\t<span style='font-size:24px;color:".concat(t.assets[e.asset_type].c,";vertical-align:-4px'>").concat(t.assets[e.asset_type].g,"</span>\n\t\t&nbsp;&nbsp;<span class='sui-sourceTitle'>").concat(e.title[0],"</span>\n\t\t<hr style='border-top: 1px solid ").concat(t.assets[e.asset_type].c,"'>\n\t\t<div class='sui-sourceSec' id='sui-srcSec'></div><br>");e.creator&&e.creator.length&&(a+="<span class='sui-pageLab' style='color:".concat(t.assets[e.asset_type].c,"'>&#xe600</span>\n\t\t\t&nbsp;&nbsp;").concat(e.creator.join(", "),"<br><br>")),e.url_thumb&&!e.url_thumb.match(/gradient.jpg/)&&(a+="<img src='"+e.url_thumb+"' style='float:right;width:33%; padding:0 0 12px 12px'>"),e.collection_title&&(a+="<p>COLLECTION:&nbsp;&nbsp<a id='sui-imgCol' href='#p=".concat(e.collection_uid_s,"'>").concat(e.collection_title,"</a></p>")),e.asset_subtype&&(a+="<p>FORMAT:&nbsp;&nbsp<span class='sui-sourceText'>"+e.asset_subtype+"</span></p>"),a+="<p class='sui-pageLab' id='sui-p2'>PUBLICATION YEAR:&nbsp;&nbsp<span class='sui-sourceText' id='sui-srcYear'></span>",e.publisher_s&&(a+="<p>PUBLISHER:&nbsp;&nbsp<span class='sui-sourceText'>"+e.publisher_s+"</span></p>"),a+="<p class='sui-pageLab' id='sui-p3'>PLACE OF PUBLICATION:&nbsp;&nbsp<span class='sui-sourceText' id='sui-srcPlc'></span>",a+="<p class='sui-pageLab' id='sui-p1'>PAGES:&nbsp;&nbsp<span class='sui-sourceText' id='sui-srcPages'></span>",a+="<p class='sui-pageLab'>SOURCE ID:&nbsp;&nbsp<span class='sui-sourceText'>sources-"+e.id+"</span></p>",e.summary&&(a+="<p>ABSTRACT:<div class='sui-sourceText'>"+e.summary+"</div></p>"),a+="</div>",p()(this.div).html(a.replace(/\t|\n|\r/g,"")),t.pages.DrawRelatedAssets(),p()("#sui-imgCol").on("click",(function(){return t.GetKmapFromID(e.collection_uid_s,(function(e){t.SendMessage("",e)})),!1})),t.GetJSONFromKmap(e,(function(e){var a,s="";if(e.biblio_pages?p()("#sui-srcPages").html(e.biblio_pages):p()("#sui-sp1").hide(),e.biblio_year?p()("#sui-srcYear").html(e.biblio_year):p()("#sui-sp2").hide(),e.biblio_secondary_title?p()("#sui-srcSec").html(e.biblio_secondary_title):p()("#sui-srcSec").hide(),e.biblio_place_published?p()("#sui-srcPlc").html(e.biblio_place_published):p()("#sui-sp3").hide(),e.field_kmaps_subjects&&e.field_kmaps_subjects.und){for(s+="<p class='sui-pageLab'>SUBJECTS:&nbsp;&nbsp;",a=0;a<e.field_kmaps_subjects.und.length;++a)s+=e.field_kmaps_subjects.und[a].header,s+=t.pages.AddPop(e.field_kmaps_subjects.und[a].domain+"-"+e.field_kmaps_subjects.und[a].id),a<e.field_kmaps_subjects.und.length-1&&(s+=", ");s+="</p>"}if(e.field_kmaps_places&&e.field_kmaps_places.und){for(s+="<p class='sui-pageLab'>TERMS:&nbsp;&nbsp;",a=0;a<e.field_kmaps_places.und.length;++a)s+=e.field_kmaps_places.und[a].header,s+=t.pages.AddPop(e.field_kmaps_places.und[a].domain+"-"+e.field_kmaps_places.und[a].id),a<e.field_kmaps_places.und.length-1&&(s+=", ");s+="</p>"}if(e.field_kmap_terms&&e.field_kmap_terms.und){for(s+="<p class='sui-pageLab'>TERMS:&nbsp;&nbsp;",a=0;a<e.field_kmap_terms.und.length;++a)s+=e.field_kmap_terms.und[a].header,s+=t.pages.AddPop(e.field_kmap_terms.und[a].domain+"-"+e.field_kmap_terms.und[a].id),a<e.field_kmap_terms.und.length-1&&(s+=", ");s+="</p>"}e.biblio_url&&(s+="<p class='sui-pageLab'>URL:&nbsp;&nbsp;<a target='_blank' href='"+e.biblio_url+"'>"+e.biblio_url+"</a></p>"),p()("#sui-sources").append(s)}))}}]),e}(),E=function(){function e(t){if(Object(l.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.sui=t,this.div=t.pages.div}return Object(c.a)(e,[{key:"Draw",value:function(e){var t=this.sui;t.GetJSONFromKmap(e,(function(e){n(e)}));var a="//visuals.shanti.virginia.edu/sites/all/libraries/SHIVA/go.htm?m=//visuals.shanti.virginia.edu/data/json/";a+=e.id;var s=t.pages.DrawItem;function n(n){var i,r=p.a.parseJSON(n.shivanode_json.und[0].value),l=r.width?r.width+"px":"100%",c=r.height?r.height+"px":"calc(100% - 155px)",o=r.dataSourceUrl?r.dataSourceUrl:"",d="<iframe id='sui-iframe' frameborder='0' scrolling='no' src='".concat(a,"' \n\t\t\tstyle='margin-left:auto;margin-right:auto;height:").concat(c,";width:").concat(l,";display:block;overflow:hidden'></Iframe><br>");d+="<div class='sui-sources' style='padding-top:0'>";try{i=e.collection_title?"<a title='Collection' id='sui-imgCol'\thref='#p=".concat(e.collection_uid_s,"'>").concat(e.collection_title,"</a>"):"None"}catch(f){}d+="<div style='text-align:center'>"+s("&#xe633","MANDALA COLLECTION",i)+"</div>",d+="<hr style='border-top: 1px solid #6e9456;margin-top:12px'>";try{d+=s("&#xe63b","TITLE",e.title[0],"Untitled")}catch(f){}try{d+=s("&#xe65f","TYPE",e.asset_subtype.replace(/:/g," | "))}catch(f){}try{d+=s("&#xe60c","DATE",e.node_created.substr(0,10))}catch(f){}try{d+="&#xe600&nbsp;&nbsp;<span class='sui-pageLab'>CREATOR</span>:&nbsp;&nbsp;<span class='sui-pageVal'>",d+=e.node_user_full?e.node_user_full+"&nbsp;&nbsp":"",d+=e.node_user?e.node_user:"",d+="</span>"}catch(f){}if(n.field_kmaps_subjects&&n.field_kmaps_subjects.und){d+="<p class='sui-pageLab'>SUBJECTS:&nbsp;&nbsp;";for(var u=0;u<n.field_kmaps_subjects.und.length;++u)d+=n.field_kmaps_subjects.und[u].header,d+=t.pages.AddPop(n.field_kmaps_subjects.und[u].domain+"-"+n.field_kmaps_subjects.und[u].id),u<n.field_kmaps_subjects.und.length-1&&(d+=", ");d+="</p>"}if(n.field_kmaps_places&&n.field_kmaps_places.und){d+="<p class='sui-pageLab'>TERMS:&nbsp;&nbsp;";for(var m=0;m<n.field_kmaps_places.und.length;++m)d+=n.field_kmaps_places.und[m].header,d+=t.pages.AddPop(n.field_kmaps_places.und[m].domain+"-"+n.field_kmaps_places.und[m].id),m<n.field_kmaps_places.und.length-1&&(d+=", ");d+="</p>"}if(n.field_kmap_terms&&n.field_kmap_terms.und){d+="<p class='sui-pageLab'>TERMS:&nbsp;&nbsp;";for(var h=0;h<n.field_kmap_terms.und.length;++h)d+=n.field_kmap_terms.und[h].header,d+=t.pages.AddPop(n.field_kmap_terms.und[h].domain+"-"+n.field_kmap_terms.und[h].id),h<n.field_kmap_terms.und.length-1&&(d+=", ");d+="</p>"}o&&(d+="<p>&#xe678&nbsp;&nbsp;<a target='_blank' href='"+o+"'>External spreadsheet</a></p>"),e.caption&&(d+=e.caption);'[iframe src="'.concat(a,'" width="').concat(l,'" height="').concat(c,'"]'),'&lt;iframe src="'.concat(a,'" width="').concat(l,'" height="').concat(c,'"&gt;');d+="<hr>&#xe600&nbsp;&nbsp;<span class='sui-pageLab'>SHARE AS</span>:&nbsp;&nbsp;\n\t\t\t\t<a id='sui-share-1' style='display:inline-block;cursor:pointer'>Link&nbsp;&nbsp;&nbsp;</a>\n\t\t\t\t<a id='sui-share-2' style='display:inline-block;cursor:pointer'>WordPress&nbsp;&nbsp;&nbsp;</a>\n\t\t\t\t<a id='sui-share-3' style='display:inline-block;cursor:pointer'>Iframe&nbsp;&nbsp;&nbsp;</a>\n\t\t\t\t<p id='sui-resShare' style='border-radius:4px;background-color:#fff;padding:8px;display:none;border:1px solid #ccc'></p>\n\t\t\t\t</div>",p()("#sui-resShare").html("<strong>LINK</strong>: ${url}"),p()("#sui-resShare").toggle(),p()(t.pages.div).html(d.replace(/\t|\n|\r/g,"")),t.pages.DrawRelatedAssets(e),p()("[id^=sui-share-]").on("click",(function(e){var t=e.currentTarget.id.split("-")[2];"1"==t?p()("#sui-resShare").html(a):"2"==t?p()("#sui-resShare").html('[iframe src="'.concat(a,'" width="').concat(l,'" height="').concat(c,'"]')):"3"==t&&p()("#sui-resShare").html('&lt;iframe src="'.concat(a,'" width="').concat(l,'" height="').concat(c,'"&gt;')),p()("#sui-resShare").show()}))}}}]),e}(),k=function(){function e(t){if(Object(l.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.sui=t,this.div=t.pages.div,this.recordingGroup=0,this.tabs=[],this.tagged=[],this.kmap=null}return Object(c.a)(e,[{key:"Draw",value:function(e){var t=this,a=this.sui,s=[""];this.kmap=e;var n="<div class='c-content__main__kmaps' id='sui-terms' style=''>\n\t\t<span class='sui-termIcon'>".concat(a.assets[e.asset_type].g,"</span>&nbsp;&nbsp;&nbsp;\n\t\t<span class='sui-termTitle' id='sui-termTitle'>").concat(e.title[0],"</span>\n\t\t<hr style='border-top: 1px solid ").concat(a.assets[e.asset_type].c,"'>\n\t\t<p id='sui-termNames'>Names</p>\n\t\t<div id='sui-player' style='display:none'>\n\t\t<p><div class='sui-termPlay' id='sui-termPlay'>&#xe60a</div>\n\t\t<select class='sui-termSpeak unpopulated' id='sui-termGroup'><option>AMDO GROUP</option></select></p></div>");n+="<div id='sui-termDetails'></div>",n+="<div id='sui-termDefs' class='sui-termOther'></div>",n+="<br><div class='sui-termOHead'>OTHER DICTIONARIES</div>",n+="<div id='sui-termOther' class='sui-termOther' style='padding:0 24px'></div></div>",p()(this.div).html(n.replace(/\t|\n|\r/g,"")),this.tabs=[],this.SetTabContent(e),p()("#sui-termPlay").off("click").on("click",(function(e){new Audio(s[t.recordingGroup]).play()})),p()("#sui-termGroup").off("change").on("change",(function(e){t.recordingGroup=p()("#sui-termGroup").prop("selectedIndex")})),a.GetAudioFromID(e.id,(function(e){s=e,e.length&&p()("#sui-player").slideDown(),e.length>1&&p()("#sui-termGroup.unpopulated").append("<option>KHAM-HOR GROUP</option>"),e.length>2&&p()("#sui-termGroup.unpopulated").append("<option>CENTRAL TIBET DIALECT</option>"),p()("#sui-termGroup.unpopulated").removeClass("unpopulated")})),a.pages.DrawRelatedAssets(e)}},{key:"SetTabContent",value:function(e){var t=this,a=this.sui;a.GetChildDataFromID(e.uid,(function(s){var n,i,r=1,l=0,c="<br>",o="",d="<div style='height:2px'/>",u="<table>",m="";try{var h=s._childDocuments_;for(n=0;n<h.length;++n)h[n].id.match(/_definitions-/)&&(h[n].related_definitions_source_s?(c+="<div>"+r+++". <i>"+h[n].related_definitions_source_s+"</i></div>",c+="<p class='termDefs'>",c+=h[n].related_definitions_content_s,c+="</p><div class='sui-termData'>",h[n].related_definitions_author_s&&(c+="AUTHOR: "+h[n].related_definitions_author_s+" | "),c+="LANGUAGE: "+h[n].related_definitions_language_s,c+="</div><br><hr style='border-top:1px solid #a2733f'>"):(o+=t.DrawTabMenu(l++,[l+".&nbsp;&nbsp;DEFINITION","DETAILS","PASSAGES (0)","RESOURCES (0)"]),(i=["","<br>","<br>Waiting for data from Derik...<br><br><br><br>","<br>"])[0]+="<div class='termDefs'>",i[0]+=h[n].related_definitions_content_s,i[0]+="</div><div class='sui-termData'>",h[n].related_definitions_author_s&&(i[0]+="AUTHOR: "+h[n].related_definitions_author_s+" | "),i[0]+="LANGUAGE: "+h[n].related_definitions_language_s+"</div><br><br>",h[n]["related_definitions_branch_subjects-185_header_s"]&&(i[1]+=h[n]["related_definitions_branch_subjects-185_header_s"].toUpperCase(),i[1]+=": <i>"+h[n]["related_definitions_branch_subjects-185_subjects_headers_t"]+"</i>",i[1]+=a.pages.AddPop(h[n]["related_definitions_branch_subjects-185_subjects_uids_t"][0])+"<br>"),i[1]+="LANGUAGE: <i>"+h[n].related_definitions_language_s+"</i>",h[n]["related_definitions_branch_subjects-184_subjects_uids_t"]&&(i[1]+=a.pages.AddPop(h[n]["related_definitions_branch_subjects-184_subjects_uids_t"][0])+"<br>"),h[n]["related_definitions_branch_subjects-5855_header_s"]&&(i[1]+=h[n]["related_definitions_branch_subjects-5855_header_s"].toUpperCase(),i[1]+=": <i>"+h[n]["related_definitions_branch_subjects-5855_subjects_headers_t"]+"</i>",i[1]+=a.pages.AddPop(h[n]["related_definitions_branch_subjects-5855_subjects_uids_t"][0])+"<br>"),i[1]+="<br>",t.tabs.push(i))),h[n].id.match(/_names-/)&&(m||(m=h[n].related_names_header_s),u+="<tr><td <td style='padding-left:".concat(16*h[n].related_names_level_i,"px'>> <strong>").concat(h[n].related_names_header_s,"&nbsp;&nbsp;&nbsp;</strong></td><td>\n\t\t\t\t\t\t<i>").concat(h[n].related_names_language_s,", ").concat(h[n].related_names_writing_system_s,", ").concat(h[n].related_names_relationship_s,"\n\t\t\t\t\t\t</i></td></tr>"),c+="</table><br>"),p()("#sui-termNames").html(u+"</table>"),p()("#sui-termTitle").html("".concat(m,"&nbsp;&nbsp;&nbsp;").concat(e.title[0]))}catch(g){throw g}if(a.GetDefinitionAssets(e.uid,(function(e){var s,n,i,r,l,c,o,d,u=[];if(!e)return"";if(!e.length)return"";for(t.tagged=[],s=0;s<t.tabs.length;++s)t.tagged.push([]);for(s=0;s<e.length;++s)if("terms"!=(i=e[s]).asset_type)for(n=0;n<i.kmapid.length;++n)(l=i.kmapid[n].match(/_definitions-(\d*)/i))&&t.tagged[l[1]-1].push(i);for(s=0;s<t.tabs.length;++s){for(u.all=u.subjects=u.places=u.images=u.sources=u.visuals=u.collections=u.texts=u["audio-video"]=0,n=0;n<t.tagged[s].length;++n)u[t.tagged[s][n].asset_type]++,u.all++;for(n in r="",u)if(u[n]){r="<strong>Resources tagged with this definition: </strong><br>";break}for(n in u)u[n]&&(r+=(c=n,o=s,d=u[n],"<div id='sui-termAssetBut-".concat(o,"-").concat(c,"'\n\t\t\t\t\tclass='sui-termAssetBut' style='background-color:").concat(a.assets[c].c,"'>\n\t\t\t\t\t<span style='font-size:20px; vertical-align:-4px'>").concat(a.assets[c].g,"&nbsp;</span>").concat(c,"&nbsp;&nbsp;\n\t\t\t\t\t(").concat(d,")</div>").replace(/\t|\n|\r/g,"")));p()("#sui-tabTab-"+s+"-3").text("RESOURCES ("+u.all+")"),t.tabs[s][3]+=r}})),d="<table style='width:100%'><tr>",f("PHONEME",e.data_phoneme_ss),f("GRAMMARS",e.data_grammars_ss),d+="</tr><tr>",f("TOPICS",e.data_tibet_and_himalayas_ss),f("LITERARY PERIOD",e.data_literary_period_ss),d+="</tr><tr>",f("REGISTER",e.data_register_ss),f("LANGUAGE CONTEXT",e.data_language_context_ss),d+="</tr></table>",s.etymologies_ss&&s.etymologies_ss.length){for(d+="<br><strong>Etymology</strong><br><div class='sui-termDefs'>",n=0;n<s.etymologies_ss.length;++n)d+=s.etymologies_ss[n];c+="</div>"}for(p()("#sui-termDetails").html(d+"<br>"),p()("#sui-termDefs").html(o.replace(/\t|\n|\r/g,"")),p()("#sui-termOther").html(c.replace(/\t|\n|\r/g,"")),n=0;n<l;++n)t.ShowTab(n,0);function f(t,s){var n=0;if(s){if(e.kmapid_subjects_idfacet){for(n=0;n<e.kmapid_subjects_idfacet.length&&e.kmapid_subjects_idfacet[n].split("|")[0]!=s;++n);n=Math.min(e.kmapid_subjects_idfacet.length-1,n)}d+="<td>".concat(t,": <i>").concat(s,"</i>"),e.kmapid_subjects_idfacet?d+=a.pages.AddPop(e.kmapid_subjects_idfacet[n].split("|")[1])+"</td>":d+=a.pages.AddPop(e.related_uid_ss[n])+"</td>"}}}))}},{key:"DrawTabMenu",value:function(e,t){var a,s="";for(a=0;a<t.length;++a)s+="<div class='sui-tabTab' id='sui-tabTab-".concat(e,"-").concat(a,"' style='display:inline-block;text-align:left;padding-left:24px;width:calc(25% - 26px)'>\n\t\t\t").concat(t[a],"&nbsp;&#xe609</div>");return(s+="<div class='sui-tabContent' id='sui-tabContent-".concat(e,"'>hhh</div>")).replace(/\t|\n|\r|/g,"")}},{key:"ShowTab",value:function(e,t){var a=this,s=this.sui;p()("[id^=sui-tabTab-"+e).css({"background-color":"#999",color:"#fff","border-top":"1px solid #999"}),p()("#sui-tabContent-"+e).css({display:"block","background-color":"#eee"}),p()("#sui-tabTab-"+e+"-"+t).css({"background-color":"#eee",color:"#000","border-top":"1px solid #a2733f"}),p()("#sui-tabContent-"+e).html(this.tabs[e][t]),p()("[id^=sui-tabTab]").off(),p()("[id^=sui-termAssetBut-]").off(),p()("[id^=sui-termAssetBut-]").on("click",(function(e){var t,n=e.currentTarget.id.substring(17).split("-");if(s.ss.mode="related","audio"==n[1]&&(n[1]="audio-video"),s.pages.relatedType=n[1],s.pages.relatedBase=a.kmap,s.pagesrelatedId=s.pages.relatedBase.asset_type+"-"+s.pages.relatedBase.id,"all"==n[1])s.curResults=a.tagged[n[0]];else for(s.curResults=[],t=0;t<a.tagged[n[0]].length;++t)a.tagged[n[0]][t].asset_type==n[1]&&s.curResults.push(a.tagged[n[0]][t]);s.DrawResults()})),p()("[id^=sui-tabTab]").on("click",(function(e){var t=e.currentTarget.id.substring(11).split("-");a.ShowTab(t[0],t[1])}))}}]),e}(),w=function(){function e(t){if(Object(l.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.div=t.pages.div,this.content=["",""," "],this.sui=t}return Object(c.a)(e,[{key:"Draw",value:function(e){var t=this,a=this.sui,s=a.assets[e.asset_subtype.toLowerCase()],n="<div id='sui-topCon' style='margin-left:192px'>\n\t\t<div class='sui-sources'  id='sui-collections'>\n\t\t\t<span style='font-size:24px;color:".concat(s.c,";vertical-align:-4px'>").concat(s.g,"</span>\n\t\t\t&nbsp;&nbsp;<span class='sui-sourceTitle'>").concat(e.title[0],"</span>\n\t\t\t&nbsp;&nbsp;(").concat(e.asset_subtype.toUpperCase(),")\n\t\t\t<hr style='border-top: 1px solid ").concat(a.assets[e.asset_type].c,"'>\n\t\t\t<div class='sui-sourceSec' id='sui-srcSec'></div>");e.url_thumb&&!e.url_thumb.match(/gradient.jpg/)&&(n+="<img src='"+e.url_thumb+"' style='width:33%;padding-right:12px;vertical-align:top'>"),e.summary&&(n+="<div class='sui-sourceText' style='display:inline-block;width:calc(66% - 12px)'>".concat(e.summary,"</div>")),n+="<br>"+a.pages.DrawTabMenu(["RELATED COLLECTIONS","MEMBERS","DETAILS"])+"</div>",p()(this.div).html(n.replace(/\t|\n|\r/g,"")),p()("[id^=sui-tabTab]").on("click",(function(e){var a=e.currentTarget.id.substring(10);t.ShowTab(a)})),p()("#sui-imgCol").on("click",(function(){return a.GetKmapFromID(e.collection_uid_s,(function(e){a.SendMessage("",e)})),!1})),a.pages.DrawRelatedAssets(e),this.AddTabContent(e),this.ShowTab(0)}},{key:"AddTabContent",value:function(e){var t,a,s=this.sui,n=0;this.content[0]="<br>";var i=e.asset_subtype.toLowerCase()+"-collection-";try{e.collection_title_path_ss&&(a=e.collection_uid_path_ss,this.content[0]+="<div><a href='#p=".concat(a,"' id='sui-spItem-").concat(a,"+\"'>").concat(e.collection_title_path_ss,"</a></div>"),n++)}catch(r){}if(this.content[0]+="<div style='margin-left:".concat(24*n,"px'><strong>").concat(e.title[0],"</strong></div>"),e.subcollection_name_ss&&e.subcollection_name_ss.length)for(n++,t=0;t<e.subcollection_name_ss.length;++t)a=i+e.subcollection_id_is[t],this.content[0]+="<div style='margin-left:".concat(24*n,"px'><a  href='#p=").concat(a,"' id='sui-spItem-").concat(a,"+\"'>").concat(e.subcollection_name_ss[t],"</a></div>");if(this.content[0]+="<br><br>",this.content[1]="",e.members_name_ss&&e.members_name_ss.length){for(t=0;t<e.members_name_ss.length;++t)this.content[1]+="<br>"+e.members_name_ss[t]+" &nbsp; ("+e.members_id_ss[t]+")";this.content[1]+="<br><br>"}this.content[2]="<br>",e.node_user_full_s&&(this.content[2]+=s.pages.DrawItem("&#xe600","OWNER",e.node_user_full_s+" &nbsp; ("+e.node_user+")","","sui-pageLab",1)),e.collection_visibility_s&&(this.content[2]+=s.pages.DrawItem("&#xe622","VISIBILITY",e.collection_visibility_s.substr(0,1).toUpperCase()+e.collection_visibility_s.substr(1),"","sui-pageLab",1)),e.asset_subtype&&(this.content[2]+=s.pages.DrawItem(s.assets[e.asset_subtype.toLowerCase()].g,"TYPE",e.asset_subtype,"","sui-pageLab",1)),e.collection_title&&(this.content[2]+=s.pages.DrawItem(s.assets[e.asset_subtype.toLowerCase()].g,"COLLECTION","<a title='Collection' id='sui-imgCol'\thref='#p=".concat(e.collection_uid_s,"'>").concat(e.collection_title,"</a>"),"","sui-pageLab",1)),this.content[2]+="<br>"}},{key:"ShowTab",value:function(e){p()("[id^=sui-tabTab]").css({"background-color":"#999",color:"#fff"}),p()("#sui-tabContent").css({display:"block","background-color":"#eee"}),p()("#sui-tabTab"+e).css({"background-color":"#eee",color:"#000"}),p()("#sui-tabContent").html(this.content[e])}}]),e}(),x=function(){function e(t){if(Object(l.a)(this,e),!t)throw new Error("sui must be defined in constructor");this.sui=t,t.pages=this,this.div=p()("<div></div>"),this.reldiv=p()("<div></div>"),this.relatedBase=null,this.relatedType="Home",this.relatedId="",this.lastMode=t.ss.mode,this.curKmap=null,this.carouselTimer=null,t.plc=new f(t),t.av=new g(t),t.sub=new v(t),t.img=new _(t),t.txt=new b(t),t.src=new y(t),t.vis=new E(t),t.trm=new k(t),t.col=new w(t),this.recentPages=[],this.editing=!1,window.location.hash&&t.PageRouter(window.location.hash)}return Object(c.a)(e,[{key:"Draw",value:function(e,t){var a=this.sui;if(clearInterval(this.carouselTimer),e){t||a.SetState("p=".concat(e.uid)),this.curKmap=e,this.recentPages.push(e.uid+"|"+e.title+"|"+e.asset_type);var s,n=this.recentPages.length-1;for(s=n-1;s>=0;--s)if(this.recentPages[s]==this.recentPages[n]){this.recentPages.splice(s,1);break}"related"!=a.ss.mode&&this.DrawHeader(e),p()(this.div).css({"background-image":""}),p()(this.div).css({"padding-left":"12px",width:"calc(100% - 24px"}),p()(this.div).css({display:"block",color:"#000"}),"related"==a.ss.mode&&(e.asset_type.match(/places|subjects|terms/)||p()(this.div).css({"padding-left":"192px",width:"calc(100% - 216px"})),"places"==e.asset_type?a.plc.Draw(e):"sources"==e.asset_type?a.src.Draw(e):"terms"==e.asset_type?a.trm.Draw(e):"subjects"==e.asset_type?a.sub.Draw(e):"images"==e.asset_type?a.img.Draw(e):"audio-video"==e.asset_type?a.av.Draw(e):"texts"==e.asset_type?a.txt.Draw(e):"visuals"==e.asset_type?a.vis.Draw(e):"collections"==e.asset_type&&a.col.Draw(e)}}},{key:"ShowPopover",value:function(e,t){var a=this,s=this.sui;if((!e||!e.match(/collections-/))&&(!this.PopoverTimer||"mousemove"!=t.type)&&("mousemove"!=t.type||e!=this.lastPopover))return"mousedown"==t.type?("related"==s.ss.mode&&(s.ss.mode=this.lastMode),this.relatedBase=null,s.GetKmapFromID(e,(function(e){a.Draw(e)})),void this.ClearPopover()):void(this.PopoverTimer=setTimeout((function(){a.DisplayPopover(e,t)}),500))}},{key:"ClearPopover",value:function(){clearTimeout(this.PopoverTimer),this.PopoverTimer=null,p()("[id^=sui-popover-]").remove(),this.lastPopover=""}},{key:"DisplayPopover",value:function(e,t){var a,s,n=this,i=this.sui;clearTimeout(this.PopoverTimer),this.PopoverTimer=null,t.target?s=p()(t.target).offset():((s=p()("#plc-main").offset()).top+=t.y,s.left+=t.x);var r=Math.max(160,Math.min(s.left,p()("#sui-main").width()-200)),l=s.left-r+150,c=String(l)+"px";if(s.top){this.lastPopover=e,i.GetKmapFromID(e,(function(t){var l;if(t)if(t.error)console.error("Solr Callback for sui.GetKmapFromID (pages.js, line 201) returned error for kmap ".concat(e,": \n"),t.error.stack);else{p()("[id^=sui-popover-]").remove();var o=p()("#sui-main").scrollTop(),d="<div id='sui-popover-".concat(e,"' class='sui-popover' \n\t\t\tstyle='top:").concat(s.top+24+o,"px;left:").concat(r-150,"px'><div class='sui-popover-body'>\n\t\t\t<div style='position:absolute;width:0;height:0;border-left:8px solid transparent;\n\t\t\tborder-right:8px solid transparent;border-bottom:10px solid #999;top:-10px;\n\t\t\tleft:").concat(c,"'</div>\n\t\t\t<div style='position:absolute;width:0;height:0;border-left:8px solid transparent;\n\t\t\tborder-right:8px solid transparent;border-bottom:10px solid white;left:-8px;top:2px;'</div>\n\t\t\t</div>");if(p()("#sui-main").append(d.replace(/\t|\n|\r/g,"")),p()("#sui-main").one("click",(function(){n.ClearPopover()})),d="<div style='float:right;margin-top:-8px;font-size:10px'>".concat(t.id,"</div>\n\t\t\t<strong>").concat(t.title?t.title[0]:"untitled","</strong><hr style='border-top:1px solid #ccc'>\n\t\t\t<span style='font-size:12px;text-transform:capitalize'>\n\t\t\tFor more information about this ").concat(t.asset_type.slice(0,-1),", see Full Entry below.<p>"),t.feature_types_idfacet&&"places"==t.asset_type)for(d+="<strong>Feature types: </strong>",a=0;a<t.feature_types_idfacet.length;++a)l=t.feature_types_idfacet[a].split("|"),d+="<a class='sui-crumb' style='color:#000;text-transform:none' id='sui-crumb-".concat(l[1],"'\n\t\t\t\t\thref='#p=").concat(l[1],"'>").concat(l[0],"</a>"),a<t.feature_types_idfacet.length-1?d+=", ":d+="<br>";if(t.ancestors_txt&&t.ancestors_txt.length>1&&(d+="<strong>".concat(t.asset_type,": </strong>")),t.ancestors_txt)for(a=0;a<t.ancestors_txt.length-1;++a)d+="<a class='sui-crumb' style='color:#000;text-transform:none' id='sui-crumb-".concat(t.asset_type,"-").concat(t.ancestor_ids_is[a],"'\n\t\t\t\t\thref='#p=").concat(t.asset_type,"-").concat(t.ancestor_ids_is[a],"'>").concat(t.ancestors_txt[a],"</a>"),a<t.ancestors_txt.length-2&&(d+=" / ");d+="</p></span>",p()("#sui-popover-"+e).find(".sui-popover-body").eq(0).append(d.replace(/\t|\n|\r/g,""));var u="<div id='sui-popbot'> \n\t\t\t<a class='sui-popItem' href='#p=".concat(t.uid,"'>\n\t\t\t<p id='sui-full-").concat(t.uid,"'>&#xe629&nbsp;&nbsp;FULL ENTRY</p></a>\n\t\t\t</div>");p()("#sui-popover-"+e).append(u.replace(/\t|\n|\r/g,"")),p()("#sui-popover-"+e).on("mouseleave",(function(){n.ClearPopover()})),p()("#sui-full-"+e).on("click",(function(e){n.ClearPopover(),"related"==i.ss.mode&&(i.ss.mode=n.lastMode),n.relatedBase=null;var t=e.currentTarget.id.substring(9).toLowerCase();return i.GetKmapFromID(t,(function(e){i.SendMessage("",e)})),!1})),p()("[id^=sui-crumb-]").on("click",(function(e){n.ClearPopover(),"related"==i.ss.mode&&(i.ss.mode=n.lastMode),n.relatedBase=null;var t=e.currentTarget.id.substring(10).toLowerCase();return i.GetKmapFromID(t,(function(e){i.SendMessage("",e)})),!1}))}}));var o=i.solrUtil.createKmapQuery(e,null,null,300);p.a.ajax({url:o,dataType:"jsonp",jsonp:"json.wrf"}).done((function(t){var a,s,r="";if(!p()("[id^=sui-pop-]")[0]&&t.facets.asset_counts.buckets&&t.facets.asset_counts.buckets.length){var l=t.facets.asset_counts.buckets;for(a=0;a<l.length;++a)s=l[a].count,"texts:pages"!=l[a].val&&(s>1e3&&(s=Math.floor(s/1e3)+"K"),r+="<a class='sui-popItem' href='#v=".concat(e,"=").concat(l[a].val,"'>\n\t\t\t\t\t<p id='sui-pop-").concat(e,"-").concat(l[a].val,"' style='cursor:pointer;text-transform:capitalize'>\n\t\t\t\t\t<span style='color:").concat(i.assets[l[a].val].c,"'>").concat(i.assets[l[a].val].g,"</span>\n\t\t\t\t\t&nbsp;&nbsp;Related ").concat(l[a].val," (").concat(s,")</p></a>"));p()("#sui-popbot").append(r.replace(/\t|\n|\r/g,"")),p()("[id^=sui-pop-]").on("click",(function(t){n.ClearPopover();var a=t.currentTarget.id.toLowerCase().split("-");"audio"==a[4]&&(a[4]="audio-video");var s=i.solrUtil.createKmapQuery(a[2]+"-"+a[3],a[4],0,1e3);return p.a.ajax({url:s,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){i.curResults=i.MassageKmapData(e.response.docs),i.DrawItems(),i.DrawFooter(),i.ss.page=0})),i.GetKmapFromID(e,(function(e){n.relatedBase=e,n.relatedId=e.asset_type+"-"+e.id,n.DrawHeader(e)})),!1}))}}))}}},{key:"DrawRelatedAssets",value:function(e,t){var a,s,n=this,i=this.sui,r="",l=!0,c=this.relatedBase||e;if(c&&(l=c.asset_type.match(/places|subjects|terms|collections/)),"related"==i.ss.mode?e=this.relatedBase:this.lastMode=i.ss.mode,e&&(l||"related"==i.ss.mode)){if("collections"!=c.asset_type){var o=i.solrUtil.createKmapQuery(e.uid);p.a.ajax({url:o,dataType:"jsonp",jsonp:"json.wrf"}).done((function(t){var a,s,n=0;if(t.facets.asset_counts.buckets&&t.facets.asset_counts.buckets.length){var i=t.facets.asset_counts.buckets;for(a=0;a<i.length;++a)"texts:pages"!=i[a].val&&("terms"==e.asset_type&&"terms"==i[a].val||(n+=s=i[a].count,s>1e3&&(s=Math.floor(s/1e3)+"K"),p()("#sui-rln-"+i[a].val).html(s),p()("#sui-rl-"+i[a].val).css({display:"block"})));n>1e3&&(n=Math.floor(n/1e3)+"K"),p()("#sui-rln-all").html(n),p()("#sui-rl-all").css({display:"block"})}var r="#sui-btree-"+e.asset_type;p()("#sui-footer").offset()&&p()(r).offset()&&p()(r).css("max-height",p()("#sui-footer").offset().top-p()(r).offset().top-40+"px")}))}else l=!1,s=e.asset_subtype.toLowerCase();for(a in p()("#c-columnContent__main").scrollTop(0),p()(this.div).scrollTop(0),a=e.asset_type,r+="<div class='l-related__wrap' style='border-color:".concat("related"==i.ss.mode?i.assets[a].c:"transparent",";\n\t\t\theight:").concat(p()(this.div).height()+6,"px'>"),"related"!=i.ss.mode&&(r+="RELATED RESOURCES<hr>"),r+="<div class='c-relatedViewer'>",r+="<div class='c-related__item' id='sui-rl-Home'><span style='font-size:18px; vertical-align:-3px; color:"+i.assets[a].c+"'>"+i.assets[a].g+" </span> <b style='color:"+i.assets[a].c+"'>Home</strong></div>","collections"==c.asset_type&&(r+="<div class='c-related__item' id='sui-rl-"+s+"'><span style='font-size:18px; vertical-align:-3px; color:"+i.assets[s].c+"'>"+i.assets[s].g+" </span> "+e.asset_subtype+"</div>"),i.assets)r+="<a class='c-related__item' style='display:none' id='sui-rl-"+a.toLowerCase(),r+="' href='#r="+this.relatedId+"="+this.relatedId+"="+a+"="+e.uid+"'>",r+="<span style='font-size:18px; vertical-align:-3px; color:"+i.assets[a].c+"'>"+i.assets[a].g+"</span> ",r+=a.charAt(0).toUpperCase()+a.substr(1)+" (<span id='sui-rln-"+a.toLowerCase()+"'>0</span>)</a>";0,p()(this.reldiv).html(r.replace(/\t|\n|\r/g,"")),l&&this.DrawTree("#sui-btree-"+e.asset_type,e.asset_type),this.relatedType?p()("#sui-rl-"+this.relatedType).css({"background-color":"#f7f7f7"}):p()("#sui-rl-Home").css({"background-color":"#f7f7f7"}),p()("[id^=sui-rcItem-]").off("click"),p()("[id^=sui-rcItem-]").on("click",(function(e){var t=e.currentTarget.id.substring(11);return"related"==i.ss.mode&&(i.ss.mode=n.lastMode),n.relatedBase=null,i.GetKmapFromID(t,(function(e){i.SendMessage("",e)})),!1})),p()("[id^=sui-rl-]").on("click",(function(a){return alert("CLICKED RELATED LINK "+a.target),n.relatedType=a.currentTarget.id.substring(7),"Home"==n.relatedType?("related"==i.ss.mode&&(i.ss.mode=n.lastMode),n.Draw(n.relatedBase?n.relatedBase:e),n.relatedBase=null):"places"==c.asset_type&&"places"==n.relatedType?i.plc.Draw(e,4):"places"==c.asset_type&&"subjects"==n.relatedType?i.plc.Draw(e,3):"subjects"==c.asset_type&&"subjects"==n.relatedType?i.sub.Draw(e,1):"subjects"==c.asset_type&&"places"==n.relatedType?i.sub.Draw(e,2):(n.relatedBase||(n.relatedBase=e),n.DrawRelatedResults(e),t||i.SetState("r="+n.relatedId+"="+n.relatedBase.uid+"="+n.relatedType+"="+e.uid)),!1}))}}},{key:"DrawRelatedResults",value:function(e){e.uid&&e.uid;var t=this.sui;t.ss.mode="related",this.relatedBase||(this.relatedBase=e),this.relatedId=this.relatedBase.asset_type+"-"+this.relatedBase.id,t.Query(!1,"collections"==e.asset_type?e.uid:""),t.DrawFooter(),t.ss.page=0}},{key:"DrawHeader",value:function(e){}},{key:"AddRelTreeLine",value:function(e,t,a,s){var n=this.sui,i="<li style='margin:2px 0 2px ".concat(-24,"px'>");return i+=a?"<div class='sui-spDot' id='sui-spDot-".concat(s,"'>").concat(a,"</div>"):"<div class='sui-spLoner'><strong>&bull;&nbsp;&nbsp;</strong></div>",i+="<a class='sui-noA' href='#p=".concat(t,"' id='sui-spLab-").concat(t,"'>").concat(e,"</strong>").concat(n.pages.AddPop(t),"</a>")}},{key:"AddRelBranch",value:function(e,t,a){var s=this,n=this.sui,i=this;n.GetTreeChildren(e,t,(function(t){var n,r,l,c,o,d="",u=[];try{u=t.facets.child_counts.buckets}catch(m){}for(t=t.response.docs,n=0;n<t.length;++n){for(o="",c=null,l=new RegExp(t[n].id.split("-")[1]),r=0;r<u.length;++r)u[r].val.match(l)&&(c="+",o=u[r].val);d+="<ul style='list-style-type:none'>",d+=s.AddRelTreeLine(t[n].header,t[n].id,c,o)+"</li></ul>"}p()(a).prop("id","sui-spDot-null"),a.parent().append(d),p()("[id^=sui-spDot-]").off("click"),p()("[id^=sui-spDot-]").on("click",(function(t){var a=p()(this).parent().find("ul")[0],s=t.currentTarget.id.substring(10);"null"!=s?(p()(this).html("&ndash;"),i.AddRelBranch(e,s,p()(this))):p()(this).html("none"==p()(a).css("display")?"&ndash;":"+"),p()(this).parent().find("ul").slideToggle()}))}))}},{key:"DrawTabMenu",value:function(e){var t,a="";for(t=0;t<e.length;++t)a+="<div class='sui-tabTab' id='sui-tabTab".concat(t,"' style='width:calc(").concat(100/e.length,"% - 2px)'>").concat(e[t],"&nbsp;&#xe609</div>");return(a+="<div class='sui-tabContent' id='sui-tabContent'></div>").replace(/\t|\n|\r|/g,"")}},{key:"DrawCarousel",value:function(e){var t,a=this.sui,s=0,n="<div class='sui-caroBox'>\n\t\t<div class='sui-caroButL' id='sui-caroButL'>&#xe640</div>\n\t\t<div class='sui-caroButR' id='sui-caroButR'>&#xe641</div>\n\t\t<div class='sui-caroHeader'>&nbsp;</div>\n\t\t\t<div class='sui-caroLeft'>\n\t\t\t\t<div class='sui-caroTitle' id='sui-caroTitle'></div>\n\t\t\t\t<div class='sui-caroText' id='sui-caroText'></div>\n\t\t\t</div>\n\t\t\t<img class='sui-caroPic' id='sui-caroPic' src=''><br>\n\t\t\t<a class='sui-caroRes' id='sui-caroRes')' href='#p=".concat((e=[{title:"The Shinj\xe9 Yapyum Cham is performed",text:"One of the most common sacred masked dances performed during religious festivals in Bhutan is the Shinj\xe9 Yapyum Cham. The dance is often performed early during a festival\u2019s program as it is believed to subdue negative spirits and harmful influences. Although known as the Shinj\xe9 Yapyum Cham, or the Dance of the Male and Female Lords of Death, it represents the male and female Yam\u0101ntaka is the Destroyer of Death...",pic:"https://cicada.shanti.virginia.edu/images/mandala/shanti-image-550401/full/!600,/0/default.jpg",id:"images-stage_shanti_virginia_edu-1187696"},{title:"A Song Called Ja legmo Tsering",text:"Unlike today, meeting a person was extremely difficult in the past. The lyrics of this song say that meeting someone was considered as an act of fate. People would meet even if they had never thought of meeting that person. The composer wishes for two people who have met through fate, to stay together for their entire life...",pic:"https://cfvod.kaltura.com/p/381832/sp/38183200/thumbnail/entry_id/1_xvwn4fvx/version/100021/600/600/height/0",id:"audio-video-stage_shanti_virginia_edu-22741"},{title:"Tongue Twister in the Kheng Language",text:"In the past, parents taught their kids tongue twisters as a way to practice pronunciation. Rinchen Drakpa from Sharigang presents two tongue twisters in his local language, Khengkha. Rinchen Drakpa says that in his childhood he witnessed villagers competing to be the one who could say the tongue twisters with the most perfect pronunciation.",pic:"https://cfvod.kaltura.com/p/381832/sp/38183200/thumbnail/entry_id/0_ou7n6lp9/version/100021/600/600/height/0",id:"audio-video-stage_shanti_virginia_edu-3806"},{title:"Seven Limbs of Practice: Ch\xf6pa",text:"Most Bhutanese Buddhist rituals contain the set of seven practices known as yoen lak duen pa (\u0f61\u0f53\u0f0b\u0f63\u0f42\u0f0b\u0f56\u0f51\u0f74\u0f53\u0f0b\u0f54\u0f0b). The seven practices prostration (\u0f55\u0fb1\u0f42\u0f0b), offering (\u0f58\u0f46\u0f7c\u0f51\u0f0b\u0f54\u0f0b), confession (\u0f56\u0f64\u0f42\u0f66\u0f0b\u0f54\u0f0b), rejoicing (\u0f62\u0f97\u0f7a\u0f66\u0f0b\u0f66\u0f74\u0f0b\u0f61\u0f72\u0f0b\u0f62\u0f44\u0f0b\u0f56\u0f0b), request to live long (\u0f56\u0f5e\u0f74\u0f42\u0f66\u0f0b\u0f54\u0f62\u0f0b\u0f42\u0f66\u0f7c\u0f63\u0f0b\u0f56\u0f0b\u0f60\u0f51\u0f7a\u0f56\u0f66\u0f0b\u0f54\u0f0b), request to turn the wheel of Dharma (\u0f46\u0f7c\u0f66\u0f0b\u0f40\u0fb1\u0f72\u0f0b\u0f60\u0f41\u0f7c\u0f62\u0f0b\u0f63\u0f7c\u0f0b\u0f66\u0f90\u0f7c\u0f66\u0f90\u0f7c\u0f62\u0f0b\u0f56\u0f62\u0f0b\u0f56\u0f66\u0f90\u0f74\u0f63\u0f0b\u0f56\u0f0b) and to dedicate the merits (\u0f56\u0f66\u0f94\u0f7c\u0f0b\u0f56\u0f0b).This piece was initially published in Bhutan\u2019s national newspaper Kuensel..",pic:"https://mms.thlib.org/images/0050/8753/63691_large.jpg",id:"texts-stage_shanti_virginia_edu-38836"},{title:"A Story of a Rich and a Poor Girl",text:"Ap Tempo of Karna Gewog, Dagana narrates a story of a poor girl who is straight forward and faithful. Her rich friend was always insecure. The poor girl gets rewarded by a deity for her kind heart and good attitude; she suddenly becomes rich, and her rich friend became insecure about her. She tries to achieve what the poor girl has achieved, but gets punished due to her jealousy and greediness.",pic:"https://cfvod.kaltura.com/p/381832/sp/38183200/thumbnail/entry_id/1_607tfowl/version/100031/600/600/height/0",id:"audio-video-stage_shanti_virginia_edu-24651"},{title:"An Exchange of Tsangmo Poems",text:"Tsangmo is a type of song used to express individual's emotions, conveying their inner warmth and affection to another person, through numerious lyrical tunes. Tsangmo can be sung to express love, hatred and any other feelings. While it is sung, the Tsangmo songs are never sung with dance, as it is a poetry song for a singing expression without a dance. It is usually a composition limited to a verse of four lines for an expression.",pic:"https://cfvod.kaltura.com/p/381832/sp/38183200/thumbnail/entry_id/1_zk9hsnff/version/100011/609/600/height/0",id:"audio-video-stage_shanti_virginia_edu-22596"}])[s].id,"'>\n\t\t\t<i>View Resource</i>&nbsp;&nbsp;&#xe683</a>\n\t\t\t<div class='sui-caroDots'>");for(t=0;t<e.length;++t)n+="<div class='sui-caroDot' id='sui-caroDot-".concat(t,"'></div>");function i(t){p()("#sui-caroTitle").html("&#xe633&nbsp;&nbsp;"+e[t].title),p()("#sui-caroText").html(e[t].text),p()("#sui-caroPic").prop("src",e[t].pic),p()("[id^=sui-caroDot-]").css({"background-color":"#fff"}),p()("#sui-caroDot-"+t).css({"background-color":"#5d68cc"})}n+="</div></div>",p()(this.div).append(n.replace(/\t|\n|\r/g,"")),clearInterval(this.carouselTimer),this.carouselTimer=setInterval((function(){p()("#sui-caroButR").trigger("click")}),8e3),i(s),p()("#sui-caroRes").on("click",(function(t){return a.GetKmapFromID(e[s].id,(function(e){a.SendMessage("",e)})),!1})),p()("#sui-caroButL").on("click",(function(t){i(s=s?s-1:e.length-1)})),p()("#sui-caroButR").on("click",(function(t){i(s=s==e.length-1?0:s+1)})),p()("[id^=sui-caroDot-]").on("click",(function(t){s=t.target.id.substring(12),i(s=Math.min(e.length-1,Math.max(s,0)))}))}},{key:"DrawItem",value:function(e,t,a,s,n,i){var r,l="<p>";if(null==a||void 0==a)return"";if(e&&(l+=e+"&nbsp;&nbsp;"),l+="<span class='sui-pageLab'",i&&(l+=" style='font-weight:600'"),l+=">"+t+":&nbsp;&nbsp;</span>",l+="<span class='",l+=(n||"sui-pageVal")+"'>","object"==typeof a)for(r=0;r<a.length;++r)a[r].header?l+=a[r].header:a[r].value?l+=a[r].value:a[r].val?l+=a[r].val:a[r].title?l+=a[r].title:l+=a[r],r!=a.length-1&&(l+=", ");else l+=a&&!a.match(/undefined/)?a:s;return l+"</span></p>"}},{key:"FormatDate",value:function(e,t){var a=new Date(e);return a&&(t="string"!=typeof t?"default":t),e="short"==t?a.toDateString():a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear()}},{key:"GetLangCode",value:function(e){var t=(e=p.a.trim(e.replace(/(<([^>]+)>)/gi,""))).charCodeAt(0);return t>2303&&t<2432?"sa":t>3455&&t<3584?"si":t>3583&&t<3712?"th":t>3839&&t<4096?"bo":t>4095&&t<4256?"my":t>4352&&t<4547?"ko":t>6143&&t<6320?"mn":t>12351&&t<12446?"ja":t>19967?"zh":""}},{key:"WrapInLangSpan",value:function(e,t){var a=t?" text-nowrap":"",s=this.GetLangCode(e);return""===s?e:'<span class="u-'.concat(s).concat(a,'">').concat(e,"</span>")}},{key:"GetPublicUrlPath",value:function(e){var t=window.location.href.split("#"),a=(t=(t=t[0].split(e))[0].split(window.location.host)).length>1&&t[1];return a&&"/"!==a[a.length-1]&&(a+="/"),a}},{key:"AddPop",value:function(e,t){this.sui;window.sui=this.sui;return"&nbsp;<img class='popover-icon' style='display:inline-block' src='".concat("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAANCAYAAABLjFUnAAAACXBIWXMAAAsSAAALEgHS3X78AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAFlJREFUeNpijEq9+J+BSoBp6Sw9RqoZxsDAwEAtAxn//0f4MjrtEoaXl87Sw2tAdNol7IbhMpAsl2EzkBSXsRCyDVkxIUDQsFGXYU+0VM0B1AIAAAAA//8DAPEeJvJ295NvAAAAAElFTkSuQmCC","' \n                    ").concat(t?"style='width:13px'":"","\n                    onmouseenter='sui.pages.ShowPopover(\"").concat(e,"\",event); return false;'\n                    onmousemove='sui.pages.ShowPopover(\"").concat(e,"\",event); return false;'\n                    onmousedown='sui.pages.ShowPopover(\"").concat(e,"\",event) return false;'>").replace(/\t|\n|\r|/g,"")}},{key:"DrawTree",value:function(e,t){var a=this.sui;a.curTree=t,"places"==t?a.LazyLoad(e,null,t,13735):a.GetTopRow(e,t),p()("#sui-footer").offset()&&p()(e).offset()&&p()(e).css("max-height",p()("#sui-footer").offset().top-p()(e).offset().top-120+"px")}}]),e}(),T=a(15),j=a(6),S=a(12),N=a(11),O=a(8),A=a(10),C=a.n(A);function P(e){var t,a=Object(N.g)(),i=Object(s.useRef)(null),r=Object(O.k)((function(e){return e}));var l=null===(t=r.search.query)||void 0===t?void 0:t.searchText,c=function(){e.search.setSearchText(i.current.value),e.onSubmit(i.current.value),console.log("BasicSearch handleSubmit: ",i.current.value),a.push("/search")},o=C.a.debounce((function(){console.log("BasicSearch handleChange: ",i.current.value)}),500);return Object(s.useLayoutEffect)((function(){i.current.value!==e.search.query.searchText&&(i.current.value=e.search.query.searchText)})),n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"sui-search1"},n.a.createElement("input",{type:"text",id:"sui-search",className:"sui-search2",defaultValue:l,placeholder:"Enter Search",onChange:o,onKeyDownCapture:function(e){13===e.keyCode&&c()},ref:i}),n.a.createElement("span",{className:"l-search__input__buttons"},n.a.createElement("span",{id:"sui-searchgo",className:"sui-search4",onClick:c},n.a.createElement("span",{className:"icon"})),n.a.createElement("span",{id:"sui-clear",className:"sui-search3",onClick:function(){i.current.value="",c(),e.onSubmit(i.current.value),console.log("BasicSearch clearInput: ",i.current.value)}}," ","x"," "))))}var D=a(71),R=a(36),I=a(298),L=a(108);a(323);function F(e){var t=Object(s.useState)(e.viewMode||"off"),a=Object(j.a)(t,2),i=a[0],r=a[1],l=e.chooseViewMode||function(){alert("No chooseViewMode handler:  mode = "+i)};return Object(s.useEffect)((function(){l(i)}),[i]),n.a.createElement(D.a,{name:"Georgie",value:i,type:"radio",className:"c-MainSearchToggle--group"},n.a.createElement(R.a,{name:"viewMode",value:"tree",type:"radio",className:"c-MainSearchToggle--button",onClick:function(e){if("tree"===e.target.value)return r("tree"===i?"off":"tree"),e.stopPropagation(),!1}},n.a.createElement(I.b,null)),n.a.createElement(R.a,{name:"viewMode",value:"advanced",type:"radio",className:"c-MainSearchToggle--button",onClick:function(e){if("advanced"===e.target.value)return r("advanced"===i?"off":"advanced"),e.stopPropagation(),!1}},n.a.createElement(L.d,null)))}var M=a(73),U=(a(324),n.a.Component,a(18)),q=a.n(U),B=a(23),G=a(46),H=a(29),K=a.n(H),z=a(86),V=a.n(z);function J(e){return V.a.stringify(e,{arrayFormat:"repeat"})}function Y(e){return new Promise((function(t,a){var s=document.createElement("script"),n=e.url;if(e.params){var i=J(e.params);i&&(n+=(n.indexOf("?")>=0?"&":"?")+i)}function r(){s&&(s.onload=s.onreadystatechange=s.onerror=null,s.parentNode&&s.parentNode.removeChild(s),s=null)}s.async=!0;var l="axiosJsonpCallback_"+(Math.floor(Math.random()*Math.pow(10,12))+1),c=window[l],o=!1;window[l]=function(e){(window[l]=c,o)||t({data:e,status:200})};var d={_:(new Date).getTime()};d[e.callbackParamName||"callback"]=l,n+=(n.indexOf("?")>=0?"&":"?")+J(d),s.onload=s.onreadystatechange=function(){s.readyState&&!/loaded|complete/.test(s.readyState)||r()},s.onerror=function(){r(),a(new Error("Network Error"))},e.cancelToken&&e.cancelToken.promise.then((function(e){s&&(o=!0,a(e))})),s.src=n,document.head.appendChild(s)}))}var Q,W,Z=a(299),X=a.n(Z),$=a(64),ee=a.n($),te=a(300);a.n(te)()(Promise);function ae(e){return X.a.createHash("sha1").update(e).digest("base64")}function se(e){return ne.apply(this,arguments)}function ne(){return(ne=Object(B.a)(q.a.mark((function e(t){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,le(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ie(e){ee.a.getItem(ae(JSON.stringify(e))).then((function(e){return e})).catch((function(e){return console.log("getCached failed.  Returning null: ",e),null}))}function re(e,t){ee.a.setItem(ae(JSON.stringify(e)),t).then((function(){})).catch((function(e){console.log("setCache failed.  Ignoring: ",e)}))}function le(e){var t,a,s,n,i,r,l,c,o,d,u,p,m,h,f,g,v,_,b,y,E,k,w,x,S,N,O,A,P,D,R,I,L,F,M,U,q,B,H,z,V,J,Q=e.page,W=e.query,Z=Q.start||0,X=Q.rows||100,$=W.facetFilters,ee={asset_count:{type:"terms",field:"asset_type",limit:(null===(t=$.asset_type)||void 0===t?void 0:t.limit)||20,offset:(null===(a=$.asset_type)||void 0===a?void 0:a.offset)||0,sort:(null===(s=$.asset_type)||void 0===s?void 0:s.sort)||"count desc",domain:{excludeTags:"asset_type"}},related_subjects:{type:"terms",field:"kmapid_subjects_idfacet",limit:(null===(n=$.subjects)||void 0===n?void 0:n.limit)||500,offset:(null===(i=$.subjects)||void 0===i?void 0:i.offset)||0,sort:(null===(r=$.subjects)||void 0===r?void 0:r.sort)||"count desc"},related_places:{type:"terms",field:"kmapid_places_idfacet",limit:(null===(l=$.places)||void 0===l?void 0:l.limit)||500,offset:(null===(c=$.places)||void 0===c?void 0:c.offset)||0,sort:(null===(o=$.places)||void 0===o?void 0:o.sort)||"count desc"},related_terms:{type:"terms",field:"kmapid_terms_idfacet",limit:(null===(d=$.terms)||void 0===d?void 0:d.limit)||500,offset:(null===(u=$.terms)||void 0===u?void 0:u.offset)||0,sort:(null===(p=$.terms)||void 0===p?void 0:p.sort)||"count desc"},feature_types:{type:"terms",field:"feature_types_idfacet",limit:(null===(m=$.feature_types)||void 0===m?void 0:m.limit)||500,offset:(null===(h=$.feature_types)||void 0===h?void 0:h.offset)||0,sort:(null===(f=$.feature_types)||void 0===f?void 0:f.sort)||"count desc"},languages:{type:"terms",field:"node_lang",limit:(null===(g=$.languages)||void 0===g?void 0:g.limit)||500,offset:(null===(v=$.languages)||void 0===v?void 0:v.offset)||0,sort:(null===(_=$.languages)||void 0===_?void 0:_.sort)||"count desc"},collections:{type:"terms",field:"collection_idfacet",limit:(null===(b=$.collections)||void 0===b?void 0:b.limit)||500,offset:(null===(y=$.collections)||void 0===y?void 0:y.offset)||0,sort:(null===(E=$.collections)||void 0===E?void 0:E.sort)||"count desc"},collection_nid:{type:"terms",field:"collection_nid",limit:(null===(k=$.collection_nid)||void 0===k?void 0:k.limit)||500,offset:(null===(w=$.collection_nid)||void 0===w?void 0:w.offset)||0,sort:(null===(x=$.collection_nid)||void 0===x?void 0:x.sort)||"count desc"},collection_uid:{type:"terms",field:"collection_uid_s",limit:(null===(S=$.collection_uid)||void 0===S?void 0:S.limit)||500,offset:(null===(N=$.collection_uid)||void 0===N?void 0:N.offset)||0,sort:(null===(O=$.collection_uid)||void 0===O?void 0:O.sort)||"count desc"},asset_subtype:{type:"terms",field:"asset_subtype",facet:{parent_type:{limit:1,type:"terms",field:"asset_type"}},limit:(null===(A=$.asset_subtype)||void 0===A?void 0:A.limit)||500,offset:(null===(P=$.asset_subtype)||void 0===P?void 0:P.offset)||0,sort:(null===(D=$.asset_subtype)||void 0===D?void 0:D.sort)||"count desc"},node_user:{type:"terms",field:"node_user_full_s",limit:(null===(R=$.user)||void 0===R?void 0:R.limit)||500,offset:(null===(I=$.user)||void 0===I?void 0:I.offset)||0,sort:(null===(L=$.user)||void 0===L?void 0:L.sort)||"count desc"},creator:{type:"terms",field:"creator",limit:(null===(F=$.creator)||void 0===F?void 0:F.limit)||500,offset:(null===(M=$.creator)||void 0===M?void 0:M.offset)||0,sort:(null===(U=$.creator)||void 0===U?void 0:U.sort)||"count desc"},perspective:{type:"terms",field:"perspectives_ss",limit:(null===(q=$.perspective)||void 0===q?void 0:q.limit)||50,offset:(null===(B=$.perspective)||void 0===B?void 0:B.offset)||0,sort:(null===(H=$.perspective)||void 0===H?void 0:H.sort)||"count desc"},associated_subjects:{type:"terms",field:"associated_subject_map_idfacet",limit:(null===(z=$.associated_subjects)||void 0===z?void 0:z.limit)||50,offset:(null===(V=$.associated_subjects)||void 0===V?void 0:V.offset)||0,sort:(null===(J=$.associated_subjects)||void 0===J?void 0:J.sort)||"count desc"}},te={fl:"*",wt:"json",echoParams:"explicit",indent:"true",start:Z,rows:X,"json.facet":JSON.stringify(ee)},ae=function(e){var t=(i=e||"",i=(i=(i=(i=(i=(i=(i=(i=i.replace(/ /g,"\\ ")).replace("(","\\(")).replace(")","\\)")).replace(":","\\:")).replace("+","\\+")).replace("-","\\-")).replace('"','\\"')).replace("?","\\?")),a=t.length?t+"*":"*",s=t.length?"*"+t+"*":"*",n=t+"/";var i;e&&0!==t.length||(t=s=n="*");return{q:"( title:${xact}^100 title:${slashy}^100 title:${starts}^80 names_txt:${xact}^90 names_txt:${starts}^70)",xact:t,starts:a,search:s,slashy:n}}(e.query.searchText),se=function(e){var t=(n=e,i="field",n||(n=[]),n.reduce((function(e,t){var a=t[i]||"unknown key";return e[a]||(e[a]=[]),e[a].push(t),e}),{})),a=Object.keys(t),s=[];var n,i;function r(e,t){var a=[],s=[],n=[],i=[];e.forEach((function(e){"NOT"===e.operator?s.push(e.match):"AND"===e.operator?n.push(e.match):i.push('"'+e.match+'"')}));var r="{!tag="+t+"}"+t+":("+i.join(" ")+")";return i.length&&a.push(r),n.length&&a.push.apply(a,n),s.length&&a.push.apply(a,s),a}return a.forEach((function(e){var a=t[e],n=[];switch(e){case"asset_type":n=r(a,"asset_type"),s.push.apply(s,Object(G.a)(n));break;case"subjects":case"places":case"terms":n=r(a,"kmapid"),s.push.apply(s,Object(G.a)(n));break;case"languages":n=r(a,"language"),s.push.apply(s,Object(G.a)(n));break;case"feature_types":n=r(a,"kmapid"),s.push.apply(s,Object(G.a)(n));break;case"users":n=r(a,"node_user_full_s"),s.push.apply(s,Object(G.a)(n));break;case"creator":n=r(a,"creator"),s.push.apply(s,Object(G.a)(n));break;case"collections":n=r(a,"collection_uid_s"),s.push.apply(s,Object(G.a)(n));break;case"perspective":n=r(a,"perspectives_ss"),s.push.apply(s,Object(G.a)(n));break;case"associated_subjects":n=r(a,"associated_subject_map_idfacet"),s.push.apply(s,Object(G.a)(n));break;default:console.error("UNHANDLED FACET TYPE: "+e)}})),{fq:s}}(e.query.filters),ne={adapter:Y,callbackParamName:"json.wrf",url:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev/select",params:te=Object(T.a)(Object(T.a)(Object(T.a)({},te),ae),se)},le=new Promise((function(e,t){ie(ne);K.a.request(ne).then((function(t){if(t.data.response,t.data.response){var a={numFound:t.data.response.numFound,docs:C.a.map(t.data.response.docs,(function(e){return ue(e)})),facets:t.data.facets};re(ne,a),e(a)}})).catch((function(e){console.log("getAssetSearchPromise(): OUCH axios call failed!",e),t(e)})).finally((function(){}))}));return new Promise((function(e,t){le.then((function(t){e(function(e,t){return Object.entries(t).forEach((function(t){var a=Object(j.a)(t,2),s=a[0],n=a[1].search,i="";if(i="subjects"===s?"related_subjects":"places"===s?"related_places":"terms"===s?"related_terms":"users"===s?"node_user":s,e.facets&&e.facets[i]){var r=e.facets[i].buckets,l=C.a.filter(r,(function(e){return e.val.split("|")[0].toLowerCase().includes(n)}));e.facets[i].buckets=l}})),e}(t,W.facetFilters))})).catch((function(e){console.log("Promise rejected: ",e),t(e)}))}))}function ce(e){var t={adapter:Y,callbackParamName:"json.wrf",url:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev/select",params:{fl:"*",wt:"json",echoParams:"explicit",indent:"true",start:0,rows:1,q:"uid:${kmapid}",kmapid:e}};return new Promise((function(e,a){var s=ie(t);s?e(s):K.a.request(t).then((function(a){var s=a.data.response.docs[0];re(t,s),e(s)})).catch((function(e){a(e)}))}))}function oe(e){var t={adapter:Y,callbackParamName:"json.wrf",url:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmterms_dev/select",params:{fl:"*,[child parentFilter=block_type:parent limit=1000]",wt:"json",echoParams:"explicit",indent:"true",start:0,rows:1,q:"uid:${kmapid}",kmapid:e}};return new Promise((function(e,a){var s=ie(t);s?e(s):K.a.request(t).then((function(a){var s=a.data.response.docs[0];re(t,s),e(s)})).catch((function(e){a(e)}))}))}function de(e,t,a,s){var n="undefined"===typeof t||null===t||"all"===t?["audio-video","images","texts","visuals","sources","subjects","places","terms"]:[t],i={adapter:Y,callbackParamName:"json.wrf",url:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev/select",params:{fl:"*",wt:"json",echoParams:"explicit",indent:"true",start:"undefined"===typeof a?0:a,rows:"undefined"===typeof s?100:s,"json.facet":JSON.stringify({asset_counts:{limit:20,type:"terms",field:"asset_type",domain:{excludeTags:"ast"}}}),q:"(uid:${kmapid}^100+kmapid:${kmapid})",kmapid:e,fq:"{!tag=ast}asset_type:( "+n.join(" ")+")"}};return new Promise((function(n,r){K.a.request(i).then((function(r){var l=function(n){var i=n.data.facets.asset_counts.buckets,r={all:{count:0,docs:n.data.response.docs}};return i.forEach((function(e){r[e.val]={count:e.count,docs:[]},r.all.count+=e.count})),n.data.response.docs.forEach((function(e){var t=ue(e);r[e.asset_type].docs.push(t)})),{uid:e,start:a,rows:s,type:t,stateKey:[e,t,a,s].join("/"),assets:r}}(r);re(i,l),n(l)})).catch((function(e){console.log("getRelatedAssetsPromise(): OUCH axios call failed!",e),r(e)}))}))}function ue(e){var t,a;switch(e.asset_type){case"texts":case"sources":case"subjects":case"places":case"terms":case"collections":e.url_large="/mandala-om/img/gradient.jpg",e.url_thumb="/mandala-om/img/gradient.jpg",e.url_thumb_height=100,e.url_thumb_width=150;break;case"images":e.url_large=(t=e.url_thumb,a=1200,t.toString().replace("200,200",a+","+a))}return e}!function(e){e.Places="places",e.Subjects="subjects",e.Terms="terms",e.AudioVideo="audio-video",e.Images="images",e.Visuals="visuals",e.Sources="sources"}(Q||(Q={})),function(e){e.Not="NOT",e.And="AND",e.Or="OR"}(W||(W={}));var pe,me,he={loadingState:!1,results:{numFound:0,docs:[],facets:[]},query:{searchText:"",filters:[],facetFilters:{}},page:{current:0,start:0,rows:100,maxStart:0},gotoPage:Object(O.b)((function(e,t){t*e.page.rows>e.page.maxStart?t=Math.floor(e.page.maxStart/e.page.rows):t<0&&(t=0),e.page.start=e.page.rows*t,e.page.current=t})),nextPage:Object(O.b)((function(e,t){t|=1;e.page.current;var a=e.page.start+t*e.page.rows;a>e.page.maxStart&&(a=e.page.rows*Math.floor(e.page.maxStart/e.page.rows)),e.page.start=a,e.page.current=Math.floor(a/e.page.rows)})),prevPage:Object(O.b)((function(e,t){t|=1;var a=e.page.start-t*e.page.rows;a<0&&(a=0),e.page.start=a,e.page.current=Math.floor((a+1)/e.page.rows)})),lastPage:Object(O.b)((function(e){e.page.start=e.page.rows*Math.floor(e.page.maxStart/e.page.rows),e.page.current=Math.floor(e.page.maxStart/e.page.rows)})),firstPage:Object(O.b)((function(e){e.page.start=0,e.page.current=0})),setPageSize:Object(O.b)((function(e,t){t<1&&(t=1),e.page.rows=t})),narrowFilters:Object(O.b)((function(e,t){e.query.facetFilters[t.filter]={search:t.search,limit:t.limit,offset:t.offset,sort:t.sort}})),update:Object(O.g)(function(){var e=Object(B.a)(q.a.mark((function e(t,a,s){var n,i;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=s.getStoreState().search).loadingState=!0,performance.mark("SearchModelSearchUpdateThunkStart"),e.next=5,se(n);case 5:i=e.sent,performance.mark("SearchModelSearchUpdateThunkEnd"),performance.measure("SearchModelSearchUpdate","SearchModelSearchUpdateThunkStart","SearchModelSearchUpdateThunkEnd"),performance.getEntriesByName("SearchModelSearchUpdate").forEach((function(e){})),performance.clearMeasures(),t.receiveResults(i);case 12:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}()),receiveResults:Object(O.b)((function(e,t){e.page.maxStart!==t.numFound&&(e.page.maxStart=t.numFound),e.results!==t&&(e.results=t),e.loadingState=!1})),setSearchText:Object(O.b)((function(e,t){e.query.searchText=t,e.page.current=0,e.page.start=0})),addFilters:Object(O.b)((function(e,t){for(var a=function(a){var s=t[a],n=e.query.filters.findIndex((function(e){return e.id===s.id}));n>=0&&e.query.filters.splice(n,1),e.query.filters.push(t[a]),e.page.current=0,e.page.start=0},s=0;s<t.length;s++)a(s)})),removeFilters:Object(O.b)((function(e,t){for(var a=function(a){var s=t[a],n=e.query.filters.findIndex((function(e){return console.log("checking "+e.id+" against ",s.id),e.id===s.id}));n>=0?(e.query.filters.splice(n,1),e.page.current=0,e.page.start=0):(console.log("SearchFilter.removeFilters(): Couldn't find filter by that id: ",s.id,"  -- Ignoring."),console.log("   Requested = ",s),console.log("   Filters = ",JSON.parse(JSON.stringify(e.query.filters))))},s=0;s<t.length;s++)a(s)})),clearFilters:Object(O.b)((function(e,t){t?console.error("HEY: clearing by specific filter not implemented yet!  type = ",t):(e.query.filters=[],e.query.facetFilters={}),e.page.current=0,e.page.start=0})),clearAll:Object(O.b)((function(e){e.query.filters=[],e.query.facetFilters={},e.query.searchText="",e.page.current=0,e.page.start=0})),superClear:Object(O.b)((function(e){e.query.filters=[],e.query.facetFilters={},e.query.searchText="",e.page.current=0,e.page.start=0,ee.a.clear().then((function(){console.log("localForage cleared!")})).catch((function(e){console.error("localForage error on clear(): ",e)}))})),setSearchState:Object(O.b)((function(e,t){e.query.searchText=t.searchString,e.query.filters=t.filters})),onUpdate:Object(O.h)((function(e,t){return[e.setPageSize,e.nextPage,e.prevPage,e.gotoPage,e.lastPage,e.firstPage,e.removeFilters,e.clearFilters,e.clearAll,e.addFilters,e.setSearchText,e.narrowFilters,e.superClear,e.setSearchState]}),function(){var e=Object(B.a)(q.a.mark((function e(t,a){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.update();case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}())},fe={loading:!1,stateKey:Object(O.c)((function(e){var t,a,s,n;return(null===(t=e.kmap)||void 0===t?void 0:t.uid)+"/"+(null===(a=e.relatedsPage)||void 0===a?void 0:a.related_type)+"/"+(null===(s=e.relatedsPage)||void 0===s?void 0:s.page)+"/"+(null===(n=e.relatedsPage)||void 0===n?void 0:n.pageSize)})),uid:"",kmap:{uid:""},asset:{uid:""},relateds:[],relatedsPage:{related_type:null,page:0,pageSize:100},gotoRelatedsPage:Object(O.b)((function(e,t){e.relatedsPage.page=t})),firstRelatedsPage:Object(O.b)((function(e){e.relatedsPage.page=0})),lastRelatedsPage:Object(O.b)((function(e){throw new Error("need maxpage!")})),nextRelatedsPage:Object(O.b)((function(e){e.relatedsPage.page++})),prevRelatedsPage:Object(O.b)((function(e){e.relatedsPage.page--})),setRelatedsPage:Object(O.b)((function(e,t){e.relatedsPage=t})),setRelatedsPageSize:Object(O.b)((function(e,t){e.relatedsPage.pageSize=t})),receiveKmap:Object(O.b)((function(e,t){})),setUid:Object(O.b)((function(e,t){e.uid=t})),onUpdate:Object(O.h)((function(e,t){return[e.gotoRelatedsPage,e.nextRelatedsPage,e.prevRelatedsPage,e.firstRelatedsPage,e.lastRelatedsPage,e.setRelatedsPage,e.setUid]}),function(){var e=Object(B.a)(q.a.mark((function e(t,a){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.update();case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),update:Object(O.g)(function(){var e=Object(B.a)(q.a.mark((function e(t,a,s){var n,i,r,l,c;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=s.getStoreState().kmap).loading=!0,i=n.relatedsPage.related_type,r=Number(n.relatedsPage.page*n.relatedsPage.pageSize)||0,l=n.relatedsPage.pageSize||100,c=[ce(n.uid),oe(n.uid),de(n.uid,i,r,l)],Promise.allSettled(c).then((function(e){var a=Object(j.a)(e,3),s=a[0],i=a[1],r=a[2];"fulfilled"===i.status&&(n.kmap=i.value),"fulfilled"===s.status&&(n.asset=s.value),"fulfilled"===r.status&&(n.relateds=r.value),t.receiveKmap(n)})).catch((function(e){throw console.error("oh dear! ",e),e})),n.loading=!1;case 8:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}())};!function(e){e.FeatureTypes="feature_types",e.RelatedPlaces="related_places"}(pe||(pe={})),function(e){e.Child="child"}(me||(me={}));var ge,ve={type:null,headerTitle:"Mandala",subTitle:null,path:[],id:null,clear:Object(O.b)((function(e){e.id=null,e.type=null,e.subTitle=null,e.headerTitle=null,e.path=[],e.id=null})),setId:Object(O.b)((function(e,t){document.title=e.headerTitle+" ("+t+")",e.id=t})),setPath:Object(O.b)((function(e,t){e.path=t})),setSubTitle:Object(O.b)((function(e,t){e.subTitle=t})),setHeaderTitle:Object(O.b)((function(e,t){document.title=t+(e.id?" ("+e.id+")":""),e.headerTitle=t})),setType:Object(O.b)((function(e,t){e.type=t})),setStatus:Object(O.b)((function(e,t){Object(T.a)({},t)}))};function _e(e,t){return e.key===t.key||JSON.stringify(Object(T.a)(Object(T.a)({},e),{},{key:null,name:null}))===JSON.stringify(Object(T.a)(Object(T.a)({},t),{},{key:null,name:null}))}!function(e){e[e.search=0]="search",e[e.visit=1]="visit"}(ge||(ge={}));var be={kmap:fe,search:he,status:ve,history:{addLocation:Object(O.b)((function(e,t){var a=e.historyStack.findIndex((function(e){return _e(e,t)}));a>-1&&e.historyStack.splice(a,1),e.historyStack.push(t)})),clear:Object(O.b)((function(e){e.historyStack=[]})),removeType:Object(O.b)((function(e,t){console.log("HistoryModel: type = ",t.valueOf()),console.log("HistoryModel: Type.search = ",ge.search),console.log(t==ge.search);var a=e.historyStack.filter((function(e){return console.log(" x====> ",JSON.stringify(e)),t.valueOf()!=ge.search||!e.pathname.startsWith("/search/")||(console.log("omitting: ",e),!1)}));e.historyStack=a})),removeLocation:Object(O.b)((function(e,t){var a=e.historyStack.findIndex((function(e){return _e(e,t)}));a>-1?(console.log("removing item number "+a),e.historyStack.splice(a,1)):console.log("HistoryModel.ts: remove failed:  location = ",t)})),historyStack:[]}},ye=Object(O.e)(),Ee=ye.useStoreActions,ke=ye.useStoreState;ye.useStoreDispatch,ye.useStore;function we(e){var t,a,i,r,l;Object(N.i)();var c,o=ke((function(e){return e.search})),d=(c=Ee((function(e){return e.search})),C.a.reduce(c,(function(e,t,a){var s;return e[a]=(s=t,C.a.debounce(s,100)),e}),{})),u=d.update,p=d.setSearchText,m=d.addFilters,h=d.gotoPage,f=d.nextPage,g=d.prevPage,v=d.lastPage,_=d.firstPage,b=d.clearFilters,y=d.clearAll,E=d.removeFilters,k=d.setPageSize,w=d.narrowFilters,x=d.superClear;var T={query:o.query,currentText:o.searchText,update:u,setSearchText:p,addFilters:m,clearFilters:b,clearAll:y,superClear:x,removeFilters:E,narrowFilters:w};Object(s.useEffect)((function(){u()}),[]);var j=null===(t=o.results)||void 0===t?void 0:t.docs,S={numFound:null===(a=o.results)||void 0===a?void 0:a.numFound,currentPage:null===(i=o.page)||void 0===i?void 0:i.current,currentPageSize:null===(r=o.page)||void 0===r?void 0:r.rows,getMaxPage:function(){var e;if(null===(e=o.results)||void 0===e?void 0:e.numFound){var t,a,s=null===(t=o.results)||void 0===t?void 0:t.numFound,n=null===(a=o.page)||void 0===a?void 0:a.rows;return Math.floor((s-1)/n)}return 0},getPage:function(){var e;return null===(e=o.page)||void 0===e?void 0:e.current},setPage:function(e){var t,a;e=Number(e);var s=null===(t=o.results)||void 0===t?void 0:t.numFound,n=null===(a=o.page)||void 0===a?void 0:a.rows,i=Math.floor(s/n);e=C.a.isNaN(e)?0:e,h(e>i?i:e<0?0:e)},setPageSize:function(e){var t,a;e=Number(e);var s=Number(e),n=Number(null===(t=o.page)||void 0===t?void 0:t.current);e=e<1?1:e,e=C.a.isNaN(e)?s:e,k(e);var i=null===(a=o.page)||void 0===a?void 0:a.rows,r=Math.floor(i/s*n);r=C.a.isNaN(r)?0:r,S.setPage(r)},getPageSize:function(){var e;return null===(e=o.page)||void 0===e?void 0:e.rows},nextPage:function(){f()},prevPage:function(){g()},firstPage:function(){_()},lastPage:function(){v()}},O=null===(l=o.results)||void 0===l?void 0:l.facets;return n.a.Children.map(e.children,(function(e){return e.type?n.a.cloneElement(e,{docs:j,facets:O,pager:S,search:T}):e}))}function xe(e){var t=Object(s.useState)(""),a=Object(j.a)(t,2),i=(a[0],a[1]),r=Object(s.useState)("off"),l=Object(j.a)(r,2),c=l[0],o=l[1];return n.a.createElement("section",{id:"c-site__search",className:"c-site__search"},n.a.createElement(we,null,n.a.createElement(P,{onSubmit:function(e){console.log("Submit: "+e),i(e)},onChange:function(e){console.log("Input Change",e.target.value),i(e.target.value)}}),n.a.createElement(F,{chooseViewMode:function(t){console.log("chooseViewMode = ",t),o(t),"off"===t?e.onStateChange({advanced:!1,tree:!1}):"tree"===t?e.onStateChange({advanced:!1,tree:!0}):"advanced"===t&&e.onStateChange({advanced:!0,tree:!1})},viewMode:c})))}a(448);function Te(e){return n.a.createElement("header",{className:"c-site__header"},n.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-light bg-light"},n.a.createElement(S.b,{to:"/home",className:"navbar-brand"},n.a.createElement("img",{src:"/mandala-om/img/bhutanleft.gif",alt:"Home Page",className:"o-image-logo d-inline-block align-top"}),n.a.createElement("h1",{className:"sr-only"},"Bhutan Library")),n.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarNav",role:"navigation"},n.a.createElement("ul",{className:"navbar-nav"},n.a.createElement("li",{className:"nav-item active"},n.a.createElement("a",{className:"nav-link",href:"#"},"Home ",n.a.createElement("span",{className:"sr-only"},"(current)"))),n.a.createElement("li",{className:"nav-item"},n.a.createElement("a",{className:"nav-link",href:"#"},"About")),n.a.createElement("li",{className:"nav-item"},n.a.createElement("a",{className:"nav-link",href:"#"},"Documentation")))),n.a.createElement(xe,{advanced:e.advanced,tree:e.tree,onStateChange:e.onStateChange}),n.a.createElement("button",{className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":"#navbarNav","aria-controls":"navbarNav","aria-expanded":"false","aria-label":"Toggle navigation"},n.a.createElement("span",{className:"navbar-toggler-icon"}))))}var je=a(183),Se=(a(449),a(59)),Ne=a(301),Oe=a(302);a(450);function Ae(e){return n.a.createElement("div",{className:"sui-main",style:{marginTop:"5em"}},n.a.createElement(Se.a,null,n.a.createElement(Ne.a,null,n.a.createElement(Oe.a,null,n.a.createElement(je.a,null,n.a.createElement("h3",null,"Work-in-Progress"),n.a.createElement("h4",null,"Terms"),n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement(S.b,{to:"/terms/terms-12434"},"/terms/terms-12434")),n.a.createElement("li",null,n.a.createElement(S.b,{to:"/terms/terms-45057"},"'gro ba/ (terms-45057)")),n.a.createElement("li",null,n.a.createElement(S.b,{to:"/terms/terms-85193"},"thod rgal/: (terms-85193)"))),n.a.createElement("h4",null,"Places"),n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement(S.b,{to:"/places/places-16408"},"Potala Palace: (places-16408)")),n.a.createElement("li",null,n.a.createElement(S.b,{to:"/places/places-637"},"Lhasa: (places-637)")),n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement(S.b,{to:"/places/places-637/related-images/deck"},"Related Images")),n.a.createElement("li",null,n.a.createElement(S.b,{to:"/places/places-637/related-audio-video/deck"},"Related Audio-Video"))),n.a.createElement("li",null,n.a.createElement(S.b,{to:"/places/places-427"},"Bhutan: (places-427)")),n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement(S.b,{to:"/places/places-427/related-images/deck"},"Related Images")),n.a.createElement("li",null,n.a.createElement(S.b,{to:"/places/places-427/related-audio-video/deck"},"Related Audio-Video")))),n.a.createElement("h4",null,"Search"),n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement(S.b,{to:"/search"},"/search"))),n.a.createElement("h4",null,"Images"),n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement(S.b,{to:"/images/1421596"},"Image: Dudul Dorjay Festival Photo")),n.a.createElement("li",null,n.a.createElement(S.b,{to:"/images/160186"},"Image: High Tibet Chu ser")),n.a.createElement("li",null,n.a.createElement(S.b,{to:"/images/1243906"},"Image: Lhasa Mural Painting")),n.a.createElement("li",null,n.a.createElement(S.b,{to:"/images/45806"},"Image: Woman on Basum Island"))),n.a.createElement("h4",null,"Audio-Video"),n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement(S.b,{to:"/audio-video/825"},"Video: Carpenter of Lhagya Ri Palace")),n.a.createElement("li",null,n.a.createElement(S.b,{to:"/audio-video/306"},"Video: Dawa and Pudr\xf6n Flirt")),n.a.createElement("li",null,n.a.createElement(S.b,{to:"/audio-video/9246"},"Video: Riddle of the Terma Vase")," ","(Many Agents, Transcript, Tibetan and Chinese text)")),n.a.createElement("h4",null,"Texts"),n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement(S.b,{to:"/texts/16230"},"Text: Introduction to Drepung Colleges")),n.a.createElement("li",null,n.a.createElement(S.b,{to:"/texts/46641"},"Text: Veronoica\u2019s Test")," ","has embedded video etc."),n.a.createElement("li",null,n.a.createElement(S.b,{to:"/texts/50751"},"Text: Hagar of The Pawn-Shop")," ","has Hagar... and a Pawn Shop.")),n.a.createElement("h4",null,"References"),n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement("a",{href:"https://www.viseyes.org/ksolr/#s=text:lhasa=assets:All:all:AND"},"KSolr search on Lhasa")),n.a.createElement("li",null,n.a.createElement(S.b,{to:"/poptest/places/637"},"Kmaps Popover Test Page"))))))))}function Ce(e){var t=e.uid,a=e.label,s=e.key,i=e.className,r=t.split("-"),l=Object(j.a)(r,2),c=l[0];l[1];return s||(s=t),n.a.createElement(S.b,{className:i,key:s,to:"/"+c+"/"+t},a)}a(451);function Pe(e){var t=ke((function(e){return e.status})),a=[];t.path.forEach((function(e,t){0!==t&&a.push(">"),a.push(n.a.createElement(Ce,{className:"breadcrumb-item",key:e.uid,uid:e.uid,label:e.name}))}));var s=a;return n.a.createElement("header",{id:"c-content__header__main",className:"c-content__header__main sui-header legacy ".concat(e.siteClass," ").concat(t.type)},n.a.createElement("div",{id:"c-content__header__main__wrap",className:"c-content__header__main__wrap legacy"},n.a.createElement("h1",{className:"c-content__header__main__title"},n.a.createElement("span",{className:"icon u-icon__".concat(t.type)}),t.headerTitle),n.a.createElement("div",{className:"c-content__header__breadcrumb breadcrumb"},s),n.a.createElement("h5",{className:"c-content__header__main__id"},t.id),n.a.createElement("h4",{className:"c-content__header__main__sub"},t.subTitle)))}var De=function(){return Object(O.i)((function(e){return e.status}))},Re=a(136),Ie=a(55),Le=(a(452),a(43)),Fe=a(26),Me=a(32),Ue=a(22),qe=a(95),Be=a(184),Ge=a.n(Be);function He(e){var t=Array.isArray(e.doc.title)&&e.doc.title.length>0?e.doc.title[0]:e.doc.title;function a(e,t){return C.a.findIndex(e,(function(e){return e===t}))}switch(e.doc.asset_type){case"places":var s=a(e.doc.ancestors_txt,"United States of America");if(s>1){var i=e.doc.ancestors_txt[s+1];a(e.doc.feature_types_ss,"County")>-1&&(t+=" County"),-1===a(e.doc.feature_types_ss,"State")&&(t+=", "+i)}break;case"subjects":case"terms":case"audio-video":case"texts":case"sources":case"visuals":case"images":break;case"collections":e.doc.asset_subtype&&(t+=" ("+e.doc.asset_subtype+")")}return n.a.createElement(Ge.a,{style:{whiteSpace:"pre-wrap"},maxLine:2,text:t,basedOn:"words"})}function Ke(e){var t=e.doc;var a,s,i=n.a.createElement(n.a.Fragment,null,t.ancestors_txt.join("/"));switch(t.asset_type){case"places":i=(a=e.doc.ancestors_txt,s="United States of America",C.a.findIndex(a,(function(e){return e===s})))>1?n.a.createElement(n.a.Fragment,null,t.ancestors_txt.slice(3,6).join("/")):n.a.createElement(n.a.Fragment,null,t.ancestors_txt.slice(2,5).join("/"));break;case"subjects":i=n.a.createElement(n.a.Fragment,null,t.ancestors_txt.slice(1,2).join("/"));break;case"terms":i=null}return i}a(453),a(454),a(456);function ze(e){return n.a.createElement("div",{className:"c-smartRelateds__limited"},e.relateds)}a(457);var Ve={"audio-video/video":n.a.createElement("span",{className:"icon color-invert u-icon__video"}),"audio-video/audio":n.a.createElement("span",{className:"icon color-invert u-icon__audio"})};function Je(e){var t,a,s,i,r,l,c=e.inline||!1,o=n.a.useState(!1),d=Object(j.a)(o,2),u=d[0],p=d[1],m=Ve[e.doc.asset_type+"/"+e.doc.asset_subtype],h=e.doc.uid?m||n.a.createElement("span",{className:"icon color-invert u-icon__"+e.doc.asset_type}):null,f=e.doc.uid&&"images"!==e.doc.asset_type&&"audio-video"!==e.doc.asset_type?n.a.createElement("span",{className:"icon u-icon__"+e.doc.asset_type}):null,g=e.doc.asset_type,v=null===(t=e.doc.kmapid_places_idfacet)||void 0===t?void 0:t.map((function(e,t){var a=e.split("|"),s=Object(j.a)(a,2),i=s[0],r=s[1];return n.a.createElement("div",{key:t,className:"c-card__content-field shanti-field-place"},n.a.createElement("span",{className:"icon shanti-field-content"},n.a.createElement(Ce,{uid:r,label:i})))})),_=null===(a=e.doc.kmapid_subjects_idfacet)||void 0===a?void 0:a.map((function(e,t){var a=e.split("|"),s=Object(j.a)(a,2),i=s[0],r=s[1];return n.a.createElement("div",{key:t,className:"c-card__content-field shanti-field-subject"},n.a.createElement("span",{className:"icon shanti-field-content"},n.a.createElement(Ce,{uid:r,label:i})))})),b=null===(s=e.doc.feature_types_idfacet)||void 0===s?void 0:s.map((function(e,t){var a=e.split("|"),s=Object(j.a)(a,2),i=s[0],r=s[1];return n.a.createElement("div",{key:r,className:"c-card__content-field shanti-field-subject"},n.a.createElement("span",{className:"icon shanti-field-content"},n.a.createElement(Ce,{uid:r,label:i})))})),y=e.doc.node_created?e.doc.node_created:e.doc.timestamp;y=null===(i=y)||void 0===i?void 0:i.split("T")[0];var E=(null===(r=e.doc.creator)||void 0===r?void 0:r.length)>0?e.doc.creator.join(", "):e.doc.node_user;(null===(l=e.doc.creator)||void 0===l?void 0:l.length)>3&&(E=e.doc.creator.slice(0,3).join(", ")+"\u2026"),E&&(E=E.replace(/\&amp\;/g,"&"));var k=e.doc.collection_title?n.a.createElement("span",{className:"icon u-icon__collections"}," ",e.doc.collection_title," "):n.a.createElement("span",null,e.doc.ancestors_txt&&"terms"!==e.doc.asset_type&&n.a.createElement("div",{className:"info shanti-field-path"},n.a.createElement("span",{className:"shanti-field-content u-icon__"+e.doc.asset_type},n.a.createElement(Ke,{doc:e.doc})))),w=null;"places"===e.doc.asset_type?w=b:"subjects"===e.doc.asset_type?w=v:"terms"===e.doc.asset_type&&(w=_);var x=c?"./view/".concat(e.doc.uid,"?asset_type=").concat(e.doc.asset_type):"/".concat(g,"/").concat(e.doc.id);return n.a.createElement(Me.a,{key:e.doc.uid,className:"c-card__grid--"+e.doc.asset_type},n.a.createElement(S.b,{to:x,className:"c-card__link--asset c-card__wrap--image"},n.a.createElement(Me.a.Img,{className:"c-card__grid__image--top",variant:"top",src:e.doc.url_thumb}),n.a.createElement("div",{className:"c-card__grid__glyph--type color-invert"},h),n.a.createElement("div",{className:"c-card__grid__glyph--asset"},f)),n.a.createElement(Me.a.Body,null,n.a.createElement(Me.a.Title,null,n.a.createElement(S.b,{to:x,className:"c-card__link--asset"},n.a.createElement(He,{doc:e.doc}))),n.a.createElement(qe.a,null,n.a.createElement(qe.a.Item,{className:"c-card__listItem--creator"},e.doc.creator&&n.a.createElement("div",{className:"info shanti-field-creator"},n.a.createElement("span",{className:"icon shanti-field-content"},E))),n.a.createElement(qe.a.Item,{className:"c-card__listItem--duration"},e.doc.duration_s&&n.a.createElement("div",{className:"info shanti-field-duration"},n.a.createElement("span",{className:"icon shanti-field-content"},e.doc.duration_s))),n.a.createElement(qe.a.Item,{className:"c-card__listItem--related"},n.a.createElement("div",{className:"info shanti-field-related"},n.a.createElement("span",{className:"shanti-field-content"},n.a.createElement(ze,{relateds:w})))),n.a.createElement(qe.a.Item,{className:"c-card__listItem--created"},y&&n.a.createElement("div",{className:"shanti-field-created"},n.a.createElement("span",{className:"icon shanti-field-content"},y)))),n.a.createElement("div",{className:"c-button__json"},n.a.createElement("span",{className:"sui-showinfo u-icon__info float-right",onClick:function(){return p(!0)}}),n.a.createElement(Ye,{show:u,onHide:function(){return p(!1)},data:e.doc,scrollable:!0}))),n.a.createElement(Me.a.Footer,{className:"c-card__footer c-card__footer--"+e.doc.asset_type},n.a.createElement(S.b,null,k)))}function Ye(e){return n.a.createElement(Ue.a,Object.assign({},e,{size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0}),n.a.createElement(Ue.a.Header,{closeButton:!0},n.a.createElement(Ue.a.Title,{id:"contained-modal-title-vcenter"},"JSON DATA")),n.a.createElement(Ue.a.Body,null,n.a.createElement("pre",null,JSON.stringify(e.data,void 0,3))),n.a.createElement(Ue.a.Footer,null,n.a.createElement(Fe.a,{onClick:e.onHide},"Close")))}var Qe=a(186),We=(a(584),a(192)),Ze=a.n(We);a(458);function Xe(e){var t=Object(s.useState)(0),a=Object(j.a)(t,2),i=(a[0],a[1],Object(s.useRef)(null));if(void 0===e.pager)return null;var r=n.a.createElement(Ze.a,{"aria-label":"Goto page",min:1,max:e.pager.getMaxPage()+1,size:5,value:e.pager.getPage()+1,onChange:function(t){console.log("FeaturePager pg = "+t+" maxPage = "+e.pager.getMaxPage()),e.pager.setPage(t-1)},mobile:!1,noStyle:!0,ref:i});return e.pager.getMaxPage()<e.pager.getPage()&&e.pager.setPage(e.pager.getMaxPage()),n.a.createElement("div",{className:"c-featurePager__container"},n.a.createElement("div",{className:"c-featurePager__navButtons"},n.a.createElement("span",{onClick:function(){e.pager.firstPage(),console.log("firstPage()",i.current),console.log("getPage()",e.pager.getPage()),i.current.refsInput.setValue(e.pager.getPage()+1)},className:"icon u-icon__arrow-end-left c-pagerIcon__buttonFirst"}," "),n.a.createElement("span",{onClick:function(){e.pager.prevPage(),console.log("getPage()",e.pager.getPage()),i.current.refsInput.setValue(e.pager.getPage()+1)},className:"icon u-icon__arrow3-left c-pagerIcon__buttonPrev"}," "),n.a.createElement("span",{className:"c-pager__counterWrapper"},n.a.createElement("span",{className:"c-pager__counter-1"},r),"of",n.a.createElement("span",{className:"c-pager__counterMax"},e.pager.getMaxPage()+1)),n.a.createElement("span",{onClick:function(){e.pager.nextPage(),console.log("getPage()",e.pager.getPage()),i.current.refsInput.setValue(e.pager.getPage()+1)},className:"icon u-icon__arrow3-right c-pagerIcon__buttonNext"}," "),n.a.createElement("span",{onClick:function(){e.pager.lastPage(),console.log("getPage()",e.pager.getPage()),i.current.refsInput.setValue(e.pager.getPage()+1)},className:"icon u-icon__arrow-end-right c-pagerIcon__buttonLast"}," ")),e.loadingState?n.a.createElement("span",null," loading..."):n.a.createElement("span",null),n.a.createElement("div",{className:"c-featurePager__itemCount"},n.a.createElement("span",null,"Items per page:"),n.a.createElement(Ze.a,{"aria-label":"Set number of items per page",min:1,max:100,size:3,step:10,value:e.pager.getPageSize(),onChange:function(t){e.pager.setPageSize(t)},mobile:!1,style:{"input.mobile":{border:"0px"},"btnUp.mobile":{}}})))}var $e=a(60);function et(e){var t=function(t){var a=!0;if(!1===e.inline)return!1;switch(t.asset_type){case"subjects":case"terms":case"places":break;default:a=!0}return a},a=e.docs,s=[];return a&&(s=null===a||void 0===a?void 0:a.map((function(e,a){var s=[],i=n.a.createElement(Je,{doc:e,key:a,inline:t(e)});return s.push(i),s})),a.length||(s=n.a.createElement("div",{className:"u-search__results__wrap"},e.loadingState?n.a.createElement($e.a,{animation:"border",role:"status"},n.a.createElement("span",{className:"sr-only"},"Loading...")):n.a.createElement(tt,null))),n.a.createElement(Le.a,null,n.a.createElement(Le.a.Toggle,{as:Fe.a,eventKey:"0"},"Full JSON"),n.a.createElement(Le.a.Collapse,{eventKey:"0"},n.a.createElement("pre",null,JSON.stringify(a,void 0,1))))),n.a.createElement(n.a.Fragment,null,n.a.createElement(Xe,{pager:e.pager}),n.a.createElement(Qe.a,{className:"c-card__grid"},s),n.a.createElement(Xe,{pager:e.pager}))}function tt(e){return n.a.createElement("h2",{className:"u-search__noresults__header"},"No results. Your query yielded no results.")}var at=a(41),st=a.n(at),nt=a(76),it={assets:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev/select",terms:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmterms_dev/select"},rt={info:{url:it.terms,params:{q:"uid:_DOMAIN_-_KID_",fl:"*"},dataFilter:function(e){return!!(e.response&&e.response.numFound>0)&&e.response.docs[0]}},related:{url:it.assets,params:{q:"kmapid:_DOMAIN_-_KID_",start:"0",facets:"on",group:"true","group.field":"asset_type","group.ngroups":"true","group.limit":"0"},dataFilter:function(e){return!(!e.grouped||!e.grouped.asset_type)&&e.grouped.asset_type.groups}}},lt=function(){var e=Object(B.a)(q.a.mark((function e(t,a){var s,n,i,r,l,c,o,d,u;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(l in s=a.qtype,n=a.domain,i=a.kid,(r=Object(T.a)({},rt[s])).params=Object(T.a)({},r.params),r.params)r.params[l]=r.params[l].replace("_DOMAIN_",n).replace("_KID_",i);return"wt"in(c=r.params)||(c.wt="json"),o={adapter:Y,callbackParamName:"json.wrf",url:r.url,params:c,transformResponse:function(e){var t=r.dataFilter(e);return t||e}},e.next=9,K.a.request(o);case 9:return d=e.sent,u=d.data,e.abrupt("return",u);case 12:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();function ct(e,t,a){return a="undefined"===typeof a?"info":a,Object(nt.a)(["kmap",{qtype:a,domain:e,kid:t}],lt)}var ot=a(307),dt=a(94);function ut(e){var t=Object(s.useState)(!1),a=Object(j.a)(t,2),i=a[0],r=a[1],l=Object(s.useRef)(null),c=e.domain,o=e.kid,d=e.placement?e.placement:"bottom",u=e.mykey,p=ct(c,o,"info"),m=p.isLoading,h=p.isError,f=p.data,g=p.error,v=ct(c,o,"related"),_=v.isLoading,b=v.isError,y=v.data,E=v.error;if(m||_)return n.a.createElement("span",null,"Loading ....");if(h||b)return console.error(h?g:E),n.a.createElement("span",{className:"red"},"Error occurred ....");var k=f,w=y;if(!k||!w)return n.a.createElement(n.a.Fragment,null,"No data!");var x="terms"==k.tree&&k.name_tibt,T=x?k.name_tibt[0]:k.header,S="";return S=e.children?n.a.createElement("span",{className:"popover-link-custom",ref:l,onMouseOver:function(){return r(!0)},onMouseOut:function(){return r(!1)}},e.children):n.a.createElement(n.a.Fragment,null,n.a.createElement("span",{className:x?"u-bo":""},T),n.a.createElement("span",{className:"popover-link",ref:l,onMouseOver:function(){return r(!0)},onMouseOut:function(){return r(!1)}},n.a.createElement("span",{className:"icon u-icon__kmaps-popover"}))),n.a.createElement("span",{key:u,className:"kmap-tag-group processed","data-kmdomain":c,"data-kmid":o},S,n.a.createElement(ot.a,{target:l.current,show:i,placement:d},n.a.createElement(dt.a,{"data-kmid":o,className:"related-resources-popover processed",onMouseOver:function(){return r(!0)},onMouseOut:function(){return r(!1)}},n.a.createElement(dt.a.Title,{as:"h5",className:x?"bo":""},T," ",n.a.createElement("span",{className:"kmid"},o)),n.a.createElement(dt.a.Content,null,n.a.createElement(pt,{domain:c,kid:o,info:k,related:w})))))}function pt(e){var t=e.info,a=e.related;a.sort((function(e,t){var a=e.groupValue,s=t.groupValue;return a<s?-1:a>s?1:0}));var s=e.domain,i=e.kid,r=t.caption_eng&&t.caption_eng.length>0?t.caption_eng[0].replace(/<\/?p>/g,"")+" ":"",l="/mandala-om/"+s+"/"+s+"-"+i,c="";t.feature_type_ids&&t.feature_type_ids.length>0&&(c=n.a.createElement("div",{className:"other featuretypes clearfix"},n.a.createElement("p",null,n.a.createElement("strong",null,"Feature Type"),t.feature_type_ids.map((function(e,a){var s="/mandala-om/subjects/subjects-"+e;return n.a.createElement(n.a.Fragment,null,n.a.createElement("a",{href:s},t.feature_types[a]))})))));var o="",d="terms"==t.tree&&t["ancestor_ids_tib.alpha"]?t["ancestor_ids_tib.alpha"]:t.ancestor_ids_generic,u="terms"==t.tree&&t["ancestors_tib.alpha"]?t["ancestors_tib.alpha"]:t.ancestors;if(d&&d.length>1){var p=t.tree[0].toUpperCase()+t.tree.substr(1);o=n.a.createElement("div",{className:"parents clearfix"},n.a.createElement("p",null,n.a.createElement("strong",null,p),"\xa0",d.map((function(e,a){if(a!=d.length-1){var s="/mandala-om/"+t.tree+"/"+t.tree+"-"+e,i=u[a],r="akey-"+e+"-"+a;return n.a.createElement("a",{key:r,href:s},i)}}))))}var m="";"terms"==t.tree&&t.associated_subject_ids&&(m=n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"other"},n.a.createElement("strong",null,"Wylie"),t.header),n.a.createElement("div",{className:"termtypes"},t.associated_subject_ids.map((function(e,a){var s="/mandala-om/subjects/subjects-"+e;return n.a.createElement("a",{href:s},t.associated_subjects[a])})))));var h=n.a.createElement(n.a.Fragment,null,a.map((function(e,t){var a=e.groupValue;if("texts:pages"!=a){var s=l+"/related-"+a+"/deck",i="Related "+a[0].toUpperCase()+a.substr(1).replace("-v"," V").replace("-"," "),r="icon u-icon__"+a;return n.a.createElement("div",{className:"popover-footer-button"},n.a.createElement("a",{href:s,className:r},i," (",e.doclist.numFound,")"))}})));return n.a.createElement("div",{className:"react-popover-body"},n.a.createElement("span",{className:"kmdomain"},s),n.a.createElement("span",{className:"kmid"},i),n.a.createElement("div",{className:"popover-body"},m,n.a.createElement("div",{className:"desc"},r,"For more information about this term, see Full Entry below."),c,o),n.a.createElement("div",{className:"popover-footer"},n.a.createElement("div",{className:"popover-footer-button"},n.a.createElement("a",{className:"icon u-icon__link-external",href:l},"Full Entry")),h))}function mt(e){var t=e.match.params.dom,a=e.match.params.kid,s=ct(t,a,"info"),i=JSON.stringify(s,null,4),r=e.placement?e.placement:"bottom",l="/mandala-om/poptest/{}";return n.a.createElement(n.a.Fragment,null,n.a.createElement(Se.a,{fluid:!0,id:"mptestdiv",style:{margin:"20px",border:"thin dashed green",padding:"15px",backgroundColor:"#e1eff3",maxWidth:"98vw"}},n.a.createElement(Ne.a,null,n.a.createElement("h1",{style:{marginLeft:"10px"}},"Mandala Popover React Test")),n.a.createElement(Ne.a,null,n.a.createElement(Oe.a,{md:"4"},n.a.createElement("p",null,"We\u2019re rolling along in the text, when we cite a kamp term,",n.a.createElement(ut,{domain:t,kid:a,placement:r})," ","Magnis turpis inceptos nostrud malesuada, faucibus excepteur modi laboriosam, commodi suscipit viverra?"),n.a.createElement("p",null,"Now this is the mandala inline popover test:"," ",n.a.createElement(ut,{domain:"subjects",kid:"442",placement:r},n.a.createElement(ht,{label:"Bologna",type:"fire"}))," ","The whale has no famous author, and whaling no famous chronicler, you will say."," ",n.a.createElement(ut,{domain:"subjects",kid:"4481",placement:"top"},n.a.createElement(ht,{label:"housewife",type:"zelda"}))," ","The Pequod had now swept so nigh to the stranger, that Stubb vowed he recognised his cutting spade-pole entangled in the lines that were knotted round the tail of one of these whales."," ",n.a.createElement(ut,{domain:"subjects",kid:"2191",placement:"right"},n.a.createElement(ht,{label:"what\u2019s right?",type:"tree"}))," "),n.a.createElement("p",null,"Faucibus excepteur modi laboriosam, commodi suscipit viverra?",n.a.createElement(ut,{domain:"terms",kid:"85193",placement:"top"})," ","Duis amet. Suspendisse numquam? Incididunt mollitia, perspiciatis penatibus."),n.a.createElement("p",null,"Other well-known kmaps:"),n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement("a",{href:l.replace("{}","places/637")},"Lhasa")),n.a.createElement("li",null,n.a.createElement("a",{href:l.replace("{}","subjects/8260")},"Bhutan Cultural Library")),n.a.createElement("li",null,n.a.createElement("a",{href:l.replace("{}","terms/85193"),className:"bo"},"\u0f50\u0f7c\u0f51\u0f0b\u0f62\u0f92\u0f63\u0f0b")))),n.a.createElement(Oe.a,{md:"8"},n.a.createElement("button",{id:"showbutt",onClick:function(){var e=document.getElementById("showbutt"),t=document.getElementById("precode");"none"==t.style.display?(t.style.display="block",e.innerText="Hide Kmaps Data"):(t.style.display="none",e.innerText="Show Kmaps Data")}},"Show Kmaps Data"),n.a.createElement("pre",{id:"precode",style:{display:"none",border:"thick outset lightblue",padding:"10px",backgroundColor:"white",fontFamily:"verdana",fontSize:"10pt"}},i)))))}function ht(e){var t=e.label,a={rose:"https://www.gstatic.com/webp/gallery3/1.sm.png",fire:"https://www.gstatic.com/webp/gallery/5.sm.jpg",valley:"https://www.gstatic.com/webp/gallery/1.sm.jpg",rapids:"https://www.gstatic.com/webp/gallery/2.sm.jpg",peppers:"https://homepages.cae.wisc.edu/~ece533/images/peppers.png",zelda:"https://homepages.cae.wisc.edu/~ece533/images/zelda.png",tree:"https://www.gstatic.com/webp/gallery/4.sm.jpg",error:"https://cdn.freshdesignweb.com/wp-content/uploads/site/Free-404-Error-Page-Responsive-website-Template.jpg"},s=e.type in a?e.type:"error";return n.a.createElement("div",{className:"inline"},n.a.createElement("span",{style:{fontStyle:"italic",color:"blue",paddingRight:"2px"}},t),n.a.createElement("img",{src:a[s],style:{height:"80px",display:"inline"}}))}function ft(e){var t=e.url,a=e.gourl?e.gourl:t;t.indexOf("youtube.com")>-1&&(t=t.replace("watch?v=","embed/")).indexOf("&t")>-1&&(t=(t=t.replace("&t","?start")).substring(0,t.length-1));var i=e.text,r=e.title?e.title:"External Link",l=Object(s.useState)(!1),c=Object(j.a)(l,2),o=c[0],d=c[1],u=function(){return d(!1)};return n.a.createElement(n.a.Fragment,null,n.a.createElement("a",{className:"mandala-modal","data-original-url":t,href:"#",onClick:function(){return d(!0)}},i),n.a.createElement(Ue.a,{size:"xl",show:o,onHide:u,backdrop:"static",keyboard:!1},n.a.createElement(Ue.a.Header,{closeButton:!0},n.a.createElement(Ue.a.Title,null,"External Link: \u201c",r,"\u201d")),n.a.createElement(Ue.a.Body,null,n.a.createElement("iframe",{className:"mdlmodal",src:t})),n.a.createElement(Ue.a.Footer,null,n.a.createElement("a",{href:a,target:"_blank"},n.a.createElement(Fe.a,{variant:"success"},"Go")),n.a.createElement(Fe.a,{variant:"primary",onClick:u},"Done"))))}var gt={assets:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev/select",terms:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmterms_dev/select"},vt=function(){var e=Object(B.a)(q.a.mark((function e(t,a){var s,n,i,r,l,c;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((s=a.query).index in gt&&s.params){e.next=4;break}return console.warn("The query object sent to useSolr() did not have proper index or params values: ",s),e.abrupt("return",!1);case 4:return"wt"in(n=s.params)||(n.wt="json"),i={adapter:Y,callbackParamName:"json.wrf",url:gt[s.index],params:n},e.next=9,K.a.request(i);case 9:return r=e.sent,l=r.data,c=l&&l.response?l.response:l,e.abrupt("return",c);case 13:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();function _t(e,t){var a=Object(nt.a)([e,{query:t}],vt);return!(!a||!a.data)&&(a.data.status=a.status,a.data)}function bt(e,t){if(e.attribs&&"kmap-tag-group"===e.attribs.class){var a=e.attribs["data-kmdomain"],s=e.attribs["data-kmid"];return n.a.createElement(ut,{domain:a,kid:s})}if("img"===e.name&&e.attribs&&e.attribs.class&&"popover-icon"===e.attribs.class&&e.attribs.onmouseenter){var i=e.attribs.onmouseenter.match(/(places|subjects|terms)\-(\d+)/);return i?(e.prev.data="",n.a.createElement(ut,{domain:i[1],kid:i[2]})):null}if("text"===e.type&&e.next&&e.next.attribs&&e.next.attribs.class&&"popover-icon"===e.next.attribs.class)return st()("&nbsp;&nbsp;");if(e.name&&"a"===e.name&&e.attribs&&e.attribs.href){var r=e.attribs.href,l="undefined"!==typeof e.attribs["data-mandala-id"]&&e.attribs["data-mandala-id"],c=[];for(var o in e.children)c.push(Object(at.convertNodeToElement)(e.children[o],t,bt));var d=!!e.attribs.title&&e.attribs.title;!1===d&&(d="string"===typeof c[0]?c[0].split(":")[0]:"No title");var u=function(e){var t=[".virginia.edu","youtube.com","vimeo.com"];for(var a in t){var s=t[a];if(e.includes(s))return!1}return!0}(r);if("#"===r[0])return;if(l)return n.a.createElement(kt,{mid:l,contents:c});if(!r.includes("https://mandala")&&("/"===r[0]||r.includes("shanti.virginia.edu"))){var p=r.replace(/https?\:\/\//,"").split("?")[0].split("/"),m=!!p[0].includes(".shanti.virginia")&&p.shift(),h=!(!m||"string"!=typeof m)&&m.match(/(audio-video|images|sources|texts|visuals)/);if(1==p.length||!h)return n.a.createElement(ft,{url:r,title:d,text:c});var f=p.join("/");return n.a.createElement(wt,{mpath:f,url:r,title:d,contents:c})}if(u)return n.a.createElement("a",{href:r,target:"_blank"},c);if(-1==r.search(/(subjects|places|terms)\/\d+/))return n.a.createElement(ft,{url:r,title:d,text:c})}}function yt(e){var t=e.markup?e.markup:"<div></div>",a={decodeEntities:!0,transform:bt};return n.a.createElement(n.a.Fragment,null,st()(t,a))}function Et(e){var t=e.markup?e.markup:"<div></div>",a=e.options?e.options:{};return a&&!a.decodeEntities&&(a.decodeEntities=!0),n.a.createElement(n.a.Fragment,null,st()(t,a))}function kt(e){var t=e.mid,a=e.contents,s="/mandala-om/";return t.includes("-collection-")?s+=t.replace("-collection-","-collection/"):s+=t.replace(/\-/g,"/").replace("audio/video","audio-video"),n.a.createElement("a",{href:s,"data-mandala-id":t},a)}function wt(e){var t=e.mpath,a=_t(t,{index:"assets",params:{q:'url_html:"'+t+'"',fl:"asset_type,id"}});if(a&&a.docs&&a.docs.length>0){var s=a.docs[0],i=s.asset_type,r=s.id;if(i&&r){var l="/mandala-om/"+i+"/"+r;return n.a.createElement("a",{href:l,title:e.title,"data-original-url":e.url},e.contents)}}return n.a.createElement(ft,{url:e.url,title:e.title,text:e.contents})}function xt(e){var t=e.id,a=e.mdlasset,i=e.nodejson,r=e.sui,l=!!e.ismain&&e.ismain,c=Object(s.useState)(!1),o=Object(j.a)(c,2),d=o[0],u=o[1],m=De();if(a&&l){m.setType("audio-video");var h=a.title&&a.title.length>0?a.title[0]:"";m.setHeaderTitle(h);var f=2,g=[n.a.createElement("a",{key:"bc1",href:"/mandala-om/audio-video"},"Audio-Video")];if(a.collection_title_path_ss&&a.collection_title_path_ss.length>0){for(var v=0;v<a.collection_title_path_ss.length;v++){f++;var _=a.collection_title_path_ss[v],b="/mandala-om/"+a.collection_uid_path_ss[v].replace("audio-video-collection-","audio-video-collection/"),y=n.a.createElement("a",{key:"bc"+f,href:b},_);g.push(y)}f++;var E=a.title&&a.title.length>0?a.title[0]:a.caption,k=n.a.createElement("a",{key:"bc"+f,className:"self",name:"selflink"},E);g.push(k),m.setSubTitle(g)}}return Object(s.useEffect)((function(){p()("body").on("click","a.sui-avMore2",(function(){p()("#sui-avlang").toggle(),this.text="SHOW MORE"==this.text?"SHOW LESS":"SHOW MORE"})),p()("#l-site__wrap").addClass("av")}),[]),Object(s.useEffect)((function(){a&&i&&(d||(r.av.DrawPlayer(a,i),window.sui=r,u(!0)))}),[a,i]),n.a.createElement("div",{id:"av-viewer"},n.a.createElement("div",{id:"sui-av"},"Loading ..."),n.a.createElement(Tt,{id:t,asset:a,sui:r,node:i}))}function Tt(e){var t=e.asset,a=e.node,i=e.sui,r=t&&a?i.av.DrawMetaNew(t,a):"Loading ...",l=Object(s.useState)("details"),c=Object(j.a)(l,2),o=c[0],d=c[1];return Object(s.useEffect)((function(){p()(".c-columnContent__main").scrollTop(0),d("details")}),[t]),n.a.createElement("div",{id:"av-meta-row"},n.a.createElement(Re.a,{id:"av-meta-tabs",activeKey:o,onSelect:function(e){return d(e)}},n.a.createElement(Ie.a,{eventKey:"details",title:"DETAILS \ue609"},n.a.createElement("div",{id:"meta-details"},n.a.createElement(yt,{markup:r}))),n.a.createElement(Ie.a,{eventKey:"related",title:"RELATED \ue609"},n.a.createElement(jt,{asset:t,node:a}))))}function jt(e){var t=e.asset,a=e.node,i=a&&a.nid?a.nid:t&&t.id?t.id:"",r=Object(s.useState)([]),l=Object(j.a)(r,2),c=l[0],o=l[1],d="https://audio-video-dev.shanti.virginia.edu/services/mlt/"+i+"?wt=json";return Object(s.useEffect)((function(){K()({url:d,adapter:Y}).then((function(e){o(e.data)})).catch((function(e){o([])}))}),[i]),n.a.createElement("div",{id:"meta-mlt"},n.a.createElement(et,{docs:c,title:"Related AV Assets",inline:!1}))}function St(e){var t=De();return Object(s.useEffect)((function(){t.clear(),t.setHeaderTitle("Audio Video Home")})),n.a.createElement(n.a.Fragment,null," Audio Video Home: Not much here yet.. ")}a(493);function Nt(e){var t=e.solrdoc,a=null===t||void 0===t?void 0:t.asset_type,i=null===t||void 0===t?void 0:t.collection_nid,r=_t("collitems",{index:"assets",params:{q:"asset_type:".concat(a," AND collection_nid:").concat(i),fl:["id","title","url_thumb"],rows:1e4}}),l=function(){clearTimeout(window.centerCarousel),window.centerCarousel=setTimeout((function(){if(0!==p()(".thumb.current").length){var e=Math.floor(p()(".thumb.current").get(0).offsetLeft-p()("#image-carousel").get(0).offsetWidth/2);p()("#image-carousel").scrollLeft(e)}}),10)};if(Object(s.useEffect)((function(){p()("#image-carousel").length>0&&setTimeout((function(){l()}),1e3)}),[p()("#image-carousel")]),"undefined"===typeof t||"undefined"===typeof r.docs)return null;var c=r.docs;c.sort((function(e,t){return e.id===t.id?0:e.id<t.id?-1:1}));var o=c.findIndex((function(e){return e.id==t.id})),d=o>30?o-30:0,u=o+30<c.length-1?o+30:c.length-1,m=c.slice(d,u);return n.a.createElement("div",{id:"image-carousel",className:"c-image__carousel"},m.map((function(e,a){return n.a.createElement("div",{key:"cs-"+a,id:"carousel-slide-"+a,className:"thumb"+(e.id===t.id?" current":"")},n.a.createElement(S.b,{to:e.id},n.a.createElement("img",{src:e.url_thumb,onLoad:l})))})))}function Ot(e){var t=e.solrdoc,a=t.assettype;if("undefined"!==typeof t){var s=a+"-collection/"+t.collection_nid,i=t.collection_title;return n.a.createElement(n.a.Fragment,null,n.a.createElement("span",{className:"u-icon__collections"}),n.a.createElement(S.b,{to:s},i),n.a.createElement("span",{className:"u-visibility"},"Public"))}}function At(e){var t,a,s,i,r,l,c,o=e.nodejson;if(!o||"undefined"===typeof o)return null;var d=null===(t=o[e.collfield?e.collfield:"field_kmap_collections"])||void 0===t||null===(a=t.und)||void 0===a?void 0:a.map((function(e,t){var a="kmcolls-"+e.domain+"-"+e.id+"-"+t;return n.a.createElement(ut,{key:a,domain:e.domain,kid:e.id})})),u=null===(s=o[e.subjectfield?e.subjectfield:"field_subjects"])||void 0===s||null===(i=s.und)||void 0===i?void 0:i.map((function(e,t){var a="kmsubj-"+e.domain+"-"+e.id+"-"+t;return n.a.createElement(ut,{key:a,domain:e.domain,kid:e.id})})),p=null===(r=o.field_places)||void 0===r||null===(l=r.und)||void 0===l?void 0:l.map((function(e,t){var a="kmplc-"+e.domain+"-"+e.id+"-"+t;return n.a.createElement(ut,{key:a,domain:e.domain,kid:e.id})})),m=o.field_terms?o.field_terms:o.field_kmap_terms,h=null===m||void 0===m||null===(c=m.und)||void 0===c?void 0:c.map((function(e,t){var a="kmterm-"+e.domain+"-"+e.id+"-"+t;return n.a.createElement(ut,{key:a,domain:e.domain,kid:e.id})})),f=d&&0!==d.length?"":" d-none",g=u&&0!==u.length?"":" d-none",v=p&&0!==p.length?"":" d-none",_=h&&0!==h.length?"":" d-none";return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"c-kmaps__collections"+f},n.a.createElement("span",{className:"u-icon__collections",title:"Collections"})," ",d," "),n.a.createElement("div",{className:"c-kmaps__subjects"+g},n.a.createElement("span",{className:"u-icon__subjects",title:"Subjects"})," ",u," "),n.a.createElement("div",{className:"c-kmaps__places"+v},n.a.createElement("span",{className:"u-icon__places",title:"Places"})," ",p," "),n.a.createElement("div",{className:"c-kmaps__terms"+_},n.a.createElement("span",{className:"u-icon__terms",title:"Terms"})," ",h," "))}var Ct=function(){window.history.back(),setTimeout((function(){window.location.reload()}),1e3)};function Pt(e){var t=e.type;"s"===t[t.length-1]&&(t=t.substr(0,t.length-1)),t="aeiou".includes(t[0])?"an "+t:"a "+t;var a=e.id;return n.a.createElement("div",{className:"c-not-found"},n.a.createElement(Se.a,{fluid:!0},n.a.createElement(Ne.a,{className:"justify-content-md-center"},n.a.createElement(Oe.a,{lg:"auto"},n.a.createElement("img",{className:"logo",src:"/mandala-om/img/logo-shanti.png",alt:"mandala logo"}),n.a.createElement("h1",null,"Page Not Found!"),n.a.createElement("p",null,"Sorry, ",t," with ID, ",a,", does not exist.",n.a.createElement("br",null),"If you followed a link to an item, you may have the wrong item ID,",n.a.createElement("br",null),"or the item may have been deleted or is private."),n.a.createElement(Fe.a,{variant:"primary",href:"#",onClick:Ct},"Back")))))}var Dt=["field_image_digital|Only Digital|info","field_image_color|Color|info","field_image_quality|Quality|info","field_image_rotation|Rotation|info","field_physical_size|Physical Size|arrows","field_image_capture_device|Capture Device|camera","field_image_materials|Materials|th","field_image_enhancement|Enhancement|plus-square-o","location_constructed|Location|places","copyright_statement|Copyright|copyright","field_license_url|License|info","field_aperture|Aperture|info","field_exposure_bias|Exposure Bias|info","field_flash_settings|Flash Settings|info","field_focal_length|Focal Length|info","field_iso_speed_rating|ISO Speed|info","field_lens|lens|info","field_light_source|Light Source|info","field_metering_mode|Metering Mode|info","field_noise_reduction|Noise Reduction|info","field_organization_name|Organization|info","field_original_filename|Original File Name|info","field_project_name|Project|info","field_sensing_method|Sensing Method|info","field_sponsor_name|Sponsor|info","field_spot_feature|Spot Feature|info"];function Rt(e){var t,a,i=e.solrdoc,r=e.nodejson,l=e.sizestr?e.sizestr:"",c=null===r||void 0===r?void 0:r.title,o=Object(s.useState)(""),d=Object(j.a)(o,2),u=d[0];d[1];r&&(r.copyright_statement=function(e){var t=!1,a=!1,s=!1,n="";if(e){var i,r;if(e.field_copyright_holder.und&&e.field_copyright_holder.und.length>0&&(t=e.field_copyright_holder.und[0].value),e.field_copyright_statement.und&&e.field_copyright_statement.und.length>0)a=null===e||void 0===e||null===(i=e.field_copyright_statement)||void 0===i?void 0:i.und[0].value;if(e.field_copyright_date.und&&e.field_copyright_date.und.length>0)s=(s=new Date(null===e||void 0===e||null===(r=e.field_copyright_date)||void 0===r?void 0:r.und[0].value)).getFullYear();s&&s.toString().length>0&&(s+=". "),t&&t.length>0&&(t+=",  "),a&&(n=t+s+"|"+a)}return{und:[{value:n}]}}(r),r.location_constructed=function(e){var t,a,s,n,i,r,l=!!(null===e||void 0===e||null===(t=e.field_longitude)||void 0===t?void 0:t.und)&&(null===e||void 0===e||null===(a=e.field_longitude)||void 0===a?void 0:a.und[0].value),c=!!(null===e||void 0===e||null===(s=e.field_latitude)||void 0===s?void 0:s.und)&&(null===e||void 0===e||null===(n=e.field_latitude)||void 0===n?void 0:n.und[0].value),o=!!(null===e||void 0===e||null===(i=e.field_altitude)||void 0===i?void 0:i.und)&&(null===e||void 0===e||null===(r=e.field_altitude)||void 0===r?void 0:r.und[0].value),d=!1;if(e&&c&&l){if(!l||!c||!o)return{und:[]};isNaN(1*l)||(l=l>0?"+"+l:"-"+l),isNaN(c)||(c=c>0?"+"+c:"-"+c),isNaN(o)||(o=o>0?"+"+o:"-"+o),d=l+" "+c+" "+o}return{und:[{value:d}]}}(r));var p=(null===r||void 0===r||null===(t=r.field_image_descriptions)||void 0===t?void 0:t.und)?r.field_image_descriptions.und:[],m="ir-caption-main-"+Math.floor(3333333*Math.random());return n.a.createElement(n.a.Fragment,null,n.a.createElement(Ne.a,{className:"l-top"},n.a.createElement(Oe.a,{className:"l-first col-sm-12 col-md-6"},n.a.createElement("h5",{className:"c-image__colhead"},"Mandala Collections"),n.a.createElement("div",null,n.a.createElement(Ot,{solrdoc:i}))),n.a.createElement(Oe.a,{className:"col-sm-12 col-md-6"},n.a.createElement("h5",{className:"c-image__colhead"},"Classifications"),n.a.createElement("div",{className:"c-kmaps-list"},n.a.createElement(At,{nodejson:r})))),n.a.createElement(Ne.a,{className:"l-meta"},n.a.createElement(Oe.a,{className:"l-first col-sm-12 col-md-6"},n.a.createElement(It,{key:m,cls:"c-image__caprow",icon:"images",label:"Caption",value:c}),n.a.createElement("hr",null),n.a.createElement(Ft,{json:null===r||void 0===r?void 0:r.field_image_agents}),n.a.createElement(It,{key:"ir-uploader",cls:"u-data",icon:"agents",label:"Uploader",value:i.node_user_full_s,date:Lt(r.created,"ts")}),n.a.createElement(It,{key:"ir-image-type",cls:"u-data",icon:"square-o",label:"Type",value:null===r||void 0===r||null===(a=r.field_image_type)||void 0===a?void 0:a.und[0].value,valclass:"text-capitalize"}),n.a.createElement(It,{key:"ir-image-size",cls:"u-data",icon:"arrows",label:"size",value:l}),n.a.createElement("hr",null),p.map((function(e,t){return n.a.createElement(Mt,{key:"im-desc-"+t,data:p[t],defaultauth:u})}))),n.a.createElement(Oe.a,{className:"l-second col-sm-12 col-md-6"},Dt.map((function(e,t){var a=e.split("|");if(a.length<3)do{a.push("")}while(a.length<3);return n.a.createElement(Ut,{key:a[0],fieldName:a[0],label:a[1],icon:a[2],nodejson:r})})))))}function It(e){var t=e.cls?e.cls:"",a=e.icon?e.icon:"info",s=e.label?e.label:"",i=e.labclass?" "+e.labclass:"",r=e.value?e.value:"",l=e.valclass?" "+e.valclass:"",c=e.date?" ("+e.date+")":"",o="ir-"+s.toLowerCase().replace(" ","-")+Math.floor(888888*Math.random());return n.a.createElement(Ne.a,{className:t,key:o},n.a.createElement(Oe.a,{key:o+"-c1"},n.a.createElement("span",{className:"u-icon__"+a})," ",n.a.createElement("span",{className:"u-label"+i},s)," "),n.a.createElement(Oe.a,{className:"u-value"+l,key:o+"-c2"},r,c))}function Lt(e,t){if(!e||""===e)return null;var a=new Date(e);return t&&"ts"===t&&(a=new Date(1e3*e)),a.toLocaleString().split(",")[0]}function Ft(e){var t=null===e||void 0===e?void 0:e.json;return t&&"undefined"!==typeof t&&t.und&&0!==t.und.length?n.a.createElement(n.a.Fragment,null,t.und.map((function(e,t){var a,s=(null===e||void 0===e||null===(a=e.field_agent_dates)||void 0===a?void 0:a.und)&&e.field_agent_dates.und.length>0?Lt(e.field_agent_dates.und[0].value):"",i=e.field_agent_role.und[0].value.toLowerCase()+e.title.toLowerCase();return i=i.replace(" ","-"),n.a.createElement(It,{key:i,cls:"u-data",icon:"agents",label:e.field_agent_role.und[0].value.toUpperCase(),value:e.title,date:s})}))):n.a.createElement(It,{cls:"u-data",icon:"agents",label:"Creator",value:"Unknown"})}function Mt(e){var t,a=e.data,s=e.defaultauth,i=Lt(a.created,"ts"),r=(null===a||void 0===a||null===(t=a.field_author)||void 0===t?void 0:t.und)&&a.field_author.und.length>0?a.field_author.und[0].value:s,l=""===r?"byline noauthor":"byline";return n.a.createElement("div",{className:"o-desc"},n.a.createElement("h5",{className:"o-desc__title"},a.title),n.a.createElement("p",{className:"o-desc__"+l},r," (",i,")"),n.a.createElement(Et,{markup:a.field_description.und[0].value}))}function Ut(e){var t,a,s=e.nodejson,i=e.fieldName,r=e.icon,l=e.label;if(!(null===(t=s[i])||void 0===t?void 0:t.und))return null;var c=null===(a=s[i])||void 0===a?void 0:a.und[0].value;if("location_constructed"===i&&!c)return null;"http"===c.substr(0,4)&&(c=n.a.createElement("a",{href:c,target:"_blank"},c)),"field_image_digital"===i&&(c="0"===c?"No":"Yes"),"field_image_rotation"===i&&(c+="\xb0");if("copyright_statement"===i){var o=c.split("|");if(""===o[0])return null;for(;o.length<2;)o.push("");return n.a.createElement(n.a.Fragment,null,n.a.createElement(Ne.a,{className:"o-desc"},n.a.createElement(Oe.a,null,n.a.createElement("span",{className:"u-icon__"+r})," ",n.a.createElement("span",{className:"u-label"},l)," "),n.a.createElement(Oe.a,{className:"u-value"},o[0])),n.a.createElement(Ne.a,{className:"o-desc"},n.a.createElement(Oe.a,null,o[1])))}return"field_original_filename"!==i&&"field_license_url"!==i||(c=n.a.createElement("span",{className:"t-overwrap-any"},c)),n.a.createElement(It,{cls:"u-data",icon:r,label:l.toUpperCase(),value:c})}a(495);var qt=a(305),Bt=a.n(qt);function Gt(e){var t=e.manifest,a=e.rotation,i=a&&0!==a?1:0,r=Object(s.useState)(!1),l=Object(j.a)(r,2),c=(l[0],l[1]);return Object(s.useEffect)((function(){if(t&&a&&1===p()("#osdviewer").length){p()("#osdviewer").html("");var e=Bt()({id:"osdviewer",prefixUrl:"/mandala-om/seadragon/images/",tileSources:t,degrees:a,showRotationControl:!0,defaultZoomLevel:i,minZoomImageRatio:.1,maxZoomPixelRatio:1.8,maxZoomLevel:10,minZoomLevel:.5});c(e)}}),[t,a]),n.a.createElement("div",{id:"osdviewer",className:"c-osdviewer"},"Loading ...")}function Ht(e){var t=e.mdlasset,a=e.nodejson,i=e.ismain,r=De();(null===e||void 0===e?void 0:e.id)||(null===t||void 0===t?void 0:t.id)||null===a||void 0===a||a.nid;Object(s.useEffect)((function(){t&&i&&(r.clear(),r.setHeaderTitle((null===t||void 0===t?void 0:t.title)||(null===t||void 0===t?void 0:t.caption)||"ImageViewer"));var e=p()(".react-iiif-viewer");if(e.length>0){var a=e.children();if(a.length>2){p()(a[1]).addClass("zoom");var s=p()(a[1]).children().eq(0);s.addClass("in"),s.html('<span class="u-icon__zoom-in"></span>');var n=p()(a[1]).children().eq(1);n.addClass("out"),n.html('<span class="u-icon__zoom-out"></span>'),p()(a[2]).addClass("fullscreen"),0===p()("#expand-proxy").length&&p()(a[2]).children("button").eq(0).prepend('<span id="expand-proxy" class="u-icon__enlarge"></span>')}}}),[t]);var l=function(e){var t=p()(e.target),a=p()(".thumb.current"),s="prev"===(t.parent().hasClass("before")?"prev":"next")?a.prev("div").find("a"):a.next("div").find("a");try{p()(s).get(0).click()}catch(e){}};if(t){var c,o=Array.isArray(t.creator)?t.creator.join(", "):t.creator,d=t.img_width_s+" x "+t.img_height_s,u=!!(null===a||void 0===a||null===(c=a.field_image_rotation)||void 0===c?void 0:c.und[0])&&a.field_image_rotation.und[0].value;return n.a.createElement("div",{className:"c-image"},n.a.createElement(Se.a,{fluid:!0,className:"c-image__context"},n.a.createElement(Oe.a,{className:"c-image__viewer"},n.a.createElement(Ne.a,{className:"c-image__viewer-row"},n.a.createElement(Oe.a,{className:"page-control before"},n.a.createElement("span",{className:"u-icon__arrow3-left",onClick:l})),n.a.createElement(Oe.a,null,n.a.createElement(Gt,{manifest:t.url_iiif_s,rotation:u})),n.a.createElement(Oe.a,{className:"page-control after"},n.a.createElement("span",{className:"u-icon__arrow3-right",onClick:l}))),n.a.createElement("div",{className:"c-image__caption"},n.a.createElement("h1",{className:"c-image__title"},n.a.createElement("span",{className:"u-icon__images"}),t.title),n.a.createElement("div",{className:"c-image__byline"},n.a.createElement("span",{className:"author"},o),"|",n.a.createElement("span",{className:"size"},d))),n.a.createElement(Nt,{solrdoc:t}))),n.a.createElement(Se.a,{className:"c-image__metadata"},n.a.createElement(Rt,{q:!0,solrdoc:t,nodejson:a,sizestr:d})))}return n.a.createElement(n.a.Fragment,null,"Loading...")}function Kt(e){var t=De();return Object(s.useEffect)((function(){t.clear(),t.setHeaderTitle("Images Home")})),n.a.createElement(n.a.Fragment,null," Images Home: Not much here yet.. ")}var zt=a(135);function Vt(e){var t=e.match(/(\d+)$/);return Object(j.a)(t,1)[0]}function Jt(e){return{"audio-video":n.a.createElement("span",{className:"facetItem icon u-icon__audio-video"}),texts:n.a.createElement("span",{className:"facetItem icon u-icon__texts"}),"texts:pages":n.a.createElement("span",{className:"facetItem icon u-icon__texts"}),images:n.a.createElement("span",{className:"facetItem icon u-icon__images"}),sources:n.a.createElement("span",{className:"facetItem icon u-icon__sources"}),visuals:n.a.createElement("span",{className:"facetItem icon u-icon__visuals"}),places:n.a.createElement("span",{className:"facetItem icon u-icon__places"}),subjects:n.a.createElement("span",{className:"facetItem icon u-icon__subjects"}),terms:n.a.createElement("span",{className:"facetItem icon u-icon__terms"}),collections:n.a.createElement("span",{className:"facetItem"},n.a.createElement(I.a,null)),asset_type:n.a.createElement("span",{className:"facetItem"},n.a.createElement(L.b,null)),users:n.a.createElement("span",{className:"facetItem icon u-icon__community"}),creator:n.a.createElement("span",{className:"facetItem icon u-icon__agents"}),languages:n.a.createElement("span",{className:"facetItem icon u-icon__comments-o"}),feature_types:n.a.createElement("span",{className:"facetItem"},n.a.createElement(L.c,null)),associated_subjects:n.a.createElement("span",{className:"facetItem icon u-icon__essays"}),perspective:n.a.createElement("span",{className:"facetItem icon u-icon__file-picture"}),search:n.a.createElement("span",{className:"facetItem icon u-icon__search"})}[e]}a(496);function Yt(e){var t=e.nodejson?e.nodejson:"",a=e.mdlasset?e.mdlasset:"",i=t?t.nid:"",r=t?t.title:"",l=!!e.ismain&&e.ismain,c=Object(s.useState)([]),o=Object(j.a)(c,2),d=o[0],u=o[1],m=Object(s.useState)(["shanti-texts-"+i]),h=Object(j.a)(m,2),f=h[0],g=h[1],v=Object(s.useState)(""),_=Object(j.a)(v,2),b=_[0],y=_[1],E=De();Object(s.useEffect)((function(){if(l){E.setType("texts");var e=a.title?a.title:"Loading ...";e&&E.setHeaderTitle(e)}}),[a]),Object(s.useEffect)((function(){p()(".l-site__wrap").addClass("texts"),setTimeout((function(){p()(".not-found-msg").removeClass("d-none")}),1e4)}),[]),Object(s.useEffect)((function(){if(0==d.length&&p()("#shanti-texts-body .shanti-texts-section").length>0){var e=p()("#shanti-texts-body .shanti-texts-section").toArray(),t=p.a.map(e,(function(t,a){var s=p()(t);if(a<e.length+1){var n=p()(e[a+1]).offset();n&&n.top&&n.top-145}return{el:s,id:s.attr("id"),title:p.a.trim(s.children().eq(0).text()),getTop:function(){return this.el.offset().top}}}));u(t);var a=window.location.hash,s=a.replace("shanti-texts-","shanti-texts-toc-"),n=p()(".shanti-texts-toc > ul > li.first > a");a&&1===p()(".shanti-texts-toc > ul  a"+s).length&&(n=p()(".shanti-texts-toc > ul  a"+s),p()(a).get(0).scrollIntoView()),n.addClass("toc-selected")}}));var k=n.a.createElement(n.a.Fragment,null,n.a.createElement(Se.a,{className:"astviewer texts",fluid:!0},n.a.createElement(Ne.a,{id:"shanti-texts-container"},n.a.createElement("div",{className:"loading"},n.a.createElement($e.a,{as:"div",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),"Loading text..."),n.a.createElement("div",{className:"not-found-msg d-none"},n.a.createElement("h1",null,"Text Not Found!"),n.a.createElement("p",{className:"error"},"Could not find the requested text: ",e.id)))));return t&&t.nid&&(""===t.bibl_summary&&(t.bibl_summary="<div>Description is loading!</div>"),k=n.a.createElement(n.a.Fragment,null,n.a.createElement(Se.a,{className:"astviewer texts",fluid:!0},n.a.createElement(Ne.a,{id:"shanti-texts-container"},n.a.createElement(Qt,{id:t.nid,alias:t.alias,markup:t.full_markup,listener:function(e){var t=90+p()("#shanti-texts-body").height(),a=[];p()(".toc-selected").removeClass("toc-selected"),p.a.each(d,(function(e){var s=d[e],n=e<d.length-1&&d[e+1],i=s.getTop(),r=n?n.getTop():1e7;if(i>90&&i<t||i<90&&r>90){a.push(s.id);var l="#"+s.id.replace("texts-","texts-toc-");p()(l).addClass("toc-selected")}})),g(a)}}),n.a.createElement(Wt,{toc:t.toc_links,meta:t.bibl_summary,links:t.views_links,title:r,sections:f,altChange:y}))),n.a.createElement(Zt,{title:r,url:b,altChange:y}))),k}function Qt(e){var t=e.alias;return Object(s.useEffect)((function(){p()(".l-content__wrap, #l-content__main,.astviewer, .astviewer.texts #shanti-texts-container").css("height","inherit")}),[]),Object(s.useEffect)((function(){!function(e){var t="h1, h2, h3, h4, h5, h6, h7, div, p, blockquote, li, span, label, th, td, a, b, strong, i, em, u, s, dd, dl, dt, figure",a=/[a-zA-Z0-9\,\.\:\;\-\s]/g;("undefined"===typeof e||"all"===e?p()(t):p()(e).find(t)).each((function(){var e=p()(this).clone().children().remove().end().text(),t=(e=e.replace(a,"")).charCodeAt(0);t>3839&&t<4096&&(p()(this).hasClass("bo")||p()(this).parents().hasClass("bo")||p()(this).addClass("bo"))}))}("#l-content__main")})),n.a.createElement(Oe.a,{id:"shanti-texts-body",onScroll:e.listener},n.a.createElement("div",{className:"link-external mandala-edit-link"},n.a.createElement("a",{href:t,target:"_blank",title:"View Text in Mandala"},n.a.createElement("span",{className:"icon u-icon__external"}))),n.a.createElement(yt,{markup:e.markup}))}function Wt(e){var t=n.a.createElement("span",{className:"shanticon shanticon-info"}),a=n.a.createElement("span",{className:"shanticon shanticon-circle-right"}),i=Object(s.useState)(!0),r=Object(j.a)(i,2),l=r[0],c=r[1],o=Object(s.useState)(a),d=Object(j.a)(o,2),u=d[0],m=d[1],h=function(){m(l?a:t)},f=p()(e.links).find("a").map((function(t,a){var s=p()(a).attr("href");s.includes("http")||(s="https://texts-dev.shanti.virginia.edu"+s);var i=p()(a).text(),r=function(e){var t=e||Math.floor(Math.random()*Math.pow(10,15)).toString(16);return Math.floor(Math.random()*Math.pow(10,15)).toString(16)+t}(i);return n.a.createElement("tr",{className:"shanti-texts-field nothing",key:r},n.a.createElement("td",{colSpan:"2",className:"shanti-texts-field-content"},n.a.createElement("a",{href:"#","data-href":s,onClick:function(){e.altChange(s)}},i)))})),g=e.title;return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{id:"sidecolumn-ctrl"},n.a.createElement("a",{onClick:function(){c(!l)},"aria-controls":"txtsidecol","aria-expanded":"open",className:"sidecol-toggle"},u)),n.a.createElement(zt.a,{in:l,onExited:h,onEnter:h},n.a.createElement(Oe.a,{id:"shanti-texts-sidebar",md:4},n.a.createElement(Re.a,{id:"shanti-texts-sidebar-tabs",className:"nav-justified"},n.a.createElement(Ie.a,{eventKey:"text_toc",title:"Contents",className:"shanti-texts-toc"},n.a.createElement("div",{className:"shanti-texts-record-title"},n.a.createElement("a",{href:"#shanti-top"},e.title)),n.a.createElement(yt,{markup:e.toc,app:"texts"})),n.a.createElement(Ie.a,{eventKey:"text_bibl",title:"Description"},n.a.createElement(yt,{markup:e.meta,app:"texts"})),n.a.createElement(Ie.a,{eventKey:"text_links",title:"Views"},n.a.createElement("div",{className:"shanti-texts-record-title"},g),n.a.createElement("h6",null,"Alternative Formats"),n.a.createElement("div",null,n.a.createElement("table",{className:"shanti-texts-record-table table"},n.a.createElement("tbody",null,f))))))))}function Zt(e){var t=e.url?e.url:"",a=t?"hidden":"shown",s=e.title?e.title:"",i=t?n.a.createElement("iframe",{src:t,className:"full-page-frame"}):" ";return n.a.createElement("div",{id:"text-alt-viewer",className:a},n.a.createElement("div",{className:"close-iframe"},n.a.createElement("a",{href:"#",title:"Back to "+s,onClick:function(){e.altChange("")}},n.a.createElement("span",{className:"icon shanticon-cancel"}))),i)}function Xt(e){var t=De();return Object(s.useEffect)((function(){t.clear(),t.setHeaderTitle("Texts Home")})),n.a.createElement(n.a.Fragment,null," Texts Home: Not much here yet.. ")}function $t(e){var t=De();return Object(s.useEffect)((function(){e.inline||(console.log(e),t.clear(),t.setHeaderTitle("Sources Viewer For A Better Tomorrow"),t.setType("sources"))})),n.a.createElement("div",{className:"Sources legacy"},"NOT YET IMPLEMENTED Sources"," ",n.a.createElement("pre",null,JSON.stringify(e.kmasset)))}function ea(e){var t=De();return Object(s.useEffect)((function(){t.clear(),t.setHeaderTitle("Sources Home")})),n.a.createElement(n.a.Fragment,null," Sources Home: Not much here yet.. ")}var ta=function(e){Object(o.a)(a,e);var t=Object(d.a)(a);function a(e){var s;if(Object(l.a)(this,a),s=t.call(this,e),console.error(typeof e.sui),"object"!==typeof e.sui)throw new Error("sui must be passed as a property to the component!");if("object"!==typeof e.sui.pages)throw new Error("sui.pages must be passed as part of the sui passed to the constructor!");return s.sui=e.sui,s.props=e,s}return Object(c.a)(a,[{key:"componentDidMount",value:function(){}},{key:"componentDidCatch",value:function(e,t){}},{key:"componentWillUnmount",value:function(){}},{key:"componentDidUpdate",value:function(e,t,a){}},{key:"shouldComponentUpdate",value:function(e,t,a){return e.id}},{key:"render",value:function(){return n.a.createElement("div",{class:"VISUALS legacy"},"VISUALS LEGACY ",JSON.stringify(this.props))}}]),a}(n.a.Component);function aa(e){var t=De();return Object(s.useEffect)((function(){t.clear(),t.setHeaderTitle("Visuals Home")})),n.a.createElement(n.a.Fragment,null," Visuals Home: Not much here yet.. ")}a(173),a(498),a(499);var sa=function(e,t,a,s){var n={termIndex:"http://localhost/solr/kmterms_dev",assetIndex:"http://localhost/solr/kmassets_dev",featureId:"places-1",domain:"places",perspective:"general",view:"roman.scholar",tree:"places",featuresPath:"/features/%%ID%%"},i={init:function(t){var a=p.a.extend(!0,{},this);return a.settings=e.extend({},n,t),a},getDirectDescendantCount:function(){var t=this,a=e.Deferred(),s=t.settings.termIndex+"/select?q={!child of=block_type:parent}id:"+t.settings.featureId+"&group=true&group.field=block_child_type&group.limit=0&wt=json&json.wrf=?";return e.ajax({type:"GET",url:s,dataType:"jsonp",timeout:9e4,error:function(e){console.error(e)},beforeSend:function(){},success:function(s){var n={};e.each(s.grouped.block_child_type.groups,(function(e,t){var a=t.groupValue,s=t.doclist.numFound;n[a]=s})),a.resolve(n["related_"+t.settings.domain])}}),a.promise()},addPlacesSummaryItems:function(t,a,s,n){var i=e("."+this.settings.domain+"-in-"+this.settings.domain),r=t;for(var l in n[s]){var c=p()("<div></div>").addClass("feature-block"),o=p()("<h6></h6>").html(r+" "+l).addClass("dontend");c.append(o);var d=p()('<ul class="collapsibleList"></ul>'),u=Object.keys(n[s][l]).sort(),m=0;for(var h in u){m++,h=u[h];var f=p()("<li></li>"),g=p()("<ul></ul>"),v=0,_=n[s][l][h];for(var b in _){var y=p()('<li class="dontsplit"></li>'),E=_[b],k=E["related_"+this.settings.domain+"_id_s"].replace(this.settings.domain+"-",""),w=p()("<a href="+a.replace("%%ID%%",k)+">"+E["related_"+this.settings.domain+"_header_s"]+"</a>"),x=p()('<span class="popover-kmaps" data-id="'+this.settings.domain+"-"+k+'"><span class="popover-kmaps-tip"></span><span class="icon shanticon-menu3"></span></span>');y.append(w),y.append(p()(x)),g.append(y),v++}var T=p()('<div class="dontsplit"></div>');T.append(p()('<span class="glyphicon"></span> ')),T.append(h+" ("+v+")"),f.append(T),f.append(g),1==v&&f.addClass("dontsplit"),d.append(f)}c.append(d),1==m&&1==v&&c.addClass("dontsplit"),i.append(c)}},getPlacesSummaryElements:function(){var t=this,a=e.Deferred(),s=["header","id","uid","related_"+t.settings.domain+"_feature_type_s","related_"+t.settings.domain+"_relation_label_s","related_kmaps_node_type","related_"+t.settings.domain+"_feature_types_t","related_"+t.settings.domain+"_id_s","related_"+t.settings.domain+"_header_s"].join(",");"places"==t.settings.domain&&(s+=",related_subjects_t");var n=t.settings.termIndex+"/select?&q={!child of=block_type:parent}id:"+t.settings.featureId+"&fl="+s+"&rows=200&indent=true&wt=json&json.wrf=?&sort=related_"+t.settings.domain+"_header_s+asc";return e.ajax({url:n,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){var s=e.response;if(s.numFound>0){var n=s.docs.reduce((function(e,a,s){var n=a.related_kmaps_node_type;void 0===n&&(n="other"),void 0===e[n]&&(e[n]=[]);var i=a["related_"+t.settings.domain+"_relation_label_s"];if(void 0===i)return e;for(var r in void 0===e[n][i]&&(e[n][i]=[]),a["related_"+t.settings.domain+"_feature_types_t"]){var l=a["related_"+t.settings.domain+"_feature_types_t"][r];void 0===e[n][i][l]&&(e[n][i][l]={});var c=a["related_"+t.settings.domain+"_id_s"];e[n][i][l][c]=a}return e}),[]);a.resolve(n)}else a.resolve([])})),a.promise()},addSubjectsSummaryItems:function(t,a,s,n){var i=e("."+this.settings.domain+"-in-"+this.settings.domain),r=t;for(var l in n[s]){var c=p()("<div></div>").addClass("feature-block"),o=p()("<h6></h6>").addClass("dontend").append(p()('<span class="glyphicon"></span> '));o.append(r+" "+l);var d=p()('<ul style="list-stype:none;" class="collapsibleList"></ul>'),u=p()('<li class="collapsible_list_header"></li>');u.append(o);var m=p()("<ul></ul>"),h=0,f=n[s][l];for(var g in f){var v=p()('<li class="dontsplit"></li>'),_=f[g],b=_["related_"+this.settings.domain+"_id_s"].replace(this.settings.domain+"-","");v.append("<a href="+a.replace("%%ID%%",b)+">"+_["related_"+this.settings.domain+"_header_s"]+"</a>");var y=p()('<span class="popover-kmaps" data-id="'+this.settings.domain+"-"+b+'"><span class="popover-kmaps-tip"></span><span class="icon shanticon-menu3"></span></span>');v.append(p()(y)),m.append(v),h++}u.append(m),d.append(u),1==h&&d.addClass("dontsplit"),c.append(d),i.append(c)}},getSubjectsSummaryElements:function(){var t=this,a=e.Deferred(),s=["header","id","related_"+t.settings.domain+"_feature_type_s","related_"+t.settings.domain+"_relation_label_s"].join(",");"places"==t.settings.domain&&(s+=",related_subjects_t");var n=t.settings.termIndex+"/select?&q={!child of=block_type:parent}id:"+t.settings.featureId+"&fl=related_"+t.settings.domain+"_feature_types_t,uid,related_"+t.settings.domain+"_id_s,related_"+t.settings.domain+"_header_s,"+s+"&rows=200&indent=true&wt=json&json.wrf=?&sort=related_"+t.settings.domain+"_header_s+asc";return e.ajax({url:n,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){var s=e.response;if(s.numFound>0){var n=s.docs.reduce((function(e,a,s){var n=a.related_kmaps_node_type;void 0===n&&(n="other"),void 0===e[n]&&(e[n]=[]);var i=a["related_"+t.settings.domain+"_relation_label_s"];if(void 0===i)return e;void 0===e[n][i]&&(e[n][i]=[]);var r=a["related_"+t.settings.domain+"_id_s"];return e[n][i][r]=a,e}),[]);a.resolve(n)}else a.resolve([])})),a.promise()},getNodeInfo:function(t,a){var s=this,n=e.Deferred(),i=[];i.always="present";var r=["ancestors_"+s.settings.perspective,"ancestor_ids_"+s.settings.perspective,"ancestor_ids_closest_"+s.settings.perspective,"ancestors_closest_"+s.settings.perspective].join(","),l=s.settings.termIndex+"/select?q=id:"+t+"&fl=header,"+r+"*&wt=json&json.wrf=?";return e.ajax({url:l,dataType:"jsonp",jsonp:"json.wrf",error:function(e){console.error(e),n.resolve([])},beforesend:function(){},success:function(e){if(e.response.docs.length>0){var t=e.response.docs[0],r="ancestor_ids_"+s.settings.perspective,l="ancestors_"+s.settings.perspective;void 0===t[r]&&(r="ancestor_ids_closest_"+s.settings.perspective,l="ancestors_closest_"+s.settings.perspective),i.ancestors=void 0===t[r]?"":t[r].reduce((function(e,s,n){return e+="/"+("<a href='"+a.replace("%%ID%%",s)+"'>"+t[l][n]+"</a>")}),""),i.title="<strong>"+t.header+"</strong>",n.resolve(i)}}}),n.promise()},getNodeCaptions:function(t){var a=e.Deferred(),s=this.settings.termIndex+"/select?q=id:"+t+"&fl=caption_*&wt=json&json.wrf=?";return e.ajax({type:"GET",url:s,dataType:"jsonp",jsonp:"json.wrf",timeout:9e4,error:function(e){console.error(e),a.resolve([])},success:function(t){var s={};t.response.docs.length>0&&e.each(t.response.docs[0],(function(e,t){null!=e&&(s[e]=t[0])})),a.resolve(s)}}),a.promise()},getNodeAssetCount:function(t,a,s){var n=e.Deferred(),i=this.settings.assetIndex+"/select?q=kmapid:"+t+a+"&start=0&facets=on&group=true&group.field=asset_type&group.facet=true&group.ngroups=true&group.limit=0&wt=json&json.wrf=?";return e.ajax({type:"GET",url:i,dataType:"jsonp",jsonp:"json.wrf",timeout:9e4,error:function(e){console.error(e),n.resolve([])},success:function(t){var a={};e.each(t.grouped.asset_type.groups,(function(e,t){var s=t.groupValue,n=t.doclist.numFound;a[s]=n})),n.resolve(a)}}),n.promise()},getNodeRelatedCount:function(t,a,s){var n=e.Deferred(),i=this.settings.termIndex+"/select?q={!child of=block_type:parent}id:"+t+a+"&wt=json&indent=true&group=true&group.field=block_child_type&group.limit=0&wt=json&json.wrf=?";return e.ajax({type:"GET",url:i,dataType:"jsonp",jsonp:"json.wrf",timeout:9e4,error:function(e){console.error(e),n.resolve([])},success:function(t){var a={};e.each(t.grouped.block_child_type.groups,(function(e,t){var s=t.groupValue,n=t.doclist.numFound;a[s]=n})),n.resolve(a)}}),n.promise()},getNodeSubjectsRelatedPlacesCount:function(t,a){var s=e.Deferred(),n=this.settings.termIndex+"/select?indent=on&q={!parent%20which=block_type:parent}related_subject_uid_s:"+t+"&wt=json&json.wrf=?&group=true&group.field=tree&group.limit=0";return e.ajax({type:"GET",url:n,dataType:"jsonp",jsonp:"json.wrf",timeout:9e4,error:function(e){console.error(e),s.resolve([])},success:function(t){var a={};e.each(t.grouped.tree.groups,(function(e,t){var s=t.groupValue,n=t.doclist.numFound;a["related_"+s]=n})),s.resolve(a)}}),s.promise()},getAncestorPath:function(){var t=this,a=e.Deferred(),s=t.settings.termIndex+"/select?&q=id:"+t.settings.domain+"-"+t.settings.featureId+"&fl=level_"+t.settings.perspective+"_i,ancestor_id_"+t.settings.perspective+"_path&fq=tree:"+t.settings.tree+"&indent=true&wt=json&json.wrf=?&rows=2000&limit=2000";return e.ajax({url:s,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){var s=e.response;if(s.numFound<1)a.resolve([]);else{s.docs[0]["ancestor_id_"+t.settings.perspective+"_path"],s.docs[0]["level_"+t.settings.perspective+"_i"];a.resolve([e])}})).fail((function(e){a.resolve([])})),a.promise()},getFullAncestorTree:function(t){var a=this,s=!!t.descendants&&!!t.descendants,n=!!t.directAncestors&&t.directAncestors,i=t.sortBy?t.sortBy:"header_ssort+ASC",r=t.extraFields?t.extraFields:[],l=t.nodeMarkerPredicates?t.nodeMarkerPredicates:[],c=e.Deferred(),o=(a.settings.view.blank?"header":"header:name_"+a.settings.view)+["id","ancestor_id_"+a.settings.perspective+"_path","level_"+a.settings.perspective+"_i"].concat(r).join(","),d=a.settings.termIndex+"/select?";return n||(a.settings.featureId?d+="&q=id:"+a.settings.featureId:(d+="&q=*",d+="&df=header",d+="&fq=level_"+a.settings.perspective+"_i:[1 TO 1]")),d+="&fl="+o+"&fq=tree:"+a.settings.tree+"&indent=true&wt=json&json.wrf=?&rows=2000&limit=2000",e.ajax({url:d,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){var t=e.response,n=function(){var e=Object(B.a)(q.a.mark((function e(t,n){var c,o,d,u,p,m;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c="ancestor_id_"+a.settings.perspective+"_path",o=t[c].split("/"),void 0===t["level_"+a.settings.perspective+"_i"]&&(d=o.length-1,a.settings.featureId=a.settings.domain+"-"+o[d]),void 0!==o){e.next=5;break}return e.abrupt("return",[]);case 5:u=function(){var e=Object(B.a)(q.a.mark((function e(t,n,c){var d,u,p,m;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if([],-1,d=[],0==c){e.next=11;break}return o[c-1],u=c+1,e.next=8,a.getDescendantsInPath(o.slice(0,c).join("/"),u,i,r,l);case 8:d=e.sent,e.next=15;break;case 11:if(0!=c){e.next=15;break}return e.next=14,a.getDescendantsInPath("*",1,i,r,l);case 14:d=e.sent;case 15:e.t0=q.a.keys(d);case 16:if((e.t1=e.t0()).done){e.next=26;break}if(p=e.t1.value,(m=d[p]).key!=a.settings.domain+"-"+n){e.next=24;break}return t&&(m.children=[].concat(t)),m.expanded=s,m.key==a.settings.featureId&&(m.active=!0,m.lazy=!0,m.backColor="#eaeaea"),e.abrupt("break",26);case 24:e.next=16;break;case 26:return e.abrupt("return",d);case 27:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),p=n,m=o.length-1;case 8:if(!(m>=0)){e.next=15;break}return e.next=11,u(p,o[m],m);case 11:p=e.sent;case 12:m--,e.next=8;break;case 15:return e.abrupt("return",p);case 16:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();if(t.numFound>0){var o=t.docs[0];if(s&&a.settings.featureId){var d="ancestor_id_"+a.settings.perspective+"_path",u="level_"+a.settings.perspective+"_i",p=o[d].split("/"),m=o[u];void 0===o[u]&&(m=p.length),a.getDescendantsInPath(o[d],m+1,i,r,l).then((function(e){n(o,e).then((function(e){c.resolve(e)}))}))}else{if(t.numFound>=1)n(o).then((function(e){c.resolve(e)}));else a.getDescendantsInPath("*",1,i,r,l).then((function(e){c.resolve(e)}))}}else c.resolve([])})),c.promise()},getDescendantsInPath:function(t,a,s){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],r=this,l=e.Deferred(),c=["header:name_"+r.settings.view,"id","ancestor_id_"+r.settings.perspective+"_path","ancestor_ids_"+r.settings.perspective,"ancestors_"+r.settings.perspective,"ancestor_id_closest_"+r.settings.perspective+"_path","ancestors_closest_"+r.settings.perspective,"level_"+r.settings.perspective+"_i","related_"+r.settings.domain+"_feature_type_s","related_"+r.settings.domain+"_relation_label_s"].concat(n).join(",");"places"==r.settings.domain&&(c+=",related_subjects_t");var o=r.settings.termIndex+"/select?&q="+t+"&sort="+s+"&df=ancestor_id_"+r.settings.perspective+"_path&fq=level_"+r.settings.perspective+"_i:["+a+"+TO+"+(a+1)+"]&fq={!tag=children}level_"+r.settings.perspective+"_i:["+a+"+TO+"+(a+0)+"]&facet.mincount=2&facet.limit=-1&facet.field={!ex=children}ancestor_id_"+r.settings.perspective+"_path&fl="+c+"&facet=true&wt=json&limit=2000&indent=true&wt=json&json.wrf=?&rows=2000";return e.ajax({url:o,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){for(var t=e.response,a=e.facet_counts.facet_fields["ancestor_id_"+r.settings.perspective+"_path"],s={},n=0;n<a.length;n+=2)s[a[n]]=a[n+1];if(t.numFound>0){var c=t.docs.reduce((function(e,t,a){var n=new RegExp(r.settings.domain+"-(.*)"),l=t.id.match(n),c=l?void 0===l[1]?"":l[1]:"",o="ancestor_ids_"+r.settings.perspective;r.settings.perspective;void 0===t[o]&&(o="ancestor_ids_closest_"+r.settings.perspective,r.settings.perspective);var d=[];i.length>0&&i.forEach((function(e,a){if("=="==e.operation)JSON.stringify(t[e.field])==JSON.stringify(e.value)&&d.push(e.mark);else if("includes"==e.operation)t[e.field].includes(e.value)&&d.push(e.mark);else if("!includes"==e.operation){var s;(null===(s=t[e.field])||void 0===s?void 0:s.includes(e.value))||d.push(e.mark)}}));var u={title:t.header,displayPath:"",key:r.settings.domain+"-"+c,expanded:!1,lazy:!0,href:r.settings.featuresPath.replace("%%ID%%",c),marks:d};return void 0===s[t["ancestor_id_"+r.settings.perspective+"_path"]]&&(u.lazy=!1),void 0!==e?e.concat([u]):[u]}),[]);l.resolve(c)}else l.resolve([])})),l.promise()},getAncestorTree:function(t){var a=this,s=!!t.descendants&&!!t.descendants,n=!!t.directAncestors&&!!t.directAncestors,i=!!t.descendantsFullDetail&&!!t.descendantsFullDetail,r=t.sortBy?t.sortBy:"header_ssort+ASC",l=t.extraFields?t.extraFields:[],c=t.nodeMarkerPredicates?t.nodeMarkerPredicates:[],o=e.Deferred(),d=["header:name_"+a.settings.view,"id","ancestor_id_"+a.settings.perspective+"_path","ancestor_ids_"+a.settings.perspective,"ancestors_"+a.settings.perspective,"ancestors_closest_"+a.settings.perspective,"ancestor_id_closest_"+a.settings.perspective+"_path","ancestor_ids_closest_"+a.settings.perspective,"level_"+a.settings.perspective+"_i"].concat(l).join(","),u=a.settings.termIndex+"/select?";return n&&(a.settings.featureId?u+="&q=id:"+a.settings.featureId:(u+="&q=*",u+="&df=header",u+="&fq=level_"+a.settings.perspective+"_i:[1 TO 1]")),u+="&fl="+d+"&fq=tree:"+a.settings.tree+"&indent=true&wt=json&json.wrf=?&rows=2000&limit=2000&sort="+r,e.ajax({url:u,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){var t=e.response,n=function(e,t){var s="ancestor_ids_"+a.settings.perspective,n="ancestors_"+a.settings.perspective;return void 0===e[s]&&(s="ancestor_ids_closest_"+a.settings.perspective,n="ancestors_closest_"+a.settings.perspective),[void 0===e[s]?[]:e[s].reduceRight((function(t,s,i){var r={title:"<strong>"+e[n][i]+"</strong>",key:a.settings.domain+"-"+s,expanded:!0,href:a.settings.featuresPath.replace("%%ID%%",s),lazy:!0,displayPath:e[n].join("/"),children:void 0===t?null:[].concat(t)};return r.key===a.settings.featureId&&(r.active=!0,r.backColor="#eaeaea"),r}),t)]};if(t.numFound>0){var d=t.docs[0];if(s&&a.settings.featureId)a.getDescendantTree(a.settings.featureId,i,r,l,c).then((function(e){o.resolve(n(d,e))}));else if(t.numFound>1){for(var u=[],p=0;p<t.numFound;p++){d=t.docs[p];n(d);u=u.concat(n(d))}o.resolve(u)}else o.resolve(n(d))}else o.resolve([])})),o.promise()},getDescendantTree:function(t,a,s){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=this;a=a||!1;var r=e.Deferred(),l=["header:name_"+i.settings.view,"id","ancestor_id_"+i.settings.perspective+"_path","ancestors_"+i.settings.perspective,"ancestor_id_closest_"+i.settings.perspective+"_path","ancestor_ids_closest_"+i.settings.perspective,"caption_eng","related_"+i.settings.domain+"_feature_type_s","related_"+i.settings.domain+"_relation_label_s"].concat(n).join(",");"places"==i.settings.domain&&(l+=",related_subjects_t");var c=s||"related_"+i.settings.domain+"_header_s+ASC",o=i.settings.termIndex+"/select?&q={!child of=block_type:parent}id:"+t+"&fl=child_count:[subquery],uid,related_"+i.settings.domain+"_id_s,related_"+i.settings.domain+"_header_s,"+l+"&expand=true&child_count.fq=related_kmaps_node_type:child&child_count.fl=uid&child_count.rows=0&child_count.q={!child of='block_type:parent'}{!term f=uid v=$row.related_"+i.settings.domain+"_id_s}&fq=related_kmaps_node_type:child&fq={!collapse field=related_"+i.settings.domain+"_id_s}&wt=json&limit=2000&indent=true&wt=json&json.wrf=?&sort="+c+"&rows=2000";return e.ajax({url:o,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){var t=e.response;if(t.numFound>0){var s=t.docs.reduce((function(t,s,n){var r=new RegExp(i.settings.domain+"-(.*)"),l=s["related_"+i.settings.domain+"_id_s"].match(r),c=l?void 0===l[1]?"":l[1]:"",o="";if("places"==i.settings.domain){var d=e.expanded[s["related_"+i.settings.domain+"_id_s"]],u=d&&d.docs[0]||[],p=u.related_subjects_t?u.related_subjects_t.join(",")+": ":"";o=p,""==p&&(o=(o=s["related_"+i.settings.domain+"_feature_type_s"])?o+": ":" ")}var m="ancestor_ids_"+i.settings.perspective;i.settings.perspective;void 0===s[m]&&(m="ancestor_ids_closest_"+i.settings.perspective,i.settings.perspective);var h="<strong>"+s["related_"+i.settings.domain+"_header_s"]+"</strong>";a&&(h+=" ("+o+s["related_"+i.settings.domain+"_relation_label_s"]+")");var f={title:h,displayPath:"",key:i.settings.domain+"-"+c,expanded:!1,lazy:!0,href:i.settings.featuresPath.replace("%%ID%%",c)};return void 0!==s.child_count&&0===s.child_count.numFound&&(f.lazy=!1),void 0!==t?t.concat([f]):[f]}),[]);r.resolve(s)}else r.resolve([])})),r.promise()}};return i}(p.a,window,document);!function(e,t,a,s){var n="kmapsRelationsTree",i={termIndex:"http://localhost/solr/kmterms_dev",assetIndex:"http://localhost/solr/kmassets_dev",tree:"places",featuresPath:"/features/%%ID%%",domain:"places",featureId:1,perspective:"pol.admin.hier",descendants:!1,directAncestors:!0,descendantsFullDetail:!0,sortBy:"header_ssort+ASC",initialScrollToActive:!1,displayPopup:!1,mandalaURL:"https://mandala.shanti.virginia.edu/%%APP%%/%%ID%%/%%REL%%/nojs",solrUtils:{},language:"eng",extraFields:[],nodeMarkerPredicates:[]};function r(t,a){this.element=t,this.options=e.extend({},i,a),this._defaults=i,this._name=n,this.init()}r.prototype={init:function(){var t=this,a={descendants:t.options.descendants,directAncestors:t.options.directAncestors,descendantsFullDetail:t.options.descendantsFullDetail,sortBy:t.options.sortBy,extraFields:t.options.extraFields,nodeMarkerPredicates:t.options.nodeMarkerPredicates};e(t.element).fancytree({extensions:["filter","glyph"],source:t.getAncestorTree(a),init:function(e,a){t.options.initialScrollToActive&&t.scrollToActiveNode()},glyph:{preset:"awesome5",map:{doc:"",docOpen:"",error:"fas fa-exclamation-circle",expanderClosed:"fas fa-plus-circle",expanderLazy:"fas fa-plus-circle",expanderOpen:"fas fa-minus-circle",folder:"",folderOpen:"",loading:"fas fa-spinner"}},activate:function(e,a){var s=a.node;a.originalEvent;s.data.marks.includes("nonInteractiveNode")?s.toggleExpanded():s.data.href&&t.options.history.push(s.data.href.replace("https://shanti-uva.github.io/mandala-om",""))},lazyLoad:function(e,a){a.result=t.getDescendantTree(a.node.key,a.node.getKeyPath(),t.options.sortBy)},createNode:function(a,s){s.node.span.childNodes[2].innerHTML='<span id="ajax-id-'+s.node.key+'">'+s.node.title+" "+(s.node.data.path||"")+"</span>";var n=s.node.span,i=s.node.key;s.node.title,s.node.data.caption,s.node.data.path,s.node.getParentList(!0,!0).reduce((function(e,t){var a=t.title,s="";null!=a&&(s=a[0]);var n="<a href='"+t.data.href+"'>"+s+"</a>";return""==e?n:e+"/"+n}),"");if(t.options.displayPopup){var r=e('<span class="popover-kmaps" data-app="places" data-id="'+i+'"><span class="popover-kmaps-tip"></span><span class="icon shanticon-menu3"></span></span>');e(n).append(e(r)),e(r).kmapsPopup({featuresPath:t.options.featuresPath,domain:t.options.domain,featureId:"",mandalaURL:t.options.mandalaURL,solrUtils:t.options.solrUtils,language:t.options.language})}return s}})},scrollToActiveNode:function(){var t=Object(B.a)(q.a.mark((function t(){var a,s;return q.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=e(this.element).fancytree("getTree"),(s=a.getActiveNode())&&s.makeVisible().then((function(){var t=e(s.li).offset().top-e(s.li).closest(".view-wrap").offset().top;e(s.li).closest(".view-wrap").scrollTop(t)}));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),getAncestorPath:function(){return this.options.solrUtils.getAncestorPath()},getAncestorTree:function(e){return this.options.directAncestors?this.options.solrUtils.getAncestorTree(e):this.options.solrUtils.getFullAncestorTree(e)},getDescendantTree:function(e,t){if(!this.options.directAncestors){var a=t.split("/"+this.options.domain+"-");return a.shift(),this.options.solrUtils.getDescendantsInPath(a.join("/"),a.length+1,this.options.sortBy,this.options.extraFields,this.options.nodeMarkerPredicates)}return this.options.solrUtils.getDescendantTree(e,this.options.descendantsFullDetail,this.options.sortBay,this.options.extraFields,this.options.nodeMarkerPredicates)}},e.fn[n]=function(t){var a,s=arguments;return void 0===t||"object"===typeof t?this.each((function(){e.data(this,"plugin_"+n)||e.data(this,"plugin_"+n,new r(this,t))})):"string"===typeof t&&"_"!==t[0]&&"init"!==t?(this.each((function(){var i=e.data(this,"plugin_"+n);i instanceof r&&"function"===typeof i[t]&&(a=i[t].apply(i,Array.prototype.slice.call(s,1))),"destroy"===t&&e.data(this,"plugin_"+n,null)})),void 0!==a?a:this):void 0}}(p.a,window,document);a(500),a(501);var na=function(e){var t=e.domain,a=e.tree,i=e.descendants,r=void 0===i||i,l=e.directAncestors,c=void 0!==l&&l,o=e.displayPopup,d=void 0!==o&&o,u=e.perspective,m=void 0===u?"tib.alpha":u,h=e.view,f=void 0===h?"roman.scholar":h,g=e.sortBy,v=void 0===g?"position_i+ASC":g,_=Object(s.useRef)(null),b=Object(N.g)(),y=Object(N.i)();return Object(s.useEffect)((function(){var e={termIndex:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmterms_dev",assetIndex:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev",featureId:y.id,domain:t,perspective:m,mandalaURL:"https://shanti-uva.github.io/mandala-om"+"/".concat(t,"/").concat(t,"-%%ID%%"),featuresPath:"https://shanti-uva.github.io/mandala-om"+"/".concat(t,"/").concat(t,"-%%ID%%"),tree:a},s=sa.init(e),n=p()(_.current),i={domain:t,featureId:y.id,featuresPath:"https://shanti-uva.github.io/mandala-om"+"/".concat(t,"/").concat(t,"-%%ID%%"),perspective:m,tree:a,termIndex:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmterms_dev",descendants:r,descendantsFullDetail:!1,directAncestors:c,displayPopup:d,mandalaURL:"https://shanti-uva.github.io/mandala-om"+"/".concat(t,"/").concat(t,"-%%ID%%"),solrUtils:s,view:f,sortBy:v,initialScrollToActive:!0,history:b,params:y};return n.kmapsRelationsTree(i),function(){n.fancytree("destroy")}}),[]),n.a.createElement("div",{className:"suiFancyTree view-wrap",ref:_})},ia=(a(281),a(4)),ra=a(141);function la(e){var t,a,s=null===(t=e.location)||void 0===t?void 0:t.state,i=null===(a=e.location)||void 0===a?void 0:a.kmasset,r=[];if(s){r.push(n.a.createElement("div",{key:e.key},Jt("search"),' "',s.searchString,'"'," "));for(var l=0;l<s.filters.length;l++){var c=s.filters[l];r.push(n.a.createElement("div",null,Jt(c.field)," ",c.label))}return n.a.createElement(n.a.Fragment,null,r)}return n.a.createElement(n.a.Fragment,null," ",Jt(null===i||void 0===i?void 0:i.asset_type)," ",null===i||void 0===i?void 0:i.uid)}function ca(e){var t,a,s,i,r,l=Ee((function(e){return e.history})).removeLocation,c=Object(N.g)(),o=e.location.kmasset?null===(t=e.location.kmasset)||void 0===t?void 0:t.asset_type:"search",d=(null===(a=e.location)||void 0===a?void 0:a.relTitle)?n.a.createElement(n.a.Fragment,null,JSON.stringify(e.location.relTitle)):n.a.createElement("span",{className:"c-HistoryViewer__title"},Jt(o)," ",null===(s=e.location)||void 0===s?void 0:s.name,n.a.createElement(oa,{state:e.location.state}));return n.a.createElement(ra.a,{placement:"auto",delay:{show:250,hide:400},overlay:function(t){var a;return n.a.createElement(dt.a,Object.assign({},t,{className:"c-HistoryLocation--popover"}),n.a.createElement(dt.a.Content,null,n.a.createElement(la,{location:e.location,key:null===(a=e.location)||void 0===a?void 0:a.key})))},"data-filters":null===(i=e.location)||void 0===i||null===(r=i.state)||void 0===r?void 0:r.filters,popperConfig:{modifiers:[{name:"offset",options:{offset:[0,10]}}]}},n.a.createElement("div",{className:"c-HistoryViewer__relatedRecentItem",onClick:function(t){return c.push(e.location)}},d,n.a.createElement("span",{className:"c-HistoryViewer__removeItem u-icon__cancel-circle icon","data-key":e.location.key,alt:"Remove from list","aria-label":"Remove from list",onClick:function(t){console.log("delete:",t.target.dataset.key),l(e.location),t.stopPropagation()}})))}function oa(e){var t=e.state;if(!t)return null;for(var a=[],s=0;s<t.filters.length;s++){var i=Jt(t.filters[s].field);a.push(i)}return n.a.createElement("span",{className:"c-HistoryViewer__filterIcons",alt:"hooligans of virtue"},a)}la.propTypes={location:ia.any};var da=function(e){var t=Object(O.k)((function(e){return e.history.historyStack})),a=[];return t.forEach((function(t,s){var i,r=!!(null===(i=t.search)||void 0===i?void 0:i.length);(r&&"search"===e.mode||!r&&"search"!==e.mode)&&a.unshift(n.a.createElement(ca,{key:t.key,location:t}))})),n.a.createElement("div",{className:"c-HistoryViewer"},a)};a(502);function ua(e){var t,a=Object(N.j)(["/:baseType/:baseUid/related-:type","/:baseType/:baseUid"]),s={};s[(null===a||void 0===a?void 0:a.params.type)||"home"]="selected";var i={baseType:(null===a||void 0===a?void 0:a.params.baseType)||(null===(t=e.kmap)||void 0===t?void 0:t.tree)||"assets",baseUid:e.id||(null===a||void 0===a?void 0:a.params.baseUid),relateds:e.relateds};return e.id||i.baseUid?n.a.createElement("aside",{className:"l-column__related"},n.a.createElement("div",{className:"l-column__related__wrap"},n.a.createElement("section",{className:"l-related__list__wrap"},n.a.createElement("div",{className:"u-related__list__header"},"Related Resources"),n.a.createElement("div",{className:"c-relatedViewer"},n.a.createElement(S.b,{id:"sui-rl-Home",to:"/"+i.baseType+"/"+i.baseUid,className:"c-related__link--home c-related__item ".concat(s.home)},n.a.createElement("span",{className:"icon u-icon__overview"})," ",n.a.createElement("span",null,"Home")),n.a.createElement(pa,Object.assign({type:"all"},i,{className:s.mandala})),n.a.createElement(pa,Object.assign({type:"places"},i,{className:s.places})),n.a.createElement(pa,Object.assign({type:"audio-video"},i,{className:s["audio-video"]})),n.a.createElement(pa,Object.assign({type:"images"},i,{className:s.images})),n.a.createElement(pa,Object.assign({type:"sources"},i,{className:s.sources})),n.a.createElement(pa,Object.assign({type:"texts"},i,{className:s.texts})),n.a.createElement(pa,Object.assign({type:"visuals"},i,{className:s.visuals})),n.a.createElement(pa,Object.assign({type:"subjects"},i,{className:s.subjects})),n.a.createElement(pa,Object.assign({type:"terms"},i,{className:s.terms})),n.a.createElement(pa,Object.assign({type:"collections"},i,{className:s.collections})))),n.a.createElement("section",{className:"l-history__list__wrap"},n.a.createElement("div",{className:"u-related__list__header"},"Recently Viewed"),n.a.createElement(da,null)),n.a.createElement("section",{className:"l-terms__tree__wrap"},n.a.createElement("div",{className:"u-related__list__header"},"Browse Terms"),n.a.createElement(na,{domain:"terms",tree:"terms",descendants:!0,directAncestors:!1,displayPopup:!1,perspective:"tib.alpha",view:"roman.scholar",sortBy:"position_i+ASC"})))):null}function pa(e){var t,a,s=(null===(t=e.relateds)||void 0===t?void 0:t.assets)?null===(a=e.relateds.assets[e.type])||void 0===a?void 0:a.count:0,i="icon u-icon__"+("all"===e.type?"logo-shanti":e.type);return s?n.a.createElement(S.b,{id:"sui-rl-"+e.type,href:"#",className:"c-related__item c-related__link--"+e.type,to:"/"+e.baseType+"/"+e.baseUid+"/related-"+e.type+"/default"},n.a.createElement("span",{className:"u-icon__"+e.type+" "+i}),n.a.createElement("span",{className:"c-related__item__label"}," ",e.type),n.a.createElement("span",{id:"sui-rln-places"},s)):null}var ma=a(306),ha=function(e){Object(o.a)(a,e);var t=Object(d.a)(a);function a(e){var s;Object(l.a)(this,a),(s=t.call(this,e)).props=e,s.sui=e.sui;var n=s.props.id||s.props.match.params.id;return s.sui.GetKmapFromID(n,(function(e){console.log("LegacyViewer: kmasset = ",e),(!s.state||!s.state.kmasset||e.uid&&e.uid!==s.state.kmasset.uid)&&(s.state={kmasset:e,id:n},s.sui.pages.Draw(s.state.kmasset,!1),s.props.onStateChange(s.state),console.log("LegacyViewer: whoop"))})),s}return Object(c.a)(a,[{key:"render",value:function(){var e=new ma.Parser,t=e.parse(p()(this.sui.pages.div).html()),a=e.parse(p()(this.sui.pages.reldiv).html());return console.log("LegacyViewer VIEWER = ",t),console.log("LegacyViewer RELDIV = "+a),n.a.createElement("div",{className:"legacyviewer"},t)}}]),a}(n.a.Component),fa=Object(N.k)(ha),ga=a(193);a(553),a(560);function va(e){var t,a=Object(s.useState)(),i=Object(j.a)(a,2);i[0],i[1],null===(t=e.focus)||void 0===t||t.alt;return Object(s.useEffect)((function(){})),n.a.createElement(n.a.Fragment,null,n.a.createElement("center",null,e.focus?n.a.createElement("img",{src:e.focus.original}):n.a.createElement(n.a.Fragment,null)),n.a.createElement("pre",null,"focus = ",JSON.stringify(e.focus,void 0,2)))}function _a(e){var t=e.children,a=e.portalRootId,n=(e.focused,e.galleryRef,document.getElementById(a)),r=document.createElement("div");return Object(s.useEffect)((function(){return n&&n.appendChild(r),function(){n&&console.log("mount = ",n)}}),[r,n]),Object(i.createPortal)(t,r)}var ba="FoldOutViewer";function ya(e){var t=document.getElementById(ba);t||((t=document.createElement("div")).id=ba);var a=Object(s.useState)(null),i=Object(j.a)(a,2),r=i[0],l=i[1],c=Object(s.useRef)();Object(s.useEffect)((function(e){}));var o=e.docs,d=[],u=[];o&&(u=null===o||void 0===o?void 0:o.map((function(e,t){var a=e.url_thumb_width?Number(e.url_thumb_width):200,s=e.url_thumb_height?Number(e.url_thumb_height):200;return{original:e.url_large?e.url_large:e.url_thumb,thumbnail:e.url_thumb,src:e.url_thumb,width:a,height:s,key:e.uid,alt:e.uid}})),d=n.a.createElement(Le.a,null,n.a.createElement(Le.a.Toggle,{as:Fe.a,eventKey:"0"},"Full JSON"),n.a.createElement(Le.a.Collapse,{eventKey:"0"},n.a.createElement("pre",null,JSON.stringify(o,void 0,1)))));var p=n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{ref:c},n.a.createElement(ga.b,{targetRowHeight:200,photos:u,onClick:function(e,t){l(t.photo);var a=document.getElementById(ba);a||((a=document.createElement("div")).id=ba),a.getAttribute("uid")===t.photo.alt&&"hidden"!==a.className?a.className="hidden":a.className="w-100",a.setAttribute("uid",t.photo.alt);for(var s="div[photoKey='"+t.photo.alt+"']",n=c.current.querySelector(s),i=n.offsetTop;n.offsetTop===i;){var r=n.nextSibling;if(!r||r.offsetTop!==i)break;n=r}n.after(a)},renderImage:function(e){var t=e.key===(null===r||void 0===r?void 0:r.alt)?{className:"sui-featureGallery-selectedImg"}:{};return n.a.createElement("div",Object.assign({photoKey:e.key},t),n.a.createElement(ga.a,e))}})),n.a.createElement(_a,{portalRootId:ba,focus:r},n.a.createElement(va,{focus:r})));return n.a.createElement(n.a.Fragment,null,n.a.createElement(Ea,{title:e.title}),n.a.createElement(Xe,{pager:e.pager}),p,n.a.createElement(Xe,{pager:e.pager}),n.a.createElement(je.a,null,d))}function Ea(e){return e.title?n.a.createElement("h5",{className:"sui-relatedHeader"},e.title):null}function ka(e){var t=C.a.map(e.docs,(function(e){return n.a.createElement(Me.a,{className:"p-0 m-1",key:e.id},n.a.createElement(Le.a,null,n.a.createElement(Me.a.Body,{className:"p-1"},n.a.createElement("span",{className:"shanticon-"+e.asset_type+" icon"})," ",e.title," (",e.uid,")",n.a.createElement(Le.a.Toggle,{as:"span",eventKey:"0",onClick:function(e){"(+)"===e.target.innerHTML?e.target.innerHTML="(-)":e.target.innerHTML="(+)"}},"(+)"),n.a.createElement(Le.a.Collapse,{eventKey:"0"},n.a.createElement(Me.a,null,n.a.createElement("pre",null,JSON.stringify(e,void 0,2)))))))})),a=n.a.createElement("div",null,n.a.createElement(Se.a,null,n.a.createElement(Xe,{pager:e.pager}),t,n.a.createElement(Xe,{pager:e.pager})));return n.a.createElement("div",null,a,n.a.createElement("pre",null,JSON.stringify(e,void 0,2)))}function wa(e){var t,a;var s=e.chosen?"chosen":"",i=Jt(e.facetType),r="add"===e.mode?n.a.createElement("div",{onClick:function(){e.onFacetClick(Object(T.a)(Object(T.a)({},e),{},{action:"add"}))},className:"sui-advEditLine "+s},n.a.createElement("span",{className:e.className})," ",i," ",e.label,"(",e.count,")"," "):n.a.createElement("div",null,n.a.createElement("span",{onClick:function(t,a){e.onFacetClick(Object(T.a)(Object(T.a)({},e),{},{action:"remove"}))},className:e.className})," ",i," ",e.label);return n.a.createElement(ra.a,{placement:"auto",delay:{show:250,hide:400},overlay:function(t){return n.a.createElement(dt.a,Object.assign({},t,{className:"c-FacetChoice--popover"}),n.a.createElement(dt.a.Content,null,e.value))},"data-filters":null===(t=e.location)||void 0===t||null===(a=t.state)||void 0===a?void 0:a.filters,popperConfig:{modifiers:[{name:"offset",options:{offset:[0,10]}}]}},r)}var xa=a(590),Ta=a(591);function ja(e){var t=Object(O.k)((function(e){return e.search.query.filters})),a=(Object(O.k)((function(e){return e.search})),Object(O.i)((function(e){return e.search})).removeFilters);var s=(null===t||void 0===t?void 0:t.map((function(e){return n.a.createElement(xa.a,{key:e.id,timeout:1e3,classNames:"item"},n.a.createElement(wa,{mode:"remove",key:"Remove ".concat(e.id),className:"sui-advTermRem u-icon__cancel-circle icon",value:e.id,labelText:e.label,label:e.label,facetType:e.field,onFacetClick:function(e){!function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];console.log("Received ",t),console.log(" try to remove id = ",t.value),a([{id:t[0].value}])}(Object(T.a)(Object(T.a)({},e),{},{action:"remove"}))}}))})))||[];return s.length&&s.unshift(n.a.createElement(xa.a,{key:"label",timeout:1e3,classNames:"item"},n.a.createElement("span",null,"Applied Filters: "))),n.a.createElement("span",null,n.a.createElement(Ta.a,{className:"sui-facetList-horiz"},s))}function Sa(e){var t=Object(N.i)().viewMode,a=Object(s.useState)("deck"),i=Object(j.a)(a,2),r=i[0],l=i[1],c=t||e.viewMode;if(C.a.isEmpty(c)||r===c||l(c),r&&t&&t!==r)return n.a.createElement(N.a,{to:r});var o=n.a.createElement(N.a,{to:"deck"});switch(r){case"gallery":o=n.a.createElement(ya,e);break;case"deck":o=n.a.createElement(et,e);break;case"list":o=n.a.createElement(ka,e)}return n.a.createElement("div",{className:"c-buttoneGroup__viewMode__wrap"},n.a.createElement("div",{className:"c-buttoneGroup__viewMode"},"View Mode:"," ",n.a.createElement(Na,{viewMode:r}),e.loadingState&&n.a.createElement($e.a,{animation:"border",role:"status"},n.a.createElement("span",{className:"sr-only"},"Loading..."))),e.showSearchFilters&&n.a.createElement(ja,null),o)}function Na(e){var t=Object(N.g)(),a=e.viewMode;var s=n.a.createElement("span",{className:"u-icon__vcard-o icon"}),i=n.a.createElement("span",{className:"u-icon__image icon"}),r=n.a.createElement("span",{className:"u-icon__list2 icon"});return n.a.createElement(D.a,{name:a,value:a,type:"radio",onChange:function(e){return function(e){t.push(e)}(e)}},n.a.createElement(R.a,{name:"viewMode",value:"deck",type:"radio"},s),n.a.createElement(R.a,{name:"viewMode",value:"gallery",type:"radio"},i),n.a.createElement(R.a,{name:"viewMode",value:"list",type:"radio"},r))}function Oa(e){var t=De(),a=Object(N.g)(),i=Object(O.k)((function(e){return e.search.loadingState})),r=Object(O.k)((function(e){return e.search})),l=V.a.stringify({page:{current:r.page.current,rows:r.page.rows},query:{filters:r.query.filters,searchText:r.query.searchText}},{allowDots:!0});return Object(s.useEffect)((function(){var e,a,s,n,i=(null===(e=r.query)||void 0===e||null===(a=e.searchText)||void 0===a?void 0:a.length)>1?'"'+r.query.searchText+'"':"*",l=(null===(s=r.query)||void 0===s||null===(n=s.filters)||void 0===n?void 0:n.length)||0,c=l?" (+"+l+" filter"+(1!==l?"s":"")+")":"";t.clear(),t.setHeaderTitle("Search Results: "+i+" "+c),t.setSubTitle("For a Better Tomorrow...")}),[l]),Object(s.useEffect)((function(){a.replace("?".concat(l))}),[l]),n.a.createElement(Sa,Object.assign({},e,{viewMode:"deck",loadingState:i,inline:!1,showSearchFilters:!0}))}function Aa(e){var t=De();return Object(s.useEffect)((function(){e.inline||(console.log(e),t.clear(),t.setHeaderTitle("Collections Viewer For A Better Tomorrow"),t.setType("collections"))})),n.a.createElement("div",{className:"Collections legacy"},"NOT YET IMPLEMENTED Collections LEGACY"," ",n.a.createElement("pre",null,JSON.stringify(e.kmasset)))}function Ca(e){var t=De();return Object(s.useEffect)((function(){t.clear(),t.setHeaderTitle("Collections Home")})),n.a.createElement(n.a.Fragment,null," Collections Home: Not much here yet.. ")}function Pa(e){De();var t=Ee((function(e){return e.kmap})),a=(t.firstRelatedsPage,t.gotoRelatedsPage),i=(t.lastRelatedsPage,t.nextRelatedsPage,t.prevRelatedsPage,t.setRelatedsPage),r=t.setRelatedsPageSize,l=t.setUid,c=(t.update,t.receiveKmap,Ee((function(e){return e.search})),ke((function(e){return e.kmap})),ke((function(e){return e.kmap.uid})),ke((function(e){return e.kmap.asset}))),o=ke((function(e){return e.kmap.relateds})),d=ke((function(e){return e.kmap.kmap})),u=(ke((function(e){return e.kmap.loadingState})),ke((function(e){var t;return null===(t=e.kmap.relatedsPage)||void 0===t?void 0:t.page}))),p=ke((function(e){var t;return null===(t=e.kmap.relatedsPage)||void 0===t?void 0:t.pageSize})),m=Object(N.i)(),h=m.id,f=m.relatedType,g="";h&&!h.match(/[a-z]\-\d+/)&&e.assetType&&(g=e.assetType+"-");var v=g+h,_={getMaxPage:function(){if(o.assets&&o.assets[f]){var e=o.assets[f].count;return Math.floor((e-1)/p)}return 0},getPage:function(){return u},setPage:function(e){e=Number(e);var t=o.assets[f].count,s=Math.floor(t/p);e=C.a.isNaN(e)?0:e,a(e>s?s:e<0?0:e)},setPageSize:function(e){e=Number(e);var t=Number(e),a=Number(u);e=e<1?1:e,e=C.a.isNaN(e)?t:e,r(e);var s=Math.floor(p/t*a);s=C.a.isNaN(s)?0:s,_.setPage(s)},getPageSize:function(){return p},nextPage:function(){_.setPage(_.getPage()+1)},prevPage:function(){_.setPage(_.getPage()-1)},lastPage:function(){_.setPage(_.getMaxPage())},firstPage:function(){_.setPage(0)}};return Object(s.useEffect)((function(){v&&(l(v),i({related_type:f,page:u,pageSize:p}))}),[v,f,u,p]),n.a.Children.map(e.children,(function(e){return e.type?n.a.cloneElement(e,{id:v,kmap:d,kmasset:c,relateds:o,pager:_}):e}))}var Da=function(e,t){return _t("kmassets",{index:"assets",params:{q:"asset_type:".concat(e," AND id:").concat(t),rows:1}})},Ra=function(){var e=Object(B.a)(q.a.mark((function e(t,a){var s,n,i,r,l;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==(s=a.query)){e.next=3;break}return e.abrupt("return",!1);case 3:return n={adapter:Y,callbackParamName:"callback",url:s},e.next=6,K.a.request(n);case 6:return i=e.sent,r=i.data,l=r&&r.response?r.response:r,e.abrupt("return",l);case 10:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),Ia=function(e){var t="";e&&(e.url_json?t=e.url_json:e.docs&&e.docs.length>0&&(t=e.docs[0].url_json)),t=t.replace(/\.json$/,".jsonp?callback=mdldata");var a=Object(nt.a)(["mndlapi",{query:t}],Ra,{enabled:t});return!(!a||!a.data)&&a.data};function La(e){var t=e.assetType,a=Object(s.useState)(null),i=Object(j.a)(a,2),r=i[0],l=i[1],c=Object(s.useState)(!1),o=Object(j.a)(c,2),d=o[0],u=o[1],p=Object(N.i)(),m=p.relId||p.id||p.nid;m.indexOf("-")>1&&(m=m.split("-").pop());var h=De();h.setType(t);var f=Da(t,m),g=Ia(f);if(Object(s.useEffect)((function(){(null===f||void 0===f?void 0:f.docs)&&f.docs.length>0?l(f.docs[0]):"success"===f.status&&u(!0)}),[f]),d){var v=t;return v=v[0].toUpperCase()+v.substr(1).replace("-v","-V"),h.setHeaderTitle(v),n.a.createElement(Pt,{type:t,id:m})}return n.a.Children.map(e.children,(function(e){return e.type?n.a.cloneElement(e,{asset_type:t,id:m,mdlasset:r,nodejson:g}):e}))}a(561);function Fa(e){var t,a=function(e,t,a){a=a||t+"_path_s";var s={};return e=C.a.filter(e,(function(e){return e.block_child_type===t})),C.a.forEach(e,(function(e,t){var n=e[a].split("/");if(e.order=t,1===n.length)s[n[0]]=e;else for(var i=s,r=0;r<n.length;r++)i[n[r]]||(i[n[r]]={}),r===n.length-1&&(i[n[r]]=e),i[n[r]]._nested_||(i[n[r]]._nested_={}),i=i[n[r]]._nested_})),s}(null===(t=e.kmap)||void 0===t?void 0:t._childDocuments_,"related_names");return n.a.createElement("div",{className:"sui-nameEntry__wrapper"},n.a.createElement("ul",{className:"sui-nameEntry first-entry"},n.a.createElement(Ma,{names:a})))}function Ma(e){var t=[];return console.log("NameEntry: props.names=",e.names),Object.entries(e.names).map((function(e){var a=Object(j.a)(e,2),s=a[0],i=a[1];return t.push(n.a.createElement("li",{id:s,key:s,className:"sui-nameEntry"},n.a.createElement("span",{className:"sui-nameEntry-header"},i.related_names_header_s),n.a.createElement("span",{className:"sui-nameEntry-meta"},n.a.createElement("span",{className:"sui-nameEntry-language"},i.related_names_language_s),n.a.createElement("span",{className:"sui-nameEntry-relationship"},i.related_names_relationship_s),n.a.createElement("span",{className:"sui-nameEntry-writing-system"},i.related_names_writing_system_s)),!C.a.isEmpty(i._nested_)&&n.a.createElement("ul",null,n.a.createElement(Ma,{names:i._nested_})))),!0})),n.a.createElement(n.a.Fragment,null,t)}a(562);var Ua=function(e){Object(N.g)();var t,a,s,i=Object(N.j)(),r=e.back||!1,l=i.params,c=l.id,o=l.relId,d=l.relatedType,u=l.viewerType,p=(l.viewMode,null);e.relatedType&&(d=e.relatedType);var m=Vt(o||c),h=Da(d,m);if(o&&d){var f=null===h||void 0===h?void 0:h.docs,g=null;(null===f||void 0===f?void 0:f.length)&&(g=f[0].caption||f[0].title?f[0].title[0]:null),p=(null===f||void 0===f?void 0:f.length)?n.a.createElement("h5",{className:"c-nodeHeader-itemHeader"},n.a.createElement("span",{className:"icon u-icon__"+f[0].asset_type}),n.a.createElement("span",{className:"c-nodeHeader-itemHeader-subType"},f[0].asset_subtype),n.a.createElement("span",{className:"c-nodeHeader-itemHeader-caption"},g)):null}var v=e.subHeader||("all"===d?"All Related Items":u?"Related "+d:null),_=(null===(t=e.kmasset)||void 0===t?void 0:t.name_tibt)?e.kmasset.name_tibt[0]:null,b=(null===(a=e.kmasset)||void 0===a?void 0:a.name_latin)?e.kmasset.name_latin[0]:e.kmasset.title[0],y=_?n.a.createElement("span",{className:"sui-nodeTitle-item tibt"},_," "):null,E=b?n.a.createElement("span",{className:"sui-nodeTitle-item latin"},b):null;return n.a.createElement("div",{className:"c-nodeHeader"},r&&n.a.createElement("div",{className:"c-nodeHeader__backLink__wrap"},n.a.createElement(S.b,{to:"..",className:"c-nodeHeader__backLink"},n.a.createElement("span",{className:"icon u-icon__arrow-left_2"},"Return"))),n.a.createElement("span",{className:"icon u-icon__".concat(null===(s=e.kmasset)||void 0===s?void 0:s.asset_type)}),n.a.createElement("span",{className:"sui-termTitle sui-nodeTitle",id:"sui-termTitle"},y," ",E)," ",v&&n.a.createElement("span",{className:"sui-relatedSubHeader"},v),p)};function qa(e){var t,a=Object(N.i)().relatedType,s=null===(t=e.relateds)||void 0===t?void 0:t.assets,i=s?s[a]:null,r=null===i||void 0===i?void 0:i.docs,l="all"!==a?"Related ".concat(a):"All Related Items";return n.a.createElement(Sa,{docs:r,pager:e.pager,title:l,viewMode:"gallery",inline:!0})}a(563),a(564);var Ba=function(e){var t,a,i=C.a.filter(null===(t=e.kmap)||void 0===t?void 0:t._childDocuments_,(function(e){return"terms_recording"===e.block_child_type})),r=Object(s.useRef)(),l=null===(a=i[0])||void 0===a?void 0:a.recording_url,c=Object(s.useState)(l),o=Object(j.a)(c,2),d=o[0],u=o[1],p=C.a.map(i,(function(e,t){return n.a.createElement("option",{key:t,value:e.recording_url},e.recording_dialect_s)})),m=d?n.a.createElement(n.a.Fragment,null,n.a.createElement("button",{className:"c-audioPlayer__button",onClick:function(){r.current.play()}},n.a.createElement("span",{className:"icon u-icon__audio"})),n.a.createElement("select",{className:"c-audioPlayer__select",onChange:function(e){return function(e){u(e.target.value)}(e)}},p)):"No Audio Available";return n.a.createElement("div",{className:"c-audioPlayer"},n.a.createElement("audio",{src:d,ref:function(e){return r.current=e}}),n.a.createElement("form",{onSubmit:function(e){return e.preventDefault(),!1}},m))},Ga=(a(565),function(e){var t=C.a.pickBy(e.kmap,(function(e,t){return/^etymology_\d+/.test(t)}));return t=C.a.reduce(t,(function(e,t,a){var s=/^etymology_(\d+)/.exec(a)[1];return e[s]||(e[s]={}),-1!==a.indexOf("_content_")?e[s].content=t:e[s].heading=t,e}),{}),n.a.createElement("div",{className:"sui-etymology__wrapper"},n.a.createElement("div",{className:"sui-etymology__content"},Object.keys(t).map((function(e){return n.a.createElement("div",{key:e,className:"sui-etymology__content-items"},n.a.createElement("span",{className:"sui-etymology__heading"},t[e].heading,":"," "),n.a.createElement("span",{className:"sui-etymology__text"},st()(t[e].content.toString().replace(/(<([^>]+)>)/gi,""))))}))))}),Ha=a(194),Ka=a(1),za=a(113),Va=(a(566),function(e){var t=e.def,a=C.a.reduce(t,(function(e,t,a){var s=a.match(/^related_definitions_branch_subjects-(\d+)_(\w+)/);if((null===s||void 0===s?void 0:s.length)>0)switch(e[s[1]]=e[s[1]]||{},s[2]){case"header_s":e[s[1]].header_title=t;break;case"subjects_headers_t":e[s[1]].header_text=t;break;case"subjects_uids_t":e[s[1]].header_uids=t}return e}),{});return n.a.createElement("div",{className:"sui-termDefDetailsWrapper"},Object.keys(a).map((function(e){return n.a.createElement("div",{key:e,className:"sui-termDefDetails__item"},n.a.createElement("span",{className:"sui-termDefDetails__title"},a[e].header_title,":"," "),n.a.createElement("span",{className:"sui-termDefDetails__text"},a[e].header_text.join(", ")))})))}),Ja=(a(567),function(){return n.a.createElement("div",null,"No Passage data currently available")}),Ya=(a(568),function(e){var t=e.defID,a=e.resCounts[t];return a?n.a.createElement("div",{className:"sui-termDefResource__wrapper"},n.a.createElement("div",{className:"sui-termDefResource__header"},"Resources tagged with this definition:"),n.a.createElement("div",{className:"sui-termDefResource__content"},Object.keys(a).filter((function(e){return"all"!==e})).map((function(e){return n.a.createElement(Fe.a,{key:e,variant:"outline-dark",size:"lg"},n.a.createElement("span",{className:"u-icon__".concat(e," icon")}),n.a.createElement("span",{className:"btn-text"},e.toUpperCase())," ",n.a.createElement("span",{className:"badge badge-light"},a[e]))})))):n.a.createElement("div",{className:"sui-termDefResource__wrapper"},"No resources are currently tagged with this definition.")}),Qa=(a(569),function(e){var t,a,s,i=(null===(t=e.kmRelated.assets)||void 0===t||null===(a=t.all)||void 0===a?void 0:a.docs)||[],r=e.kmRelated.uid,l=new RegExp("".concat(r,"_definitions-\\d+")),c={},o=Object(Ha.a)(i);try{for(o.s();!(s=o.n()).done;){var d,u=s.value,p=Object(Ha.a)(u.kmapid);try{for(p.s();!(d=p.n()).done;){var m,h=d.value;if(l.test(h))c[h]=null!==(m=c[h])&&void 0!==m?m:{},c[h][u.asset_type]=c[h][u.asset_type]+1||1,c[h].all=c[h].all+1||1}}catch(f){p.e(f)}finally{p.f()}}}catch(f){o.e(f)}finally{o.f()}return n.a.createElement("div",{className:"sui-termDefinitions_wrapper"},n.a.createElement("div",{className:"sui-termDefinitions__content"},C.a.orderBy(e.mainDefs,(function(e){return e.order}),"asc").map((function(e,t){var a;return n.a.createElement(Re.a,{key:e.id,defaultActiveKey:"definition"},n.a.createElement(Ie.a,{eventKey:"definition",title:n.a.createElement(n.a.Fragment,null,n.a.createElement("span",{className:"sui-termDefinitions__tabHeading"},"".concat(parseInt(t,10)+1,". "),"Definition"," "),n.a.createElement(Ka.b.Provider,{value:{style:{verticalAlign:"middle"}}},n.a.createElement(za.a,null)))},st()(e.related_definitions_content_s),e.related_definitions_author_s&&e.related_definitions_language_s&&n.a.createElement("div",{className:"sui-termDefinitions__extra"},n.a.createElement("span",{className:"sui-termDefinitions__extra-author"},"Author:")," ",n.a.createElement("span",{className:"sui-termDefinitions__extra-author-text"},e.related_definitions_author_s)," ","|"," ",n.a.createElement("span",{className:"sui-termDefinitions__extra-lang"},"Language:")," ",n.a.createElement("span",{className:"sui-termDefinitions__extra-lang-text"},e.related_definitions_language_s))),n.a.createElement(Ie.a,{eventKey:"details",title:n.a.createElement(n.a.Fragment,null,n.a.createElement("span",{className:"sui-termDefinitions__tabHeading"},"Details"," "),n.a.createElement(Ka.b.Provider,{value:{style:{verticalAlign:"middle"}}},n.a.createElement(za.a,null)))},n.a.createElement(Va,{def:e})),n.a.createElement(Ie.a,{eventKey:"passages",title:n.a.createElement(n.a.Fragment,null,n.a.createElement("span",{className:"sui-termDefinitions__tabHeading"},"Passages (0)"," "),n.a.createElement(Ka.b.Provider,{value:{style:{verticalAlign:"middle"}}},n.a.createElement(za.a,null)))},n.a.createElement(Ja,null)),n.a.createElement(Ie.a,{eventKey:"resources",title:n.a.createElement(n.a.Fragment,null,n.a.createElement("span",{className:"sui-termDefinitions__tabHeading"},"Resources (",(null===(a=c[e.id])||void 0===a?void 0:a.all)||0,")"," "),n.a.createElement(Ka.b.Provider,{value:{style:{verticalAlign:"middle"}}},n.a.createElement(za.a,null)))},n.a.createElement(Ya,{defID:e.id,resCounts:c})))}))))}),Wa=(a(570),function(e){var t=e.definitions;return n.a.createElement("div",{className:"sui-termDicts__wrapper"},n.a.createElement("div",{className:"sui-termDicts__title"},"Other Dictionaries"),n.a.createElement("div",{className:"sui-termDicts__content"},Object.keys(t).map((function(e,a){return n.a.createElement(n.a.Fragment,{key:e},n.a.createElement("div",{className:"sui-termDicts__dict-name"},a+1,". ",e),n.a.createElement("ul",{className:"sui-termDicts__dict-wrapper"},t[e].map((function(e){return n.a.createElement("li",{className:"sui-termDicts__dict",key:e.id},st()(e.related_definitions_content_s.replace(/(<p[^>]+?>|<p>|<\/p>)/gim,"")),e.related_definitions_language_s&&n.a.createElement("div",{className:"sui-termDicts__dict-extra"},n.a.createElement("span",{className:"sui-termDicts__dict-extra-lang"},"Language:")," ",n.a.createElement("span",{className:"sui-termDicts__dict-extra-lang-text"},e.related_definitions_language_s)))}))))}))))}),Za=(a(571),function(e){var t,a;return n.a.createElement("div",{className:"sui-termsDetails__wrapper"},n.a.createElement("ul",{className:"sui-termsDetails__list"},null===(t=e.kmAsset)||void 0===t||null===(a=t.associated_subject_map_idfacet)||void 0===a?void 0:a.map((function(e){var t=e.split("|"),a=t[1].split("=")[1].split("-");return n.a.createElement("li",{className:"sui-termsDetails__list-item",key:e},t[0].split("=")[0].toUpperCase(),": "," ",n.a.createElement(ut,{domain:a[0],kid:a[1]}))}))))});function Xa(e){var t;console.log("TermsInfo props = ",e);var a=C()(null===(t=e.kmap)||void 0===t?void 0:t._childDocuments_).pickBy((function(e){return"related_definitions"===e.block_child_type})).groupBy((function(e){return C.a.get(e,"related_definitions_source_s","main_defs")})).value();return e.kmap?n.a.createElement(n.a.Fragment,null,n.a.createElement(Za,{kmAsset:e.kmasset}),n.a.createElement(Ba,{kmap:e.kmap}),e.kmap.etymologies_ss&&n.a.createElement(Ga,{kmap:e.kmap}),n.a.createElement(Qa,{mainDefs:a.main_defs,kmRelated:e.kmRelated}),n.a.createElement(Wa,{definitions:C.a.omit(a,["main_defs"])})):n.a.createElement(n.a.Fragment,null)}function $a(e){e.kmap;var t=e.kmasset,a="no feature types";return t.feature_types_idfacet&&(a=t.feature_types_idfacet.map((function(e,t){var a=e.split("|"),s=Object(j.a)(a,2),i=s[0],r=s[1];return console.log("label = ",i),console.log("uid = ",r),n.a.createElement("li",null,n.a.createElement(Ce,{key:r,uid:r,label:i}))}))),[n.a.createElement("h3",null,"Feature Types"),n.a.createElement("ul",null,a)]}function es(e){e.kmap,e.kmasset;return n.a.createElement("div",null,n.a.createElement("h2",null," Yo this is the Subjects joint!"),n.a.createElement("pre",null,JSON.stringify(Object(T.a)(Object(T.a)({},e),{},{sui:null}),void 0,2)))}function ts(e,t){var a={adapter:Y,callbackParamName:"json_wrf",url:function(e,t){var a="REACT_APP_DRUPAL_"+(e=e.replace("-","_").toLowerCase()).toUpperCase();if(!(a in Object({NODE_ENV:"production",PUBLIC_URL:"/mandala-om",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SOLR_KMASSETS:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev",REACT_APP_SOLR_KMTERMS:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmterms_dev",REACT_APP_DRUPAL_HOME:"https://mandala-dev.shanti.virginia.edu",REACT_APP_DRUPAL_AUDIO_VIDEO:"https://audio-video-dev.shanti.virginia.edu",REACT_APP_DRUPAL_IMAGES:"https://images-dev.shanti.virginia.edu",REACT_APP_DRUPAL_SOURCES:"https://sources-dev.shanti.virginia.edu",REACT_APP_DRUPAL_PLACES:"https://mandala-dev.shanti.virginia.edu/places",REACT_APP_DRUPAL_SUBJECTS:"https://mandala-dev.shanti.virginia.edu/subjects",REACT_APP_DRUPAL_TERMS:"https://mandala-dev.shanti.virginia.edu/terms",REACT_APP_DRUPAL_TEXTS:"https://texts-dev.shanti.virginia.edu",REACT_APP_DRUPAL_VISUALS:"https://visuals-dev.shanti.virginia.edu",REACT_APP_MANDALA_KB:"https://confluence.its.virginia.edu/display/KB/Mandala+Suite+of+Tools",REACT_APP_PUBLIC_URL:"https://shanti-uva.github.io/mandala-om"})))return console.error("Drupal App host URL, "+a+", not found in React environment variables"),"";var s=Object({NODE_ENV:"production",PUBLIC_URL:"/mandala-om",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SOLR_KMASSETS:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev",REACT_APP_SOLR_KMTERMS:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmterms_dev",REACT_APP_DRUPAL_HOME:"https://mandala-dev.shanti.virginia.edu",REACT_APP_DRUPAL_AUDIO_VIDEO:"https://audio-video-dev.shanti.virginia.edu",REACT_APP_DRUPAL_IMAGES:"https://images-dev.shanti.virginia.edu",REACT_APP_DRUPAL_SOURCES:"https://sources-dev.shanti.virginia.edu",REACT_APP_DRUPAL_PLACES:"https://mandala-dev.shanti.virginia.edu/places",REACT_APP_DRUPAL_SUBJECTS:"https://mandala-dev.shanti.virginia.edu/subjects",REACT_APP_DRUPAL_TERMS:"https://mandala-dev.shanti.virginia.edu/terms",REACT_APP_DRUPAL_TEXTS:"https://texts-dev.shanti.virginia.edu",REACT_APP_DRUPAL_VISUALS:"https://visuals-dev.shanti.virginia.edu",REACT_APP_MANDALA_KB:"https://confluence.its.virginia.edu/display/KB/Mandala+Suite+of+Tools",REACT_APP_PUBLIC_URL:"https://shanti-uva.github.io/mandala-om"})[a],n="";switch(e){case"texts":n=s+"/shanti_texts/node_json/"+t;break;default:n=s}return n}(e,t)};return new Promise((function(e,t){K.a.request(a).then((function(t){var s=t.data;ns(a,s),e(s)})).catch((function(e){t(e)}))}))}function as(e,t){var a={adapter:Y,callbackParamName:"json.wrf",url:function(e,t){return"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev/select?q=asset_type:"+e+"%20AND%20id:"+t+"&wt=json"}(e,t)};return new Promise((function(e,t){K.a.request(a).then((function(t){var s=t.data.response.docs[0];ns(a,s),e(s)})).catch((function(e){t(e)}))}))}function ns(e,t){if(sessionStorage)try{sessionStorage.setItem(JSON.stringify(e),JSON.stringify(t))}catch(a){}}p()(document).ready((function(){window.show_not_found=setTimeout((function(){p()(".loading").hide(),p()(".not-found-msg").show()}),1e4)}));a(572);function is(e){var t=Object(s.useState)(e.assettype),a=Object(j.a)(t,2),i=a[0],r=(a[1],Object(s.useState)({})),l=Object(j.a)(r,2),c=l[0],o=l[1],d=De(),u=e.inline||!1;Object(s.useEffect)((function(){}));var p=Object(N.i)(),m=p.relId||p.id||p.nid;if(m.indexOf("-")>1&&(m=m.split("-").pop()),!e.children)return n.a.createElement("h2",null,"No Children?");var h=!1,f=[];return"texts"==i?f=[ts(i,m)]:"audio-video"==i&&(f=[as(i,m)]),Promise.allSettled(f).then((function(t){var a=Object(j.a)(t,1)[0],s=a.status,n=a.value;"fulfilled"===s?a&&(c.nid!==n.nid?(o(n),h=!0,u||(d.clear(),d.setHeaderTitle(n.title),d.setType(i),d.setId(n.id))):c.id!==n.id&&(o(n),h=!0,u||(d.clear(),d.setHeaderTitle(n.title[0]),d.setType(i),d.setId(n.id)))):"rejected"==s&&(o(!1),h=!0),h&&e.onStateChange&&e.onStateChange({id:m,asset_type:i,mdlasset:c})})).catch((function(e){console.error("oh dear! failure!??? ",e,f)})),n.a.Children.map(e.children,(function(e){return e.type?n.a.cloneElement(e,{id:m,asset_type:i,mdlasset:c}):e}))}function rs(e){var t,a=Object(N.j)(),i=Object(s.useState)(),r=Object(j.a)(i,2),l=r[0],c=r[1],o=De();var d=function(t,a){var s=a.get("asset_type"),i=null;switch(s){case"images":i=n.a.createElement(Ht,{kmasset:e.kmasset,kmap:e.kmap});break;case"audio-video":i=n.a.createElement(xt,{sui:window.sui});break;case"sources":i=n.a.createElement($t,null);break;case"texts":i=n.a.createElement(Yt,null);break;case"visuals":i=n.a.createElement(ta,null);break;case"subjects":case"terms":case"places":i=n.a.createElement(rs,null)}return{declaredType:s,declaredViewer:i}}(0,new URLSearchParams(Object(N.h)().search)),u=d.declaredType,p=d.declaredViewer;Object(s.useEffect)((function(){if(e.kmasset){var t;o.clear(),o.setHeaderTitle(e.kmasset.title),o.setType(e.kmasset.asset_type);var a=function(e,t){var a=[];if((null===t||void 0===t?void 0:t.ancestor_ids_is)&&(null===t||void 0===t?void 0:t.ancestors_txt))for(var s=t.asset_type,n=t.ancestor_ids_is,i=t.ancestors_txt,r=0;r<n.length;r++){var l=s+"-"+n[r],c=i[r];a.push({uid:l,name:c})}else console.log("KmapContext.assembledPath: kmasset does not have ancestor_ids_is or ancestors_txt.");return a}(e.kmap,e.kmasset);o.setPath(a),o.setId(null===(t=e.kmasset)||void 0===t?void 0:t.uid)}}),[null===(t=e.kmasset)||void 0===t?void 0:t.uid,a]);var m=n.a.createElement("div",{className:"l-content__main__wrap"},"Loading...");return e.kmasset&&e.kmasset.asset_type&&(m=n.a.createElement("section",{className:"l-content__main__wrap"},n.a.createElement("div",{className:"c-content__main__kmaps"},n.a.createElement(N.d,null,n.a.createElement(N.b,{path:"/:viewerType/:nid/related-audio-video/view/:relId"},n.a.createElement(Ua,Object.assign({},e,{kmasset:e.kmasset,relatedType:"audio-video",back:"true"})),n.a.createElement(La,{assetType:"audio-video"},n.a.createElement(xt,{sui:window.sui}))),n.a.createElement(N.b,{path:"/:viewerType/:nid/related-texts/view/:relId"},n.a.createElement(Ua,Object.assign({},e,{kmasset:e.kmasset,relatedType:"texts",back:"true"})),n.a.createElement(La,{assetType:"texts"},n.a.createElement(Yt,{inline:!0}))),n.a.createElement(N.b,{path:"/:viewerType/:nid/related-images/view/:relId"},n.a.createElement(Ua,Object.assign({},e,{kmasset:e.kmasset,relatedType:"images",back:"true"})),n.a.createElement(La,{assetType:"images"},n.a.createElement(Ht,{inline:!0}))),n.a.createElement(N.b,{path:"/:viewerType/:nid/related-sources/view/:relId"},n.a.createElement(Ua,Object.assign({},e,{kmasset:e.kmasset,relatedType:"sources",back:"true"})),n.a.createElement(is,{assettype:"sources",inline:!0},n.a.createElement($t,null))),n.a.createElement(N.b,{path:"/:viewerType/:nid/related-all/view/:relId"},n.a.createElement(Ua,Object.assign({},e,{kmasset:e.kmasset,relatedType:"all",back:"true"})),n.a.createElement(is,{assettype:u,inline:!0},p)),n.a.createElement(N.a,{from:"/:viewerType/:id/related-:relatedType/view/:relId",to:"/:viewerType/:relId"}),n.a.createElement(N.b,{path:"/:viewerType/:id/related-:relatedType/:viewMode"},n.a.createElement(Ua,Object.assign({},e,{kmasset:e.kmasset})),n.a.createElement(qa,e)),n.a.createElement(N.b,{path:"/:viewerType/:id/related-:relatedType"},n.a.createElement(N.a,{to:"./all"})),n.a.createElement(N.b,null,n.a.createElement(Ua,{kmasset:e.kmasset}),n.a.createElement(Fa,{kmap:e.kmap}),n.a.createElement(N.d,null,n.a.createElement(N.b,{path:"/subjects"},n.a.createElement(es,e)),n.a.createElement(N.b,{path:"/places"},n.a.createElement($a,e)),n.a.createElement(N.b,{path:"/terms"},n.a.createElement(Xa,{kmasset:e.kmasset,kmap:e.kmap,kmRelated:e.relateds})))))),n.a.createElement("span",{className:"sui-showinfo u-icon__info float-right",onClick:function(){return c(!0)}}),n.a.createElement(ls,{show:l,onHide:function(){return c(!1)},data:e.kmasset,scrollable:!0}))),m}function ls(e){return n.a.createElement(Ue.a,Object.assign({},e,{size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0}),n.a.createElement(Ue.a.Header,{closeButton:!0},n.a.createElement(Ue.a.Title,{id:"contained-modal-title-vcenter"},"JSON DATA")),n.a.createElement(Ue.a.Body,null,n.a.createElement("pre",null,JSON.stringify(e.data,void 0,3))),n.a.createElement(Ue.a.Footer,null,n.a.createElement(Fe.a,{onClick:e.onHide},"Close")))}var cs=function(e){var t=De();return Object(s.useEffect)((function(){t.clear(),t.setHeaderTitle("Places Home")})),n.a.createElement(n.a.Fragment,null," Places Home: Not much here yet.. ")};var os=function(e){var t=De();return Object(s.useEffect)((function(){t.clear(),t.setHeaderTitle("Subjects Home")})),n.a.createElement(n.a.Fragment,null," Subjects Home: Not much here yet.. ")};var ds=function(e){var t=De();return Object(s.useEffect)((function(){t.clear(),t.setHeaderTitle("Terms Home")})),n.a.createElement(n.a.Fragment,null," Terms Home: Not much here yet.. ")};function us(e){var t=Object(N.j)().path,a=e.title||"Untitled",s=e.site||"defauit";return n.a.createElement("main",{className:"l-column__main"},n.a.createElement("article",{id:"l-column__main__wrap",className:"l-column__main__wrap"},n.a.createElement(Pa,null,n.a.createElement(Pe,{siteClass:s,title:a,sui:e.sui})),n.a.createElement("section",{id:"l-content__main",className:"l-content__main"},n.a.createElement(N.d,null,n.a.createElement(N.b,{path:"".concat(t,"audio-video/:id")},n.a.createElement(La,{assetType:"audio-video"},n.a.createElement(xt,{sui:e.sui,ismain:!0}))),n.a.createElement(N.b,{path:"".concat(t,"audio-video")},n.a.createElement(St,null)),n.a.createElement(N.b,{path:"".concat(t,"images/:id")},n.a.createElement(La,{assetType:"images"},n.a.createElement(Ht,{ismain:!0,sui:e.sui}))),n.a.createElement(N.b,{path:"".concat(t,"images")},n.a.createElement(Kt,null)),n.a.createElement(N.b,{path:"".concat(t,"texts/:id")},n.a.createElement(La,{assetType:"texts"},n.a.createElement(Yt,{ismain:!0,onStateChange:e.onStateChange}))),n.a.createElement(N.b,{path:"".concat(t,"texts")},n.a.createElement(Xt,null)),n.a.createElement(N.b,{path:"".concat(t,"sources/:id")},n.a.createElement($t,{id:e.id,sui:e.sui,onStateChange:e.onStateChange})),n.a.createElement(N.b,{path:"".concat(t,"sources")},n.a.createElement(ea,null)),n.a.createElement(N.b,{path:"".concat(t,"visuals/:id")},n.a.createElement(ta,{id:e.id,sui:e.sui,onStateChange:e.onStateChange})),n.a.createElement(N.b,{path:"".concat(t,"visuals")},n.a.createElement(aa,null)),n.a.createElement(N.b,{path:["".concat(t,"places/:id/related-:relatedType/:viewMode"),"".concat(t,"places/:id")]},n.a.createElement(Pa,{assetType:"places"},n.a.createElement(ua,null),n.a.createElement(rs,{id:e.id,sui:e.sui,onStateChange:e.onStateChange}))),n.a.createElement(N.b,{path:"".concat(t,"places")},n.a.createElement(cs,null)),n.a.createElement(N.b,{path:["".concat(t,"subjects/:id/related-:relatedType/:viewMode"),"".concat(t,"subjects/:id")]},n.a.createElement(Pa,{assetType:"subjects"},n.a.createElement(ua,null),n.a.createElement(rs,{id:e.id,sui:e.sui,onStateChange:e.onStateChange}))),n.a.createElement(N.b,{path:"".concat(t,"subjects")},n.a.createElement(os,null)),n.a.createElement(N.b,{path:["".concat(t,"terms/:id/related-:relatedType/:viewMode"),"".concat(t,"terms/:id")]},n.a.createElement(Pa,{assetType:"terms"},n.a.createElement(ua,null),n.a.createElement(rs,{id:e.id,sui:e.sui,onStateChange:e.onStateChange})," ")),n.a.createElement(N.b,{path:"".concat(t,"terms")},n.a.createElement(ds,null)),n.a.createElement(N.b,{path:"".concat(t,"terms/:id/related-:relatedType")},n.a.createElement(N.a,{to:"./default"})),n.a.createElement(N.b,{path:"".concat(t,"collections/:id")},n.a.createElement(Aa,{id:e.id,sui:e.sui,onStateChange:e.onStateChange})),n.a.createElement(N.b,{path:"".concat(t,"collections")},n.a.createElement(Ca,null)),n.a.createElement(N.b,{path:"".concat(t,"search/:viewMode")},n.a.createElement(we,null,n.a.createElement(Oa,null))),n.a.createElement(N.b,{exact:!0,path:"".concat(t,"search")},n.a.createElement(N.a,{to:"".concat(t,"search/default")})),n.a.createElement(N.b,{path:"".concat(t,"assets/:id")},n.a.createElement(ua,null),n.a.createElement(fa,{id:e.id,sui:e.sui,onStateChange:e.onStateChange})),n.a.createElement(N.b,{path:"".concat(t,"poptest/:dom/:kid"),component:mt}),n.a.createElement(N.b,{path:"*"},n.a.createElement(Os,null))))))}function ps(e){var t=e.hamburgerOpen?"open":"closed";return n.a.createElement("div",{className:"sui-hamburger ".concat(t),id:"sui-hamburger"},n.a.createElement("span",{id:"sui-help",className:"sui-hamItem"},"\ue67e","\xa0\xa0HELP GUIDE"),n.a.createElement("span",{id:"sui-home",className:"sui-hamItem"},"\ue60b","\xa0\xa0HOME"))}var ms=a(72);a(573);function hs(e){return n.a.createElement("span",{className:"sui-advEdit-facet-ctrls-btns"},n.a.createElement(D.a,{onChange:e.onChange,name:e.name+"_field",type:"radio",value:e.value,ref:e.ref},n.a.createElement(R.a,{name:e.name+"_field",type:"radio",value:"count",onClick:e.onClick},"#"),n.a.createElement(R.a,{name:e.name+"_field",type:"radio",value:"index",onClick:e.onClick},"A-Z")),e.loadingState&&n.a.createElement($e.a,{animation:"border",role:"status"},n.a.createElement("span",{className:"sr-only"},"Loading...")))}function fs(e){var t=Object(s.useRef)(null),a=(Object(s.useRef)(null),Object(s.useState)("count")),i=Object(j.a)(a,2),r=i[0],l=i[1],c=(Object(s.useRef)(null),Object(s.useState)("desc")),o=Object(j.a)(c,2),d=o[0],u=o[1],p=Object(s.useState)(!1),m=Object(j.a)(p,2),h=m[0],f=m[1],g=e.icon,v=e.facetType,_=e.facets,b=e.chosenFacets||[],y=Object(O.k)((function(e){return e.search.loadingState}));Object(s.useEffect)((function(){w()}),[r,d]),Object(s.useEffect)((function(){t.current.value=""}),[e.resetFlag]);var E,k=(E="id",b.reduce((function(e,t){return e[t[E]]=t,e}),{}));function w(){var a,s;e.onNarrowFilters&&e.onNarrowFilters({filter:e.facetType,search:t.current.value,sort:r+" "+d,limit:(null===(a=t.current)||void 0===a||null===(s=a.value)||void 0===s?void 0:s.length)?-1:null})}var x=C.a.debounce((function(){console.log("handleChange: ",t.current.value),w()}),500),S=function(e){return!!k[e]},N={"audio-video":n.a.createElement("span",{className:"icon u-icon__audio-video"}),texts:n.a.createElement("span",{className:"icon u-icon__texts"}),"texts:pages":n.a.createElement("span",{className:"icon u-icon__texts"}),images:n.a.createElement("span",{className:"icon u-icon__images"}),sources:n.a.createElement("span",{className:"icon u-icon__sources"}),visuals:n.a.createElement("span",{className:"icon u-icon__visuals"}),places:n.a.createElement("span",{className:"icon u-icon__places"}),subjects:n.a.createElement("span",{className:"icon u-icon__subjects"}),terms:n.a.createElement("span",{className:"icon u-icon__terms"}),collections:n.a.createElement(I.a,null),asset_type:n.a.createElement(L.b,null),users:n.a.createElement("span",{className:"icon u-icon__community"}),creator:n.a.createElement("span",{className:"icon u-icon__agents"}),languages:n.a.createElement("span",{className:"icon u-icon__comments-o"}),feature_types:n.a.createElement(L.c,null),associated_subjects:n.a.createElement("span",{className:"icon u-icon__essays"}),perspective:n.a.createElement("span",{className:"icon u-icon__file-picture"})},A=g=g||N[v],P=n.a.createElement("span",{className:"u-icon__plus icon"}),D=n.a.createElement("span",{className:"u-icon__minus icon"}),R=e.label||"UNKNOWN LABEL";var F=C.a.map(null===_||void 0===_?void 0:_.buckets,(function(t){var a=function(e){var t=e.val;return"u-icon__"+(t="texts:pages"===t?"file-text-o":t)+" icon"}(t),s=function(e,t){var a="",s="",i="";if(e.val.match(/[^=]+\=[^\|]+\|[^=]+.*/)){var r=e.val.split("|"),l=Object(j.a)(r,2),c=l[0],o=l[1],d=c.split("="),u=Object(j.a)(d,2),p=u[0],m=(u[1],o.split("=")),h=Object(j.a)(m,2),f=h[0];h[1];a=p+": "+f,s=e.val,i=a}else{var g=e.val.split("|"),v=Object(j.a)(g,2);a=v[0],s=v[1],a=a||"undefined";var _=t&&s?n.a.createElement("span",null,"(",s,")"):"";i=n.a.createElement("span",{uid:s},a," ",_)}return{label:a,fullLabel:i,value:s||a}}(t,!1),i=s.label,r=s.fullLabel,l=s.value,c=t.count,o=v+":"+function(e){var t=e.split("|");return t[1]?t[1]:e}(t.val);return n.a.createElement(wa,{mode:"add",key:"".concat(l," ").concat(i," ").concat(v),className:a,value:l,labelText:i,label:r,count:c,facetType:v,chosen:S(o),onFacetClick:function(t){e.onFacetClick(Object(T.a)(Object(T.a)({},t),{},{action:S(o)?"remove":"add"}))}})})),M=C.a.map(e.chosenFacets,(function(t){return n.a.createElement(wa,{mode:"remove",key:"Remove ".concat(t.match," ").concat(R," ").concat(v),className:"sui-advTermRem u-icon__cancel-circle icon",value:t.match,labelText:t.label,label:t.label,facetType:v,onFacetClick:function(t){e.onFacetClick(Object(T.a)(Object(T.a)({},t),{},{action:"remove"}))}})})),U="sort_"+e.id;return n.a.createElement("div",{className:"sui-advBox sui-advBox-"+e.id},n.a.createElement("div",{className:"sui-advHeader",id:"sui-advHeader-A",onClick:function(){return f(!h)}},n.a.createElement("span",{className:"icon"},A),n.a.createElement("span",null,R),n.a.createElement("span",{id:"sui-advPlus-"+e.id,className:"sui-advPlus"},n.a.createElement(ms.a,{pill:!0,variant:F.length?"primary":"secondary"},F.length)," ",h?D:P)),n.a.createElement("div",{className:"sui-advTerm",id:"sui-advTerm-"+e.id},M),n.a.createElement("div",{className:"sui-advEdit c-FacetBox--expander "+(h?"open":"closed"),id:"sui-advEdit-"+e.id},n.a.createElement("div",{className:"sui-advEdit-facet-ctrls"},n.a.createElement("input",{type:"text",placeholder:"Filter this list",onChange:x,defaultValue:"",onKeyDownCapture:function(e){13===e.keyCode&&w()},ref:t}),n.a.createElement(hs,{onChange:l,name:U,value:r,onClick:function(e){e.target.name&&e.target.value===r&&u("asc"===d?"desc":"asc")},loadingState:y})),n.a.createElement("div",{className:"sui-adv-facetlist overflow-auto"},F)))}var gs=a(56),vs=a(93),_s=a(195),bs=a.n(_s);function ys(e){var t=Object(s.useRef)(null),a=(Object(s.useRef)(null),Object(s.useState)("count")),i=Object(j.a)(a,2),r=i[0],l=(i[1],Object(s.useRef)(null),Object(s.useState)("desc")),c=Object(j.a)(l,2),o=c[0],d=(c[1],Object(s.useState)(!1)),u=Object(j.a)(d,2),p=u[0],m=u[1],h=e.icon,f=e.facetType,g=(e.facets,e.chosenFacets||[]),v=(Object(O.k)((function(e){return e.search.loadingState})),Object(O.k)((function(e){return e.history.historyStack}))),_=Object(O.i)((function(e){return e.history})).removeType;var b;b="id",g.reduce((function(e,t){return e[t[b]]=t,e}),{});function y(){var a,s;e.onNarrowFilters&&e.onNarrowFilters({filter:e.facetType,search:t.current.value,sort:r+" "+o,limit:(null===(a=t.current)||void 0===a||null===(s=a.value)||void 0===s?void 0:s.length)?-1:null})}var E=C.a.debounce((function(){console.log("handleChange: ",t.current.value),y()}),500),k=(h=h||{"audio-video":n.a.createElement("span",{className:"icon u-icon__audio-video"}),texts:n.a.createElement("span",{className:"u-icon__texts icon"}),"texts:pages":n.a.createElement("span",{className:"u-icon__texts icon"}),images:"\ue62a",sources:"\ue631",visuals:"\ue63b",places:"\ue62b",subjects:"\ue634",terms:"\ue635",collections:"\ue633","recent-searches":"\ue62e",asset_type:"\ue60b",users:"\ue600",creator:"\ue600",languages:"\ue670",feature_types:n.a.createElement("span",{className:"u-icon__explore icon"})}[f],n.a.createElement("span",{className:"u-icon__plus icon"})),w=n.a.createElement("span",{className:"u-icon__minus icon"}),x=e.label||"UNKNOWN LABEL";var T=function(e){return e.filter((function(e){var t;return(null===(t=e.search)||void 0===t?void 0:t.length)>0})).length}(v),S=n.a.createElement(da,{mode:"search"});e.id;return n.a.createElement("div",{className:"sui-advBox sui-advBox-"+e.id},n.a.createElement("div",{className:"sui-advHeader",id:"sui-advHeader-A",onClick:function(){return m(!p)}},n.a.createElement("span",{className:"icon"},n.a.createElement(L.a,null)),n.a.createElement("span",null,x),n.a.createElement("span",{id:"sui-advPlus-"+e.id,className:"sui-advPlus"},n.a.createElement(ms.a,{pill:!0,variant:T?"primary":"secondary"},T)," ",p?w:k)),n.a.createElement("div",{className:"sui-advEdit "+(p?"open":"closed"),id:"sui-advEdit-"+e.id},n.a.createElement(gs.a,null,n.a.createElement(bs.a.Item,{className:"sui-advEdit-facet-ctrls"},n.a.createElement("input",{type:"text",placeholder:"Filter this list",onChange:E,defaultValue:"",onKeyDownCapture:function(e){13===e.keyCode&&y()},ref:t})),n.a.createElement(gs.a.Collapse,{className:"justify-content-end"},n.a.createElement(bs.a.Link,{eventKey:"resetHistory",onClick:function(){console.log("HistoryBox:  RESET HISTORY"),_(ge.search)}},"clear"))),n.a.createElement("div",{className:"sui-adv-facetlist overflow-auto"},T?S:"Search History is empty.")))}ys.propTypes={label:ia.string,chosenIcon:ia.string,facetType:ia.string,filters:ia.array};function Es(e){var t,a,i,r,l,c,o,d,u,p,m,h=Object(N.g)(),f=e.advanced?"open":"closed",g=Object(s.useState)(0),v=Object(j.a)(g,2),_=v[0],b=v[1],y=Object(O.k)((function(e){return e.history.historyStack})),E=Object(N.j)("/search");function k(t){t.facetType,t.value,t.operator;var a=t.action,s=e.search,n="".concat(t.facetType,":").concat(t.value);if(null===a||"add"===a){var i={id:n,label:t.labelText,operator:t.operator,field:t.facetType,match:t.value};console.log("NEW FILTER: "+JSON.stringify(i,void 0,2)),s.addFilters([i])}else"remove"===a&&s.removeFilters([{id:n}]);E||h.push("/search")}function w(t){e.search.narrowFilters(t)}function x(t){var a,s;return null===(a=e.search.query)||void 0===a||null===(s=a.filters)||void 0===s?void 0:s.filter((function(e){return e.field===t}))}return n.a.createElement("aside",{id:"l-column__search",className:"l-column__search ".concat(f," overflow-auto")},"function"===typeof e.onStateChange&&n.a.createElement(gs.a,{className:"justify-content-end"},n.a.createElement(vs.a.Link,{onClick:function(){"function"===typeof e.onStateChange?e.onStateChange({advanced:!1}):console.error("SearchAdvanced: No onStateChange() function passed in properties!")}},n.a.createElement("span",{className:"icon shanticon-cancel"}))),n.a.createElement(gs.a,null,n.a.createElement(gs.a.Toggle,null),!E&&n.a.createElement(S.b,{to:"/search"},"<<"," Show Results"," ",n.a.createElement(ms.a,{pill:!0,variant:"secondary"},e.pager.numFound)),n.a.createElement(gs.a.Collapse,{className:"justify-content-end"},n.a.createElement(gs.a.Text,null,"Reset: "),n.a.createElement(vs.a.Link,{eventKey:"resetFilters",onClick:function(){e.search&&e.search.clearFilters(),b(_+1)}},"Filters"),"|",n.a.createElement(vs.a.Link,{eventKey:"resetAll",onMouseOver:function(e){return console.log(e)},onClick:function(){e.search&&e.search.clearAll(),b(_+1)}},"All"))),n.a.createElement("section",null,n.a.createElement(fs,{id:"asset_type",label:"item type",facets:null===(t=e.facets)||void 0===t?void 0:t.asset_count,facetType:"asset_type",resetFlag:_,onFacetClick:k,onNarrowFilters:w,chosenFacets:x("asset_type")}),n.a.createElement(fs,{id:"subjects",label:"related subjects",facets:null===(a=e.facets)||void 0===a?void 0:a.related_subjects,facetType:"subjects",resetFlag:_,onFacetClick:k,onNarrowFilters:w,chosenFacets:x("subjects")}),n.a.createElement(fs,{id:"places",label:"related places",facets:null===(i=e.facets)||void 0===i?void 0:i.related_places,facetType:"places",resetFlag:_,onFacetClick:k,onNarrowFilters:w,chosenFacets:x("places")}),n.a.createElement(fs,{id:"terms",label:"related terms",facets:null===(r=e.facets)||void 0===r?void 0:r.related_terms,facetType:"terms",resetFlag:_,onFacetClick:k,onNarrowFilters:w,chosenFacets:x("terms")}),n.a.createElement(fs,{id:"feature_types",label:"feature types",facets:null===(l=e.facets)||void 0===l?void 0:l.feature_types,facetType:"feature_types",resetFlag:_,onFacetClick:k,onNarrowFilters:w,chosenFacets:x("feature_types")}),n.a.createElement(fs,{id:"collections",label:"collections",facets:null===(c=e.facets)||void 0===c?void 0:c.collections,facetType:"collections",resetFlag:_,onFacetClick:k,onNarrowFilters:w,chosenFacets:x("collections")}),n.a.createElement(fs,{id:"languages",label:"languages",facets:null===(o=e.facets)||void 0===o?void 0:o.languages,facetType:"languages",resetFlag:_,onFacetClick:k,onNarrowFilters:w,chosenFacets:x("languages")}),n.a.createElement(fs,{id:"users",label:"users",facets:null===(d=e.facets)||void 0===d?void 0:d.node_user,facetType:"users",resetFlag:_,onFacetClick:k,onNarrowFilters:w,chosenFacets:x("users")}),n.a.createElement(fs,{id:"creator",label:"creator",facets:null===(u=e.facets)||void 0===u?void 0:u.creator,facetType:"creator",resetFlag:_,onFacetClick:k,onNarrowFilters:w,chosenFacets:x("creator")}),n.a.createElement(fs,{id:"perspective",label:"perspective",facets:null===(p=e.facets)||void 0===p?void 0:p.perspective,facetType:"perspective",resetFlag:_,onFacetClick:k,onNarrowFilters:w,chosenFacets:x("perspective")}),n.a.createElement(fs,{id:"associated subjects",label:"Associated Subjects",facets:null===(m=e.facets)||void 0===m?void 0:m.associated_subjects,facetType:"associated_subjects",resetFlag:_,onFacetClick:k,onNarrowFilters:w,chosenFacets:x("associated_subjects")}),n.a.createElement(ys,{historyStack:y,id:"recent",label:"recent searches",facetType:"recent-searches"})),n.a.createElement("div",{className:"sui-advFooter"},"Show Boolean Controls? \xa0",n.a.createElement("input",{type:"checkbox",id:"sui-showBool",defaultChecked:"checked"})))}function ks(){var e,t,a,n,i,r,l=Ee((function(e){return e.search})).setSearchState,c=Ee((function(e){return e.history})),o=c.addLocation,d=(c.clear,Object(N.h)()),u=Object(N.j)(["/:type/:id/related-:relType/view/:relId","/:type/:id","/:type"]),p=Object(N.j)("/search/:mode"),m=null===u||void 0===u||null===(e=u.params)||void 0===e?void 0:e.relType,h=null===u||void 0===u||null===(t=u.params)||void 0===t?void 0:t.relId;function f(e){if(!e)return null;var t=e.match(/(\d+)$/)||[];return Object(j.a)(t,1)[0]}var g=f(null===u||void 0===u?void 0:u.params.id),v=Da(null===u||void 0===u?void 0:u.params.type,g),_=f(h),b=Da(m,_);function y(e){var t=null;return(null===e||void 0===e?void 0:e.length)&&((t=e[0].title)||(t=e[0].caption)),t||(t=null),t}var E=z.parse(d.search,{allowDots:!0,ignoreQueryPrefix:!0,depth:5}),k={searchString:"",filters:[]};(null===(a=E.query)||void 0===a||null===(n=a.searchText)||void 0===n?void 0:n.length)&&(k.searchString=E.query.searchText),(null===(i=E.query)||void 0===i||null===(r=i.filters)||void 0===r?void 0:r.length)&&(k.filters=E.query.filters),E.page&&(k.page={current:Number(E.page.current),rows:Number(E.page.rows)}),E.key&&(k.key=E.key),Object(s.useEffect)((function(){var e;(null===(e=d.search)||void 0===e?void 0:e.length)&&l(k)}),[d.search]),Object(s.useEffect)((function(){if(p&&k){var e,t;if((null===(e=k.filters)||void 0===e?void 0:e.length)>0){var a=1===k.filters.length?"":"s";" (+".concat(k.filters.length," filter").concat(a,")")}var s=Object(T.a)(Object(T.a)({},d),{},{name:'"'+k.searchString+'"',pathname:u.url,state:k});""===k.searchString&&0===(null===(t=k.filters)||void 0===t?void 0:t.length)||o(s)}}),[d.search]);var w=(null===u||void 0===u?void 0:u.url)||"",x=(null===b||void 0===b?void 0:b.docs)||[];return Object(s.useEffect)((function(){if(v&&v.numFound>0){var e=y(v.docs),t=y(b.docs),a=m?t:null,s=Object(T.a)(Object(T.a)({},d),{},{name:e,relTitle:a,pathname:u.url,asset_type:null===v||void 0===v?void 0:v.docs[0].asset_type,kmasset:null===v||void 0===v?void 0:v.docs[0]});o(s)}}),[o,v,d,w,x,m]),null}var ws={kmasset:{header:"Mandala",title:["Mandala"],uid:"mandala"}};function xs(e){var t=Object(s.useState)(ws),a=Object(j.a)(t,2),i=a[0],r=a[1],l=function(e){r(Object(T.a)(Object(T.a)({},i),e))},c=Object(O.j)(),o=n.a.createElement("div",{className:"loading-msg"},"Loading..."),d=[];i.advanced&&d.push("u-ToggleState--advanced"),i.tree&&d.push("u-ToggleState--tree"),i.tree||i.advanced||d.push("u-ToggleState--off");var u=d.join(" "),p=n.a.createElement(S.a,{basename:"/mandala-om"},n.a.createElement("div",{id:"l-site__wrap",className:"l-site__wrap  ".concat(u)},n.a.createElement(ks,null),n.a.createElement(Te,{advanced:i.advanced,tree:i.tree,onStateChange:l}),n.a.createElement(ps,{hamburgerOpen:i.hamburgerOpen}),n.a.createElement(N.d,null,n.a.createElement(N.b,{path:"/home"},n.a.createElement(Ae,null)),n.a.createElement(N.b,{exact:!0,path:"/"},n.a.createElement(N.a,{to:"/home"})),n.a.createElement(N.b,{path:"/"},n.a.createElement(us,{site:"mandala",mode:"development",title:"Mandala",sui:e.sui,kmasset:i.kmasset,kmap:i.kmap,onStateChange:l})),n.a.createElement(N.b,{path:"*"},n.a.createElement(Os,null),n.a.createElement(Ae,null))),n.a.createElement(we,null,n.a.createElement(Es,{advanced:i.advanced,onStateChange:l}),n.a.createElement(Ts,{tree:i.tree})),n.a.createElement(ps,{hamburgerOpen:i.hamburgerOpen})));return c?p:o}function Ts(e){var t=e.tree?"open":"closed";return n.a.createElement("aside",{id:"l-column__search--treeNav",className:"l-column__search c-TreeNav--tabs ".concat(t," overflow-auto")},n.a.createElement("div",null,n.a.createElement("span",{class:"sacrifical-dummy-element-that-is-not-displayed-for-some-reason"}),n.a.createElement(Re.a,{defaultActiveKey:"places",id:"kmaps-tab"},n.a.createElement(Ie.a,{eventKey:"places",title:"Places"},n.a.createElement(js,null)),n.a.createElement(Ie.a,{eventKey:"subjects",title:"Subjects"},n.a.createElement(Ns,null)),n.a.createElement(Ie.a,{eventKey:"terms",title:"Terms"},n.a.createElement(Ss,null)))))}function js(e){return n.a.createElement(na,{domain:"places",tree:"places",descendants:!0,directAncestors:!1,displayPopup:!1,perspective:"pol.admin.hier",view:"roman.scholar",sortBy:"position_i+ASC"})}function Ss(e){return n.a.createElement(na,{domain:"terms",tree:"terms",descendants:!0,directAncestors:!1,displayPopup:!1,perspective:"tib.alpha",view:"roman.scholar",sortBy:"position_i+ASC"})}function Ns(e){return n.a.createElement(na,{domain:"subjects",tree:"subjects",descendants:!0,directAncestors:!1,displayPopup:!1,perspective:"gen",view:"gen",sortBy:"position_i+ASC"})}function Os(){return n.a.createElement("div",null,n.a.createElement("h2",null,"OUCH!"),"Unknown Path: ",window.location.pathname)}var As=function(e){Object(o.a)(a,e);var t=Object(d.a)(a);function a(e){var s;return Object(l.a)(this,a),s=t.call(this),window.sui||(window.sui=new h),s.sui=window.sui,window.sui.pages||(s.sui.pages=window.sui.pages=new x(s.sui)),s}return Object(c.a)(a,[{key:"render",value:function(){return n.a.createElement(xs,{sui:this.sui})}}]),a}(n.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Cs=Object(O.d)(Object(O.f)(be,{storage:ee.a})),Ps=document.getElementById("root");Ps&&r.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(O.a,{store:Cs},n.a.createElement(As,null))),Ps),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[312,1,2]]]);
//# sourceMappingURL=main.0c89a604.chunk.js.map