(this["webpackJsonpkmaps-app"]=this["webpackJsonpkmaps-app"]||[]).push([[0],{233:function(e,t,s){e.exports=s(448)},238:function(e,t,s){},239:function(e,t,s){},240:function(e,t,s){},280:function(e,t){},299:function(e,t,s){},316:function(e,t){},333:function(e,t,s){},334:function(e,t,s){},335:function(e,t,s){},363:function(e,t){},365:function(e,t){},374:function(e,t){},376:function(e,t){},403:function(e,t){},404:function(e,t){},448:function(e,t,s){"use strict";s.r(t);var a=s(0),i=s.n(a),n=s(37),r=s.n(n),l=(s(238),s(7)),o=s(8),c=s(16),u=s(15),d=s(1),p=s.n(d),h=function(){function e(t){if(Object(l.a)(this,e),"undefined"===typeof p.a)throw"This libraries requires jQuery";this.defaultState={solrUrl:"https://solrUrl.must.be.set.in.the.state.object",mode:"input",view:"Card",sort:"Alpha",type:"All",page:0,pageSize:100,query:{text:"",places:[],collections:[],languages:[],features:[],subjects:[],terms:[],relationships:[],users:[],assets:[],dateStart:"",dateEnd:"",project_filter:""}},t&&(this.defaultState=p.a.extend(!0,{},this.defaultState,t)),this.facetJSON={asset_counts:{limit:100,type:"terms",field:"asset_type",domain:{excludeTags:"ast"}},places:{limit:300,type:"terms",field:"kmapid_places_idfacet"},subjects:{limit:300,type:"terms",field:"kmapid_subjects_idfacet"},terms:{limit:300,type:"terms",field:"kmapid_terms_idfacet"},features:{limit:300,type:"terms",field:"feature_types_idfacet"},languages:{limit:300,type:"terms",field:"node_lang"},collections:{limit:300,type:"terms",field:"collection_idfacet"},collection_nid:{limit:300,type:"terms",field:"collection_nid"},collection_uid:{limit:300,type:"terms",field:"collection_uid_s"},asset_subtype:{limit:300,type:"terms",field:"asset_subtype",facet:{parent_type:{limit:1,type:"terms",field:"asset_type"}}},node_user:{limit:300,type:"terms",field:"user_name_full_s"},creator:{limit:300,type:"terms",field:"creator"}},this.facetAdvancedJSON={related:{domain:{blockChildren:"block_type:parent"},type:"terms",field:"related_subjects_relation_code_s",limit:-1,facet:{related_subject:{type:"terms",field:"related_subjects_id_s",limit:-1,facet:{related_subject_name:{type:"terms",field:"related_subjects_header_s",limit:1}}}}}}}return Object(o.a)(e,[{key:"allAssets",value:function(){return[{id:"audio-video",title:"audio-video",bool:"OR"},{id:"images",title:"images",bool:"OR"},{id:"texts",title:"images",bool:"OR"},{id:"visuals",title:"visuals",bool:"OR"},{id:"sources",title:"sources",bool:"OR"},{id:"subjects",title:"subjects",bool:"OR"},{id:"places",title:"places",bool:"OR"},{id:"terms",title:"terms",bool:"OR"}]}},{key:"createBasicQuery",value:function(e,t,s){var a=this.allAssets();e=p.a.extend(!0,{},this.defaultState,e);var i={};if(t&&t.length>0)for(var n=0;n<t.length;n++){var r=t[n],l=this.facetJSON[r];l?i[r]=l:console.error("Warning: ignoring unknown facet: "+r)}p.a.isEmptyObject(i)&&(console.log("no currentFacets so using ALL facets"),i=this.facetJSON);var o=[];if(s&&s.length>0)for(var c=0;c<s.length;c++){var u=s[c].split(":"),d=u[0],h=u[1],m=this.facetJSON[d].field+":*"+h+"*";o.push(m)}var g=e.query.text||"";g=g.replace(/ /g,"\\ ").replace("(","\\(").replace(")","\\)").replace(":","\\:").replace("+","\\+").replace("-","\\-").replace('"','\\"').replace("?","\\?");var f=e.page||0,v=e.pageSize||100;o.length>0&&(v=0);var b=g.length?g+"*":"*",y=g.length?"*"+g+"*":"*",_=g+"/";"undefined"!==p.a.type(g)&&0!==g.length||(g=y=_="*");var k=f*v,w=[];if(e.query.places&&e.query.places.length&&w.push(this.buildFq(e.query.places,"kmapid")),e.query.subjects&&e.query.subjects.length&&w.push(this.buildFq(e.query.subjects,"kmapid")),e.query.terms&&e.query.terms.length&&w.push(this.buildFq(e.query.terms,"kmapid")),e.query.features&&e.query.features.length&&w.push(this.buildFq(e.query.features,"feature_types_ss","title")),e.query.collections&&e.query.collections.length&&w.push(this.buildFq(e.query.collections,"collection_uid_s","id")),e.query.languages&&e.query.languages.length&&w.push(this.buildFq(e.query.languages,"node_lang","title")),e.query.assets&&e.query.assets.length){for(var x=0;x<e.query.assets.length;x++)"all"===e.query.assets[x].id&&(e.query.assets=a);w.push(this.buildFq(e.query.assets,"asset_type","id","ast"))}e.query.users&&e.query.users.length&&w.push(this.buildFq(e.query.users,"node_user","title")),e.query.creators&&e.query.creators.length&&w.push(this.buildFq(e.query.creators,"creator","title")),e.project_filter&&e.project_filter.length&&w.push(e.project_filter);var E="";e.query.kmapid&&(E=e.query.kmapid);var S={q:"( title:${xact}^100 title:${slashy}^100 names_txt:${xact}^90 title:${starts}^80 names_txt:${starts}^70 title:${search}^10 caption:${search} summary:${search} names_txt:${search})",xact:g,starts:b,search:y,slashy:_},T={q:"(uid:${kmapid}^100 kmapid:${kmapid})",kmapid:E};"*"!==g&&""!==g||(S={q:"*"});var j=E.length?T:S,C=p.a.extend({},{fl:"*",wt:"json",start:k,rows:v,facet:"on","json.facet":JSON.stringify(i),echoParams:"explicit",indent:"true"},j),D=e.solrUrl,O=new URLSearchParams(C);for(x=0;x<w.length;x++)O.append("fq",w[x]);for(var P=0;P<o.length;P++)O.append("fq",o[P]);return new URL(D+"?"+O.toString())}},{key:"createKmapQuery",value:function(e,t,s,a){var i=this.allAssets();a=a||10,s=s||0;var n=t?[{id:t,title:t,bool:"OR"}]:i;return this.createBasicQuery({page:s,pageSize:a,query:{kmapid:e,assets:n}},["asset_counts"])}},{key:"createAssetsByCollectionQuery",value:function(e,t,s){return this.createBasicQuery({page:t,pageSize:s,query:{collections:[{title:e,id:e,bool:"OR"}]}})}},{key:"buildFq",value:function(e,t,s,a){s||(s="id");for(var i=a?"{!tag="+a+"}":"",n="",r=0;r<e.length;r++){var l=e[r],o=l[s],c="";"AND"===l.bool?c="+":"NOT"===l.bool?c="-":"OR"===l.bool?c="":console.error("Unknown operator = "+l.bool+" : "+JSON.stringify(l)),n+=" "+c+'"'+o+'"'}return i+t+":("+n+")"}},{key:"createAdvancedFacetQuery",value:function(e){(e=p.a.extend(!0,{},this.defaultState,e)).solrUrl="https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmterms_dev/select";var t=e.query.text||"",s=e.page||0,a=e.pageSize||100,i=t+"*",n="*"+t+"*",r=t+"/";"undefined"!==p.a.type(t)&&0!==t.length||(t=n=r="*");var l={q:"( header:${xact}^100 header:${slashy}^100 header:${starts}^80 header:${search}^10)",xact:t,starts:i,search:n,slashy:r,fl:"*,[child parentFilter=block_type:parent]",wt:"json",start:s,rows:a,facet:"on","json.facet":JSON.stringify(this.facetAdvancedJSON),echoParams:"explicit",indent:"true"},o=e.solrUrl,c=new URLSearchParams(l);return new URL(o+"?"+c.toString())}},{key:"buildQuery",value:function(e,t,s,a,i,n){""===(s=s.replace(/^\//,"").replace(/\s\//," "))&&(s="*");var r="level_i",l="ancestor_id_path";"terms"===t&&(r="level_tib.alpha_i",l="ancestor_id_tib.alpha_path");for(var o={child_counts:{limit:300,mincount:2,type:"terms",field:l,domain:{excludeTags:"hoot"}}},c=n||["header","id","ancestor*","caption_eng","position*",r].join(","),u=[],d=i+1;d>a;d--){var p=s.split("/").slice(0,d-1).join("/"),h=p.length?" AND "+l+":"+p:"";u.push("("+r+":"+(d-1)+h+")")}var m=u.join(" ");return e+"/select?df="+l+"&q="+s.split("/").slice(0,a).join("/")+"&wt=json&indent=true&limit=2000&facet=true&fl="+c+"&indent=true&fq=tree:"+t+"&fq="+r+":["+a+"+TO+"+(i+1)+"]&fq={!tag=hoot}"+m+"&facet.mincount=2&facet.limit=-1&sort="+r+"+asc,position_i+asc,header+asc&facet.sort="+l+"+ASC&facet.field={!ex=hoot}"+l+"&json.facet="+JSON.stringify(o)+"&wt=json&json.wrf=?&rows=2000"}},{key:"buildAssetQuery",value:function(e){return this.createBasicQuery(e)}}]),e}(),m=function(){function e(t,s){Object(l.a)(this,e),this.sui=this,this.curResults="",this.numItems=0,this.AND="AND",this.OR="OR",this.NOT="NOT",this.ss={},this.site=t,this.facets={},this.facets.assets={type:"list",icon:"&#xe60b",mode:null,data:[]},this.facets.places={type:"tree",icon:"&#xe62b",mode:null,data:[]},this.facets.features={type:"tree",icon:"&#xe638",mode:null,data:[]},this.facets.subjects={type:"tree",icon:"&#xe634",mode:null,data:[]},this.facets.terms={type:"tree",icon:"&#xe635",mode:null,data:[]},this.facets.collections={type:"list",icon:"&#xe633",mode:null,data:[]},this.facets.languages={type:"tree",icon:"&#xe670",mode:null,data:[]},this.facets.users={type:"input",icon:"&#xe600",mode:null,data:[]},this.assets={},this.assets.all={c:"#5b66cb",g:"&#xe60b"},this.assets.places={c:"#6faaf1",g:"&#xe62b"},this.assets["audio-video"]={c:"#58aab4",g:"&#xe648"},this.assets.images={c:"#b49c59",g:"&#xe62a"},this.assets.sources={c:"#5a57ad",g:"&#xe631"},this.assets.texts={c:"#8b5aa1",g:"&#xe636"},this.assets.visuals={c:"#6e9456",g:"&#xe63b"},this.assets.subjects={c:"#cc4c39",g:"&#xe634"},this.assets.terms={c:"#a2733f",g:"&#xe635"},this.assets.collections={c:"#5b66cb",g:"&#xe633"},this.searches=[],this.showBool=!1,this.showSearch=!1,this.noTop="CU"==t,p()("<link/>",{rel:"stylesheet",type:"text/css",href:"searchui.css"}).appendTo("head"),this.solrId=s?"_prod":"_dev",this.solrBase="https://"+(s?"ss395824":"ss251856")+"-us-east-1-aws.measuredsearch.com/solr/",this.ss.solrUrl=this.solrBase+"kmassets"+(s?"":"_dev")+"/select",this.ss.mode="input",this.ss.view="Card",this.ss.sort="Alpha",this.ss.page=0,this.ss.pageSize=100,this.ss.site="Mandala",this.ss.numResults=0,this.solrUtil=new h({solrUrl:this.ss.solrUrl}),this.ClearQuery()}return Object(o.a)(e,[{key:"Draw",value:function(e){console.log("Draw called!"),console.log("searchui.Draw called with "+JSON.stringify(arguments)),e&&(this.ss.mode=e),this.DrawResults()}},{key:"ShowAdvanced",value:function(e){throw new Error("ShowAdvanced")}},{key:"ShowHamburger",value:function(){p()("#sui-hamburger").html("<span id='sui-help' class='sui-hamItem'>&#xe67e&nbsp;&nbsp;HELP GUIDE</span>\n\t\t<span id='sui-home' class='sui-hamItem'>&#xe60b&nbsp;&nbsp;HOME</span>".replace(/\t|\n|\r/g,"")),p()("#sui-hamburger").slideToggle(),p()("#sui-home").on("click",(function(){alert("DrawLandingPage()")})),p()("#sui-help").on("click",(function(){window.open("//confluence.its.virginia.edu/display/KB/Mandala+Suite+of+Tools","_blank")})),p()("#sui-hamburger").on("click",(function(){p()("#sui-hamburger").slideUp()}))}},{key:"SetState",value:function(e){var t=window.location.href.split("#")[0];window.history.pushState("#"+e,"Mandala",t+(e?"#"+e:""))}},{key:"PageRouter",value:function(e){var t=this;console.log("PageRouter called.");var s,a=this.sui;window.location.href.split("#")[0];if(s=e.match(/#p=(.+)/))s=s[1].toLowerCase(),n(),this.alert("======== PAGEROUTER: "+e+" Handling p: Drawing "+s),this.log("\tPAGEROUTER: calling pages.Draw() with id="+s),this.GetKmapFromID(s,(function(e){t.log("\tPAGEROUTER: calling pages.Draw() with kmap="+e.uid),t.pages.Draw(e,!0)}));else if(s=e.match(/#r=(.+)/)){n();var i=s[1].replace(/\%20/g," ").split("=");this.pages.relatedId=i[0],this.pages.relatedType=i[2],this.alert("======== PAGEROUTER: "+e+" Handling r: calling getKmapFromID with id = "+i[3]+" this.pages.relatedId="+this.pages.relatedId+" this.pages.relatedType="+this.pages.relatedType),this.GetKmapFromID(i[3],(function(e){t.pages.relatedBase=e,console.log("\tPAGEROUTER handling callback.  calling pages.DrawRelatedResults with kmap uid = "+e.uid),t.pages.DrawRelatedResults(e,!0)}))}else(s=e.match(/#s=(.+)/))&&(n(),s=s[1].replace(/\%20/g," "),this.ParseQuerystring(s),this.alert("======== PAGEROUTER: "+e+" Handling s: Parsing querystring: "+s+" set ss.query.text to "+ss.query.text),p()("#sui-search").val(this.ss.query.text),this.Query(!0));function n(){a.ss.mode="simple",a.ss.page=0,p()("#sui-legacy").scrollTop(0),p()("#sui-content").scrollTop(0),p()("#plc-infoDiv").remove(),p()("#sui-content").css({width:"100%",display:"inline-block"}),p()("#sui-adv").css({display:"none"}),p()("#sui-legacy").css({display:"block"}),a.DrawHeader(!0),a.DrawFooter()}}},{key:"SerializeQuery",value:function(e){var t,s,a="";for(s in this.ss.query.assets=[this.ss.query.assets[0]],e.query)if("text"==s&&e.query[s])a+="".concat(s,":").concat(e.query[s],"=");else for(t=0;t<e.query[s].length;++t)a+="".concat(s,":").concat(e.query[s][t].title,":").concat(e.query[s][t].id,":").concat(e.query[s][t].bool,"=");return a.slice(0,-1)}},{key:"ParseQuerystring",value:function(e){var t,s,a,i=e.split("=");for(this.ClearQuery(),this.ss.query.assets=[],t=0;t<i.length;++t)i[t].match(/^text/)?this.ss.query.text=i[t].substr(5):(a={title:(s=i[t].split(":"))[1],id:s[2],bool:s[3]},this.ss.query[s[0]].push(a));this.ss.query.assets=[this.ss.query.assets[0]]}},{key:"ClearQuery",value:function(){p()("#sui-search").val(""),this.pages&&(this.pages.relatedBase=this.pages.relatedId=""),this.ss.page=0,this.ss.query={text:"",places:[],collections:[],languages:[],features:[],subjects:[],terms:[],relationships:[],users:[],assets:[{title:"All",id:"all",bool:"AND"}],termPerspective:"",subjectPerspective:"",placePerspective:"",view:""}}},{key:"Query",value:function(e,t){var s,a=this;if(console.log("Query() called with fromHistory = "+e+" collectionId =  "+t),this.LoadingIcon(!0,64),t){console.log("\tSearchUI.Query: collection mode");var i=JSON.parse(JSON.stringify(this.ss));i.query={text:"",places:[],assets:[{id:this.pages.relatedType,bool:"AND"}],languages:[],features:[],subjects:[],terms:[],relationships:[],users:[],perspectives:[],collections:[{title:"all",id:t,bool:"AND"}]},s=this.solrUtil.buildAssetQuery(i)}else"related"==this.ss.mode?(console.log("\tSearchUI.Query: related mode"),s=this.solrUtil.createKmapQuery(this.pages.relatedId.toLowerCase(),this.pages.relatedType.toLowerCase(),this.ss.page,this.ss.pageSize)):(console.log("\tSearchUI.Query: asset mode"),s=this.solrUtil.buildAssetQuery(this.ss));"related"==this.ss.mode||e||(console.log("\tSearchUI.Query: default mode"),this.SetState("s="+this.SerializeQuery(this.ss))),p()("#sui-relatedAssets").remove(),this.ActiveSearch()&&(this.searches.filter((function(e,t){JSON.stringify(e.query)===JSON.stringify(a.ss.query)&&a.searches.splice(t,1)})),this.searches.push(JSON.parse(JSON.stringify(this.ss)))),p.a.ajax({url:s,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){console.log("\tSearchUI.Query: got data back from SOLR query: "+s),console.dir(e),a.curResults=a.MassageKmapData(e.response.docs),a.ParseFacetData(e),a.LoadingIcon(!1),a.DrawResults()})).fail((function(e){console.log(e),a.LoadingIcon(!1),a.Popup("Query error")}))}},{key:"GetKmapFromID",value:function(e,t){var s=this;console.log("GetKmapFromID() called with id="+e);var a=this.ss.solrUrl+"?q=uid:"+e.toLowerCase()+"&wt=json";console.log("SOLR QUERY GetKmapFromID() = "+a),p.a.ajax({url:a,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){try{e=s.MassageKmapData(e.response.docs[0])}catch(a){e.error=a}t(e)})).fail((function(e){console.log(e)}))}},{key:"GetDefinitionAssets",value:function(e,t){var s=this,a=this.ss.solrUrl+"?q=kmapid:"+e.toLowerCase()+"&wt=json";p.a.ajax({url:a,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){e=s.MassageKmapData(e.response.docs),t(e)})).fail((function(e){console.log(e)}))}},{key:"GetRelatedFromID",value:function(e,t){var s=this;this.log("GetRelatedFromID() called with arguments"),console.log(JSON.stringify(arguments));var a="".concat(this.solrBase,"kmterms").concat(this.solrId,"/query");a+="?child_count.fq=related_kmaps_node_type:child&child_count.fl=uid&fq=!related_kmaps_node_type:parent",a+="&child_count.rows=0&fl=child_count:[subquery],*&child_count.q={!child%20of='block_type:parent'}",a+="{!term%20f=uid%20v=$row.related_subjects_id_s}&rows=2000&q=id:"+e+"%20OR%20{!child%20of=block_type:parent}id:"+e+"%20&sort=block_type%20DESC,%20related_subjects_header_s%20ASC",this.log("SOLR QUERY GetRelatedFromID():  query = "+a),p.a.ajax({url:a,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){s.log("GetRelatedFromID() returns "+e),console.dir(e),t(e.response.docs)})).fail((function(e){console.log(e)}))}},{key:"GetRelatedPlaces",value:function(e,t){var s=this;this.LoadingIcon(!0,64);var a=this.solrUtil.createKmapQuery(e,"places",0,1e4);p.a.ajax({url:a,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){e=s.MassageKmapData(e.response.docs),s.LoadingIcon(!1),t(e)})).fail((function(e){console.log(e),s.LoadingIcon(!1),s.Popup("Related query error")}))}},{key:"GetChildNamesFromID",value:function(e,t,s){var a="".concat(this.solrBase,"kmterms").concat(this.solrId,"/select?fl=uid%2C%5Bchild%20childFilter%3Did%3A").concat(e,"-").concat(t,"_names-*%20parentFilter%3Dblock_type%3Aparent%5D&q=uid%3A").concat(e,"-").concat(t,"&wt=json&rows=300");p.a.ajax({url:a,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){s(e.response.docs)})).fail((function(e){console.log(e)}))}},{key:"GetChildDataFromID",value:function(e,t){var s="".concat(this.solrBase,"kmterms").concat(this.solrId,"/query?q=uid:").concat(e,"&wt=json&fl=*,[child%20parentFilter=block_type:parent%20limit=300]");console.log("SOLR QUERY GetChildDataFromID = "+s),p.a.ajax({url:s,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){t(e.response.docs[0])})).fail((function(e){console.log(e)}))}},{key:"GetTreeChildren",value:function(e,t,s){var a=this.sui,i="".concat(this.solrBase,"kmterms").concat(this.solrId),n=Math.max(t.split("/").length+1,2);"features"!=e&&"languages"!=e||(e="subjects");var r=a.solrUtil.buildQuery(i,e,t,n,n);p.a.ajax({url:r,dataType:"jsonp"}).done((function(e){s(e)})).fail((function(e){console.log(e)}))}},{key:"GetAudioFromID",value:function(e,t){p.a.getJSON("//terms.kmaps.virginia.edu/slices/"+e+"/recordings",(function(e){var s,a=[];try{for(s=0;s<e.recordings.length;++s)a.push(e.recordings[s].audio_file);t(a)}catch(i){}})).fail((function(e){console.log(e)}))}},{key:"GetJSONFromKmap",value:function(e,t){var s=this,a=e.url_json;a&&(a=(a=a.replace(/images.shanti.virginia.edu/i,"images-dev.shanti.virginia.edu")).replace(/https:|http:/i,""),a+="?callback=myfunc",("audio-video"==e.asset_type||e.subcollection_uid_ss)&&(a=a.replace(/.json/i,".jsonp")),p.a.ajax({url:a,dataType:"jsonp",error:function(e){s.Popup("JSON access error")}}).done((function(e){t(e)})))}},{key:"MassageKmapData",value:function(e){var t,s;for(t=0;t<e.length;++t)(s=e[t]).asset_subtype&&(s.asset_subtype=s.asset_subtype.charAt(0).toUpperCase()+s.asset_subtype.slice(1)),s.url_thumb&&(s.url_thumb=s.url_thumb.replace(/images-test/i,"images")),"places"==s.asset_type&&(s.ancestors_txt&&s.ancestors_txt.length&&s.ancestors_txt.splice(0,1),s.ancestor_ids_is&&s.ancestor_ids_is.length&&s.ancestor_ids_is.splice(0,1)),"texts"==s.asset_type?s.url_thumb="gradient.jpg":s.url_thumb||(s.url_thumb="gradient.jpg"),s.display_label&&(s.title=s.display_label);return e}},{key:"ParseFacetData",value:function(e){var t,s,a,i,n=0;for(s in this.assets)this.assets[s].n=0;if(e&&e.facets&&e.facets.asset_counts&&e.facets.asset_counts.buckets){for(i=e.facets.asset_counts.buckets,t=0;t<i.length;++t)a=i[t].val,this.assets[a]&&(this.assets[a].n=i[t].count),n+=i[t].count;this.ss.numResults=this.assets.all.n=n}}},{key:"QueryFacets",value:function(e,t){var s=this;if("users"!=e&&"relationships"!=e){this.LoadingIcon(!0,64);var a=this.solrUtil.createBasicQuery(this.ss,["assets"==e?"languages":e]);p.a.ajax({url:a,dataType:"jsonp",jsonp:"json.wrf"}).done((function(t){var a,i,n;if(s.LoadingIcon(!1),t.facets[e])for(i=t.facets[e].buckets,s.facets[e].data=[],a=0;a<Math.min(300,i.length);++a)n=i[a].val.split("|"),s.facets[e].data.push({title:n[0],id:n[1],n:i[a].count});s.ResetFacetList(e)}))}}},{key:"DrawResults",value:function(e){if(this.log("DrawResults() called",arguments),p()("#sui-content").scrollTop(0),p()("#sui-legacy").scrollTop(0),p()("#sui-legacy").css({"background-image":""}),p()("#sui-legacy").css({display:"block"}),p()("#plc-infoDiv").remove(),"related"==this.ss.mode?this.numItems=this.assets[this.pages.relatedType].n:this.numItems=this.assets[this.ss.query.assets[0].id].n,"input"==this.ss.mode)return p()("#sui-header").css({display:"none"}),p()("#sui-header").css({display:"inline-block","background-color":"#4d59ca"}),p()("#sui-content").css({display:"block",width:"100%"}),p()("#sui-adv").css({display:"none"}),void p()("#sui-legacy").css({display:"none"});"simple"==this.ss.mode?(p()("#sui-content").css({width:"100%"}),p()("#sui-adv").css({display:"none"}),p()("#sui-content").slideDown(),p()("#sui-content").css({width:p()("#sui-main").width()})):"advanced"==this.ss.mode&&(p()("#sui-adv").css({display:"block"}),p()("#sui-content").css({width:p()("#sui-main").width()-p()("#sui-adv").width()})),p()("#sui-mode").prop({title:"advanced"==this.ss.mode?"Basic search":"Advanced search"}),p()("#sui-mode").html("advanced"==this.ss.mode?"BASIC<br>SEARCH":"ADVANCED<br>SEARCH"),p()("#sui-header").css({display:"block"}),e||(this.DrawHeader(),this.DrawItems(),this.DrawFooter())}},{key:"DrawHeader",value:function(){var e=this;if(console.log("pages.Drawheader called!"),"related"!=this.ss.mode){var t=Math.floor(this.numItems/this.ss.pageSize),s=this.ss.page*this.ss.pageSize+1,a=Math.min(s+this.ss.pageSize,this.numItems),i="<span style='vertical-align:-10px'>".concat(this.ss.query.assets[0].title.toUpperCase()," search results &nbsp; <span style='font-size:12px'> (").concat(s,"-").concat(a,") of ").concat(this.numItems,"\t\n\t\t<div style='float:right;font-size:11px;margin:12px -48px 0 0'>\n\t\t\t<div id='sui-page1T' class='sui-resDisplay' title='Go to first page'>&#xe63c</div>\n\t\t\t<div id='sui-pagePT' class='sui-resDisplay' title='Go to previous page'>&#xe63f</div>\n\t\t\t<div class='sui-resDisplay'> PAGE <input type='text' id='sui-typePageT' \n\t\t\tstyle='border:0;border-radius:4px;width:30px;text-align:center;vertical-align:1px;font-size:10px;padding:2px'\n\t\t\ttitle='Enter page, then press Return'> OF ").concat(t+1,"</div>\n\t\t\t<div id='sui-pageNT' class='sui-resDisplay' title='Go to next page'>&#xe63e</div>\n\t\t\t<div id='sui-pageLT' class='sui-resDisplay' title='Go to last page'>&#xe63d</div>\n\t\t\t</div>");p()("#sui-contentHead").html(i.replace(/\t|\n|\r/g,"")),p()("#sui-header").css("background-color","#888"),p()("#sui-typePageT").val(this.ss.page+1),p()("[id^=sui-page]").css("color","#fff"),0==this.ss.page&&(p()("#sui-page1T").css("color","#ddd"),p()("#sui-pagePT").css("color","#ddd")),this.ss.page==t&&(p()("#sui-pageNT").css("color","#ddd"),p()("#sui-pageLT").css("color","#ddd")),p()("#sui-page1T").on("click",(function(){e.ss.page=0,e.Query()})),p()("#sui-pagePT").on("click",(function(){e.ss.page=Math.max(e.ss.page-1,0),e.Query()})),p()("#sui-pageNT").on("click",(function(){e.ss.page=Math.min(e.ss.page+1,t),e.Query()})),p()("#sui-pageLT").on("click",(function(){e.ss.page=t,e.Query()})),p()("#sui-typePageT").on("change",(function(){var s=p()("#sui-typePageT").val();isNaN(s)||(e.ss.page=Math.max(Math.min(s-1,t),0)),e.Query()}))}}},{key:"DrawFooter",value:function(){var e=this,t=Math.floor(this.numItems/this.ss.pageSize);"related"!=this.ss.mode&&p()("#sui-footer").css("background-color","#888");var s="\n\t\t<div style='float:left;font-size:18px'>\n\t\t\t<div id='sui-viewModeList' class='sui-resDisplay' title='List view'>&#xe61f</div>\n\t\t\t<div id='sui-viewModeGrid' class='sui-resDisplay' title='Grid view'>&#xe61b</div>\n\t\t\t<div id='sui-viewModeCard' class='sui-resDisplay' title='Card view'>&#xe673</div>\n\t\t</div>\t\n\t\t<div style='display:inline-block;font-size:11px'>\n\t\t\t<div id='sui-page1' class='sui-resDisplay' title='Go to first page'>&#xe63c</div>\n\t\t\t<div id='sui-pageP' class='sui-resDisplay' title='Go to previous page'>&#xe63f</div>\n\t\t\t<div class='sui-resDisplay'> PAGE <input type='text' id='sui-typePage' \n\t\t\tstyle='border:0;border-radius:4px;width:30px;text-align:center;vertical-align:1px;font-size:10px;padding:2px'\n\t\t\ttitle='Enter page, then press Return'> OF ".concat(t+1,"</div>\n\t\t\t<div id='sui-pageN' class='sui-resDisplay' title='Go to next page'>&#xe63e</div>\n\t\t\t<div id='sui-pageL' class='sui-resDisplay' title='Go to last page'>&#xe63d</div>\n\t\t\t</div>\t\n\t\t<div style='float:right;font-size:16px;'>\n\t\t\t<div id='sui-viewSortAlpha' class='sui-resDisplay' title='Sort alphabetically'>&#xe652</div>\n\t\t\t<div id='sui-viewSortDate'  class='sui-resDisplay' title='Sort by date'>&#xe60c</div>\n\t\t\t<div id='sui-viewSortAuthor' class='sui-resDisplay' title='Sort by author'>&#xe600</div>\n\t\t\t</div>");p()("#sui-footer").html(s.replace(/\t|\n|\r/g,"")),p()("#sui-typePage").val(this.ss.page+1),p()("[id^=sui-viewMode]").css("color","#ddd"),p()("#sui-viewMode"+this.ss.view).css("color","#fff"),p()("[id^=sui-viewMode]").on("click",(function(t){e.ss.view=t.currentTarget.id.substring(12),e.DrawResults()})),p()("[id^=sui-viewSort]").css("color","#ddd"),p()("#sui-viewSort"+this.ss.sort).css("color","#fff"),p()("[id^=sui-viewSort]").on("click",(function(t){e.ss.sort=t.currentTarget.id.substring(12),"Alpha"==e.ss.sort?e.curResults.sort((function(e,t){return e.title[0]>t.title[0]?1:e.title[0]<t.title[0]?-1:0})):"Date"==e.ss.sort?e.curResults.sort((function(e,t){return e.timestamp>t.timestamp?1:e.timestamp<t.timestamp?-1:0})):"Author"==e.ss.sort&&e.curResults.sort((function(e,t){return e.node_user>t.node_user?1:e.node_user<t.node_user?-1:0})),e.DrawResults()})),p()("[id^=sui-page]").css("color","#fff"),0==this.ss.page&&(p()("#sui-page1").css("color","#ddd"),p()("#sui-pageP").css("color","#ddd")),this.ss.page==t&&(p()("#sui-pageN").css("color","#ddd"),p()("#sui-pageL").css("color","#ddd")),p()("#sui-page1").on("click",(function(){e.ss.page=0,e.Query()})),p()("#sui-pageP").on("click",(function(){e.ss.page=Math.max(e.ss.page-1,0),e.Query()})),p()("#sui-pageN").on("click",(function(){e.ss.page=Math.min(e.ss.page+1,t),e.Query()})),p()("#sui-pageL").on("click",(function(){e.ss.page=t,e.Query()})),p()("#sui-typePage").on("change",(function(){var s=p()("#sui-typePage").val();isNaN(s)||(e.ss.page=Math.max(Math.min(s-1,t),0)),e.Query()}))}},{key:"DrawItems",value:function(){var e=this;console.log("SearchUI.DrawItems()");var t,s="";for(p()("#sui-legacy").css({"background-color":"List"==this.ss.view?"#fff":"#ddd"}),"related"==this.ss.mode?p()("#sui-legacy").css({"padding-left":"204px",width:"calc(100% - 216px"}):p()("#sui-legacy").css({"padding-left":"12px",width:"calc(100% - 24px"}),t=0;t<this.curResults.length;++t)"Card"==this.ss.view?s+=this.DrawCardItem(t):"Grid"==this.ss.view?s+=this.DrawGridItem(t):s+=this.DrawListItem(t);this.curResults.length||(s="<br><br><br><div style='text-align:center;color:#666'>Sorry, there were no items found<br>Try broadening your search</div>"),p()("#sui-legacy").html(s.replace(/\t|\n|\r/g,"")),"related"==this.ss.mode&&this.pages.DrawRelatedAssets(),p()(".sui-itemIcon").on("click",(function(t){var s=t.currentTarget.id.substring(13);return t.originalEvent.metaKey?window.open("#p="+e.curResults[s].uid,"_blank"):e.SendMessage("page="+e.curResults[s].url_html,e.curResults[s]),!1})),p()("[id^=sui-itemPic-]").on("click",(function(t){var s=t.currentTarget.id.substring(12);return t.originalEvent.metaKey?window.open("#p="+e.curResults[s].uid,"_blank"):e.SendMessage("page="+e.curResults[s].url_html,e.curResults[s]),!1})),p()(".sui-gridInfo").on("mouseover",(function(t){var s=t.currentTarget.id.substring(13),a=e.curResults[s],i="";if(a.title&&(i+="<b>"+a.title+"</b><br><br>"),i+=e.assets[a.asset_type].g+"&nbsp;&nbsp;"+a.asset_type.toUpperCase(),a.asset_subtype&&(i+=" / "+a.asset_subtype),i+="<br>",a.creator&&(i+="<p>&#xe600&nbsp;&nbsp;"+a.creator.join(", ")+"</p>"),a.summary||a.caption){var n=a.summary||a.caption;n.length>80&&(n=n.substr(0,80)+"..."),i+="<p><div style='display:inline-block;background-color:#ccc;width:4px;height:18px;margin:2px 10px 0 5px;vertical-align:-4px'></div>&nbsp;<i>"+n+"</i></p>"}a.summary&&(i+="<p style='font-family:serif;'>"+a.summary+"</p>");var r=p()("#"+t.currentTarget.id).offset();e.Popup(i,20,Math.max(8,r.left-220),r.top+24)})),p()(".sui-gridInfo").on("mouseout",(function(e){p()("#sui-popupDiv").remove()})),p()("[id^=sui-itemTitle-]").on("click",(function(t){var s=t.currentTarget.id.substring(14);return t.originalEvent.metaKey?window.open("#p="+e.curResults[s].uid,"_blank"):e.SendMessage("page="+e.curResults[s].url_html,e.curResults[s]),!1})),p()(".sui-itemPlus").on("click",(function(t){e.ShowItemMore(t.currentTarget.id.substring(13))}))}},{key:"DrawListItem",value:function(e){var t,s=this.curResults[e],a="<div class='sui-item'>";if(a+="<div class='sui-itemPlus' id='sui-itemPlus-"+e+"'>&#xe669</div>",a+="<div class='sui-itemIcon' id='sui-itemIcon-"+e+"' style='background-color:"+this.assets[s.asset_type].c+"'>",a+="<a class='sui-noA' href='#p="+s.uid+"'><span style='color:#fff'>"+this.assets[s.asset_type].g+"</span></a></div>",a+="<div class='sui-itemTitle' id='sui-itemTitle-"+e+"'>",a+="<a class='sui-noA' href='#p="+s.uid+"'>"+s.title+"</a></div>",s.feature_types_ss&&(a+="<span style='color:"+this.assets[s.asset_type].c+"'>&nbsp;&bull;&nbsp;</span>",a+="<div class='sui-itemFeature'>&nbsp;"+s.feature_types_ss.join(", ")+"</div>"),a+="<div class='sui-itemId'>"+s.uid,s.collection_title&&(a+="<div style='text-align:right;margin-top:2px;'>&#xe633&nbsp;"+s.collection_title+"</div>"),a+="</div>",s.ancestors_txt&&s.ancestors_txt.length>1){for(a+="<div class='sui-itemTrail'>",t=0;t<s.ancestors_txt.length;++t)a+="<span class='sui-itemAncestor' onclick='sui.SendMessage(\"page=",a+="https://mandala.shanti.virginia.edu/"+s.asset_type+"/",a+=s.ancestor_ids_is[t+1]+"/overview/nojs#search,"+this.curResults[e]+")'>",a+="<a href='#p="+s.uid+"'>"+s.ancestors_txt[t]+"</a></span>",t<s.ancestors_txt.length-1&&(a+=" > ");a+="</div>"}return(a+="<div class='sui-itemMore' id='sui-itemMore-"+e+"'></div>")+"</div>"}},{key:"ShowItemMore",value:function(e){var t,s,a,i=this,n="";if(p()("#sui-itemMore-"+e).html())p()("#sui-itemMore-"+e).slideUp(400,(function(){p()("#sui-itemMore-"+e).html("")}));else{if((s=this.curResults[e]).url_thumb.match(/gradient.jpg/)||(n+="<img src='"+s.url_thumb+"' class='sui-itemPic' id='sui-itemPic-"+e+"'>"),n+="<div class='sui-itemInfo'>",n+=this.assets[s.asset_type].g+"&nbsp;&nbsp;"+s.asset_type.toUpperCase(),s.asset_subtype&&(n+=" / "+s.asset_subtype),s.creator&&(n+="<br>&#xe600&nbsp;&nbsp;"+s.creator.join(", ")),(s.summary||s.caption)&&((a=s.summary||s.caption).length>137&&(a=a.substr(0,137)+"..."),n+="<br><div style='display:inline-block;background-color:#ccc;width:4px;height:18px;margin:2px 10px 0 5px;vertical-align:-4px'></div>&nbsp;<i>"+a+"</i>"),n+="</div>",s.summary&&(n+="<br><div style='font-family:serif'>"+s.summary+"</div>"),s.kmapid_strict&&s.kmapid_strict.length){var r=[],l=[];for(n+="<div style='margin-bottom:12px'>",t=0;t<s.kmapid_strict.length;++t)s.kmapid_strict[t].match(/subjects/i)?l.push(t):s.kmapid_strict[t].match(/places/i)&&r.push(t);if(n+="<div style='float:left;min-width:200px;'><span style='color:"+this.assets.places.c+"'>",n+="<br><b>"+this.assets.places.g+"</b></span>&nbsp;RELATED PLACES",r.length)for(t=0;t<r.length;++t)n+="<br>",s.kmapid_strict_ss&&(n+="<span class='sui-itemRelated'>"+s.kmapid_strict_ss[r[t]]+"</span>"),n+="&nbsp;<span style='font-size:10px;margin-right:40px'>("+s.kmapid_strict[r[t]]+")</span>";if(n+="</div>",n+="<div><span style='display:inline-block;color:"+this.assets.subjects.c+"'>",n+="<br><b>"+this.assets.subjects.g+"</b></span>&nbsp;RELATED SUBJECTS",l.length)for(t=0;t<l.length;++t)n+="<br>",s.kmapid_strict_ss&&(n+="<span class='sui-itemRelated'>"+s.kmapid_strict_ss[l[t]]+"</span>"),n+="&nbsp;<span style='font-size:10px'>("+s.kmapid_strict[l[t]]+")</span>";n+="</div></div>"}p()("#sui-itemMore-"+e).html(n),p()("#sui-itemMore-"+e).slideDown(),p()("[id^=sui-itemPic]").on("click",(function(e){var t=e.currentTarget.id.substring(12);i.SendMessage("page="+i.curResults[t].url_html,i.curResults[t])}))}}},{key:"DrawGridItem",value:function(e){var t="<div class='sui-grid'>",s=this.curResults[e];return t+="<a href='#p="+s.uid+"'>",t+="<img src='"+s.url_thumb+"' class='sui-gridPic' id='sui-itemPic-"+e+"'></a>",s.url_thumb.match(/gradient.jpg/)&&(t+="<div class='sui-gridGlyph' style='color:".concat(this.assets[s.asset_type].c,"'>\n\t\t\t ").concat(this.assets[s.asset_type].g,"\n\t\t\t <p style='font-size:12px;margin-top:0'>").concat(s.title,"</p>\n\t\t\t </div>")),(t+="<div id='sui-gridInfo-"+e+"' class='sui-gridInfo'>&#xe67f</div>")+"</div>"}},{key:"DrawCardItem",value:function(e){var t=this.curResults[e],s="&#xe633",a="#9e894d",i=t.collection_title,n="<div class='sui-card'>";n+="<div style='width:100%;height:100px;overflow:hidden;display:inline-block;margin:0;padding:0'>",n+="<a href='#p="+t.uid+"'>",n+="<img src='"+t.url_thumb+"' class='sui-cardPic' id='sui-itemPic-"+e+"'></a></div>";var r=this.assets[t.asset_type].g;return"Audio"==t.asset_subtype?r="&#xe60a":"Video"==t.asset_subtype&&(r="&#xe62d"),n+="<div class='sui-cardType'>"+r+"</div>",t.url_thumb.match(/gradient.jpg/)&&(n+="<div class='sui-cardGlyph' style='color:".concat(this.assets[t.asset_type].c,"'>").concat(this.assets[t.asset_type].g,"</div>")),n+="<div class='sui-cardInfo'><div class='sui-cardTitle' id='sui-itemTitle-"+e+"'",t.ancestors_txt&&t.ancestors_txt.length>2&&(n+="title='"+t.ancestors_txt.join("/")+"'"),n+="><b>"+t.title+"</b><br></div>",n+="<div style='border-top:.5px solid "+a+";height:1px;width:100%;margin:6px 0 6px 0'></div>",t.ancestors_txt&&t.ancestors_txt.length>1&&(n+="&#xe638&nbsp;&nbsp;"+t.ancestors_txt[0]+"/...<br>",n+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.../"+t.ancestors_txt[t.ancestors_txt.length-2]+"<br>"),t.feature_types_ss&&(n+="&#xe62b&nbsp;&nbsp;"+t.feature_types_ss.join(", ")+"<br>"),t.data_phoneme_ss&&(n+="&#xe635&nbsp;&nbsp;"+t.data_phoneme_ss.join(", ")+"<br>"),t.creator&&(n+="&#xe600&nbsp;&nbsp;"+t.creator[0]+"<br>"),t.duration_s&&(n+="&#xe61c&nbsp;&nbsp;"+t.duration_s+"<br>"),t.timestamp&&(n+="&#xe60c&nbsp;&nbsp;"+t.timestamp.substr(0,10)+"<br>"),t.name_tibt&&(n+="=&nbsp;&nbsp;"+t.name_tibt+"<br>"),n+="</div>",i||(i=t.asset_type,s=this.assets[t.asset_type].g),n+="<div class='sui-cardFooter' style='background-color:"+a+"'>"+s+"&nbsp;&nbsp;",(n+="<span style='font-size:11px;vertical-align:2px'>"+i+"<span></div>")+"</div>"}},{key:"DrawAdvanced",value:function(){this.log("searchui.DrawAdvanced() short circuit")}},{key:"DrawFacetItems",value:function(e,t){"assets"!=e||this.curResults||this.Query(),"recent"==e?this.RecentSearches():"input"==this.facets[e].type?this.DrawInput(e,t):"tree"==this.facets[e].type?this.ActiveSearch()?this.DrawFacetList(e,t):this.DrawFacetTree(e,t):this.DrawFacetList(e,t)}},{key:"ActiveSearch",value:function(e){var t,s=!1;for(t in this.ss.query.text.length&&!e&&(s=!0),this.facets)this.ss.query[t].length&&"assets"!=t&&(s=!0);return s}},{key:"DrawInput",value:function(e){var t=this;if("none"==p()("#sui-advEdit-"+e).css("display")){this.facets[e].mode="input";var s="<input id='sui-advInput-".concat(e,"' placeholder='Type here'  \n\t\tstyle='width:90px;border:1px solid #999;border-radius:12px;font-size:11px;padding-left:6px'>\n\t\t<div class='sui-advEditNums'> <span id='sui-advListNum'>").concat(934,"</span> ").concat(e,"</div>");p()("#sui-advEdit-"+e).html(s+"</div>".replace(/\t|\n|\r/g,"")),p()("#sui-advEdit-"+e).slideDown(),p()("#sui-advInput-"+e).on("change",(function(s){s.target.id.split("-");t.AddNewFilter(p()("#sui-advInput-"+e).val(),e+"-0","AND",e)}))}else p()("#sui-advEdit-"+e).slideUp()}},{key:"RecentSearches",value:function(){var e=this;if("none"==p()("#sui-advEdit-recent").css("display")){var t,s,a,i="<i>Click below to recall a previous search</i><hr><div class='sui-advEditList'>";for(t=this.searches.length-1;t>=0;t--){for(a in i+="<div class='sui-advEditLine' style='width:100%' id='sui-recSrc-".concat(t,"' "),i+="title='"+this.searches[t].query.assets[0].title.toUpperCase(),i+=" "+this.searches[t].query.text,this.facets)if(this.searches[t].query[a].length&&"assets"!=a)for(s=0;s<this.searches[t].query[a].length;++s)i+=" "+this[this.searches[t].query[a][s].bool]+" "+this.searches[t].query[a][s].title;for(a in a=this.searches[t].query.assets[0].id,i+="'><span style='color:".concat(this.assets[a].c,"'>").concat(this.assets[a].g," </span>"),i+=this.searches[t].query.text,this.facets)this.searches[t].query[a].length&&"assets"!=a&&(i+=" + "+this.facets[a].icon);i+="</div>"}p()("#sui-advEdit-recent").html(i+"</div>".replace(/\t|\n|\r/g,"")),p()("[id^=sui-recSrc-]").off("click"),p()("[id^=sui-recSrc-]").on("click",(function(t){var s=t.target.id.substr(11);e.ss.query=JSON.parse(JSON.stringify(e.searches[s].query)),p()("#sui-search").val(e.ss.query.text),e.DrawAdvanced(),e.Query()})),p()("#sui-advEdit-recent").slideDown()}else p()("#sui-advEdit-recent").slideUp()}},{key:"ResetFacetList",value:function(e){var t,s,a=this,i="";if("assets"==e){var n=this.facets.assets.data=[];for(s in this.assets)n.push({title:s.charAt(0).toUpperCase()+s.slice(1),id:s,n:this.assets[s].n})}var r=Math.min(300,this.facets[e].data.length);for(p()("[id^=sui-advEditLine-]").remove(),t=0;t<r;++t)void 0==(s=this.facets[e].data[t].n)&&(s=""),s>1e3&&(s=Math.floor(s/1e3)+"K"),i+="<div class='sui-advEditLine' id='sui-advEditLine-".concat(t,"'>"),"assets"==e&&(i+="<span style='color:".concat(this.assets[this.facets[e].data[t].id].c,"'>").concat(this.assets[this.facets[e].data[t].id].g,"</span> &nbsp;")),i+="".concat(this.facets[e].data[t].title," (").concat(s,")"),"assets"!=e&&(i+=this.pages.AddPop(this.facets[e].data[t].id,!0)),i+="</div>";p()("#sui-advEditList-"+e).html("</div>"+i.replace(/\t|\n|\r/g,"")),p()("[id^=sui-advEditLine-]").off("click"),p()("[id^=sui-advEditLine-]").on("click",(function(t){var s=t.target.id.split("-"),i=a.facets[e].data;a.showSearch&&"assets"!=e?a.GetKmapFromID(i[s[2]].id,(function(e){a.SendMessage("page="+i[s[2]].url,e)})):a.AddNewFilter(i[s[2]].title,i[s[2]].id,"AND",e)})),p()("#sui-advListNum").html(r<300?r:"300+")}},{key:"DrawFacetList",value:function(e,t,s){var a,i=this,n=0;if(t||"none"==p()("#sui-advEdit-"+e).css("display")){this.QueryFacets(e),this.facets[e].mode="list";var r="<input id='sui-advEditFilter-".concat(e,"' placeholder='Search this list' value='").concat(s||"","' \n\t\tstyle='width:90px;border:1px solid #999;border-radius:12px;font-size:11px;padding-left:6px'> &nbsp; ");"tree"==this.facets[e].type&&(r+="<div class='sui-advEditBut' id='sui-advListMap-".concat(e,"' title='Tree view'>&#xe638</div> | \n\t\t\t<div class='sui-advEditBut' id='sui-advTreeMap-").concat(e,"' title='List view'>&#xe61f</div>\n\t\t\t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;")),"assets"!=e&&(r+="<div class='sui-advEditBut' id='sui-advEditSort-".concat(e,"' title='Sort'>&#xe652</div>")),r+="<div class='sui-advEditNums'> <span id='sui-advListNum'></span> ".concat(e),r+="</div><hr style='border: .5px solid #a4baec'>\n\t\t<div class='sui-advEditList' id='sui-advEditList-".concat(e,"'></div>"),p()("#sui-advEdit-"+e).html(r.replace(/\t|\n|\r/g,"")),p()("#sui-advEdit-"+e).slideDown(),p()("#sui-advTreeMap-"+e).css({color:"#668eec"}),p()("[id^=sui-advEditFilter-]").off("click"),p()("#sui-advEditFilter-"+e).on("keydown",(function(t){var s,n=Math.min(300,i.facets[e].data.length),r=p()("#sui-advEditFilter-"+e).val();for(t.keyCode>31&&t.keyCode<91&&(r+=t.key),8==t.keyCode&&r.length&&(r=r.slice(0,-1)),r=RegExp(r,"i"),a=0;a<n;++a)(s=p()("#sui-advEditLine-"+a)).text().match(r)?s.css("display","block"):s.css("display","none")})),p()("[id^=sui-advEditSort-]").off("click"),p()("#sui-advEditSort-"+e).on("click",(function(){r="";var t,s,a=i.facets[e].data,l=Math.min(300,a.length);if(!(n=1-n)){for(p()("#sui-advEditList-"+e).empty(),t=0;t<l;++t)(s=i.facets[e].data[t].n)>1e3&&(s=Math.floor(s/1e3)+"K"),r+="<div class='sui-advEditLine' id='sui-advEditLine-".concat(t,"'>"),r+="".concat(a[t].title," (").concat(s,")").concat(i.pages.AddPop(a[t].id,!0),"</div>");return p()("#sui-advEditList-"+e).html(r),void p()("#sui-advEditSort-"+e).css("color","#666")}var o=p()(".sui-advEditLine");o.sort((function(e,t){var s=p()(e).text(),a=p()(t).text();return s>a?1:s<a?-1:0})),p()("#sui-advEditList-"+e).html(o),p()("#sui-advEditSort-"+e).css("color","#668eec")})),p()("[id^=sui-advListMap-]").off("click"),p()("#sui-advListMap-"+e).on("click",(function(){i.DrawFacetTree(e,1,p()("#sui-advEditFilter-"+e).val())})),p()("#sui-advEditList-"+e).css("max-height",p()("#sui-main").height()-p()("#sui-advTerm-"+e).offset().top-p()("#sui-advTerm-"+e).height()-102+"px")}else p()("#sui-advEdit-"+e).slideUp()}},{key:"AddNewFilter",value:function(e,t,s,a){var i=this.ss.query[a];if(!i.filter((function(t){return t.title==e})).length){t&&(t=t.replace(/languages-|features-/i,"subjects-"));var n=i.length;i.push({}),i[n].title=e,i[n].id=t?t.replace(/collections-/,""):"",i[n].bool=s,"assets"==a&&(this.ss.query.assets=[{title:e,id:t,bool:s}]),this.ss.page=0,this.DrawAdvanced(),this.Query()}}},{key:"DrawFacetTree",value:function(e,t,s){var a=this;if(t||"none"==p()("#sui-advEdit-"+e).css("display")){this.facets[e].mode="tree",this.curTree=e;var i="#sui-tree"+e,n="<input id='sui-advTreeFilter' placeholder='Search this list' value='".concat(s||"","' \n\t\tstyle='width:90px;border:1px solid #999;border-radius:12px;font-size:11px;padding-left:6px'> &nbsp; \n\t\t<div class='sui-advEditBut' id='sui-advListMap-").concat(e,"' title='Tree view'>&#xe638</div> | \n\t\t<div class='sui-advEditBut' id='sui-advTreeMap-").concat(e,"' title='List view'>&#xe61f</div>");n+="<hr style='border: .5px solid #a4baec'>\n\t\t<div id='sui-tree".concat(e,"' class='sui-tree'></div>"),p()("#sui-advEdit-"+e).html(n.replace(/\t|\n|\r/g,"")),"places"==e?this.LazyLoad(i,null,e,13735):"features"==e?this.LazyLoad(i,null,e,20):"languages"==e?this.LazyLoad(i,null,e,301):this.GetTopRow(i,e),p()("#sui-advListMap-"+e).css({color:"#668eec"}),p()("[id^=sui-advTreeMap-]").off("click"),p()("#sui-advTreeMap-"+e).on("click",(function(){a.DrawFacetList(e,1,p()("#sui-advTreeFilter").val())})),p()("[id^=sui-advTreeFilter-]").off("click"),p()("#sui-advTreeFilter").on("keydown",(function(t){a.DrawFacetList(e,1,p()("#sui-advTreeFilter").val()),p()("#sui-advEditFilter-"+e).focus()})),p()(".sui-advViewTreePage").off("click"),p()(".sui-advViewTreePage").on("click",(function(e){var t=e.target.id.split("-");a.GetKmapFromID(t[1]+"-"+t[2],(function(e){sui.SendMessage("",e)})),e.stopPropagation()})),p()(i).css("max-height",p()("#sui-main").height()-p()("#sui-advTerm-"+e).offset().top-p()("#sui-advTerm-"+e).height()-102+"px"),p()("#sui-advEdit-"+e).slideDown()}else p()("#sui-advEdit-"+e).slideUp()}},{key:"GetTopRow",value:function(e,t){var s,a,i=this,n=e.match(/sui-btree-/)?"b":"",r=[],l="<ul>";for(a in"terms"==t?(r.ka=1,r.kha=14263,r.ga=24465,r.nga=45101,r.ca=51638,r.cha=55178,r.ja=62496,r.nya=66477,r.ta=73101,r.tha=80697,r.da=87969,r.na=105631,r.pa=114065,r.pha=120048,r.ba=127869,r.ma=142667,r.tsa=154251,r.tsha=158451,r.dza=164453,r.wa=166888,r.zha=167094,r.za=172249,r["'a"]=177092,r.ya=178454,r.ra=185531,r.la=193509,r.sha=199252,r.sa=204036,r.ha=215681,r.a=219022):"subjects"==t&&(r.Administration=5550,r.Architecture=6669,r.Collections=2823,r["Community Services Project Types"]=5553,r.Contemplation=5806,r["Cultural Landscapes"]=8868,r["Cultural Regions"]=305,r.Event=2743,r.General=6793,r["Geographical Features"]=20,r.Grammars=5812,r["Higher Education Digital Tools"]=6404,r["Historical Periods"]=5807,r["Human Relationships"]=306,r["Language Tree"]=301,r["Literary Genres"]=5809,r["Material Objects"]=2693,r["Mesoamerican Studies"]=6664,r["Oral Genres"]=5808,r["Organizations and Organizational Units"]=2688,r.Politics=7174,r.Profession=6670,r["Religious Sects"]=302,r["Religious Systems"]=5810,r.Ritual=5805,r.Scripts=192,r["Teaching Resources"]=6844,r["Text Typologies"]=4833,r["Tibet and Himalayas"]=6403,r["Zoologies (Biological and Spiritual)"]=5813),r)l+="<li class='parent'><a id='"+n+(s=t+"-"+r[a])+"'",l+="' data-path='"+r[a]+"'>"+a,l+=this.pages.AddPop(s,!0),l+="</a></li>";p()(e).html(l+"</ul>"),p()(".sui-tree li > a").off(),p()(".sui-tree li > a").on("click",(function(t){!function(t,s){var a=p()(t.parent()).hasClass("parent")?20:0;if(s.offsetX<a)1==t.parent().children().length?i.LazyLoad(e,t,i.curTree):(t.parent().toggleClass("active"),t.parent().children("ul").slideToggle("fast"));else if(s.clientX<200||i.showSearch)i.pages.relatedBase=i.pages.relatedId="","related"==i.ss.mode&&(i.ss.mode=i.ss.lastMode),sui.GetKmapFromID(i.curTree+"-"+s.target.id.split("-")[1],(function(e){sui.SendMessage("",e)}));else{var n=p()("#"+s.target.id).text();sui.AddNewFilter(n,i.curTree+"-"+s.target.id.split("-")[1],"AND",i.curTree)}}(p()(this),t)}))}},{key:"LazyLoad",value:function(e,t,s,a){var i,n=this,r=this.sui,l=this;if(a||1==t.parent().children().length){var o=e.match(/sui-btree-/)?"b":"";i=a?""+a:""+t.data().path,this.GetTreeChildren(s,i,(function(i){var c,u,d,h="",m="<ul>";for("terms"==s?i.facet_counts&&i.facet_counts.facet_fields&&i.facet_counts.facet_fields["ancestor_id_tib.alpha_path"]&&(h=i.facet_counts.facet_fields["ancestor_id_tib.alpha_path"].join()):i.facet_counts&&i.facet_counts.facet_fields&&i.facet_counts.facet_fields.ancestor_id_path&&(h=i.facet_counts.facet_fields.ancestor_id_path.join()),u=0;u<i.response.docs.length;++u)c=i.response.docs[u],d=new RegExp("/"+c.id.split("-")[1]),m+="<li",(h&&h.match(d)||a)&&(m+=" class='parent'"),m+="><a id='"+o+c.id,m+="terms"==s?"' data-path='"+c["ancestor_id_tib.alpha_path"]+"'>":"' data-path='"+c.ancestor_id_path+"'>",m+=c.header,m+=n.pages.AddPop(c.id,!0),m+="</a></li>";i.response.docs.length&&(a?p()(e).html(m+"</ul>"):(t.after(m+"</ul>"),t.parent().toggleClass("active"),t.parent().children("ul").slideToggle("fast")),p()(".sui-tree li > a").off(),p()(".sui-tree li > a").on("click",(function(t){!function(t,s){var a=p()(t.parent()).hasClass("parent")?20:0;if(s.offsetX<a)1==t.parent().children().length?l.LazyLoad(e,t,l.curTree):(t.parent().toggleClass("active"),t.parent().children("ul").slideToggle("fast"));else if(s.clientX<200||l.showSearch)l.pages.relatedBase=l.pages.relatedId="","related"==l.ss.mode&&(l.ss.mode=l.ss.lastMode),r.GetKmapFromID(l.curTree+"-"+s.target.id.split("-")[1],(function(e){r.SendMessage("",e)}));else{var i=p()("#"+s.target.id).text();r.AddNewFilter(i,l.curTree+"-"+s.target.id.split("-")[1],"AND",l.curTree)}}(p()(this),t)}))),p()(".sui-advViewTreePage").off("click"),p()(".sui-advViewTreePage").on("click",(function(e){var t=e.target.id.split("-");n.GetKmapFromID(t[1]+"-"+t[2],(function(e){r.SendMessage("",e)})),e.stopPropagation()}))}))}}},{key:"GeoLocate",value:function(){sui.plc.Draw("","",[{lat:36.6251,lon:-118.085,lab:"Lhasa",ui:"subjects-6061"},{lat:37.6251,lon:-119.085,lab:"Lhasa2",ui:"subjects-6060"}])}},{key:"LoadingIcon",value:function(e,t){if(e){var s="<img src='loading.gif' width='"+t+"' ";s+="id='sui-loadingIcon' style='position:absolute;top:calc(50% - "+t/2+"px);left:calc(50% - "+t/2+"px);z-index:5000'>",p()("#sui-main").append(s)}else p()("[id^=sui-loadingIcon]").remove()}},{key:"SendMessage",value:function(e,t){this.pages.Draw(t)}},{key:"Popup",value:function(e,t,s,a){var i="";p()("#sui-popupDiv").remove(),i+="<div id='sui-popupDiv' class='sui-gridPopup' style='left:"+s+"px;top:"+a+"px'>",i+=e+"</div>",p()("#sui-main").append(i),p()("#sui-popupDiv").fadeIn(500).delay(t?1e3*t:3e3).fadeOut(500)}},{key:"ShortenString",value:function(e,t,s){return"object"==typeof e&&(e=e[0]),e&&e.length>t&&(e=s?e.substr(0,(t-3)/2)+"..."+e.slice((t-3)/-2):e.substr(0,t-3)+"..."),e}},{key:"GetCookie",value:function(e){var t,s,a=e+"=",i=decodeURIComponent(document.cookie).split(";");for(t=0;t<i.length;t++){for(s=i[t];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(a))return s.substring(a.length,s.length)}return""}},{key:"SetCookie",value:function(e,t){var s=new Date;s.setTime(s.getTime()+31536e6),s=s.toUTCString(),document.cookie="".concat(e,"=").concat(t,"; expires=").concat(s,";")}},{key:"log",value:function(e,t,s){console.log(e),t&&console.dir(t),s&&alert(e,t)}},{key:"alert",value:function(e,t){this.log(e,t,!1)}}]),e}(),g=function(){function e(t){if(Object(l.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.sui=t,this.app=null,this.kmap=null,this.extent=null,this.showing=!1,p()("<link/>",{rel:"stylesheet",type:"text/css",href:"https://js.arcgis.com/4.12/esri/themes/light/main.css"}).appendTo("head"),this.div=t.pages.div,this.content=["","...loading","...loading"],this.content2=["<br>","<br>"],this.popovers=null}return Object(o.a)(e,[{key:"Draw",value:function(e,t,s){console.error("places.Draw() called with arguments: "),console.dir(arguments);var a=this.sui;this.popovers=s,p()("#sui-legacy").css({"padding-left":"12px",width:"calc(100% - 24px"}),this.kmap=e,this.DrawMetadata(t),a.LoadingIcon(!0,64);var i={container:"plc-main",map:null,baseMap:"hybrid",kml:null,mapView:null,sceneView:null,activeView:null,opt:76,bookmarks:null,legend:null,layers:null,basePick:null,sketch:null,center:[91.1721,29.6524],zoom:12,tilt:80,reqs:["esri/Map","esri/WebMap","esri/views/MapView","esri/views/SceneView","esri/Graphic","esri/layers/FeatureLayer","esri/layers/KMLLayer","esri/core/watchUtils","esri/geometry/Extent"],div:this.div};this.app=i,1&i.opt&&i.reqs.push("esri/widgets/ScaleBar"),2&i.opt&&i.reqs.push("esri/widgets/Search"),8&i.opt&&i.reqs.push("esri/widgets/BasemapGallery"),16&i.opt&&i.reqs.push("esri/widgets/LayerList"),32&i.opt&&i.reqs.push("esri/widgets/Legend"),64&i.opt&&(i.reqs.push("esri/widgets/Sketch"),i.reqs.push("esri/layers/GraphicsLayer")),128&i.opt&&i.reqs.push("esri/widgets/Bookmarks")}},{key:"GeoLocate",value:function(){var e="";this.extent=null;var t=this;try{for(var s=this.kmap.ancestors_txt.length-1;s>0;--s)e+=this.kmap.ancestors_txt[s]+"%20";1==this.kmap.ancestors_txt.length&&(e=this.kmap.ancestors_txt[0]);var a="//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/findAddressCandidates?f=pjson&SingleLine="+e;p.a.ajax({url:a,dataType:"jsonp"}).done((function(e){t.extent=e.candidates[0].extent,t.extent.spatialReference=e.spatialReference.wkid,t.showing&&t.app.GoToExtent(t.extent)}))}catch(i){}}},{key:"DrawContent",value:function(){var e=this,t=this.sui,s="<div id='sui-topCon' style='margin-left:192px'>";this.kmap.caption&&(s+="<div style='margin:5px 0 13px 0' class='sui-sourceText'>"+this.kmap.caption+"</div>"),s+=t.pages.DrawTabMenu(["MAP","NAMES","LOCATION"]),s+="</div><div class='plc-main' id='plc-main' ></div>",p()(this.div).html(s.replace(/\t|\n|\r|/g,"")),p()("#plc-main").css("height",.667*p()("#sui-main").height()+"px"),p()("[id^=sui-tabTab]").on("click",(function(t){e.ShowTab(t.currentTarget.id.substring(10))}))}},{key:"DrawMetadata",value:function(e){var t=this,s=this.sui;if(this.popovers)return p()(this.div).html("<div class='plc-main' id='plc-main'></div>"),void p()("#plc-main").css({margin:0,width:"100%",height:p()("#sui-legacy").height()+"px"});this.GeoLocate(),this.DrawContent(),this.ShowTab(e||0),s.pages.DrawRelatedAssets(this.kmap),s.GetChildNamesFromID("places",this.kmap.id,(function(e){var s,a,i,n=[],r="<div style='display:inline-block;width:50%'><br>\n\t\t\t<div style='font-weight:bold;color:#6faaf1;margin-bottom:8px'>NAMES</div>";if(e&&e[0]&&e[0]._childDocuments_&&e[0]._childDocuments_.length){for(s=0;s<e[0]._childDocuments_.length;++s)a=e[0]._childDocuments_[s],(i={}).lab=a.related_names_header_s,i.lang=a.related_names_language_s,i.rel=a.related_names_relationship_s,i.write=a.related_names_writing_system_s,i.ety=a.related_names_etymology_s,i.path=a.related_names_path_s,i.tab=a.related_names_level_i-1,n.push(i);n.sort((function(e,t){return e.path>t.path?1:e.path<t.path?-1:0}))}for(s=0;s<n.length;++s)r+="<div style='margin-left:".concat(16*n[s].tab,"px'>"),s&&(r+="&bull; "),r+="<b>".concat(n[s].lab," </b>&nbsp; (").concat(n[s].lang,", ").concat(n[s].write,", ").concat(n[s].rel,")</div>");for(r+="<br></div><div style='display:inline-block;width:calc(50% - 24px);vertical-align:top;border-left:1px solid #ccc; padding-left:12px;margin-top:22px'>\n\t\t\t<div style='font-weight:bold;color:#6faaf1;margin-bottom:8px'>ETYMOLOGY</div>",s=0;s<n.length;++s)n[s].ety&&(r+="<div>Etymology for <b>".concat(n[s].lab,"</b>: &nbsp; ").concat(n[s].ety,"</div>"));r+="</div><br>",t.content[1]=r.replace(/\t|\n|\r|/g,"")})),s.GetRelatedFromID(this.kmap.uid,(function(e){e[0].illustration_external_url&&e[0].illustration_external_url?(p()("#sui-relatedImg").addClass("sui-relatedImg"),p()("#sui-relatedImg").prop("src",e[0].illustration_external_url[0])):e[0].illustration_mms_url&&e[0].illustration_mms_url[0]&&(p()("#sui-relatedImg").addClass("sui-relatedImg"),p()("#sui-relatedImg").prop("src",e[0].illustration_mms_url[0])),t.AddRelatedTabs(),t.AddRelatedPlaces(t.kmap,e,t.content2,0),t.AddRelatedSubjects(t.kmap,e)}))}},{key:"ShowTab",value:function(e){var t=this.sui,s=this;p()("[id^=sui-tabTab]").css({"background-color":"#999",color:"#fff"}),p()("#sui-tabContent").css({display:"block","background-color":"#eee"}),p()("#sui-tabTab"+e).css({"background-color":"#eee",color:"#000"}),p()("#sui-tabTab"+e).css({"background-color":"#eee",color:"#000"}),0==e?p()("#plc-main").slideDown():p()("#plc-main").slideUp(),e>2?p()("#sui-topCon").html(this.content[e]):p()("#sui-tabContent").html(this.content[e]),4==e&&(p()("#sui-tabContent").css({display:"block","background-color":"#eee"}),p()("#sui-tabTabB0").css({"background-color":"#eee",color:"#000"}),p()("#sui-tabTabB0").css({"background-color":"#eee",color:"#000"}),p()("#sui-tabContent").html(this.content2[0]),p()("[id^=sui-spLab-]").on("click",(function(e){return!1})),p()("[id^=sui-spDot-]").on("click",(function(e){var a=e.currentTarget.id.substring(10);"null"!=a&&t.pages.AddRelBranch(s.kmap.asset_type,a,p()(this)),p()(this).html("&ndash;"),p()(this).parent().find("ul").slideToggle()}))),p()("#sui-spLab-"+this.kmap.uid).css({"font-weight":"bold","text-decoration":"underline"})}},{key:"AddRelatedTabs",value:function(){var e=this,t=this.sui,s=this,a=function(e){var t,s="";for(t=0;t<e.length;++t)s+="<div class='sui-tabTab' id='sui-tabTabB".concat(t,"' style='width:calc(").concat(100/e.length,"% - 2px)'>").concat(e[t],"&nbsp;&#xe609</div>");return(s+="<div class='sui-tabContent' id='sui-tabContent'></div>").replace(/\t|\n|\r|/g,"")}(["PLACE CONTEXT","RELATED PLACES"]);this.content[4]=a.replace(/\t|\n|\r|/g,""),p()("[id^=sui-tabTabB]").on("click",(function(a){var i=a.currentTarget.id.substring(11);p()("[id^=sui-spDot-]").off("click"),p()("[id^=sui-spItem-]").off("click"),p()("[id^=sui-togCat-]").off("click"),p()("[id^=sui-spCatUL-]").off("click"),p()("[id^=sui-tabTabB]").css({"background-color":"#999",color:"#fff"}),p()("#sui-tabContent").css({display:"block","background-color":"#eee"}),p()("#sui-tabTabB"+i).css({"background-color":"#eee",color:"#000"}),p()("#sui-tabTabB"+i).css({"background-color":"#eee",color:"#000"}),p()("#sui-tabContent").html(e.content2[i]),p()("[id^=sui-spDot-]").on("click",(function(e){var a=p()(this).parent().find("ul")[0],i=e.currentTarget.id.substring(10);"null"!=i&&t.pages.AddRelBranch(s.kmap.asset_type,i,p()(this)),p()(this).html("none"==p()(a).css("display")?"&ndash;":"+"),p()(this).parent().find("ul").slideToggle()})),p()("[id^=sui-spLab-]").on("click",(function(e){return!1})),p()("[id^=sui-spItem-]").on("click",(function(e){return!1})),p()("[id^=sui-spCatUL-]").slideDown(),p()("[id^=sui-spCat-]").on("click",(function(e){var t=e.currentTarget.id.substring(9);"none"==p()("#sui-spCatUL"+t).css("display")?p()("#sui-spCatUL"+t).slideDown():p()("#sui-spCatUL"+t).slideUp()})),p()("[id^=sui-spSub-]").on("click",(function(e){var t=e.currentTarget.id.substring(9);"none"==p()("#sui-spSubUL"+t).css("display")?p()("#sui-spSubUL"+t).slideDown():p()("#sui-spSubUL"+t).slideUp()})),p()("#sui-togCatA").on("click",(function(){p()("[id^=sui-spCatUL-]").slideDown()})),p()("#sui-togCatN").on("click",(function(){p()("[id^=sui-spCatUL-]").slideUp()}))}))}},{key:"AddRelatedPlaces",value:function(e,t,s){var a=this.sui,i=0,n=0;t[0].ancestors&&t[0].ancestors.length>2&&(n=t[0].ancestors.length-2);var r="<br><div class='sui-spHead'>Places related to ".concat(e.title,"</div>\n\t\t<div style='max-width:900px'>\n\t\t<b>").concat(e.title[0],"</b> has <b>").concat(n,"</b> superordinate places and<b> TBD </b> immediately subordinate places. \n\t\tYou can browse these subordinate places as well as its superordinate categories with the tree below. \n\t\tSee the RELATED PLACES tab if you instead prefer to view only its immediately subordinate places grouped together in useful ways, \n\t\tas well as places non-hierarchically related to it.</div><br>\n\t\t<ul class='sui-spLin' id='sui-spRows'>");if("subjects"!=e.asset_type){if(t[0].ancestors){for(i=0;i<t[0].ancestors.length-1;++i)r+="<ul style='list-style-type:none'>",r+=a.pages.AddRelTreeLine(t[0].ancestors[i+1],t[0].ancestor_uids_generic[i+1],"&ndash;",null);a.GetTreeChildren(e.asset_type,t[0].ancestor_id_path,(function(e){var i,n,l,o,c,u=[];try{u=e.facets.child_counts.buckets}catch(d){}for(e=e.response.docs,i=0;i<e.length;++i){for(c="",o=null,l=new RegExp(e[i].id.split("-")[1]),n=0;n<u.length;++n)u[n].val.match(l)&&(o="+",c=u[n].val);r+="<ul style='list-style-type:none'>",r+=a.pages.AddRelTreeLine(e[i].header,e[i].id,o,c)+"</li></ul>"}for(i=0;i<t[0].ancestors.length;++i)r+="</li></ul>";s[0]=r.replace(/\t|\n|\r/g,"")+"</ul><br>"})),this.AddRelatedContext(e,t,s)}}else s[0]=r.replace(/\t|\n|\r/g,"")+"</ul><br>"}},{key:"AddRelatedContext",value:function(e,t,s){var a,i,n=this.sui,r=[],l=0;for(i=0;i<t.length;++i)"related_places"==t[i].block_child_type&&"Earth"!=t[i].related_places_header_s&&(++l,r[t[i].related_places_relation_label_s]||(r[t[i].related_places_relation_label_s]=[]),r[t[i].related_places_relation_label_s].push({title:t[i].related_places_header_s,sub:t[i].related_places_feature_type_s,id:t[i].related_uid_s}));var o=Object.keys(r).sort((function(e,t){return e.length>t.length?-1:1}))[0],c="<br><div class='sui-spHead'>Places related to ".concat(e.title,"</div>\n\t\t\t<div style='max-width:900px'>\n\t\t\t<b>").concat(e.title[0],"</b> has <b>","TBD","</b> other place").concat(l>1?"s":""," directly related to it, which is presented here. \n\t\t\tSee the PLACE CONTEXT tab if you instead prefer to browse all subordinate and superordinate places for ").concat(e.title[0],".</div>\n\t\t\t<p><a class='sui-advEditBut' id='sui-togCatA'>Expand all</a> / <a class='sui-advEditBut' id='sui-togCatN'>Collapse all</a>\n\t\t\t</p><div style='width:100%'><div style='width:50%;display:inline-block'>");for(a in c+=u(o)+"</div><div style='display:inline-block;width:50%;vertical-align:top'>",r)a!=o&&(c+=u(a));function u(t){var s="xxx";r[t]=r[t].sort((function(e,t){return e.sub<t.sub?-1:1}));var a="<div id='sui-spCat-".concat(t.replace(/ /g,"_"),"' \n\t\t\t\tclass='sui-spCat' style='background-color:").concat(n.assets[e.asset_type].c,"'> ").concat(e.title," ").concat(t,"</div>\n\t\t\t\t<ul id='sui-spCatUL-").concat(t.replace(/ /g,"_"),"'><ul>");for(i=0;i<r[t].length;++i)s!=r[t][i].sub&&(s=r[t][i].sub,a+="</ul><div class='sui-spSubCat'>",a+="<div style='background-color:#999' class='sui-spDot' id='sui-spSub-"+r[t][i].id+"'>&ndash;</div>",a+="<b>"+s+"</b></div>",a+="<ul id='sui-spSubUL-"+r[t][i].id+"' style='list-style-type:none'>"),a+="<li style='list-style-type:none'><a class='sui-noA' id='sui-spItem-"+r[t][i].id,a+="' href='#p="+r[t][i].id+"'>",a+=r[t][i].title+"</a>"+n.pages.AddPop(r[t][i].id)+"</li>";return a+"</ul></ul>"}c+="</div></div>",s[1]=c.replace(/\t|\n|\r/g,"")+"</ul><br>"}},{key:"AddRelatedSubjects",value:function(e,t){var s,a,i=this.sui,n=[],r="<div style='width:50%;vertical-align:top'>\n\t\t\t<div class='sui-spHead'>Subjects related to ".concat(e.title,"</div>");if(e.feature_types_ss&&e.feature_types_ss.length){for(r+="<div class='sui-spCat' style='background-color:#6faaf1'>\n\t\t\tFeature Types</div>\n\t\t\t<div style='margin-left:24px'>",s=0;s<e.feature_types_ss.length;++s)r+="<li>"+e.feature_types_idfacet[s].split("|")[0]+i.pages.AddPop(e.feature_types_idfacet[s].split("|")[1])+"</li>";r+="</div><br>"}for(s=0;s<t.length;++s)"related_subjects"==t[s].block_child_type&&(a=t[s].related_subjects_display_string_s,t[s].related_subjects_time_units_t&&t[s].related_subjects_time_units_t[0]&&(a+=" (".concat(t[s].related_subjects_time_units_t[0],")")),n.push({title:a,id:t[s].related_subjects_id_s}));if(n.length)for(r+="<div class='sui-spCat' style='background-color:#6faaf1'>\n\t\t\t\tRelated subjects</div>\n\t\t\t\t<div style='margin-left:24px'>",s=0;s<n.length;++s)r+="<li>"+n[s].title+i.pages.AddPop(n[s].id)+"</li>";r+="</div>",this.content[3]=r.replace(/\t|\n|\r|/g,"")}}]),e}(),f=function(){function e(t){if(Object(l.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.sui=t,this.div=t.pages.div,this.content=["...loading","...loading","...loading"],this.inPlay=!1,this.curTransSeg=-1,this.transRes=null,this.scrollStart=0,this.handScroll=!1,this.mouseDown=!1,this.playEnd=0,this.kmap=null}return Object(o.a)(e,[{key:"Draw",value:function(e){var t,s,a=this,i=this.sui,n=100,r=this,l="";this.inPlay=!1;var o=p()(this.div).width();p()(this.div).css("background-color","#eee"),p()(this.div).html("<div id='sui-av'></div>"),i.pages.DrawRelatedAssets(e),this.kmap=e,"undefined"!=typeof window.kWidget&&window.kWidget.destroy("sui-kplayer"),i.LoadingIcon(!0,64),i.GetJSONFromKmap(e,(function(c){var u="<div id='sui-viewerSide' style='display:inline-block;width:".concat(o,"px;max-width:1100px'>");c.field_video&&c.field_video.und?l=c.field_video.und[0].entryid:c.field_video&&c.field_video.en?l=c.field_video.en[0].entryid:c.field_audio&&c.field_audio.und?(l=c.field_audio.und[0].entryid,n=50):c.field_audio&&c.field_audio.en&&(l=c.field_audio.en[0].entryid,n=50),u+="<div class='sui-vPlayer' style='width:".concat(n,"%;height:").concat(.5625*o*n/100,"px' id='sui-kplayer'>\n\t\t\t<img src=\"https://cfvod.kaltura.com/p/").concat("381832","/sp/").concat("381832","00/thumbnail/entry_id/").concat(l,'/version/100301/width/560/height/0" fill-height"></div>'),u+="<br><br><div style='display:inline-block;width:300px;margin-left:16px'>\n\t\t\t<div title='Duration'>&#xe61c&nbsp;&nbsp;&nbsp;".concat(e.duration_s,"</div>\n\t\t\t<div title='Published'>&#xe60c&nbsp;&nbsp;&nbsp;Published "),c.field_year_published&&c.field_year_published.en?u+=+c.field_year_published.en[0].value:e.node_created&&(u+=i.pages.FormatDate(e.node_created)),u+="</div>";try{e.collection_title&&(u+="<a title='Collection' id='sui-avCol'\n\t\t\t\t\thref='#c=".concat(e.asset_type,"-").concat(e.id,"=").concat(e.collection_idfacet[0],"'>\n\t\t\t\t\t&#xe633&nbsp;&nbsp;&nbsp;\n\t\t\t\t\t<a title='Collection' id='sui-avCol'\thref='#p=").concat(e.collection_uid_s,"'>").concat(e.collection_title,"</a>"))}catch(h){}u+="</div><div style='display:inline-block;vertical-align:top;width:calc(100% - 320px)'>";try{u+="<div title='Creators'>&#xe600&nbsp;&nbsp;&nbsp;"+e.creator.join(", ")+"</div>"}catch(h){}if(u+="</div><hr>\n\t\t\t<p class='sui-sourceText'>".concat(e.summary?e.summary:e.caption?e.caption:"","</p>"),c.field_pbcore_description&&c.field_pbcore_description.und&&c.field_pbcore_description.und.length){for(u+='<div class=\'sui-avMore1\'><a class=\'sui-avMore2\' onclick=\'$("#sui-avlang").toggle();this.text=(this.text == "SHOW MORE") ? "SHOW LESS" : "SHOW MORE"\'>\n\t\t\t\tSHOW MORE</a></div><br>',u+="<div id='sui-avlang' style='display:none'>",t=0;t<c.field_pbcore_description.und.length;++t)try{s=c.field_pbcore_description.und[t],u+="<b>".concat(s.field_language.und[0].value.toUpperCase(),"</b>:<br>").concat(s.field_description.und[0].value,"<br>")}catch(h){}u+="</div>"}function d(e){p()("[id^=sui-tabTab]").css({"background-color":"#999",color:"#fff"}),p()("#sui-tabContent").css({display:"block","background-color":"#fff"}),p()("#sui-tabTab"+e).css({"background-color":"#fff",color:"#000"}),p()("#sui-tabContent").html(r.content[e])}u+=i.pages.DrawTabMenu(["DETAILS","PEOPLE","TECHNICAL"]),p()("#sui-av").html(u.replace(/\t|\n|\r/g,"")),p()("#sui-avCol").on("click",(function(){return i.GetKmapFromID(e.collection_uid_s,(function(e){i.SendMessage("",e)})),!1})),a.DrawTranscript(e,"#sui-trans"),u="//cdnapi.kaltura.com/p/".concat("381832","/sp/").concat("381832","00/embedIframeJs/uiconf_id/").concat("31832371","/partner_id/").concat("381832"),p.a.ajax({url:u,dataType:"script"}).done((function(e){window.kWidget.embed({targetId:"sui-kplayer",wid:"_381832",uiconf_id:"31832371",entry_id:l,flashvars:{autoPlay:!1},params:{wmode:"transparent"}}),window.kWidget.addReadyCallback((function(){var e=document.getElementById("sui-kplayer");"object"==typeof e&&(e.kBind("doPlay.__tests__",(function(){p()("#sui-transTab1").html("&#xe681"),a.inPlay=!0,a.PlayAV()})),e.kBind("doPause.__tests__",(function(){p()("#sui-transTab1").html("&#xe641"),a.inPlay=!1,a.playEnd=0,clearInterval(a.transTimer)})))}))})),i.LoadingIcon(!1),"undefined"!=typeof window.kWidget&&window.kWidget.embed({entry_id:l}),a.DrawMetaData(e,c),d(0),p()("[id^=sui-tabTab]").on("click",(function(e){d(e.currentTarget.id.substring(10))}))}))}},{key:"DrawMetaData",value:function(e,t){var s,a,i,n,r=this.sui,l="";try{e.title&&(l+="<p title='Title'><b>TITLE</b>:&nbsp;&nbsp;"+e.title+"</p>")}catch(o){}try{e.collection_title&&(l+="<p title='Collection'><b>COLLECTION</b>:&nbsp;&nbsp;"+e.collection_title+"</p>")}catch(o){}try{for(l+="<p><b>SUBCOLLECTION</b>:&nbsp;&nbsp;",s=0;s<t.field_subcollection_new.und.length;++s)l+=t.field_subcollection_new.und[s].header+r.pages.AddPop(t.field_subcollection_new.und[s].domain+"-"+t.field_subcollection_new.und[s].id)+"&nbsp;&nbsp; ";l+="</p>"}catch(o){}try{for(l+="<p><b>SUBJECT</b>:&nbsp;&nbsp;",s=0;s<t.field_subject.und.length;++s)l+=t.field_subject.und[s].header+r.pages.AddPop(t.field_subject.und[s].domain+"-"+t.field_subject.und[s].id)+"&nbsp;&nbsp; ";l+="</p>"}catch(o){}try{l+="<p><b>RECORDING LOCATION</b>:&nbsp;&nbsp;"+t.field_recording_location_new.und[0].header+r.pages.AddPop(t.field_recording_location_new.und[0].domain+"-"+t.field_recording_location_new.und[0].id)+"</p>"}catch(o){}try{l+="<p'><b>LANGUAGE</b>:&nbsp;&nbsp;"+t.field_language_kmap.und[0].header+r.pages.AddPop(t.field_language_kmap.und[0].domain+"-"+t.field_language_kmap.und[0].id)+"</p>"}catch(o){}try{l+="<p><b>TERMS</b>:&nbsp;&nbsp;"+t.field_terms.und[0].header+"</p>"}catch(o){}try{l+="<p><b>COPYRIGHT OWNER</b>:&nbsp;&nbsp;"+t.field_copyright_owner.en[0].value+"</p>"}catch(o){}try{l+="<p><b>YEAR PUBLISHED</b>:&nbsp;&nbsp;"+t.field_year_published.en[0].value+"</p>"}catch(o){}try{l+="<p><b>RIGHTS SUMMARY</b>:&nbsp;&nbsp;"+t.field_pbcore_rights_summary.en[0].value+"</p>"}catch(o){}try{l+="<p><b>UPLOADED</b>:&nbsp;&nbsp;"+e.timestamp.substr(0,10)+" by "+e.node_user_full_s+"</p>"}catch(o){}if(this.content[0]="<div style='height:2px'/>"+l+"<br>",l="",t.field_pbcore_creator&&t.field_pbcore_creator.und&&t.field_pbcore_creator.und.length)for(s=0;s<t.field_pbcore_creator.und.length;++s){n=t.field_pbcore_creator.und[s];try{l+="<p><b>".concat(n.field_creator_role.und[0].value.toUpperCase(),"</b>:&nbsp;&nbsp;").concat(n.field_creator.und[0].value,"</p>")}catch(o){}}if(t.field_pbcore_contributor&&t.field_pbcore_contributor.und&&t.field_pbcore_contributor.und.length)for(s=0;s<t.field_pbcore_contributor.und.length;++s){n=t.field_pbcore_contributor.und[s];try{l+="<p><b>CONTRIBUTING ".concat(n.field_contributor_role.und[0].value.toUpperCase(),"</b>:&nbsp;&nbsp;").concat(n.field_contributor.und[0].value,"</p>")}catch(o){}}try{l+="<p><b>PUBLISHER</b>:&nbsp;&nbsp;"+t.field_pbcore_publisher.und[0].field_publisher.und[0].value+"</p>"}catch(o){}try{l+="<p><b>DATA ENTRY</b>:&nbsp;&nbsp;"+e.node_user_full_s+"</p>"}catch(o){}if(this.content[1]="<div style='height:2px'/>"+l+"<br>",l="",t.field_pbcore_instantiation&&t.field_pbcore_instantiation.und&&t.field_pbcore_instantiation.und.length)for(s in t.field_pbcore_instantiation.und[0]){i=t.field_pbcore_instantiation.und[0][s],a=s.replace(/field_/,"").replace(/_/g," ");try{l+="<p><b>".concat(a.toUpperCase(),"</b>:&nbsp;&nbsp;").concat(i.und[0].value,"</p>")}catch(o){}}try{l+="<p><b>FORMAT ID</b>:&nbsp;&nbsp;"+t.field_video.und[0].entryid+"</p>"}catch(o){}l+="<p><b>FORMAT ID SOURCE</b>:&nbsp;&nbsp;(Kaltura.com)</p>",this.content[2]="<div style='height:2px'/>"+l+"<br>"}},{key:"DrawTranscript",value:function(e,t){var s,a,i,n=this,r={};if(e.trid_i){this.curTransSeg=-1,r.ts_content_rus="Russian",r.content_bod="Tibetan",r.dzo_bod="Dzongkha",r.ts_content_sgt="Brokpake",r.ts_content_kjz="Bumthangkha",r.ts_content_tgf="Chalikha",r.ts_content_cgk="Chocangacakha",r.ts_content_dka="Dakpakha",r.ts_content_dzl="Dzalakha",r.ts_content_goe="Gongduk",r.ts_content_xkz="Kurtop",r.ts_content_kru="Kuruz",r.ts_content_lkh="Lakha",r.ts_content_lya="Layakha",r.ts_content_lep="Lepcha",r.ts_content_lhp="Lhokpu",r.ts_content_luk="Lunanakha",r.ts_content_npb="Nupbikha",r.ts_content_neh="Mangdekha",r.ts_content_ole="Olekha",r.ts_content_tsj="Tshangla",r.ts_content_xkf="Khengkha",r.ts_content_wylie="Wylie",r.ts_content_gyal="Gyalsumdo",r.ts_content_gvr="Gurung",r.ts_content_npa="Nar Phu",r.ts_content_nmm="Manange",r.ts_content_kte="Nubri",r.ts_content_tsum="Tsum",r.ts_content_nep="Nepali",r.ts_content_eng="English",r.ts_content_zho="Chinese",r.ts_content_und="Unknown",r.ts_content_gloss="Morpheme glossing";var l={languages:{},speakers:{},segs:[],layout:"Normal",rev:0,speaker:""},o="https://ss251856-us-east-1-aws.measuredsearch.com/solr/av_test/select?indent=on&q=is_trid:"+e.trid_i+"&wt=json&start=0&rows=1000";p.a.ajax({url:o,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){for(e.response.docs.sort((function(e,t){return e.fts_start>t.fts_start?1:-1})),s=0;s<e.response.docs.length;++s){for(var t in a=e.response.docs[s],i={start:a.fts_start,end:a.fts_end,dur:a.fts_duration},a.ss_speaker_bod&&(l.speakers[a.ss_speaker_bod]=1,i.speaker=a.ss_speaker_bod),i.lang=a.ss_language?a.ss_language:"",r)a[t]&&(i[r[t]]=a[t],l.languages[r[t]]=1);l.segs.push(i)}l.segs.length&&(n.transRes=l,p()(n.div).width()>700&&p()("#sui-viewerSide").width(.5*p()(n.div).width()),p()("#sui-kplayer").height(.5*p()(n.div).width()*.5625),n.DrawTranscriptMenu(),n.DrawTransContent())}))}}},{key:"DrawTranscriptMenu",value:function(){var e=this,t=this.transRes,s="<div style='display:inline-block;width:calc(50% - 24px);margin-left:12px;vertical-align:top; min-width:350px;'>\n\t\t<div id='sui-transTab0' class='sui-transTab' title='Options'>&#xe66f&#xe609</div>\n\t\t<div id='sui-transTab1' class='sui-transTab' title='Play/Pause'>&#xe641</div>\n\t\t<div id='sui-transTab2' class='sui-transTab' title='Previous line'>&#xe602</div>\n\t\t<div id='sui-transTab3' class='sui-transTab' title='Same line'>&#xe632</div>\n\t\t<div id='sui-transTab4' class='sui-transTab' title='Next line'>&#xe604</div>\n\t\t<div id='sui-transTab5' class='sui-transTab' style='border:none' title='Search transcript'>&#xe623</div>\n\t\t<div id='sui-transSrc' class='sui-transSrc'>\n\t\t\t\t<div style='display:inline-block;margin:14px 0 0 16px;user-select:none'>\n\t\t\t\t\t<div id='sui-transSrcB' style='display:inline-block;color:#fff;;font-size:20px;cursor:pointer' title='Previous result'>&#xe640</div>\n\t\t\t\t\t<div id='sui-transSrcN' style='display:inline-block;color:#fff;margin:0 16px;font-size:12px;cursor:pointer;vertical-align:4px'>0 of 0</div>\n\t\t\t\t\t<div id='sui-transSrcF' style='display:inline-block;color:#fff;font-size:20px;cursor:pointer' title='Previous result'>&#xe641</div>\n\t\t\t\t\t</div>\n\t\t\t\t<div id='sui-transSrcGo' class='sui-search4' style='float:right;margin:12px 16px 0 0'>&#xe623</div>\n\t\t\t\t<div class='sui-search1' style='float:right;margin-top:12px'>\n\t\t\t\t\t<input type='text' id='sui-transSrcInp' class='sui-search2' placeholder='Search this transcript'>\n\t\t\t\t\t<div id='sui-clear' class='sui-search3'>&#xe610</div>\n\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t<div id='sui-transOps' class='sui-transOps'></div>\n\t\t\t<div id='sui-trans' class='sui-trans'></div>\n\t\t</div>";p()("#sui-av").append(s.replace(/\t|\n|\r/g,""));var a=0,i=[];function n(){var e=this.sui,t=i.length?a+1:0;p()("#sui-transSrcN").html(t+" of "+i.length),i.length&&(e.av.curTransSeg=i[a],e.av.HighlightSeg(e.av.curTransSeg,void 0))}for(var r in p()("#sui-transSrcGo").on("click",(function(){var e,s,r;if(i=[],a=0,p()("#sui-transSrcInp").val())for(s=RegExp(p()("#sui-transSrcInp").val(),"i"),e=0;e<t.segs.length;++e)for(r in t.languages)t.segs[e][r]&&t.segs[e][r].match(s)&&i.push(e);n()})),p()("#sui-transSrcInp").on("change",(function(){p()("#sui-transSrcGo").trigger("click")})),p()("#sui-transSrcB").on("click",(function(){a=Math.max(0,a-1),n()})),p()("#sui-transSrcF").on("click",(function(){a=Math.min(i.length-1,a+1),n()})),s="<div class='sui-transRow'>Transcript options<span class='sui-transCheck'\n\t\tonclick='$(\"#sui-transOps\").slideToggle()'>&#xe60f</span></div>\n\t\t<div class='sui-transLab'>LANGUAGES</div>",t.languages)s+="<div class='sui-transRow' id='sui-transLan-"+r+"'>- "+r+"<span id='sui-transLang-"+r+"' class='sui-transCheck' style='color:#58aab4'>&#xe60e</span></div>";s+="<div class='sui-transLab'>SPEAKERS</div>\n\t\t<div class='sui-transRow'>- Tibetan<span id='sui-transS1' class='sui-transCheck' style='color:#58aab4'>&#xe60e</span></div>\t\n\t\t<div class='sui-transLab'>LAYOUTS</div>\n\t\t<div class='sui-transRow' id='sui-transMinR'>- Minimal<span id='sui-transMin' class='sui-transCheck'>&#xe60e</span></div>\n\t\t<div class='sui-transRow' id='sui-transRevR'>- Reversed<span id='sui-transRev' class='sui-transCheck'>&#xe60e</span></div>\n\t\t<div class='sui-transLab'>DOWNLOADS</div>\n\t\t<div class='sui-transRow' id='sui-transStr'->- SRT file<span class='sui-transCheck' style='color:#58aab4'>&#xe616</span></div>",p()("#sui-transOps").html(s.replace(/\t|\n|\r/g,"")),p()("#sui-transStr").on("click",(function(){e.SaveStrFile()})),p()("[id^=sui-transLan-]").on("click",(function(s){var a=s.currentTarget.id.substring(13);t.languages[a]=1-t.languages[a],p()("#sui-transLang-"+a).css("color",t.languages[a]?"#58aab4":"#ccc"),e.DrawTransContent()})),p()("#sui-transMinR").on("click",(function(){t.layout="Minimal"==t.layout?"Normal":"Minimal",p()("#sui-transMin").css("color","Minimal"==t.layout?"#58aab4":"#ccc"),e.DrawTransContent()})),p()("#sui-transRevR").on("click",(function(){t.rev=t.rev?0:1,p()("#sui-transRev").css("color",t.rev?"#58aab4":"#ccc"),e.DrawTransContent()})),p()("#sui-transTab0").on("click",(function(){p()("#sui-transOps").slideToggle()})),p()("#sui-transTab5").on("click",(function(){p()("#sui-transSrc").slideToggle()})),p()("#sui-transTab1").on("click",(function(){clearInterval(e.transTimer),e.inPlay?p()("#sui-kplayer")[0].sendNotification("doPause"):(e.PlayAV(),p()("#sui-kplayer")[0].sendNotification("doPlay"))})),p()("#sui-transTab2").on("click",(function(){e.curTransSeg=Math.max(e.curTransSeg-1,0),e.PlayAV(t.segs[e.curTransSeg].start,t.segs[e.curTransSeg].end),p()("#sui-kplayer")[0].sendNotification("doPlay")})),p()("#sui-transTab3").on("click",(function(){e.PlayAV(t.segs[e.curTransSeg].start,t.segs[e.curTransSeg].end),p()("#sui-kplayer")[0].sendNotification("doPlay")})),p()("#sui-transTab4").on("click",(function(){e.curTransSeg=Math.min(e.curTransSeg+1,t.segs.length-1),e.PlayAV(t.segs[e.curTransSeg].start,t.segs[e.curTransSeg].end),p()("#sui-kplayer")[0].sendNotification("doPlay")}))}},{key:"SaveStrFile",value:function(){var e,t,s,a=this.transRes,i="";for(t=0;t<a.segs.length;++t){for(e in s=a.segs[t],i+="".concat(t+1,"\n").concat(s.start,",000 --\x3e ").concat(s.end,",000\n").concat(s.speaker?">> "+s.speaker+"\n":""),a.languages)a.segs[t][e]&&a.languages[e]&&(i+=a.segs[t][e]+"\n");i+="\n"}var n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(i)),n.setAttribute("download","transcript-"+this.kmap.id+".str"),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}},{key:"DrawTransContent",value:function(){var e,t,s=this,a="",i=this,n=this.transRes;if("Minimal"==n.layout)for(e=0;e<n.segs.length;++e){for(t in a+="<div class='sui-transMinSeg' id='sui-transMinSeg-".concat(e,"'>\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t<div style='float:").concat(n.rev?"right":"left",";font-size:18px;'>\n\t\t\t\t").concat(n.segs[e].speaker?n.segs[e].speaker+"<br>":"","\n\t\t\t\t<div class='sui-transMinPlay' id='sui-transPlay-").concat(e,"' title='Play line ").concat(this.SecondsToTimecode(n.segs[e].start),"'>&#xe680</div> \n\t\t\t\t</div>\n\t\t\t\t<div class='sui-transMinBox' id='sui-transMinBox-").concat(e,"'\n\t\t\t\tstyle='margin:").concat(n.rev?"0 150px 0 0":"0  0 0 150px","'>"),n.languages)n.segs[e][t]&&n.languages[t]&&(a+=n.segs[e][t]+"<hr style='margin:0;border-top:1px dashed #eee'>");a+="</div></div>"}else for(e=0;e<n.segs.length;++e){for(t in a+="<div class='sui-transSeg' id='sui-transSeg-".concat(e,"'>\n\t\t\t\t<div style='float:").concat(n.rev?"right":"left",";font-size:18px;'>\n\t\t\t\t").concat(n.segs[e].speaker?n.segs[e].speaker+"<br>":"","\n\t\t\t\t<div class='sui-transPlay' id='sui-transPlay-").concat(e,"' \n\t\t\t\ttitle='Play line'>&#xe680\n\t\t\t\t<span style='margin-left:24px;font-size:12px;vertical-align:4px'>\n\t\t\t\t").concat(this.SecondsToTimecode(n.segs[e].start),"</span></div></div> \n\t\t\t\t<div class='sui-transBox' id='sui-transBox-").concat(e,"'\n\t\t\t\tstyle='margin:").concat(n.rev?"0 150px 0 0":"0  0 0 150px","'>"),n.languages)n.segs[e][t]&&n.languages[t]&&(a+=n.segs[e][t]+"<hr style='margin:0;border-top:1px dashed #eee'>");a+="</div></div>"}p()("#sui-trans").html(a.replace(/\t|\n|\r/g,"")),p()("#sui-trans").on("mousedown",(function(){s.mouseDown=!0})),p()("#sui-trans").on("mouseup",(function(){s.mouseDown=!1})),p()("#sui-trans").on("scroll",(function(){i.handScroll=!0,i.mouseDown||(clearTimeout(p.a.data(this,"scrollTimer")),p.a.data(this,"scrollTimer",setTimeout((function(){i.handScroll=!1}),250)))})),p()("[id^=sui-transPlay-]").on("click",(function(e){s.curTransSeg=e.currentTarget.id.substring(14),s.PlayAV(n.segs[s.curTransSeg].start,n.segs[s.curTransSeg].end),p()("#sui-kplayer")[0].sendNotification("doPlay")}))}},{key:"PlayAV",value:function(e,t){var s,a=this,i=this.transRes;clearInterval(this.transTimer),this.scrollStart=p()("#sui-trans").scrollTop(),void 0!=e&&p()("#sui-kplayer")[0].sendNotification("doSeek",e),t&&(this.playEnd=t),this.transTimer=setInterval((function(t){var n=p()("#sui-kplayer")[0].evaluate("{video.player.currentTime}");if(a.playEnd&&n>=a.playEnd)return clearInterval(a.transTimer),p()("#sui-kplayer")[0].sendNotification("doPause"),void(a.playEnd=0);for(s=0;s<i.segs.length;++s)if(n>=i.segs[s].start&&n<i.segs[s].end){a.curTransSeg=s;break}a.curTransSeg>0&&a.HighlightSeg(a.curTransSeg,e)}),100)}},{key:"HighlightSeg",value:function(e,t){var s=p()("#sui-trans".concat("Minimal"==this.transRes.layout?"Min":"","Seg-").concat(e)).position().top-p()("#sui-trans".concat("Minimal"==this.transRes.layout?"Min":"","Seg-0")).position().top;this.handScroll&&(t=1),void 0==t&&p()("#sui-trans").scrollTop(s-this.scrollStart),p()("[id^=sui-transSeg-]").css("background-color","#ddd"),p()("[id^=sui-transMinSeg-]").css("border-color","#fff"),p()("[id^=sui-transMinSeg-]").css("background-color","#fff"),p()("#sui-transMinSeg-"+e).css("border-color","#999"),p()("#sui-transMinSeg-"+e).css("background-color","#eee"),p()("#sui-transSeg-"+e).css("background-color","#aaa")}},{key:"TimecodeToSeconds",value:function(e){var t=0,s=0,a=(""+e).split(":"),i=a[0];return 2==a.length?(i=a[1],s=a[0]):3==a.length&&(i=a[2],s=a[1],t=a[0]),Number(3600*t)+Number(60*s)+Number(i)}},{key:"SecondsToTimecode",value:function(e){var t,s="";return(t=Math.floor(e/3600))&&(s+=t+":"),(t=Math.floor(e/60))<10&&(s+="0"),s+=t+":",(t=Math.floor(e%60))<10&&(s+="0"),s+=t}}]),e}(),v=function(){function e(t){Object(l.a)(this,e),this.sui=t,this.div=t.pages.div,this.content=["...loading","...loading"],this.content2=["<br>","<br>"],this.kmap=null,this.relatedPlaceData=null,this.relatedSubjectData=null}return Object(o.a)(e,[{key:"Draw",value:function(e,t){console.error("subjects.Draw() called "),console.dir(arguments);var s=this.sui;this.kmap=e,p()("#sui-legacy").css({"padding-left":"12px",width:"calc(100% - 24px"}),this.GetSubjectData(e),this.DrawContent(e,t),s.pages.DrawRelatedAssets(e)}},{key:"DrawContent",value:function(e,t){var s=this,a=this.sui,i="<div class='sui-subjects' id='sui-subConDiv'>\n\t\t<div><span class='sui-subIcon'>".concat(a.assets[e.asset_type].g,"</span>\n\t\t<span class='sui-subText'>").concat(e.title[0],"</span>\n\t\t<hr style='border-top: 1px solid ").concat(a.assets[e.asset_type].c,"'>");e.caption&&(i+="<p id='sui-spCap'>"+e.caption+"</p></div>"),1==t?i="<div style='margin-left:192px'>"+a.pages.DrawTabMenu(["SUBJECT CONTEXT","RELATED SUBJECTS"]):2==t&&(i="<div id='sui-topCon' style='margin-left:216px'>"+this.GetPlaceData(e)),p()(this.div).html(i+"</div>".replace(/\t|\n|\r/g,"")),p()("[id^=sui-tabTab]").on("click",(function(e){var t=e.currentTarget.id.substring(10);s.ShowTab(t)}))}},{key:"ShowTab",value:function(e){var t=this;p()("[id^=sui-spLab-]").off("click"),p()("[id^=sui-spDot-]").off("click"),p()("[id^=sui-spItem-]").off("click"),p()("[id^=sui-togCat-]").off("click"),p()("[id^=sui-spCatUL-]").off("click"),p()("[id^=sui-tabTab]").css({"background-color":"#999",color:"#fff"}),p()("#sui-tabContent").css({display:"block","background-color":"#eee"}),p()("#sui-tabTab"+e).css({"background-color":"#eee",color:"#000"}),p()("#sui-tabContent").html(this.content[e]),0==e?(p()("#sui-spLab-"+this.kmap.uid).css({"font-weight":"bold","text-decoration":"underline"}),p()("[id^=sui-spLab-]").on("click",(function(e){return!1})),p()("[id^=sui-spDot-]").on("click",(function(e){var s=e.currentTarget.id.substring(10);"null"!=s&&sui.pages.AddRelBranch(t.kmap.asset_type,s,p()(this)),p()(this).html("&ndash;"),p()(this).parent().find("ul").slideToggle()}))):1==e&&(p()("[id^=sui-spItem-]").on("click",(function(e){return!1})),p()("[id^=sui-spCatUL-]").slideDown(),p()("[id^=sui-spCat-]").on("click",(function(e){var t=e.currentTarget.id.substring(9);"none"==p()("#sui-spCatUL"+t).css("display")?p()("#sui-spCatUL"+t).slideDown():p()("#sui-spCatUL"+t).slideUp()})),p()("#sui-togCatA").on("click",(function(){p()("[id^=sui-spCatUL-]").slideDown()})),p()("#sui-togCatN").on("click",(function(){p()("[id^=sui-spCatUL-]").slideUp()})))}},{key:"GetPlaceData",value:function(e){var t=this;return sui.GetRelatedPlaces(e.uid,(function(e){t.relatedPlaceData=e,t.DrawRelatedPlaces("tree",1)})),"Loading..."}},{key:"DrawRelatedPlaces",value:function(e,t){var s,a,i,n=this,r=[],l=this.relatedPlaceData,o=this.kmap,c="<br><div class='sui-spHead'>Places related to ".concat(o.title,"</div>\n\t\t<p style='color:#666'>\n\t\t<input id='sui-rpSearch' placeholder='&nbsp;Search places' \n\t\tstyle='width:100px;border:1px solid #999;border-radius:12px;padding-left:8px'> &nbsp;\n\t\t<span class='sui-advEditBut' style='color:").concat("tree"==e?"#668eec":"#666","' \n\t\tid='sui-rpTree' title='Tree view'>&#xe638</span> | \n\t\t<span class='sui-advEditBut' style='color:").concat("tree"!=e?"#668eec":"#666","'\n\t\tid='sui-rpList' title='List view'>&#xe61f</span>");if("tree"!=e){for(a=p()("#sui-footer").offset().top-p()("#sui-legacy").offset().top-150,c+=" | <span class='sui-advEditBut' id='sui-rpSort' title='Sort'>\n\t\t\t".concat(1==t?"&#xe653":"&#xe652","</span>\t\t\n\t\t\t</p><div class='sui-rpList' style='height:").concat(a,"px'>"),l=l.sort((function(e,s){return e.title<s.title?-t:t})),s=0;s<l.length;++s)c+="<div id='sui-rpLine-".concat(s,"' style='width:300px' title='").concat(l[s].ancestors_txt.join("/"),"'>").concat(l[s].title,"</div>");return p()("#sui-topCon").html(c+"</div>"),p()("#sui-rpTree").on("click",(function(){n.DrawRelatedPlaces("tree",t)})),p()("#sui-rpSort").on("click",(function(){n.DrawRelatedPlaces("list",-1*t)})),void p()("#sui-rpSearch").on("keydown",(function(e){var t,a=p()("#sui-rpSearch").val();for(e.keyCode>31&&e.keyCode<91&&(a+=e.key),8==e.keyCode&&a.length&&(a=a.slice(0,-1)),a=RegExp(a,"i"),s=0;s<l.length;++s)(t=p()("#sui-rpLine-"+s)).text().match(a)?t.css("display","block"):t.css("display","none")}))}c+=" | <span class='sui-advEditBut' style='vertical-align:0' \n\t\tid='sui-togCatA' title='Expand all'<b>&#x2295</b></span> | \n\t\t<span class='sui-advEditBut' style='vertical-align:0'\n\t\tid='sui-togCatN' title='Collapse all'><b>&#x2296</b></span> \n\t\t</p><div style='width:100%'><div style='display:inline-block'>\n\t\t<ul style='list-style-type:none;margin-left:-24px'>";var u=l.length;for(s=0;s<u;++s)for(i="places-",a=0;a<l[s].ancestor_ids_is.length;++a)i+=l[s].ancestor_ids_is[a]+"-",r.push({lab:l[s].ancestors_txt[a],level:a,id:i.slice(0,-1),uid:"places-"+l[s].ancestor_ids_is[a]}),r[r.length-1].parent=i.split("-").slice(0,-2).pop();for(r=r.sort((function(e,t){return e.id<t.id?-1:1})),s=r[r.length-1],(r=r.filter((function(e,t){try{return e.id!=r[t+1].id}catch(s){}}))).push(s),u=r.length,s=0;s<u;++s)0==r[s].level&&(c+=m(r[s].lab,r[s].id,r[s].id,"&ndash;"));for(p()("#sui-topCon").html(c+"</ul></div>"),p()("#sui-rpList").on("click",(function(){n.DrawRelatedPlaces("list",t)})),p()("#sui-rpSearch").on("keyup",(function(){var e=p()("#sui-rpSearch").val();n.DrawRelatedPlaces("list",t),p()("#sui-rpSearch").val(e),p()("#sui-rpSearch").focus(),p()("#sui-rpSearch").trigger("keydown",{keyCode:13})})),s=0;s<u;++s)r[s].n=d(r[s].id);for(s=0;s<u;++s)0==r[s].level&&h(r[s].id,1);function d(e){var t,s=0;for(e=e.split("-").pop(),t=0;t<u;++t)r[t].parent==e&&++s;return s}function h(e,t){var s,a,i="";for(s=0;s<u;++s)r[s].id.match(e)&&r[s].level==t&&(a=r[s].n>0?"+":"&bull;",i="<ul style='list-style-type:none;display:none;padding:2px 0 0 24px'>",i+=m(r[s].lab,r[s].id,r[s].uid,a),i+="</ul>",p()("#sui-rpDot-"+e).parent().parent().append(i),h(r[s].id,t+1))}function m(e,t,s,a){var i="<li>";return i+="&bull;"!=a?"<div class='sui-spDot' id='sui-rpDot-".concat(t,"'>").concat(a,"</div>"):"<div class='sui-spDot' id='sui-rpDot-".concat(t,"' style='display:none;color:#5b66cb'><b>&bull;</div>&bull;&nbsp;&nbsp;"),i+="<a class='sui-noA' href='#p=".concat(s,"'>").concat(e,"</b>").concat(sui.pages.AddPop(s),"</a>")}p()("#sui-topCon").find("li").each((function(){(a=p()(this).parent().find("li").find("b").length)&&!p()(this).find("b").length&&p()(this).find("img").before("("+a/2+") ")})),p()("[id^=sui-rpDot-]").off("click"),p()("[id^=sui-rpDot-]").on("click",(function(e){var t=p()(this).parent().parent(),s=p()(this).html();p()(this).html("+"==s?"&ndash;":"+"),p()(t).children("ul").slideToggle()})),p()("#sui-togCatA").on("click",(function(){var e,t;for(e=0;e<u;++e)t=p()("#sui-rpDot-"+r[e].id).parent(),p()("#sui-rpDot-"+r[e].id).html("&ndash;"),t.parent().css("display","block"),t.css("display","block")})),p()("#sui-togCatN").on("click",(function(){var e,t;for(e=0;e<u;++e)"&bull;"!=(t=p()("#sui-rpDot-"+r[e].id)).html()&&t.html("+"),t.parent().parent().css("display","none"),r[e].level<3&&(r[e].level<2&&t.html("&ndash;"),t.parent().parent().css("display","block"))})),p()("#sui-togCatN").trigger("click")}},{key:"GetSubjectData",value:function(e){var t=this;this.sui.GetRelatedFromID(e.uid,(function(s){var a,i,n=0,r="<table>";if(s){if(t.relatedSubjectData=s,s[0].summary_eng&&s[0].summary_eng[0]&&p()("#sui-spCap").html(s[0].summary_eng[0]),e.names_txt&&e.names_txt.length)for(i=0;i<e.names_txt.length;++i)e.names_txt[i].match(/lang="bo"/i)&&(r+="<tr><td style='color:#000099;font-size:20px'><b>"+e.names_txt[i]+"</b>&nbsp;&nbsp;&nbsp;</td><td span='2'><i>Dzongkha, Tibetan script, Original</i></td></tr>");for(i=0;i<s.length;++i)"related_names"==(a=s[i]).block_child_type&&(n||(a.related_names_level_i=0),r+="<tr><td style='padding-left:".concat(16*a.related_names_level_i,"px'>\n\t\t\t\t").concat(n++?">&nbsp;":"","\n\t\t\t\t<b>").concat(a.related_names_header_s,"&nbsp;&nbsp;&nbsp;</b></td><td>\n\t\t\t\t<i>").concat(a.related_names_language_s,", ").concat(a.related_names_writing_system_s,", ").concat(a.related_names_relationship_s,"\n\t\t\t\t</i></td></tr>"));r+="</table><br>",p()("#sui-subConDiv").append(r.replace(/\t|\n|\r/g,"")),t.AddRelatedSubjects(e,s),t.AddSubjectContext(e,s)}}))}},{key:"AddRelatedSubjects",value:function(e,t){var s,a,i=0,n=[],r=t.length;for(a=0;a<r;++a)"related_subjects"==t[a].block_child_type&&(n[t[a].related_subjects_relation_label_s]||(n[t[a].related_subjects_relation_label_s]=[]),n[t[a].related_subjects_relation_label_s].push({title:t[a].related_subjects_header_s,id:t[a].related_uid_s}));var l=Object.keys(n).sort((function(e,t){return e.length>t.length?-1:1}))[0],o="<br><div class='sui-spHead'>Subjects related to ".concat(e.title,"</div>\n\t\t<div style='max-width:900px'>\n\t\t").concat(e.title[0],"</b> has <b>~|~</b> other subject").concat(r>1?"s":""," directly related to it, which is presented here. \n\t\tSee the SUBJECT CONTEXT tab if you instead prefer to browse all subordinate and superordinate categories for ").concat(e.title[0],".</div>\n\t\t<p><a class='sui-advEditBut' id='sui-togCatA'>Expand all</a> / <a class='sui-advEditBut' id='sui-togCatN'>Collapse all</a>\n\t\t</p><div style='width:100%'><div style='width:50%;display:inline-block'>");for(s in o+=c(l)+"</div><div style='display:inline-block;width:50%;vertical-align:top'>",n)s!=l&&(o+=c(s));function c(t){if(!n||!n[t])return"</ul>";n[t]=n[t].sort((function(e,t){return e.title<t.title?-1:1}));var s="<div id='sui-spCat-"+t.replace(/ /g,"_")+"' class='sui-spCat'>"+e.title+" "+t+"</div><ul id='sui-spCatUL-"+t.replace(/ /g,"_")+"' style='display:none'>";for(a=0;a<n[t].length;++a)s+="<li><a class='sui-noA' id='sui-spItem-"+n[t][a].id,s+="' href='#p="+n[t][a].id+"'>",s+=n[t][a].title+"</a>"+sui.pages.AddPop(n[t][a].id)+"</li>",++i;return s+"</ul>"}o=(o+="</div></div>").replace(/~\|~/,i),this.content[1]=o}},{key:"AddSubjectContext",value:function(e,t){var s,a=this,i=this.sui,n=0,r=0;for(s=0;s<t.length;++s)r+=t[s].child_count.numFound;r="(TBD)";var l="<br><div class='sui-spHead'>Subjects related to ".concat(e.title,"</div>\n\t\t<div style='max-width:900px'>\n\t\t<b>").concat(e.title[0],"</b> has <b> ").concat(t[0].ancestors.length-1," </b>superordinate subjects \n\t\tand <b> ").concat(r," </b>subordinate subjects. \n\t\tYou can browse these subordinate subjects as well as its superordinate categories with the tree below. \n\t\tSee the RELATED SUBJECTS tab if you instead prefer to view only its immediately \n\t\tsubordinate subjects grouped together in useful ways, as well as subjects non-hierarchically related to it.</div><br>\n\t\t<ul class='sui-spLin' id='sui-spRows'>");for(n=0;n<t[0].ancestors.length;++n)l+="<ul style='list-style-type:none'>",l+=i.pages.AddRelTreeLine(t[0].ancestors[n],t[0].ancestor_uids_generic[n],"&ndash;",null);i.GetTreeChildren(e.asset_type,t[0].ancestor_id_path,(function(e){var s,r,o,c,u,d=[];try{d=e.facets.child_counts.buckets}catch(p){}for(e=e.response.docs,s=0;s<e.length;++s){for(u="",c=null,o=new RegExp(e[s].id.split("-")[1]),r=0;r<d.length;++r)d[r].val.match(o)&&(c="+",u=d[r].val);l+="<ul style='list-style-type:none'>",l+=i.pages.AddRelTreeLine(e[s].header,e[s].id,c,u)+"</li></ul>"}for(l=l.replace(/~~/,n+e.length),s=0;s<t[0].ancestors.length;++s)l+="</li></ul>";a.content[0]=l.replace(/\t|\n|\r/g,"")+"</ul><br>",a.ShowTab(0)}))}}]),e}(),b=function(){function e(t){if(Object(l.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.sui=t,this.div=t.pages.div}return Object(o.a)(e,[{key:"Draw",value:function(e){var t,s,a,i=this,n=this.sui,r=e.url_thumb_height/e.url_thumb_width;p()(this.div).width();for(e.url_thumb&&(e.url_thumb=e.url_thumb.replace(/images-test/i,"images")),t=0;t<n.curResults.length;++t)e.id==n.curResults[t].id&&(a=t);var l="<div class='sui-imagesBox' id='sui-imagesBox' style='margin:".concat("related"==n.ss.mode?"-12px 0 0 0":"-12px -12px 0 -12px","'>\n\t\t<div id='sui-picEnlarge' style='cursor:pointer;font-size:18px' title='Click to enlarge and pan'>&#xe650</div></p>\n\t\t<div id='sui-imageDiv' class='sui-imageDiv' >\n\t\t\t<img id='sui-thisPic' src='").concat(e.url_thumb.replace(/200,200/,"2000,2000"),"' style='width:100%'> \n\t\t</div><br>\n\t\t<div><span style='max-width:900px;font-size:20px;vertical-align:-2px;color:#ccc'>&#xe62a&nbsp;&nbsp;").concat(e.title[0],"</span></div>\n\t\t<div style='color:#ccc;margin-bottom:24px'>").concat(e.creator,"&nbsp;&nbsp;|&nbsp;&nbsp;").concat(e.img_width_s," x ").concat(e.img_height_s," px</div>\n\t\t<div class='sui-imageGal'id='sui-imageGal'>");for(t=0;t<a;++t)"images"==n.curResults[t].asset_type&&(l+="<div class='sui-pageThumb'><img id='sui-pageThumb-".concat(t,"' src='").concat(n.curResults[t].url_thumb,"' style='height:100%'></div>"));for(l+="<div class='sui-pageThumb' style=' border-color:#fff'><img id='sui-pageThumb-".concat(a,"' src='").concat(e.url_thumb,"' style='height:100%'></div>"),t=a+1;t<n.curResults.length;++t)"images"==n.curResults[t].asset_type&&(l+="<div class='sui-pageThumb'><img id='sui-pageThumb-".concat(t,"' src='").concat(n.curResults[t].url_thumb,"' style='height:100%'></div>"));l+="</div></div>",n.GetJSONFromKmap(e,(function(e){g(e)})),p()(this.div).html(l.replace(/\t|\n|\r/g,"")),n.pages.DrawRelatedAssets();var o,c=[],u=[],d=[];try{for(t=0;t<e.kmapid_strict.length;++t)if(e.kmapid_strict[t].match(/places/)&&c.push(e.kmapid_strict_ss[t]+n.pages.AddPop(e.kmapid_strict[t])),e.kmapid_strict[t].match(/subjects/)&&u.push(e.kmapid_strict_ss[t]+n.pages.AddPop(e.kmapid_strict[t])),e.kmapid_strict[t].match(/terms/)){o=e.kmapid_strict_ss[t];var h=RegExp(e.kmapid_strict[t]+"_definitions-(d*)","g");if(h=e.kmapid.join().match(h)){for(o+="<span><i><sup> (",s=1;s<=h.length;++s)o+=s,s<h.length&&(o+=",");o+=")</sup></i></span>"}o+=n.pages.AddPop(e.kmapid_strict[t]),d.push(o)}}catch(f){}if(l="<br><table class='sui-imageMid'>\n\t\t\t<tr class='sui-pageLab' style='font-size:16px;padding-bottom:4px'><td style='width:50%'>MANDALA COLLECTIONS</td><td>CLASSIFICATION</td></tr>\n\t\t\t<tr class='sui-pageLab' style='padding-bottom:8px'><td>&#xe633&nbsp;&nbsp;<i>",e.collection_title?l+="".concat(e.collection_title).concat(n.pages.AddPop(e.collection_uid_s)):l+="None",l+="</td><td><i>",u.length){for(l+="<span style='color:#cc4c39'>&#xe634</span>&nbsp;&nbsp",t=0;t<u.length;++t)l+=u[t]+", ";l=l.slice(0,-2)+"<br>"}if(c.length){for(l+="<span style='color:#6faaf1'>&#xe62b</span>&nbsp;&nbsp",t=0;t<c.length;++t)l+=c[t]+", ";l=l.slice(0,-2)+"<br>"}if(d.length){for(l+="<span style='color:#a2733f'>&#xe635</span>&nbsp;&nbsp",t=0;t<d.length;++t)l+=d[t]+", ";l=l.slice(0,-2)+"<br>"}l+="</td></tr></i></table>";var m=this.DrawItem;function g(s){l+="<div class='sui-images'>",l+="<div style='width:calc(49% - 24px);display:inline-block;margin-right:16px;vertical-align:top;height:100%;'><table style='width:100%'>";try{l+=m(n.assets[e.asset_type].g,"CAPTION",e.caption,"Untitled")}catch(f){}l+="<tr><td colspan='2'><hr></td></tr>";try{l+=m("&#xe600","CREATOR",e.creator)}catch(f){}try{l+=m("&#xe66d","TYPE",s.field_image_type.und[0].value.charAt(0).toUpperCase()+s.field_image_type.und[0].value.slice(1))}catch(f){}try{l+=m("&#xe665","SIZE",e.img_width_s+" x "+e.img_height_s+" px")}catch(f){}l+="<tr><td colspan='2'><hr></td></tr>";try{for(l+="<p class='sui-pageLab'>",t=0;t<s.field_image_descriptions.und.length;++t)l+=s.field_image_descriptions.und[t].title+"<br>";l+="</p>"}catch(f){}try{l+=m("&#xe600",s.field_image_agents.und[0].field_agent_role.und[0].value.toUpperCase(),s.field_image_agents.und[0].title+" ("+n.pages.FormatDate(s.field_image_agents.und[0].field_agent_dates.und[0].value)+")")}catch(f){}try{l+="</table><p>",l+=s.field_image_descriptions.und[0].field_description.und[0].value+"<br></p>"}catch(f){}l+="</div><div style='width:49%;display:inline-block;vertical-align:top;border-left:1px solid #ddd;padding-left:16px'><br><table style='width:100%'>";try{l+=m("&#xe67f","ONLY DIGITAL",s.field_image_digital.und[0].value?"Yes":"No")}catch(f){}try{l+=m("&#xe67f","COLOR",s.field_image_color.und[0].value?"Yes":"No")}catch(f){}try{l+=m("&#xe67f","QUALITY",s.field_image_quality.und[0].value)}catch(f){}try{l+=m("&#xe67f","ROTATION",s.field_image_rotation.und[0].value+"&deg;")}catch(f){}try{l+=m("&#xe665","PHYSICAL&nbsp;SIZE",s.field_physical_size.und[0].value)}catch(f){}try{l+=m("&#xe659","CAPURE&nbsp;DEVICE",s.field_image_capture_device.und[0].value)}catch(f){}try{l+=m("&#xe65f","MATERIALS",s.field_image_materials.und[0].value)}catch(f){}try{l+=m("&#xe66c","ENHANCEMENT",s.field_image_enhancement.und[0].value)}catch(f){}try{l+="<tr><td>&#xe62B&nbsp;&nbsp;<span class='sui-pageLab'>LOCATION</span>:</td><td>"+s.field_longitude.und[0].value+"&nbsp;&nbsp;&nbsp;"+s.field_latitude.und[0].value+"</td></tr>"}catch(f){}try{l+=m("&copy;","COPYRIGHT&nbsp;HOLDER",s.field_copyright_holder.und[0].value)}catch(f){}try{l+=m("&copy;","COPYRIGHT&nbsp;STATEMENT",s.field_copyright_statement.und[0].value)}catch(f){}try{l+=m("&#xe614","ORIGINAL&nbsp;FILE",s.field_original_filename.und[0].value)}catch(f){}try{l+=m("&#xe678","TECHNICAL&nbsp;NOTES",s.field_technical_notes.und[0].value)}catch(f){}try{l+=m("&#xe639","UPLOADED&nbsp;BY",e.node_user_full_s)}catch(f){}try{l+=m("&#xe67f","LICENSE","<a style='font-weight:400' target='_blank' href='"+s.field_license_url.und[0].value+"'>"+s.field_license_url.und[0].value+"</a>")}catch(f){}var a=e.img_height_s/e.img_width_s;l+="</table><p class='sui-pageLab' style='cursor:pointer' onclick='$(\"#sui-dlOps\").toggle()'>\n\t\t\t\t&#xe616&nbsp;&nbsp;<a>DOWNLOAD IMAGE</a>\n\t\t\t\t\t<div id='sui-dlOps' style='display:none;margin-left:24px;font-size:12px'>\t\t\t\n\t\t\t\t\t<a target='_blank' href='".concat(e.url_thumb.replace(/200,200/,e.img_width_s+","+e.img_width_s),"'\n\t\t\t\t\tstyle='display:inline-block;cursor:pointer'>Original (").concat(e.img_width_s,"x").concat(e.img_height_s,")</a><br>\n\t\t\t\t\t<a target='_blank' href='").concat(e.url_thumb.replace(/200,200/,"1200,1200"),"'\n\t\t\t\t\tstyle='display:inline-block;cursor:pointer'>Large (1200x").concat(1200*a,"))</a><br>\n\t\t\t\t\t<a target='_blank' href='").concat(e.url_thumb.replace(/200,200/,"800,800"),"'\n\t\t\t\t\tstyle='display:inline-block;cursor:pointer'>Medium (800x").concat(800*a,")</a><br>\n\t\t\t\t\t<a target='_blank' href='").concat(e.url_thumb.replace(/200,200/,"400,400"),"'\n\t\t\t\t\tstyle='display:inline-block;cursor:pointer'>Small (400x").concat(400*a,')</a>\n\t\t\t\t\t<p><i>Right-click and select "Download/Save Linked File"</i></p>\n\t\t\t\t\t</div>\n\t\t\t\t</p></div></div></div>'),p()(n.pages.div).append(l.replace(/\t|\n|\r/g,"")),p()("#sui-imgCol").on("click",(function(){return n.GetKmapFromID(e.collection_uid_s,(function(e){n.SendMessage("",e)})),!1}))}p()("[id^=sui-pageThumb-]").on("click",(function(e){var t=e.currentTarget.id.split("-")[2];n.pages.Draw(n.curResults[t])})),p()("#sui-picEnlarge").on("click",(function(){var e,t,s,a,n=p()("#sui-legacy")[0],l=p()(i.div).width()/2*r;if(p()("#sui-imagesBox").css({"padding-top":"12px"}),p()("#sui-imageDiv").css({width:"100%",height:p()("#sui-legacy").height()+"px"}),p()("#sui-picEnlarge").html().match(/Zoom/))return p()("#sui-picEnlarge").html("&#xe650"),p()("#sui-thisPic").offset(p()("#sui-imageDiv").offset()),p()("#sui-imageDiv").css({width:"50%",height:l+"px"}),p()("#sui-imagesBox").css({"padding-top":"60px"}),void(n.onmousedown=n.onwheel=null);p()("#sui-picEnlarge").html("Zoom &nbsp; &#xe651  &nbsp; out "),p()("#sui-thisPic").css("width","auto"),n.style.cursor="grab",n.onwheel=function(t){(t=t||window.event).preventDefault(),e=p()("#sui-thisPic").offset(),p()("#sui-thisPic").offset({left:(t.deltaX?t.deltaX:0)/5+e.left,top:(t.deltaY?t.deltaY:0)/3+e.top})},n.onmousedown=function(i){(i=i||window.event).preventDefault(),e=i.pageX,t=i.pageY,s=p()("#sui-thisPic").offset().left,a=p()("#sui-thisPic").offset().top,n.onmousemove=function(i){(i=i||window.event).preventDefault();var n=i.pageX-e,r=i.pageY-t;p()("#sui-thisPic").offset({left:s+n,top:a+r})},n.onmouseup=function(e){n.onwheeel=n.onmouseup=n.onmousemove=null}}}))}},{key:"DrawItem",value:function(e,t,s,a,i,n){var r,l="<tr><td>";if(null==s||void 0==s||""==s)return"";if(e&&(l+=e+"&nbsp;&nbsp;"),l+="<span class='sui-pageLab'",n&&(l+=" style='font-weight:600'"),l+=">"+t+":&nbsp;&nbsp;</span>",l+="</td><td><span class='",l+=(i||"sui-pageVal")+"'>","object"==typeof s)for(r=0;r<s.length;++r)s[r].header?l+=s[r].header:s[r].value?l+=s[r].value:s[r].val?l+=s[r].val:s[r].title?l+=s[r].title:l+=s[r],r!=s.length-1&&(l+=", ");else l+=s&&!s.match(/undefined/)?s:a;return l+"</span></td></tr>"}}]),e}(),y=function(){function e(t){if(Object(l.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.sui=t,this.div=t.pages.div,this.content=["...loading","...loading","...loading"]}return Object(o.a)(e,[{key:"Draw",value:function(e){var t=this;console.error("texts.Draw()");var s=this.sui,a=this;p()(".shanti-texts-section-content").length||p()("<link/>",{rel:"stylesheet",type:"text/css",href:"https://texts-dev.shanti.virginia.edu/sites/all/themes/shanti_sarvaka_texts/css/shanti_texts.css"}).appendTo("head");var i=e.url_ajax.replace(/node_ajax/i,"node_embed")+"?callback=pfunc";p()(this.div).html();p()(this.div).html("<div id='sui-textCon' class='sui-texts'></div>\n\t\t<div style='display:inline-block;width:calc(34% + 3px);margin-left:-8px;vertical-align:top'>\n\t\t<div class='sui-textTop' id='sui-textTop'>\n\t\t\t<div class='sui-textTab' id='sui-textTab0'>CONTENTS</div>\n\t\t\t<div class='sui-textTab' id='sui-textTab1'>DESCRIPTION</div>\n\t\t\t<div class='sui-textTab' id='sui-textTab2'>VIEWS</div>\n\t\t</div>\n\t\t<div class='sui-textContent' id='sui-textContent'></div></div>".replace(/\t|\n|\r/g,"")),s.LoadingIcon(!0,64),p.a.ajax({url:i,dataType:"jsonp"}).done((function(i){s.LoadingIcon(!1),p()("#sui-textCon").html(i),p()("#shanti-texts-container").height(p()("#sui-content").height()-80),p()("#shanti-texts-body").height(p()("#sui-content").height()-110),t.content[0]=p()("#shanti-texts-toc").html(),p()("#shanti-texts-sidebar").remove(),r(0),p()("#shanti-texts-container").append("xxxxxxxxxxxxx<br><br>"),p()(".kmap-tag-group").each((function(){var e=p()(this).data("kmdomain"),t=e+"-"+p()(this).data("kmid"),a='<span style=\'font-family:"Open Sans",shanticon;color:'.concat(s.assets[e].c,"'>\n\t\t\t\t\t").concat(s.assets[e].g,"&nbsp;</span>\n\t\t\t\t\t").concat(p()(this.children[0]).text(),"\n\t\t\t\t\t").concat(s.pages.AddPop(t),"&nbsp;&nbsp;");p()(this.children[0]).html(a.replace(/\t|\n|\r/g,""))}));var n="<p><b>ALTERNATIVE FORMATS</b></p>\n\t\t\t<p>&nbsp;&nbsp;&nbsp;&nbsp;<a target='_blank' href='https://texts.shanti.virginia.edu/book_pubreader/".concat(e.id,"'>&#xe678&nbsp;&nbsp;View in PubReader</a></p>\n\t\t\t<p>&nbsp;&nbsp;&nbsp;&nbsp;<a target='_blank' href='https://texts.shanti.virginia.edu/shanti_texts/voyant/").concat(e.id,"'>&#xe678&nbsp;&nbsp;View in Voyant</a></p>\n\t\t\t<p>&nbsp;&nbsp;&nbsp;&nbsp;<a target='_blank' href='https://texts.shanti.virginia.edu/shanti_texts/node_ajax_text/").concat(e.id,"'>&#xe678&nbsp;&nbsp;View as raw text</a></p>");function r(t){p()("#sui-textContent").html("<div class='sui-sourceText' style='font-size:18px;color:#000'>"+e.title+"<div><hr>"),p()("[id^=sui-textTab]").css({"background-color":"#eee"}),p()("#sui-textTab"+t).css({"background-color":"#fff"}),p()("#sui-textContent").append(a.content[t]),p()("#sui-txtCol").off("click"),p()("#sui-txtCol").on("click",(function(){return s.GetKmapFromID(e.collection_uid_s,(function(e){s.SendMessage("",e)})),!1}))}t.content[2]=n.replace(/\t|\n|\r/g,""),s.GetJSONFromKmap(e,(function(a){var i,r="";r+="<table style='width:100%'>";try{n="<a title='Collection' id='sui-txtCol' href='#p=".concat(e.collection_uid_s,"'>").concat(e.collection_title,"</a>").concat(s.pages.AddPop(e.collection_uid_s)),e.collection_title&&(r+=t.DrawItem("&#xe633","COLLECTION",n))}catch(l){}r+=t.DrawItem("&#xe67c","VISIBILITY","Public - accessible to all site users"),e.summary&&(r+="<tr><hr><td colspan='2' style='max-width:"+p()("#sui-content").width()/4+"px'>"+e.summary+"<hr><td></tr>");try{r+=t.DrawItem("&#xe600","AUTHOR",a.field_book_author.und,"","sui-pageLab")}catch(l){}try{r+=t.DrawItem("&#xe675","EDITOR",a.field_book_editor.und,"","sui-pageLab")}catch(l){}try{r+=t.DrawItem("&#xe633","YEAR&nbsp;PUBLISHED",a.field_dc_date_publication_year.und[0].value.substr(0,4),"sui-pageLab")}catch(l){}try{r+=t.DrawItem("&#xe633","ORIGINAL&nbsp;YEAR PUBLISHED",a.field_dc_date_orginial_year.und[0].value.substr(0,4),"sui-pageLab")}catch(l){}if(a.field_kmap_places&&a.field_kmap_places.und){for(r+="<tr><td style='vertical-align:top'><span class='sui-pageLab'>&#xe62b&nbsp;&nbspPLACES:</td><td>",i=0;i<a.field_kmap_places.und.length;++i)r+=a.field_kmap_places.und[i].header,r+=s.pages.AddPop(a.field_kmap_places.und[i].domain+"-"+a.field_kmap_places.und[i].id),i<a.field_kmap_places.und.length-1&&(r+="<br>");r+="</td></tr>"}if(a.field_kmap_subjects&&a.field_kmap_subjects.und){for(r+="<tr><td style='vertical-align:top'><span class='sui-pageLab'>&#xe634&nbsp;&nbspPLACES:</td><td>",i=0;i<a.field_kmap_subjects.und.length;++i)r+=a.field_kmap_subjects.und[i].header,r+=s.pages.AddPop(a.field_kmap_subjects.und[i].domain+"-"+a.field_kmap_subjects.und[i].id),i<a.field_kmap_subjects.und.length-1&&(r+="<br>");r+="</td></tr>"}if(a.field_kmap_terms&&a.field_kmap_terms.und){for(r+="<tr><td style='vertical-align:top'><span class='sui-pageLab'>&#xe635&nbsp;&nbspTERMS:</td><td>",i=0;i<a.field_kmap_terms.und.length;++i)r+=a.field_kmap_terms.und[i].header,r+=s.pages.AddPop(a.field_kmap_termss.und[i].domain+"-"+a.field_kmap_terms.und[i].id),i<a.field_kmap_terms.und.length-1&&(r+="<br>");r+="</td></tr>"}try{r+=t.DrawItem("&#xe674","TRANSLATOR",a.field_book_translator.und,"sui-pageLab")}catch(l){}try{r+=t.DrawItem("&#xe670","LANGUAGE",a.field_dc_language_original.und,"sui-pageLab")}catch(l){}try{r+=t.DrawItem("&copy;","RIGHTS",a.field_dc_rights_general.und,"sui-pageLab")}catch(l){}r+="</table>",t.content[1]=r.replace(/\t|\n|\r/g,"");try{t.content[2]+="<p>&nbsp;&nbsp;&nbsp;&nbsp;<a target='_blank' href='"+a.field_pdf_version.und[0].url+"'>&#xe678&nbsp;&nbsp;View as PDF</a></p>"}catch(l){}})),p()("[id^=sui-textTab]").on("click",(function(e){r(e.currentTarget.id.substring(11))}))}))}},{key:"DrawItem",value:function(e,t,s,a,i,n){var r,l="<tr><td>";if(null==s||void 0==s||""==s)return"";if(e&&(l+=e+"&nbsp;&nbsp;"),l+="<span class='sui-pageLab'",n&&(l+=" style='font-weight:600'"),l+=">"+t+":&nbsp;&nbsp;</span>",l+="</td><td><span class='",l+=(i||"sui-pageVal")+"'>","object"==typeof s)for(r=0;r<s.length;++r)s[r].header?l+=s[r].header:s[r].value?l+=s[r].value:s[r].val?l+=s[r].val:s[r].title?l+=s[r].title:l+=s[r],r!=s.length-1&&(l+=", ");else l+=s&&!s.match(/undefined/)?s:a;return l+"</span></td></tr>"}}]),e}(),_=function(){function e(t){if(Object(l.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.sui=t,this.div=t.pages.div}return Object(o.a)(e,[{key:"Draw",value:function(e){var t=this.sui,s="<div class='sui-sources' id='sui-sources'>\n\t\t<span style='font-size:24px;color:".concat(t.assets[e.asset_type].c,";vertical-align:-4px'>").concat(t.assets[e.asset_type].g,"</span>\n\t\t&nbsp;&nbsp;<span class='sui-sourceTitle'>").concat(e.title[0],"</span>\n\t\t<hr style='border-top: 1px solid ").concat(t.assets[e.asset_type].c,"'>\n\t\t<div class='sui-sourceSec' id='sui-srcSec'></div><br>");e.creator&&e.creator.length&&(s+="<span class='sui-pageLab' style='color:".concat(t.assets[e.asset_type].c,"'>&#xe600</span>\n\t\t\t&nbsp;&nbsp;").concat(e.creator.join(", "),"<br><br>")),e.url_thumb&&!e.url_thumb.match(/gradient.jpg/)&&(s+="<img src='"+e.url_thumb+"' style='float:right;width:33%; padding:0 0 12px 12px'>"),e.collection_title&&(s+="<p>COLLECTION:&nbsp;&nbsp<a id='sui-imgCol' href='#p=".concat(e.collection_uid_s,"'>").concat(e.collection_title,"</a></p>")),e.asset_subtype&&(s+="<p>FORMAT:&nbsp;&nbsp<span class='sui-sourceText'>"+e.asset_subtype+"</span></p>"),s+="<p class='sui-pageLab' id='sui-p2'>PUBLICATION YEAR:&nbsp;&nbsp<span class='sui-sourceText' id='sui-srcYear'></span>",e.publisher_s&&(s+="<p>PUBLISHER:&nbsp;&nbsp<span class='sui-sourceText'>"+e.publisher_s+"</span></p>"),s+="<p class='sui-pageLab' id='sui-p3'>PLACE OF PUBLICATION:&nbsp;&nbsp<span class='sui-sourceText' id='sui-srcPlc'></span>",s+="<p class='sui-pageLab' id='sui-p1'>PAGES:&nbsp;&nbsp<span class='sui-sourceText' id='sui-srcPages'></span>",s+="<p class='sui-pageLab'>SOURCE ID:&nbsp;&nbsp<span class='sui-sourceText'>sources-"+e.id+"</span></p>",e.summary&&(s+="<p>ABSTRACT:<div class='sui-sourceText'>"+e.summary+"</div></p>"),s+="</div>",p()(this.div).html(s.replace(/\t|\n|\r/g,"")),t.pages.DrawRelatedAssets(),p()("#sui-imgCol").on("click",(function(){return t.GetKmapFromID(e.collection_uid_s,(function(e){t.SendMessage("",e)})),!1})),t.GetJSONFromKmap(e,(function(e){var s,a="";if(e.biblio_pages?p()("#sui-srcPages").html(e.biblio_pages):p()("#sui-sp1").hide(),e.biblio_year?p()("#sui-srcYear").html(e.biblio_year):p()("#sui-sp2").hide(),e.biblio_secondary_title?p()("#sui-srcSec").html(e.biblio_secondary_title):p()("#sui-srcSec").hide(),e.biblio_place_published?p()("#sui-srcPlc").html(e.biblio_place_published):p()("#sui-sp3").hide(),e.field_kmaps_subjects&&e.field_kmaps_subjects.und){for(a+="<p class='sui-pageLab'>SUBJECTS:&nbsp;&nbsp;",s=0;s<e.field_kmaps_subjects.und.length;++s)a+=e.field_kmaps_subjects.und[s].header,a+=t.pages.AddPop(e.field_kmaps_subjects.und[s].domain+"-"+e.field_kmaps_subjects.und[s].id),s<e.field_kmaps_subjects.und.length-1&&(a+=", ");a+="</p>"}if(e.field_kmaps_places&&e.field_kmaps_places.und){for(a+="<p class='sui-pageLab'>TERMS:&nbsp;&nbsp;",s=0;s<e.field_kmaps_places.und.length;++s)a+=e.field_kmaps_places.und[s].header,a+=t.pages.AddPop(e.field_kmaps_places.und[s].domain+"-"+e.field_kmaps_places.und[s].id),s<e.field_kmaps_places.und.length-1&&(a+=", ");a+="</p>"}if(e.field_kmap_terms&&e.field_kmap_terms.und){for(a+="<p class='sui-pageLab'>TERMS:&nbsp;&nbsp;",s=0;s<e.field_kmap_terms.und.length;++s)a+=e.field_kmap_terms.und[s].header,a+=t.pages.AddPop(e.field_kmap_terms.und[s].domain+"-"+e.field_kmap_terms.und[s].id),s<e.field_kmap_terms.und.length-1&&(a+=", ");a+="</p>"}e.biblio_url&&(a+="<p class='sui-pageLab'>URL:&nbsp;&nbsp;<a target='_blank' href='"+e.biblio_url+"'>"+e.biblio_url+"</a></p>"),p()("#sui-sources").append(a)}))}}]),e}(),k=function(){function e(t){if(Object(l.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.sui=t,this.div=t.pages.div}return Object(o.a)(e,[{key:"Draw",value:function(e){var t=this.sui;t.GetJSONFromKmap(e,(function(e){i(e)}));var s="//visuals.shanti.virginia.edu/sites/all/libraries/SHIVA/go.htm?m=//visuals.shanti.virginia.edu/data/json/";s+=e.id;var a=t.pages.DrawItem;function i(i){var n,r=p.a.parseJSON(i.shivanode_json.und[0].value),l=r.width?r.width+"px":"100%",o=r.height?r.height+"px":"calc(100% - 155px)",c=r.dataSourceUrl?r.dataSourceUrl:"",u="<iframe id='sui-iframe' frameborder='0' scrolling='no' src='".concat(s,"' \n\t\t\tstyle='margin-left:auto;margin-right:auto;height:").concat(o,";width:").concat(l,";display:block;overflow:hidden'></Iframe><br>");u+="<div class='sui-sources' style='padding-top:0'>";try{n=e.collection_title?"<a title='Collection' id='sui-imgCol'\thref='#p=".concat(e.collection_uid_s,"'>").concat(e.collection_title,"</a>"):"None"}catch(g){}u+="<div style='text-align:center'>"+a("&#xe633","MANDALA COLLECTION",n)+"</div>",u+="<hr style='border-top: 1px solid #6e9456;margin-top:12px'>";try{u+=a("&#xe63b","TITLE",e.title[0],"Untitled")}catch(g){}try{u+=a("&#xe65f","TYPE",e.asset_subtype.replace(/:/g," | "))}catch(g){}try{u+=a("&#xe60c","DATE",e.node_created.substr(0,10))}catch(g){}try{u+="&#xe600&nbsp;&nbsp;<span class='sui-pageLab'>CREATOR</span>:&nbsp;&nbsp;<span class='sui-pageVal'>",u+=e.node_user_full?e.node_user_full+"&nbsp;&nbsp":"",u+=e.node_user?e.node_user:"",u+="</span>"}catch(g){}if(i.field_kmaps_subjects&&i.field_kmaps_subjects.und){u+="<p class='sui-pageLab'>SUBJECTS:&nbsp;&nbsp;";for(var d=0;d<i.field_kmaps_subjects.und.length;++d)u+=i.field_kmaps_subjects.und[d].header,u+=t.pages.AddPop(i.field_kmaps_subjects.und[d].domain+"-"+i.field_kmaps_subjects.und[d].id),d<i.field_kmaps_subjects.und.length-1&&(u+=", ");u+="</p>"}if(i.field_kmaps_places&&i.field_kmaps_places.und){u+="<p class='sui-pageLab'>TERMS:&nbsp;&nbsp;";for(var h=0;h<i.field_kmaps_places.und.length;++h)u+=i.field_kmaps_places.und[h].header,u+=t.pages.AddPop(i.field_kmaps_places.und[h].domain+"-"+i.field_kmaps_places.und[h].id),h<i.field_kmaps_places.und.length-1&&(u+=", ");u+="</p>"}if(i.field_kmap_terms&&i.field_kmap_terms.und){u+="<p class='sui-pageLab'>TERMS:&nbsp;&nbsp;";for(var m=0;m<i.field_kmap_terms.und.length;++m)u+=i.field_kmap_terms.und[m].header,u+=t.pages.AddPop(i.field_kmap_terms.und[m].domain+"-"+i.field_kmap_terms.und[m].id),m<i.field_kmap_terms.und.length-1&&(u+=", ");u+="</p>"}c&&(u+="<p>&#xe678&nbsp;&nbsp;<a target='_blank' href='"+c+"'>External spreadsheet</a></p>"),e.caption&&(u+=e.caption);'[iframe src="'.concat(s,'" width="').concat(l,'" height="').concat(o,'"]'),'&lt;iframe src="'.concat(s,'" width="').concat(l,'" height="').concat(o,'"&gt;');u+="<hr>&#xe600&nbsp;&nbsp;<span class='sui-pageLab'>SHARE AS</span>:&nbsp;&nbsp;\n\t\t\t\t<a id='sui-share-1' style='display:inline-block;cursor:pointer'>Link&nbsp;&nbsp;&nbsp;</a>\n\t\t\t\t<a id='sui-share-2' style='display:inline-block;cursor:pointer'>WordPress&nbsp;&nbsp;&nbsp;</a>\n\t\t\t\t<a id='sui-share-3' style='display:inline-block;cursor:pointer'>Iframe&nbsp;&nbsp;&nbsp;</a>\n\t\t\t\t<p id='sui-resShare' style='border-radius:4px;background-color:#fff;padding:8px;display:none;border:1px solid #ccc'></p>\n\t\t\t\t</div>",p()("#sui-resShare").html("<b>LINK</b>: ${url}"),p()("#sui-resShare").toggle(),p()(t.pages.div).html(u.replace(/\t|\n|\r/g,"")),t.pages.DrawRelatedAssets(e),p()("[id^=sui-share-]").on("click",(function(e){var t=e.currentTarget.id.split("-")[2];"1"==t?p()("#sui-resShare").html(s):"2"==t?p()("#sui-resShare").html('[iframe src="'.concat(s,'" width="').concat(l,'" height="').concat(o,'"]')):"3"==t&&p()("#sui-resShare").html('&lt;iframe src="'.concat(s,'" width="').concat(l,'" height="').concat(o,'"&gt;')),p()("#sui-resShare").show()}))}}}]),e}(),w=function(){function e(t){if(Object(l.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.sui=t,this.div=t.pages.div,this.recordingGroup=0,this.tabs=[],this.tagged=[],this.kmap=null}return Object(o.a)(e,[{key:"Draw",value:function(e){var t=this,s=this.sui,a=[""];this.kmap=e;var i="<div class='sui-terms' id='sui-terms' style=''>\n\t\t<span class='sui-termIcon'>".concat(s.assets[e.asset_type].g,"</span>&nbsp;&nbsp;&nbsp;\n\t\t<span class='sui-termTitle' id='sui-termTitle'>").concat(e.title[0],"</span>\n\t\t<hr style='border-top: 1px solid ").concat(s.assets[e.asset_type].c,"'>\n\t\t<p id='sui-termNames'>Names</p>\n\t\t<div id='sui-player' style='display:none'>\n\t\t<p><div class='sui-termPlay' id='sui-termPlay'>&#xe60a</div>\n\t\t<select class='sui-termSpeak unpopulated' id='sui-termGroup'><option>AMDO GROUP</option></select></p></div>");i+="<div id='sui-termDetails'></div>",i+="<div id='sui-termDefs' class='sui-termOther'></div>",i+="<br><div class='sui-termOHead'>OTHER DICTIONARIES</div>",i+="<div id='sui-termOther' class='sui-termOther' style='padding:0 24px'></div></div>",p()(this.div).html(i.replace(/\t|\n|\r/g,"")),this.tabs=[],this.SetTabContent(e),p()("#sui-termPlay").off("click").on("click",(function(e){new Audio(a[t.recordingGroup]).play()})),p()("#sui-termGroup").off("change").on("change",(function(e){t.recordingGroup=p()("#sui-termGroup").prop("selectedIndex")})),s.GetAudioFromID(e.id,(function(e){a=e,e.length&&p()("#sui-player").slideDown(),e.length>1&&p()("#sui-termGroup.unpopulated").append("<option>KHAM-HOR GROUP</option>"),e.length>2&&p()("#sui-termGroup.unpopulated").append("<option>CENTRAL TIBET DIALECT</option>"),p()("#sui-termGroup.unpopulated").removeClass("unpopulated")})),s.pages.DrawRelatedAssets(e)}},{key:"SetTabContent",value:function(e){var t=this,s=this.sui;s.GetChildDataFromID(e.uid,(function(a){var i,n,r=1,l=0,o="<br>",c="",u="<div style='height:2px'/>",d="<table>",h="";try{var m=a._childDocuments_;for(i=0;i<m.length;++i)m[i].id.match(/_definitions-/)&&(m[i].related_definitions_source_s?(o+="<div>"+r+++". <i>"+m[i].related_definitions_source_s+"</i></div>",o+="<p class='termDefs'>",o+=m[i].related_definitions_content_s,o+="</p><div class='sui-termData'>",m[i].related_definitions_author_s&&(o+="AUTHOR: "+m[i].related_definitions_author_s+" | "),o+="LANGUAGE: "+m[i].related_definitions_language_s,o+="</div><br><hr style='border-top:1px solid #a2733f'>"):(c+=t.DrawTabMenu(l++,[l+".&nbsp;&nbsp;DEFINITION","DETAILS","PASSAGES (0)","RESOURCES (0)"]),(n=["","<br>","<br>Waiting for data from Derik...<br><br><br><br>","<br>"])[0]+="<div class='termDefs'>",n[0]+=m[i].related_definitions_content_s,n[0]+="</div><div class='sui-termData'>",m[i].related_definitions_author_s&&(n[0]+="AUTHOR: "+m[i].related_definitions_author_s+" | "),n[0]+="LANGUAGE: "+m[i].related_definitions_language_s+"</div><br><br>",m[i]["related_definitions_branch_subjects-185_header_s"]&&(n[1]+=m[i]["related_definitions_branch_subjects-185_header_s"].toUpperCase(),n[1]+=": <i>"+m[i]["related_definitions_branch_subjects-185_subjects_headers_t"]+"</i>",n[1]+=s.pages.AddPop(m[i]["related_definitions_branch_subjects-185_subjects_uids_t"][0])+"<br>"),n[1]+="LANGUAGE: <i>"+m[i].related_definitions_language_s+"</i>",m[i]["related_definitions_branch_subjects-184_subjects_uids_t"]&&(n[1]+=s.pages.AddPop(m[i]["related_definitions_branch_subjects-184_subjects_uids_t"][0])+"<br>"),m[i]["related_definitions_branch_subjects-5855_header_s"]&&(n[1]+=m[i]["related_definitions_branch_subjects-5855_header_s"].toUpperCase(),n[1]+=": <i>"+m[i]["related_definitions_branch_subjects-5855_subjects_headers_t"]+"</i>",n[1]+=s.pages.AddPop(m[i]["related_definitions_branch_subjects-5855_subjects_uids_t"][0])+"<br>"),n[1]+="<br>",t.tabs.push(n))),m[i].id.match(/_names-/)&&(h||(h=m[i].related_names_header_s),d+="<tr><td <td style='padding-left:".concat(16*m[i].related_names_level_i,"px'>> <b>").concat(m[i].related_names_header_s,"&nbsp;&nbsp;&nbsp;</b></td><td>\n\t\t\t\t\t\t<i>").concat(m[i].related_names_language_s,", ").concat(m[i].related_names_writing_system_s,", ").concat(m[i].related_names_relationship_s,"\n\t\t\t\t\t\t</i></td></tr>"),o+="</table><br>"),p()("#sui-termNames").html(d+"</table>"),p()("#sui-termTitle").html("".concat(h,"&nbsp;&nbsp;&nbsp;").concat(e.title[0]))}catch(f){throw f}if(s.GetDefinitionAssets(e.uid,(function(e){var a,i,n,r,l,o,c,u,d=[];if(!e)return"";if(!e.length)return"";for(t.tagged=[],a=0;a<t.tabs.length;++a)t.tagged.push([]);for(a=0;a<e.length;++a)if("terms"!=(n=e[a]).asset_type)for(i=0;i<n.kmapid.length;++i)(l=n.kmapid[i].match(/_definitions-(\d*)/i))&&t.tagged[l[1]-1].push(n);for(a=0;a<t.tabs.length;++a){for(d.all=d.subjects=d.places=d.images=d.sources=d.visuals=d.collections=d.texts=d["audio-video"]=0,i=0;i<t.tagged[a].length;++i)d[t.tagged[a][i].asset_type]++,d.all++;for(i in r="",d)if(d[i]){r="<b>Resources tagged with this definition: </b><br>";break}for(i in d)d[i]&&(r+=(o=i,c=a,u=d[i],"<div id='sui-termAssetBut-".concat(c,"-").concat(o,"'\n\t\t\t\t\tclass='sui-termAssetBut' style='background-color:").concat(s.assets[o].c,"'>\n\t\t\t\t\t<span style='font-size:20px; vertical-align:-4px'>").concat(s.assets[o].g,"&nbsp;</span>").concat(o,"&nbsp;&nbsp;\n\t\t\t\t\t(").concat(u,")</div>").replace(/\t|\n|\r/g,"")));p()("#sui-tabTab-"+a+"-3").text("RESOURCES ("+d.all+")"),t.tabs[a][3]+=r}})),u="<table style='width:100%'><tr>",g("PHONEME",e.data_phoneme_ss),g("GRAMMARS",e.data_grammars_ss),u+="</tr><tr>",g("TOPICS",e.data_tibet_and_himalayas_ss),g("LITERARY PERIOD",e.data_literary_period_ss),u+="</tr><tr>",g("REGISTER",e.data_register_ss),g("LANGUAGE CONTEXT",e.data_language_context_ss),u+="</tr></table>",a.etymologies_ss&&a.etymologies_ss.length){for(u+="<br><b>Etymology</b><br><div class='sui-termDefs'>",i=0;i<a.etymologies_ss.length;++i)u+=a.etymologies_ss[i];o+="</div>"}for(p()("#sui-termDetails").html(u+"<br>"),p()("#sui-termDefs").html(c.replace(/\t|\n|\r/g,"")),p()("#sui-termOther").html(o.replace(/\t|\n|\r/g,"")),i=0;i<l;++i)t.ShowTab(i,0);function g(t,a){var i=0;if(a){if(e.kmapid_subjects_idfacet){for(i=0;i<e.kmapid_subjects_idfacet.length&&e.kmapid_subjects_idfacet[i].split("|")[0]!=a;++i);i=Math.min(e.kmapid_subjects_idfacet.length-1,i)}u+="<td>".concat(t,": <i>").concat(a,"</i>"),e.kmapid_subjects_idfacet?u+=s.pages.AddPop(e.kmapid_subjects_idfacet[i].split("|")[1])+"</td>":u+=s.pages.AddPop(e.related_uid_ss[i])+"</td>"}}}))}},{key:"DrawTabMenu",value:function(e,t){var s,a="";for(s=0;s<t.length;++s)a+="<div class='sui-tabTab' id='sui-tabTab-".concat(e,"-").concat(s,"' style='display:inline-block;text-align:left;padding-left:24px;width:calc(25% - 26px)'>\n\t\t\t").concat(t[s],"&nbsp;&#xe609</div>");return(a+="<div class='sui-tabContent' id='sui-tabContent-".concat(e,"'>hhh</div>")).replace(/\t|\n|\r|/g,"")}},{key:"ShowTab",value:function(e,t){var s=this,a=this.sui;p()("[id^=sui-tabTab-"+e).css({"background-color":"#999",color:"#fff","border-top":"1px solid #999"}),p()("#sui-tabContent-"+e).css({display:"block","background-color":"#eee"}),p()("#sui-tabTab-"+e+"-"+t).css({"background-color":"#eee",color:"#000","border-top":"1px solid #a2733f"}),p()("#sui-tabContent-"+e).html(this.tabs[e][t]),p()("[id^=sui-tabTab]").off(),p()("[id^=sui-termAssetBut-]").off(),p()("[id^=sui-termAssetBut-]").on("click",(function(e){var t,i=e.currentTarget.id.substring(17).split("-");if(a.ss.mode="related","audio"==i[1]&&(i[1]="audio-video"),a.pages.relatedType=i[1],a.pages.relatedBase=s.kmap,a.pagesrelatedId=a.pages.relatedBase.asset_type+"-"+a.pages.relatedBase.id,"all"==i[1])a.curResults=s.tagged[i[0]];else for(a.curResults=[],t=0;t<s.tagged[i[0]].length;++t)s.tagged[i[0]][t].asset_type==i[1]&&a.curResults.push(s.tagged[i[0]][t]);a.DrawResults()})),p()("[id^=sui-tabTab]").on("click",(function(e){var t=e.currentTarget.id.substring(11).split("-");s.ShowTab(t[0],t[1])}))}}]),e}(),x=function(){function e(t){if(Object(l.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.div=t.pages.div,this.content=["",""," "],this.sui=t}return Object(o.a)(e,[{key:"Draw",value:function(e){var t=this,s=this.sui,a=s.assets[e.asset_subtype.toLowerCase()],i="<div id='sui-topCon' style='margin-left:192px'>\n\t\t<div class='sui-sources'  id='sui-collections'>\n\t\t\t<span style='font-size:24px;color:".concat(a.c,";vertical-align:-4px'>").concat(a.g,"</span>\n\t\t\t&nbsp;&nbsp;<span class='sui-sourceTitle'>").concat(e.title[0],"</span>\n\t\t\t&nbsp;&nbsp;(").concat(e.asset_subtype.toUpperCase(),")\n\t\t\t<hr style='border-top: 1px solid ").concat(s.assets[e.asset_type].c,"'>\n\t\t\t<div class='sui-sourceSec' id='sui-srcSec'></div><br>");e.url_thumb&&!e.url_thumb.match(/gradient.jpg/)&&(i+="<img src='"+e.url_thumb+"' style='width:33%;padding-right:12px;vertical-align:top'>"),e.summary&&(i+="<div class='sui-sourceText' style='display:inline-block;width:calc(66% - 12px)'>".concat(e.summary,"</div>")),i+="<br><br>"+s.pages.DrawTabMenu(["RELATED COLLECTIONS","MEMBERS","DETAILS"])+"</div>",p()(this.div).html(i.replace(/\t|\n|\r/g,"")),p()("[id^=sui-tabTab]").on("click",(function(e){var s=e.currentTarget.id.substring(10);t.ShowTab(s)})),p()("#sui-imgCol").on("click",(function(){return s.GetKmapFromID(e.collection_uid_s,(function(e){s.SendMessage("",e)})),!1})),s.pages.DrawRelatedAssets(e),this.AddTabContent(e),this.ShowTab(0)}},{key:"AddTabContent",value:function(e){var t,s,a=this.sui,i=0;this.content[0]="<br>";var n=e.asset_subtype.toLowerCase()+"-collection-";try{e.collection_title_path_ss&&(s=e.collection_uid_path_ss,this.content[0]+="<div><a href='#p=".concat(s,"' id='sui-spItem-").concat(s,"+\"'>").concat(e.collection_title_path_ss,"</a></div>"),i++)}catch(r){}if(this.content[0]+="<div style='margin-left:".concat(24*i,"px'><b>").concat(e.title[0],"</b></div>"),e.subcollection_name_ss&&e.subcollection_name_ss.length)for(i++,t=0;t<e.subcollection_name_ss.length;++t)s=n+e.subcollection_id_is[t],this.content[0]+="<div style='margin-left:".concat(24*i,"px'><a  href='#p=").concat(s,"' id='sui-spItem-").concat(s,"+\"'>").concat(e.subcollection_name_ss[t],"</a></div>");if(this.content[0]+="<br><br>",this.content[1]="",e.members_name_ss&&e.members_name_ss.length){for(t=0;t<e.members_name_ss.length;++t)this.content[1]+="<br>"+e.members_name_ss[t]+" &nbsp; ("+e.members_id_ss[t]+")";this.content[1]+="<br><br>"}this.content[2]="<br>",e.node_user_full_s&&(this.content[2]+=a.pages.DrawItem("&#xe600","OWNER",e.node_user_full_s+" &nbsp; ("+e.node_user+")","","sui-pageLab",1)),e.collection_visibility_s&&(this.content[2]+=a.pages.DrawItem("&#xe622","VISIBILITY",e.collection_visibility_s.substr(0,1).toUpperCase()+e.collection_visibility_s.substr(1),"","sui-pageLab",1)),e.asset_subtype&&(this.content[2]+=a.pages.DrawItem(a.assets[e.asset_subtype.toLowerCase()].g,"TYPE",e.asset_subtype,"","sui-pageLab",1)),e.collection_title&&(this.content[2]+=a.pages.DrawItem(a.assets[e.asset_subtype.toLowerCase()].g,"COLLECTION","<a title='Collection' id='sui-imgCol'\thref='#p=".concat(e.collection_uid_s,"'>").concat(e.collection_title,"</a>"),"","sui-pageLab",1)),this.content[2]+="<br>"}},{key:"ShowTab",value:function(e){p()("[id^=sui-tabTab]").css({"background-color":"#999",color:"#fff"}),p()("#sui-tabContent").css({display:"block","background-color":"#eee"}),p()("#sui-tabTab"+e).css({"background-color":"#eee",color:"#000"}),p()("#sui-tabContent").html(this.content[e])}}]),e}(),E=function(){function e(t){if(Object(l.a)(this,e),!t)throw new Error("sui must be defined in constructor");this.sui=t,t.pages=this,this.div=p()("<div></div>"),this.reldiv=p()("<div></div>"),this.relatedBase=null,this.relatedType="Home",this.relatedId="",this.lastMode=t.ss.mode,this.curKmap=null,this.carouselTimer=null,t.plc=new g(t),t.av=new f(t),t.sub=new v(t),t.img=new b(t),t.txt=new y(t),t.src=new _(t),t.vis=new k(t),t.trm=new w(t),t.col=new x(t),this.recentPages=[],this.editing=!1,window.location.hash&&t.PageRouter(window.location.hash)}return Object(o.a)(e,[{key:"Draw",value:function(e,t){console.error("pages.Draw() called! with args: "),console.dir(arguments);var s=this.sui;if(clearInterval(this.carouselTimer),e){t||s.SetState("p=".concat(e.uid)),this.curKmap=e,this.recentPages.push(e.uid+"|"+e.title+"|"+e.asset_type);var a,i=this.recentPages.length-1;for(a=i-1;a>=0;--a)if(this.recentPages[a]==this.recentPages[i]){this.recentPages.splice(a,1);break}"related"!=s.ss.mode&&this.DrawHeader(e),p()(this.div).css({"background-image":""}),p()(this.div).css({"padding-left":"12px",width:"calc(100% - 24px"}),p()(this.div).css({display:"block",color:"#000"}),"related"==s.ss.mode&&(e.asset_type.match(/places|subjects|terms/)||p()(this.div).css({"padding-left":"192px",width:"calc(100% - 216px"})),"places"==e.asset_type?s.plc.Draw(e):"sources"==e.asset_type?s.src.Draw(e):"terms"==e.asset_type?s.trm.Draw(e):"subjects"==e.asset_type?s.sub.Draw(e):"images"==e.asset_type?s.img.Draw(e):"audio-video"==e.asset_type?s.av.Draw(e):"texts"==e.asset_type?s.txt.Draw(e):"visuals"==e.asset_type?s.vis.Draw(e):"collections"==e.asset_type&&s.col.Draw(e)}}},{key:"ShowPopover",value:function(e,t){var s=this,a=this.sui;if((!e||!e.match(/collections-/))&&(!this.PopoverTimer||"mousemove"!=t.type)&&("mousemove"!=t.type||e!=this.lastPopover))return"mousedown"==t.type?("related"==a.ss.mode&&(a.ss.mode=this.lastMode),this.relatedBase=null,a.GetKmapFromID(e,(function(e){s.Draw(e)})),void this.ClearPopover()):void(this.PopoverTimer=setTimeout((function(){s.DisplayPopover(e,t)}),500))}},{key:"ClearPopover",value:function(){clearTimeout(this.PopoverTimer),this.PopoverTimer=null,p()("[id^=sui-popover-]").remove(),this.lastPopover=""}},{key:"DisplayPopover",value:function(e,t){var s,a,i=this,n=this.sui;clearTimeout(this.PopoverTimer),this.PopoverTimer=null,t.target?a=p()(t.target).offset():((a=p()("#plc-main").offset()).top+=t.y,a.left+=t.x);var r=Math.max(160,Math.min(a.left,p()("#sui-main").width()-200)),l=a.left-r+150,o=String(l)+"px";if(a.top){this.lastPopover=e,n.GetKmapFromID(e,(function(l){var c;if(l){p()("[id^=sui-popover-]").remove();var u="<div id='sui-popover-".concat(e,"' class='sui-popover' \n\t\t\tstyle='top:").concat(a.top+24+p()(i.div).scrollTop(),"px;left:").concat(r-150,"px'>\n\t\t\t<div style='position:absolute;width:0;height:0;border-left:8px solid transparent;\n\t\t\tborder-right:8px solid transparent;border-bottom:10px solid #999;top:-10px;\n\t\t\tleft:").concat(o,"'</div>\n\t\t\t<div style='position:absolute;width:0;height:0;border-left:8px solid transparent;\n\t\t\tborder-right:8px solid transparent;border-bottom:10px solid white;left:-8px;top:2px;'</div>\n\t\t\t</div>");if(p()("#sui-main").append(u.replace(/\t|\n|\r/g,"")),p()("#sui-main").one("mousemove",(function(){console.log("clearing popover on mousemove "+t.target),i.ClearPopover()})),u="<div style='float:right;margin-top:-8px;font-size:10px'>".concat(l.id,"</div>\n\t\t\t<b>").concat(l.title[0],"</b><hr style='border-top:1px solid #ccc'>\n\t\t\t<span style='font-size:12px;text-transform:capitalize'>\n\t\t\tFor more information about this ").concat(l.asset_type.slice(0,-1),", see Full Entry below.<p>"),l.feature_types_idfacet&&"places"==l.asset_type)for(u+="<b>Feature types: </b>",s=0;s<l.feature_types_idfacet.length;++s)c=l.feature_types_idfacet[s].split("|"),u+="<a class='sui-crumb' style='color:#000;text-transform:none' id='sui-crumb-".concat(c[1],"'\n\t\t\t\t\thref='#p=").concat(c[1],"'>").concat(c[0],"</a>"),s<l.feature_types_idfacet.length-1?u+=", ":u+="<br>";if(l.ancestors_txt&&l.ancestors_txt.length>1&&(u+="<b>".concat(l.asset_type,": </b>")),l.ancestors_txt)for(s=0;s<l.ancestors_txt.length-1;++s)u+="<a class='sui-crumb' style='color:#000;text-transform:none' id='sui-crumb-".concat(l.asset_type,"-").concat(l.ancestor_ids_is[s],"'\n\t\t\t\t\thref='#p=").concat(l.asset_type,"-").concat(l.ancestor_ids_is[s],"'>").concat(l.ancestors_txt[s],"</a>"),s<l.ancestors_txt.length-2&&(u+=" / ");u+="</p></span><br>\n\t\t\t<div id='sui-popbot' style='width:100%;padding:1px 12px;background-color:#333;font-size:14px;\n\t\t\tborder-radius:0 0 6px 6px;color:#ddd;margin:-12px;cursor:pointer'>\n\t\t\t<a class='sui-popItem' href='#p=".concat(l.uid,"'>\n\t\t\t<p id='sui-full-").concat(l.uid,"'>&#xe629&nbsp;&nbsp;FULL ENTRY</p></a>\n\t\t\t</div>"),p()("#sui-popover-"+e).append(u.replace(/\t|\n|\r/g,"")),p()("#sui-popover-"+e).on("mouseleave",(function(){i.ClearPopover()})),p()("#sui-full-"+e).on("click",(function(e){i.ClearPopover(),"related"==n.ss.mode&&(n.ss.mode=i.lastMode),i.relatedBase=null;var t=e.currentTarget.id.substring(9).toLowerCase();return n.GetKmapFromID(t,(function(e){n.SendMessage("",e)})),!1})),p()("[id^=sui-crumb-]").on("click",(function(e){i.ClearPopover(),"related"==n.ss.mode&&(n.ss.mode=i.lastMode),i.relatedBase=null;var t=e.currentTarget.id.substring(10).toLowerCase();return n.GetKmapFromID(t,(function(e){n.SendMessage("",e)})),!1}))}}));var c=n.solrUtil.createKmapQuery(e,null,null,300);p.a.ajax({url:c,dataType:"jsonp",jsonp:"json.wrf"}).done((function(t){var s,a,r="";if(!p()("[id^=sui-pop-]")[0]&&t.facets.asset_counts.buckets&&t.facets.asset_counts.buckets.length){var l=t.facets.asset_counts.buckets;for(s=0;s<l.length;++s)a=l[s].count,"texts:pages"!=l[s].val&&(a>1e3&&(a=Math.floor(a/1e3)+"K"),r+="<a class='sui-popItem' href='#v=".concat(e,"=").concat(l[s].val,"'>\n\t\t\t\t\t<p id='sui-pop-").concat(e,"-").concat(l[s].val,"' style='cursor:pointer;text-transform:capitalize'>\n\t\t\t\t\t<span style='color:").concat(n.assets[l[s].val].c,"'>").concat(n.assets[l[s].val].g,"</span>\n\t\t\t\t\t&nbsp;&nbsp;Related ").concat(l[s].val," (").concat(a,")</p></a>"));p()("#sui-popbot").append(r.replace(/\t|\n|\r/g,"")),p()("[id^=sui-pop-]").on("click",(function(t){i.ClearPopover();var s=t.currentTarget.id.toLowerCase().split("-");"audio"==s[4]&&(s[4]="audio-video");var a=n.solrUtil.createKmapQuery(s[2]+"-"+s[3],s[4],0,1e3);return p.a.ajax({url:a,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){n.curResults=n.MassageKmapData(e.response.docs),n.DrawItems(),n.DrawFooter(),n.ss.page=0})),n.GetKmapFromID(e,(function(e){i.relatedBase=e,i.relatedId=e.asset_type+"-"+e.id,i.DrawHeader(e)})),!1}))}}))}}},{key:"DrawRelatedAssets",value:function(e,t){var s=this;console.error("pages.DrawRelatedAssets() called with arguments"),console.dir(arguments);var a,i,n=this.sui,r="",l=!0,o=this.relatedBase||e;if(o&&(l=o.asset_type.match(/places|subjects|terms|collections/)),"related"==n.ss.mode?e=this.relatedBase:this.lastMode=n.ss.mode,e&&(l||"related"==n.ss.mode)){if("collections"!=o.asset_type){var c=n.solrUtil.createKmapQuery(e.uid);p.a.ajax({url:c,dataType:"jsonp",jsonp:"json.wrf"}).done((function(t){var s,a,i=0;if(t.facets.asset_counts.buckets&&t.facets.asset_counts.buckets.length){var n=t.facets.asset_counts.buckets;for(s=0;s<n.length;++s)"texts:pages"!=n[s].val&&("terms"==e.asset_type&&"terms"==n[s].val||(i+=a=n[s].count,a>1e3&&(a=Math.floor(a/1e3)+"K"),p()("#sui-rln-"+n[s].val).html(a),p()("#sui-rl-"+n[s].val).css({display:"block"})));i>1e3&&(i=Math.floor(i/1e3)+"K"),p()("#sui-rln-all").html(i),p()("#sui-rl-all").css({display:"block"})}var r="#sui-btree-"+e.asset_type;p()("#sui-footer").offset()&&p()(r).offset()?p()(r).css("max-height",p()("#sui-footer").offset().top-p()(r).offset().top-40+"px"):console.error("no footer or no sui-btree")}))}else l=!1,i=e.asset_subtype.toLowerCase();for(a in p()("#sui-content").scrollTop(0),p()(this.div).scrollTop(0),a=e.asset_type,r+="<div class='sui-related' style='border-color:".concat("related"==n.ss.mode?n.assets[a].c:"transparent",";\n\t\t\theight:").concat(p()(this.div).height()+6,"px'>"),"related"!=n.ss.mode&&(r+="RELATED RESOURCES<hr>"),r+="<div class='sui-relatedList'>",r+="<div class='sui-relatedItem' id='sui-rl-Home'><span style='font-size:18px; vertical-align:-3px; color:"+n.assets[a].c+"'>"+n.assets[a].g+" </span> <b style='color:"+n.assets[a].c+"'>Home</b></div>","collections"==o.asset_type&&(r+="<div class='sui-relatedItem' id='sui-rl-"+i+"'><span style='font-size:18px; vertical-align:-3px; color:"+n.assets[i].c+"'>"+n.assets[i].g+" </span> "+e.asset_subtype+"</div>"),n.assets)r+="<a class='sui-relatedItem' style='display:none' id='sui-rl-"+a.toLowerCase(),r+="' href='#r="+this.relatedId+"="+this.relatedId+"="+a+"="+e.uid+"'>",r+="<span style='font-size:18px; vertical-align:-3px; color:"+n.assets[a].c+"'>"+n.assets[a].g+"</span> ",r+=a.charAt(0).toUpperCase()+a.substr(1)+" (<span id='sui-rln-"+a.toLowerCase()+"'>0</span>)</a>";0,p()(this.reldiv).html(r.replace(/\t|\n|\r/g,"")),l&&this.DrawTree("#sui-btree-"+e.asset_type,e.asset_type),this.relatedType?p()("#sui-rl-"+this.relatedType).css({"background-color":"#f7f7f7"}):p()("#sui-rl-Home").css({"background-color":"#f7f7f7"}),p()("[id^=sui-rcItem-]").off("click"),p()("[id^=sui-rcItem-]").on("click",(function(e){var t=e.currentTarget.id.substring(11);return"related"==n.ss.mode&&(n.ss.mode=s.lastMode),s.relatedBase=null,n.GetKmapFromID(t,(function(e){n.SendMessage("",e)})),!1})),p()("[id^=sui-rl-]").on("click",(function(a){return alert("CLICKED RELATED LINK "+a.target),s.relatedType=a.currentTarget.id.substring(7),"Home"==s.relatedType?("related"==n.ss.mode&&(n.ss.mode=s.lastMode),s.Draw(s.relatedBase?s.relatedBase:e),s.relatedBase=null):"places"==o.asset_type&&"places"==s.relatedType?n.plc.Draw(e,4):"places"==o.asset_type&&"subjects"==s.relatedType?n.plc.Draw(e,3):"subjects"==o.asset_type&&"subjects"==s.relatedType?n.sub.Draw(e,1):"subjects"==o.asset_type&&"places"==s.relatedType?n.sub.Draw(e,2):(s.relatedBase||(s.relatedBase=e),s.DrawRelatedResults(e),t||n.SetState("r="+s.relatedId+"="+s.relatedBase.uid+"="+s.relatedType+"="+e.uid)),!1}))}}},{key:"DrawRelatedResults",value:function(e){var t="pages.DrawRelatedResults() called with "+(e.uid?e.uid:e);console.error(t),console.dir(e);var s=this.sui;s.ss.mode="related",this.relatedBase||(this.relatedBase=e),this.relatedId=this.relatedBase.asset_type+"-"+this.relatedBase.id,s.Query(!1,"collections"==e.asset_type?e.uid:""),s.DrawFooter(),s.ss.page=0}},{key:"DrawHeader",value:function(e){console.error("STUBBED pages.Drawheader called with arguments"),console.dir(e)}},{key:"AddRelTreeLine",value:function(e,t,s,a){var i=this.sui,n="<li style='margin:2px 0 2px ".concat(-24,"px'>");return n+=s?"<div class='sui-spDot' id='sui-spDot-".concat(a,"'>").concat(s,"</div>"):"<div class='sui-spLoner'><b>&bull;&nbsp;&nbsp;</b></div>",n+="<a class='sui-noA' href='#p=".concat(t,"' id='sui-spLab-").concat(t,"'>").concat(e,"</b>").concat(i.pages.AddPop(t),"</a>")}},{key:"AddRelBranch",value:function(e,t,s){var a=this,i=this.sui,n=this;i.GetTreeChildren(e,t,(function(t){var i,r,l,o,c,u="",d=[];try{d=t.facets.child_counts.buckets}catch(h){}for(t=t.response.docs,i=0;i<t.length;++i){for(c="",o=null,l=new RegExp(t[i].id.split("-")[1]),r=0;r<d.length;++r)d[r].val.match(l)&&(o="+",c=d[r].val);u+="<ul style='list-style-type:none'>",u+=a.AddRelTreeLine(t[i].header,t[i].id,o,c)+"</li></ul>"}p()(s).prop("id","sui-spDot-null"),s.parent().append(u),p()("[id^=sui-spDot-]").off("click"),p()("[id^=sui-spDot-]").on("click",(function(t){var s=p()(this).parent().find("ul")[0],a=t.currentTarget.id.substring(10);"null"!=a?(p()(this).html("&ndash;"),n.AddRelBranch(e,a,p()(this))):p()(this).html("none"==p()(s).css("display")?"&ndash;":"+"),p()(this).parent().find("ul").slideToggle()}))}))}},{key:"DrawTabMenu",value:function(e){var t,s="";for(t=0;t<e.length;++t)s+="<div class='sui-tabTab' id='sui-tabTab".concat(t,"' style='width:calc(").concat(100/e.length,"% - 2px)'>").concat(e[t],"&nbsp;&#xe609</div>");return(s+="<div class='sui-tabContent' id='sui-tabContent'></div>").replace(/\t|\n|\r|/g,"")}},{key:"DrawCarousel",value:function(e){var t,s=this.sui,a=0,i="<div class='sui-caroBox'>\n\t\t<div class='sui-caroButL' id='sui-caroButL'>&#xe640</div>\n\t\t<div class='sui-caroButR' id='sui-caroButR'>&#xe641</div>\n\t\t<div class='sui-caroHeader'>&nbsp;</div>\n\t\t\t<div class='sui-caroLeft'>\n\t\t\t\t<div class='sui-caroTitle' id='sui-caroTitle'></div>\n\t\t\t\t<div class='sui-caroText' id='sui-caroText'></div>\n\t\t\t</div>\n\t\t\t<img class='sui-caroPic' id='sui-caroPic' src=''><br>\n\t\t\t<a class='sui-caroRes' id='sui-caroRes')' href='#p=".concat((e=[{title:"The Shinj\xe9 Yapyum Cham is performed",text:"One of the most common sacred masked dances performed during religious festivals in Bhutan is the Shinj\xe9 Yapyum Cham. The dance is often performed early during a festival\u2019s program as it is believed to subdue negative spirits and harmful influences. Although known as the Shinj\xe9 Yapyum Cham, or the Dance of the Male and Female Lords of Death, it represents the male and female Yam\u0101ntaka is the Destroyer of Death...",pic:"https://cicada.shanti.virginia.edu/images/mandala/shanti-image-550401/full/!600,/0/default.jpg",id:"images-stage_shanti_virginia_edu-1187696"},{title:"A Song Called Ja legmo Tsering",text:"Unlike today, meeting a person was extremely difficult in the past. The lyrics of this song say that meeting someone was considered as an act of fate. People would meet even if they had never thought of meeting that person. The composer wishes for two people who have met through fate, to stay together for their entire life...",pic:"https://cfvod.kaltura.com/p/381832/sp/38183200/thumbnail/entry_id/1_xvwn4fvx/version/100021/600/600/height/0",id:"audio-video-stage_shanti_virginia_edu-22741"},{title:"Tongue Twister in the Kheng Language",text:"In the past, parents taught their kids tongue twisters as a way to practice pronunciation. Rinchen Drakpa from Sharigang presents two tongue twisters in his local language, Khengkha. Rinchen Drakpa says that in his childhood he witnessed villagers competing to be the one who could say the tongue twisters with the most perfect pronunciation.",pic:"https://cfvod.kaltura.com/p/381832/sp/38183200/thumbnail/entry_id/0_ou7n6lp9/version/100021/600/600/height/0",id:"audio-video-stage_shanti_virginia_edu-3806"},{title:"Seven Limbs of Practice: Ch\xf6pa",text:"Most Bhutanese Buddhist rituals contain the set of seven practices known as yoen lak duen pa (\u0f61\u0f53\u0f0b\u0f63\u0f42\u0f0b\u0f56\u0f51\u0f74\u0f53\u0f0b\u0f54\u0f0b). The seven practices prostration (\u0f55\u0fb1\u0f42\u0f0b), offering (\u0f58\u0f46\u0f7c\u0f51\u0f0b\u0f54\u0f0b), confession (\u0f56\u0f64\u0f42\u0f66\u0f0b\u0f54\u0f0b), rejoicing (\u0f62\u0f97\u0f7a\u0f66\u0f0b\u0f66\u0f74\u0f0b\u0f61\u0f72\u0f0b\u0f62\u0f44\u0f0b\u0f56\u0f0b), request to live long (\u0f56\u0f5e\u0f74\u0f42\u0f66\u0f0b\u0f54\u0f62\u0f0b\u0f42\u0f66\u0f7c\u0f63\u0f0b\u0f56\u0f0b\u0f60\u0f51\u0f7a\u0f56\u0f66\u0f0b\u0f54\u0f0b), request to turn the wheel of Dharma (\u0f46\u0f7c\u0f66\u0f0b\u0f40\u0fb1\u0f72\u0f0b\u0f60\u0f41\u0f7c\u0f62\u0f0b\u0f63\u0f7c\u0f0b\u0f66\u0f90\u0f7c\u0f66\u0f90\u0f7c\u0f62\u0f0b\u0f56\u0f62\u0f0b\u0f56\u0f66\u0f90\u0f74\u0f63\u0f0b\u0f56\u0f0b) and to dedicate the merits (\u0f56\u0f66\u0f94\u0f7c\u0f0b\u0f56\u0f0b).This piece was initially published in Bhutan\u2019s national newspaper Kuensel..",pic:"https://mms.thlib.org/images/0050/8753/63691_large.jpg",id:"texts-stage_shanti_virginia_edu-38836"},{title:"A Story of a Rich and a Poor Girl",text:"Ap Tempo of Karna Gewog, Dagana narrates a story of a poor girl who is straight forward and faithful. Her rich friend was always insecure. The poor girl gets rewarded by a deity for her kind heart and good attitude; she suddenly becomes rich, and her rich friend became insecure about her. She tries to achieve what the poor girl has achieved, but gets punished due to her jealousy and greediness.",pic:"https://cfvod.kaltura.com/p/381832/sp/38183200/thumbnail/entry_id/1_607tfowl/version/100031/600/600/height/0",id:"audio-video-stage_shanti_virginia_edu-24651"},{title:"An Exchange of Tsangmo Poems",text:"Tsangmo is a type of song used to express individual's emotions, conveying their inner warmth and affection to another person, through numerious lyrical tunes. Tsangmo can be sung to express love, hatred and any other feelings. While it is sung, the Tsangmo songs are never sung with dance, as it is a poetry song for a singing expression without a dance. It is usually a composition limited to a verse of four lines for an expression.",pic:"https://cfvod.kaltura.com/p/381832/sp/38183200/thumbnail/entry_id/1_zk9hsnff/version/100011/609/600/height/0",id:"audio-video-stage_shanti_virginia_edu-22596"}])[a].id,"'>\n\t\t\t<i>View Resource</i>&nbsp;&nbsp;&#xe683</a>\n\t\t\t<div class='sui-caroDots'>");for(t=0;t<e.length;++t)i+="<div class='sui-caroDot' id='sui-caroDot-".concat(t,"'></div>");function n(t){p()("#sui-caroTitle").html("&#xe633&nbsp;&nbsp;"+e[t].title),p()("#sui-caroText").html(e[t].text),p()("#sui-caroPic").prop("src",e[t].pic),p()("[id^=sui-caroDot-]").css({"background-color":"#fff"}),p()("#sui-caroDot-"+t).css({"background-color":"#5d68cc"})}i+="</div></div>",p()(this.div).append(i.replace(/\t|\n|\r/g,"")),clearInterval(this.carouselTimer),this.carouselTimer=setInterval((function(){p()("#sui-caroButR").trigger("click")}),8e3),n(a),p()("#sui-caroRes").on("click",(function(t){return s.GetKmapFromID(e[a].id,(function(e){s.SendMessage("",e)})),!1})),p()("#sui-caroButL").on("click",(function(t){n(a=a?a-1:e.length-1)})),p()("#sui-caroButR").on("click",(function(t){n(a=a==e.length-1?0:a+1)})),p()("[id^=sui-caroDot-]").on("click",(function(t){a=t.target.id.substring(12),n(a=Math.min(e.length-1,Math.max(a,0)))}))}},{key:"DrawItem",value:function(e,t,s,a,i,n){var r,l="<p>";if(null==s||void 0==s)return"";if(e&&(l+=e+"&nbsp;&nbsp;"),l+="<span class='sui-pageLab'",n&&(l+=" style='font-weight:600'"),l+=">"+t+":&nbsp;&nbsp;</span>",l+="<span class='",l+=(i||"sui-pageVal")+"'>","object"==typeof s)for(r=0;r<s.length;++r)s[r].header?l+=s[r].header:s[r].value?l+=s[r].value:s[r].val?l+=s[r].val:s[r].title?l+=s[r].title:l+=s[r],r!=s.length-1&&(l+=", ");else l+=s&&!s.match(/undefined/)?s:a;return l+"</span></p>"}},{key:"FormatDate",value:function(e){var t=new Date(e);return t&&(e=t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()),e}},{key:"AddPop",value:function(e,t){this.sui;return window.sui=this.sui,"&nbsp;<img style='display:inline-block' src='/popover.png' ".concat(t?"style='width:13px'":"","\n\t\tonmouseenter='sui.pages.ShowPopover(\"").concat(e,"\",event); return false;' \n\t\tonmousemove='sui.pages.ShowPopover(\"").concat(e,"\",event); return false;' \n\t\tonmousedown='sui.pages.ShowPopover(\"").concat(e,"\",event) return false;'>").replace(/\t|\n|\r|/g,"")}},{key:"DrawTree",value:function(e,t){var s=this.sui;s.curTree=t,"places"==t?s.LazyLoad(e,null,t,13735):s.GetTopRow(e,t),p()("#sui-footer").offset()&&p()(e).offset()?p()(e).css("max-height",p()("#sui-footer").offset().top-p()(e).offset().top-120+"px"):console.error("no footer")}}]),e}(),S=(s(239),s(240),s(63)),T=s(9),j=s(17),C=s(14);function D(){return i.a.createElement("div",{className:"sui-topBar"},i.a.createElement(j.b,{to:"/home"},i.a.createElement("img",{src:"/mandala-om/img/bhutanleft.gif",style:{cursor:"pointer"},alt:"Home Page"})))}function O(e){return i.a.createElement("div",null,i.a.createElement("h2",null,"Home"),i.a.createElement("h3",null,"Work-in-Progress"),i.a.createElement("ul",null,i.a.createElement("li",null,i.a.createElement(j.b,{to:"/view/terms/terms-12434"},"/view/terms/terms-12434")),i.a.createElement("li",null,i.a.createElement(j.b,{to:"/view/terms/terms-45057"},"/view/terms/terms-45057")),i.a.createElement("li",null,i.a.createElement(j.b,{to:"/view/terms/terms-85193"},"/view/terms/terms-85193")),i.a.createElement("li",null,i.a.createElement(j.b,{to:"/view/terms/places-16408"},"/view/terms/places-16408")),i.a.createElement("li",null,i.a.createElement(j.b,{to:"/view/search"},"/view/search"))),i.a.createElement("h3",null,"Semi-functional Asset Viewers"),i.a.createElement("ul",null,i.a.createElement("li",null,i.a.createElement(j.b,{to:"/view/assets/terms-85193"},"/view/assets/terms-85193")," (Legacy)"),i.a.createElement("li",null,i.a.createElement(j.b,{to:"/view/texts/texts-dev_shanti_virginia_edu-16230"},"/view/texts/texts-dev_shanti_virginia_edu-16230"))),i.a.createElement("h3",null,"Dys-functional legacy viewer"),i.a.createElement("ul",null,i.a.createElement("li",null,i.a.createElement(j.b,{to:"/view/assets/subjects-6752"},"/view/assets/subjects-6752")),i.a.createElement("li",null,i.a.createElement(j.b,{to:"/view/assets/places-637"},"/view/assets/places-637"))),i.a.createElement("h4",null,"References"),i.a.createElement("ul",null,i.a.createElement("li",null,i.a.createElement("a",{href:"https://www.viseyes.org/ksolr/#s=text:lhasa=assets:All:all:AND"},"KSolr search on Lhasa"))))}function P(e){return i.a.createElement("div",{id:"sui-header",className:"sui-header legacy ".concat(e.siteClass)},i.a.createElement("div",{id:"sui-contentHead",className:"sui-contentHead legacy"},i.a.createElement("div",null,i.a.createElement("span",null,e.kmasset.title),i.a.createElement("span",null,"(",e.kmasset.uid,")"))))}var A=s(31),L=function(e){Object(c.a)(s,e);var t=Object(u.a)(s);function s(e){var a;if(Object(l.a)(this,s),a=t.call(this,e),console.error(typeof e.sui),"object"!==typeof e.sui)throw new Error("sui must be passed as a property to the component!");if("object"!==typeof e.sui.pages)throw new Error("sui.pages must be passed as part of the sui passed to the constructor!");return a.sui=e.sui,a.props=e,a}return Object(o.a)(s,[{key:"componentDidMount",value:function(){}},{key:"componentDidCatch",value:function(e,t){}},{key:"componentWillUnmount",value:function(){}},{key:"componentDidUpdate",value:function(e,t,s){}},{key:"shouldComponentUpdate",value:function(e,t,s){}},{key:"render",value:function(){var e=new A.Parser;console.dir(this.sui.pages.div.html());var t=e.parse(p()(this.sui.pages.div).html());return i.a.createElement("div",null," ",t)}}]),s}(i.a.Component),N=function(e){Object(c.a)(s,e);var t=Object(u.a)(s);function s(e){var a;if(Object(l.a)(this,s),a=t.call(this,e),console.error(typeof e.sui),"object"!==typeof e.sui)throw new Error("sui must be passed as a property to the component!");if("object"!==typeof e.sui.pages)throw new Error("sui.pages must be passed as part of the sui passed to the constructor!");return a.sui=e.sui,a.props=e,a}return Object(o.a)(s,[{key:"componentDidMount",value:function(){}},{key:"componentDidCatch",value:function(e,t){}},{key:"componentWillUnmount",value:function(){}},{key:"componentDidUpdate",value:function(e,t,s){}},{key:"shouldComponentUpdate",value:function(e,t,s){}},{key:"render",value:function(){return i.a.createElement("div",{class:"images legacy"},"NOT YET IMPLEMENTED IMAGES LEGACY ",JSON.stringify(this.props))}}]),s}(i.a.Component),R=s(44),I=s(135),M=s(231),U=s(102),F=(s(299),s(221)),G=s.n(F);function q(e){var t=i.a.createElement("span",null,i.a.createElement("span",{className:"popover-link-tip"}),i.a.createElement("span",{className:"icon shanticon-menu3",title:"Click to view"})),s=e.placement?e.placement:"bottom",a=e.kmcontent,n=G()(a);return i.a.createElement(M.a,{trigger:"click",rootClose:!0,key:s,placement:s,overlay:i.a.createElement(U.a,{"data-kmid":e.kmid,className:"related-resources-popover"},i.a.createElement(U.a.Title,{as:"h5"},e.kmtitle," ",i.a.createElement("span",{className:"kmid"},e.kmid)),i.a.createElement(U.a.Content,null,n))},t)}function B(e){var t=s(31),a=t.Parser,n=function(e){return[{replaceChildren:!0,shouldProcessNode:function(e){return e.attribs&&"popover-link"===e.attribs.class},processNode:function(e,t){var s=e.parent.attribs["data-kmdomain"],a=e.parent.attribs["data-kmid"],n=e.parent.next.next,r=n.attribs["data-title"],l="";for(var o in n.children)l+=H(n.children[o]);return i.a.createElement(q,{kmid:a,kmdomain:s,kmtitle:r,kmcontent:l})}},{shouldProcessNode:function(e){return!0},processNode:e.processDefaultNode}]}(new t.ProcessNodeDefinitions(i.a)),r=new a,l=e.markup?e.markup:"<div></div>",o=r.parseWithInstructions(l,(function(){return!0}),n);return i.a.createElement(i.a.Fragment,null,o)}function H(e){var t="";if("tag"==e.type){for(var s in t="<"+e.name,e.attribs){var a=e.attribs[s];"popover"===e.attribs.class&&"style"===s||"popover-body"!==e.attribs.class&&(t+=" "+s+'="'+a+'"')}for(var i in t+=">",e.children)t+=H(e.children[i]);t+="</"+e.name+">"}else"text"==e.type&&(t=e.data);return t}var K=s(91);function z(e){var t=e.alias;return i.a.createElement(K.a,{id:"shanti-texts-body",onScroll:e.listener},i.a.createElement("div",{className:"link-external"},i.a.createElement("a",{href:t,target:"_blank",title:"View Text in Mandala"},i.a.createElement("span",{className:"shanticon shanticon-link-external"}))),i.a.createElement(B,{markup:e.markup}))}var J=s(223),V=s(101),Q=s(45);function Y(e){var t=new A.Parser,s=t.parse(e.toc),n=i.a.createElement("span",{className:"shanticon shanticon-info"}),r=i.a.createElement("span",{className:"shanticon shanticon-circle-right"}),l=Object(a.useState)(!0),o=Object(T.a)(l,2),c=o[0],u=o[1],d=Object(a.useState)(r),p=Object(T.a)(d,2),h=p[0],m=p[1],g=function(){m(c?r:n)};return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{id:"sidecolumn-ctrl"},i.a.createElement("span",null),i.a.createElement("a",{onClick:function(){u(!c)},"aria-controls":"txtsidecol","aria-expanded":"open",className:"sidecol-toggle"},h)),i.a.createElement(Q.a,{in:c,onExited:g,onEnter:g},i.a.createElement(K.a,{id:"shanti-texts-sidebar",md:4},i.a.createElement(J.a,{id:"shanti-texts-sidebar-tabs",className:"nav-justified"},i.a.createElement(V.a,{eventKey:"text_toc",title:"Contents",className:"shanti-texts-toc"},i.a.createElement("div",{className:"shanti-texts-record-title"},i.a.createElement("a",{href:"#shanti-top"},e.title)),s),i.a.createElement(V.a,{eventKey:"text_bibl",title:"Description"},i.a.createElement(B,{markup:e.meta})),i.a.createElement(V.a,{eventKey:"text_links",title:"Views"},t.parse(e.links))))))}s(333),s(334),s(335);var W=s(224);function $(e){e.id;var t=e.mdlasset?e.mdlasset.nid:"",s=Object(a.useState)([]),n=Object(T.a)(s,2),r=n[0],l=n[1],o=Object(a.useState)(["shanti-texts-"+t]),c=Object(T.a)(o,2),u=c[0],d=c[1];Object(a.useEffect)((function(){if(0==r.length&&p()("#shanti-texts-body .shanti-texts-section").length>0){var e=p()("#shanti-texts-body .shanti-texts-section").toArray(),t=p.a.map(e,(function(t,s){var a=p()(t);if(s<e.length+1){var i=p()(e[s+1]).offset();i&&i.top&&i.top-145}return{el:a,id:a.attr("id"),title:p.a.trim(a.children().eq(0).text()),getTop:function(){return this.el.offset().top}}}));l(t),p()(".shanti-texts-toc > ul > li.first > a").addClass("toc-selected")}}));var h=i.a.createElement(R.a,{className:"astviewer texts",fluid:!0},i.a.createElement(I.a,{id:"shanti-texts-container"},i.a.createElement("div",{className:"loading"},i.a.createElement(W.a,{as:"div",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),"Loading text..."),i.a.createElement("div",{className:"not-found-msg hidden"},i.a.createElement("h1",null,"Text Not Found!"),i.a.createElement("p",{className:"error"},"Could not find the requested text: ",e.id))));if(e.mdlasset&&e.mdlasset.nid){var m=e.mdlasset;h=i.a.createElement(R.a,{className:"astviewer texts",fluid:!0},i.a.createElement(I.a,{id:"shanti-texts-container"},i.a.createElement(z,{id:e.mdlasset.nid,alias:e.mdlasset.alias,markup:m.full_markup,listener:function(e){var t=90+p()("#shanti-texts-body").height(),s=[];p()(".toc-selected").removeClass("toc-selected"),p.a.each(r,(function(e){var a=r[e],i=e<r.length-1&&r[e+1],n=a.getTop(),l=i?i.getTop():1e7;if(n>90&&n<t||n<90&&l>90){s.push(a.id);var o="#"+a.id.replace("texts-","texts-toc-");p()(o).addClass("toc-selected")}})),d(s)}}),i.a.createElement(Y,{toc:m.toc_links,meta:m.bibl_summary,links:m.views_links,title:m.title,sections:u})))}return h}var X=function(e){Object(c.a)(s,e);var t=Object(u.a)(s);function s(e){var a;if(Object(l.a)(this,s),a=t.call(this,e),console.error(typeof e.sui),"object"!==typeof e.sui)throw new Error("sui must be passed as a property to the component!");if("object"!==typeof e.sui.pages)throw new Error("sui.pages must be passed as part of the sui passed to the constructor!");return a.sui=e.sui,a.props=e,a}return Object(o.a)(s,[{key:"componentDidMount",value:function(){}},{key:"componentDidCatch",value:function(e,t){}},{key:"componentWillUnmount",value:function(){}},{key:"componentDidUpdate",value:function(e,t,s){}},{key:"shouldComponentUpdate",value:function(e,t,s){}},{key:"render",value:function(){return i.a.createElement("div",{class:"sources legacy"},"NOT YET IMPLEMENTED SOURCES LEGACY ",JSON.stringify(this.props))}}]),s}(i.a.Component),Z=function(e){Object(c.a)(s,e);var t=Object(u.a)(s);function s(e){var a;if(Object(l.a)(this,s),a=t.call(this,e),console.error(typeof e.sui),"object"!==typeof e.sui)throw new Error("sui must be passed as a property to the component!");if("object"!==typeof e.sui.pages)throw new Error("sui.pages must be passed as part of the sui passed to the constructor!");return a.sui=e.sui,a.props=e,a}return Object(o.a)(s,[{key:"componentDidMount",value:function(){}},{key:"componentDidCatch",value:function(e,t){}},{key:"componentWillUnmount",value:function(){}},{key:"componentDidUpdate",value:function(e,t,s){}},{key:"shouldComponentUpdate",value:function(e,t,s){return e.id}},{key:"render",value:function(){return i.a.createElement("div",{class:"VISUALS legacy"},"VISUALS LEGACY ",JSON.stringify(this.props))}}]),s}(i.a.Component),ee=function(e){Object(c.a)(s,e);var t=Object(u.a)(s);function s(e){var a;if(Object(l.a)(this,s),a=t.call(this,e),console.error(typeof e.sui),"object"!==typeof e.sui)throw new Error("sui must be passed as a property to the component!");if("object"!==typeof e.sui.pages)throw new Error("sui.pages must be passed as part of the sui passed to the constructor!");return a.sui=e.sui,a.props=e,a}return Object(o.a)(s,[{key:"componentDidMount",value:function(){}},{key:"componentDidCatch",value:function(e,t){}},{key:"componentWillUnmount",value:function(){}},{key:"componentDidUpdate",value:function(e,t,s){}},{key:"shouldComponentUpdate",value:function(e,t,s){}},{key:"render",value:function(){return i.a.createElement("div",{class:"places legacy"},"NOT YET IMPLEMENTED PLACES LEGACY ",JSON.stringify(this.props))}}]),s}(i.a.Component),te=function(e){Object(c.a)(s,e);var t=Object(u.a)(s);function s(e){var a;if(Object(l.a)(this,s),a=t.call(this,e),console.error(typeof e.sui),"object"!==typeof e.sui)throw new Error("sui must be passed as a property to the component!");if("object"!==typeof e.sui.pages)throw new Error("sui.pages must be passed as part of the sui passed to the constructor!");if(a.sui=e.sui,a.props=e,"function"!==typeof e.onStateChange)throw new Error("onStateChange must be passed");return a}return Object(o.a)(s,[{key:"componentDidMount",value:function(){var e=this;console.log("componentDidMount"),this.sui.GetKmapFromID(this.props.id,(function(t){console.log("calling pages.Draw() with kmasset="+t.uid),e.props.onStateChange({kmasset:t}),e.sui.pages.Draw(t,!0)}))}},{key:"componentDidCatch",value:function(e,t){}},{key:"componentWillUnmount",value:function(){console.log("componentWillUnmount")}},{key:"componentDidUpdate",value:function(e,t,s){var a=this;this.sui.GetKmapFromID(this.props.id,(function(e){console.log(" calling pages.Draw() with kmasset="+e.uid),a.props.onStateChange({kmasset:e}),a.sui.pages.Draw(e,!0)}))}},{key:"shouldComponentUpdate",value:function(e,t,s){return console.log("shouldComponentUpdate"),!0}},{key:"render",value:function(){return i.a.createElement("div",{className:"Subjects legacy"},"SUBJECTS LEGACY ",JSON.stringify(this.props.kmaps))}}]),s}(i.a.Component);function se(e){console.log("Relateds props = ",e);var t={baseType:"terms",baseUid:e.id,relateds:e.relateds};return e.id?i.a.createElement("div",{className:"relatedsviewer"},i.a.createElement("div",{className:"sui-related"},"RELATED RESOURCES",i.a.createElement("hr",null),i.a.createElement("div",{className:"sui-relatedList"},i.a.createElement(j.b,{to:"/view/"+t.baseType+"/"+t.baseUid},i.a.createElement("div",{className:"sui-relatedItem  sui-color-terms",id:"sui-rl-Home"},i.a.createElement("span",{className:"sui-relatedItem-icon"},"\ue635")," ",i.a.createElement("b",null,"Home"))),i.a.createElement(ae,Object.assign({type:"all"},t)),i.a.createElement(ae,Object.assign({type:"places"},t)),i.a.createElement(ae,Object.assign({type:"audio-video"},t)),i.a.createElement(ae,Object.assign({type:"images"},t)),i.a.createElement(ae,Object.assign({type:"sources"},t)),i.a.createElement(ae,Object.assign({type:"texts"},t)),i.a.createElement(ae,Object.assign({type:"visuals"},t)),i.a.createElement(ae,Object.assign({type:"subjects"},t)),i.a.createElement(ae,Object.assign({type:"terms"},t)),i.a.createElement(ae,Object.assign({type:"collections"},t))))):null}function ae(e){var t,s,a=(null===(t=e.relateds)||void 0===t?void 0:t.assets)?null===(s=e.relateds.assets[e.type])||void 0===s?void 0:s.count:0,n="shanticon-"+("all"===e.type?"logo-shanti":e.type);return a?i.a.createElement(j.b,{to:"/view/"+e.baseType+"/"+e.baseUid+"/related/"+e.type+"/default"},i.a.createElement("span",{className:"sui-relatedItem",id:"sui-rl-"+e.type,href:"#"},i.a.createElement("span",{className:"sui-color-"+e.type+" "+n}),i.a.createElement("span",{className:"sui-relatedItem-label"}," ",e.type),"\xa0(",i.a.createElement("span",{id:"sui-rln-places"},a),")")):null}var ie=function(e){Object(c.a)(s,e);var t=Object(u.a)(s);function s(e){var a;Object(l.a)(this,s),(a=t.call(this,e)).props=e,a.sui=e.sui;var i=a.props.id||a.props.match.params.id;return a.sui.GetKmapFromID(i,(function(e){console.log("LegacyViewer: kmasset = ",e),(!a.state||!a.state.kmasset||e.uid&&e.uid!==a.state.kmasset.uid)&&(a.state={kmasset:e,id:i},a.sui.pages.Draw(a.state.kmasset,!1),a.props.onStateChange(a.state),console.log("LegacyViewer: whoop"))})),a}return Object(o.a)(s,[{key:"render",value:function(){var e=new A.Parser,t=e.parse(p()(this.sui.pages.div).html()),s=e.parse(p()(this.sui.pages.reldiv).html());return console.log("LegacyViewer VIEWER = ",t),console.log("LegacyViewer RELDIV = "+s),i.a.createElement("div",{className:"legacyviewer"},t)}}]),s}(i.a.Component),ne=Object(C.j)(ie),re=s(12),le=s.n(re);function oe(e,t,s){s=s||t+"_path_s";var a={};return e=le.a.filter(e,(function(e){return e.block_child_type===t})),le.a.forEach(e,(function(e,t){var i=e[s].split("/");if(e.order=t,1===i.length)a[i[0]]=e;else for(var n=a,r=0;r<i.length;r++)n[i[r]]||(n[i[r]]={}),r===i.length-1&&(n[i[r]]=e),n[i[r]]._nested_||(n[i[r]]._nested_={}),n=n[i[r]]._nested_})),a}var ce=s(13),ue=s(47);function de(e){var t=[],s={},a=[];Object.entries(e.definitions).map((function(a){var n=Object(T.a)(a,2),r=(n[0],n[1]),l=r.related_definitions_source_s;if(l){var o=s[l];o||(o={name:l,definitions:[]},s[l]=o),o.definitions.push(r.related_definitions_content_s)}else{var c="";le.a.isEmpty(r._nested_)||(c=i.a.createElement("ul",null,i.a.createElement(de,{definitions:r._nested_,kmap:e.kmap}))),t.push(i.a.createElement("li",{key:r.uid,className:"sui-definitionEntry"},i.a.createElement(pe,{data:r,kmap:e.kmap,nested:c})))}return!0})),Object.entries(s).map((function(t){var s=Object(T.a)(t,2),n=(s[0],s[1]);return a.push(i.a.createElement("li",{key:n.uid,className:"sui-definitionEntry"},i.a.createElement(he,{data:n,kmap:e.kmap}))),!0}));var n=[i.a.createElement(i.a.Fragment,null,t)];return a.length&&n.push(i.a.createElement(i.a.Fragment,null,i.a.createElement("hr",null),i.a.createElement("h5",null,"Other Dictionaries")),i.a.createElement(i.a.Fragment,null,a)),n}function pe(e){var t=Object(a.useState)(!1),s=Object(T.a)(t,2),n=s[0],r=s[1],l=Object(a.useState)(!1),o=Object(T.a)(l,2),c=o[0],u=o[1],d=(new A.Parser).parse(e.data.related_definitions_content_s),p=function(e){var t={},s=[];Object.entries(e).forEach((function(e){var s=Object(T.a)(e,2),a=s[0],i=s[1];if(a.startsWith("related_definitions_branch_subjects")){var n=a.match(/related_definitions_branch_(subjects-\d+)_(\S+)/),r=Object(T.a)(n,3),l=(r[0],r[1]),o=r[2];t[l]||(t[l]={}),t[l][o]=i}})),Object.entries(t).forEach((function(e){for(var t=Object(T.a)(e,2),a=t[0],i=t[1],n=[],r=0;r<i.subjects_uids_t.length;r++){var l={header:i.subjects_headers_t[r],uid:i.subjects_uids_t[r]};n.push(l)}var o={header:i.header_s,uid:a,values:n};s.push(o)}));var a=[];return le.a.forEach(s,(function(e,t){var s=le.a.map(e.values,(function(e){return i.a.createElement("a",{href:"#"+e.uid},e.header)}));a.push(i.a.createElement("li",{key:t},i.a.createElement("span",null,i.a.createElement("a",{href:"#"+e.uid},e.header)),": ",i.a.createElement("span",null,s)))})),i.a.createElement("div",null,i.a.createElement("h6",null,"Details"),a)}(e.data);return i.a.createElement("div",null,i.a.createElement(ce.a,null,i.a.createElement(ce.a,{onMouseEnter:function(){r(!0)},onMouseLeave:function(){r(!1)}},i.a.createElement(Q.a,{in:n},i.a.createElement(ce.a.Header,null,i.a.createElement(ue.a,{variant:"tabs",defaultActiveKey:"definition"},i.a.createElement(ue.a.Item,null,i.a.createElement(ue.a.Link,{eventKey:"definition",onSelect:function(){u(!1)}},"Definition")),i.a.createElement(ue.a.Item,null,i.a.createElement(ue.a.Link,{eventKey:"details",onSelect:function(){u(!0)}},"Other Info"))))),i.a.createElement(ce.a.Body,null,i.a.createElement(ce.a.Text,null,i.a.createElement("dl",null,i.a.createElement("dt",{className:"sui-definitionEntry-term"},e.kmap.name_latin[0],":"),i.a.createElement("dd",null,d),i.a.createElement(Q.a,{in:n},i.a.createElement("ul",{className:"list-group list-group-horizontal-sm justify-content-end"},i.a.createElement("li",{key:"lang",className:"list-group-item border-0"},i.a.createElement("span",null,"Definition Language:"),i.a.createElement("span",null,e.data.related_definitions_language_s)),i.a.createElement("li",{key:"author",className:"list-group-item border-0"},i.a.createElement("span",null,"Definition Author:"),i.a.createElement("span",null,e.data.related_definitions_author_s)))),i.a.createElement(Q.a,{in:c},i.a.createElement("div",null,p)))),e.nested))))}function he(e){var t=e.data.definitions.map((function(e,t){var s=(new A.Parser).parse(e);return i.a.createElement("li",{key:t,className:"sui-definitionEntry-other"},s)}));return i.a.createElement(i.a.Fragment,null,i.a.createElement(ce.a,null,i.a.createElement(ce.a.Header,null,e.data.name),i.a.createElement(ce.a.Body,null,i.a.createElement("div",{className:"sui-definitionEntry-term"},e.kmap.name_latin[0]),i.a.createElement("ol",{className:"sui-definitionEntry-other"},t))))}var me=function(e){var t=oe(e.kmap._childDocuments_,"related_definitions");return console.log("Definition: nested doc = ",t),i.a.createElement(ce.a,null,i.a.createElement(ce.a.Body,null,i.a.createElement(ce.a.Title,null,"Definitions"),i.a.createElement("ul",{className:"sui-definitionEntry"},i.a.createElement(de,{definitions:t,kmap:e.kmap}))))};function ge(e){var t=oe(e.kmap._childDocuments_,"related_names");return i.a.createElement(ce.a,{className:"kmap-entry"},i.a.createElement(ce.a.Body,null,i.a.createElement(ce.a.Title,null,"Names"),i.a.createElement("ul",{className:"sui-nameEntry"},i.a.createElement(fe,{names:t}))))}function fe(e){var t=[];return console.log("NameEntry: props.names=",e.names),Object.entries(e.names).map((function(e){var s=Object(T.a)(e,2),a=s[0],n=s[1];return t.push(i.a.createElement("li",{id:a,key:a,className:"sui-nameEntry"},i.a.createElement("span",{className:"sui-nameEntry-header"},n.related_names_header_s),i.a.createElement("span",{className:"sui-nameEntry-meta"},i.a.createElement("span",{className:"sui-nameEntry-language"},n.related_names_language_s),i.a.createElement("span",{className:"sui-nameEntry-relationship"},n.related_names_relationship_s),i.a.createElement("span",{className:"sui-nameEntry-writing-system"},n.related_names_writing_system_s)),i.a.createElement("ul",null,i.a.createElement(fe,{names:n._nested_})))),!0})),i.a.createElement(i.a.Fragment,null,t)}var ve=function(e){var t,s=le.a.filter(e.kmap._childDocuments_,(function(e){return"terms_recording"===e.block_child_type})),n=Object(a.useRef)(),r=null===(t=s[0])||void 0===t?void 0:t.recording_url,l=Object(a.useState)(r),o=Object(T.a)(l,2),c=o[0],u=o[1],d=le.a.map(s,(function(e,t){return i.a.createElement("option",{key:t,value:e.recording_url},e.recording_dialect_s)})),p=c?i.a.createElement(i.a.Fragment,null,i.a.createElement("button",{onClick:function(){n.current.play()}},i.a.createElement("span",null,"\ue60a")),i.a.createElement("select",{onChange:function(e){return function(e){u(e.target.value)}(e)}},d)):"No Audio Available";return i.a.createElement(ce.a,null,i.a.createElement("div",{className:"sui-audioPlayer"},i.a.createElement("audio",{src:c,ref:function(e){return n.current=e}}),i.a.createElement("form",{onSubmit:function(e){return e.preventDefault(),!1}},i.a.createElement(ce.a.Body,null,i.a.createElement(ce.a.Title,null,"Audio"),p))))};var be=function(e){var t=oe(e.kmap._childDocuments_,"related_terms");return i.a.createElement("div",null,i.a.createElement("h3",null,"Related Terms"),i.a.createElement("pre",null,JSON.stringify(t,void 0,3)))};s(336);var ye=function(e){var t=e.kmasset.name_tibt?e.kmasset.name_tibt[0]:e.kmasset.header,s=e.kmasset.name_latin?e.kmasset.name_latin[0]:"";return i.a.createElement("div",{className:"sui-nodeHeader"},i.a.createElement("span",{className:"shanticon-terms"}),"\xa0\xa0\xa0",i.a.createElement("span",{className:"sui-termTitle sui-nodeTitle",id:"sui-termTitle"},i.a.createElement("span",{className:"sui-nodeTitle-item tibt"},t),"\xa0\xa0\xa0",i.a.createElement("span",{className:"sui-nodeTitle-item latin"},s)),i.a.createElement("hr",{style:{borderTop:"1px solid rgb(162, 115, 63)"}}))},_e=s(24),ke=s(41),we=s(99),xe=(s(449),s(136)),Ee=s.n(xe);function Se(e){var t=Object(a.useState)(0),s=Object(T.a)(t,2),n=(s[0],s[1],Object(a.useRef)(null)),r=i.a.createElement(Ee.a,{"aria-label":"Goto page",min:1,max:e.pager.getMaxPage()+1,size:5,value:e.pager.getPage()+1,onChange:function(t){console.log("FeaturePager pg = "+t+" maxPage = "+e.pager.getMaxPage()),e.pager.setPage(t-1)},mobile:!1,noStyle:!0,ref:n});return i.a.createElement("div",null,i.a.createElement("span",{onClick:function(){e.pager.firstPage(),console.log("firstPage()",n.current),console.log("getPage()",e.pager.getPage()),n.current.refsInput.setValue(e.pager.getPage()+1)},className:"shanticon-arrow-end-left icon"}," "),i.a.createElement("span",{onClick:function(){e.pager.prevPage(),console.log("getPage()",e.pager.getPage()),n.current.refsInput.setValue(e.pager.getPage()+1)},className:"shanticon-arrow3-left icon"}," "),i.a.createElement("span",null,r)," of ",i.a.createElement("span",null,e.pager.getMaxPage()+1),"\xa0",i.a.createElement("span",{onClick:function(){e.pager.nextPage(),console.log("getPage()",e.pager.getPage()),n.current.refsInput.setValue(e.pager.getPage()+1)},className:"shanticon-arrow3-right icon"}," "),i.a.createElement("span",{onClick:function(){e.pager.lastPage(),console.log("getPage()",e.pager.getPage()),n.current.refsInput.setValue(e.pager.getPage()+1)},className:"shanticon-arrow-end-right icon"}," "),e.loadingState?i.a.createElement("span",null," loading..."):i.a.createElement("span",null),i.a.createElement("span",{className:"float-right"},i.a.createElement("span",null,"items per page:"),i.a.createElement(Ee.a,{"aria-label":"Set number of items per page",min:1,max:100,size:3,value:e.pager.getPageSize(),onChange:function(t){e.pager.setPageSize(t)},mobile:!1,style:{"input.mobile":{border:"0px"},"btnUp.mobile":{}}})))}function Te(e){return i.a.createElement(ce.a,{className:"m-2 zoom",key:e.doc.uid},i.a.createElement(j.b,{to:"/view/assets/".concat(e.doc.uid)},i.a.createElement(ce.a.Img,{variant:"top",src:e.doc.url_thumb})),i.a.createElement(ce.a.Body,null,i.a.createElement(ce.a.Title,null,e.doc.title[0]),i.a.createElement(ce.a.Text,null,i.a.createElement("p",null,e.doc.uid),i.a.createElement("p",null,le.a.isEmpty(e.doc.caption)?e.doc.summary:e.doc.caption)),i.a.createElement(_e.a,null,i.a.createElement(_e.a.Toggle,{as:ke.a,eventKey:"0"},"Item JSON"),i.a.createElement(_e.a.Collapse,{eventKey:"0"},i.a.createElement("pre",null,JSON.stringify(e.doc,void 0,2))))))}s(337);var je=s(225),Ce=s.n(je);s(344);function De(e){console.log("FeatureGallery");var t=e.docs,s=[],a=[];return t&&(console.log("FeatureGallery: looking at ",t),a=null===t||void 0===t?void 0:t.map((function(e,t){return console.log("FeatureGallery: url_large = ",e.url_large),console.log("FeatureGallery: doc = ",e),{original:e.url_large?e.url_large:e.url_thumb,thumbnail:e.url_thumb,src:e.url_thumb,width:Number(e.url_thumb_width),height:Number(e.url_thumb_height),key:e.uid}})),console.log("FeatureGallery LIST = ",a),s=i.a.createElement(_e.a,null,i.a.createElement(_e.a.Toggle,{as:ke.a,eventKey:"0"},"Full JSON"),i.a.createElement(_e.a.Collapse,{eventKey:"0"},i.a.createElement("pre",null,JSON.stringify(t,void 0,1))))),i.a.createElement(i.a.Fragment,null,i.a.createElement(Oe,{title:e.title}),i.a.createElement(Se,{pager:e.pager}),i.a.createElement(Ce.a,{items:a}),i.a.createElement(Se,{pager:e.pager}),i.a.createElement(we.a,null,s))}function Oe(e){return e.title?i.a.createElement("h5",{className:"sui-relatedHeader"},e.title):null}var Pe=s(232),Ae=s(131),Le={sm:2,md:3,lg:4,xl:6};function Ne(e){var t=e.docs,s=[],a=[];if(t){var n;console.log("FeatureDeck: looking at ",t);var r=function(e,t){for(var s=[],a=t.xl,n=0;n<a;n++){for(var r=["m-1","p-2","d-none"],l=0,o=Object.entries(t);l<o.length;l++){var c=Object(T.a)(o[l],2),u=c[0],d=c[1];e%d!==0&&n<d-e%d?r.push("d-".concat(u,"-block ").concat("invisible")):r.push("d-".concat(u,"-none"))}var p=i.a.createElement(ce.a,{className:r.join(" "),key:"fill"+n},i.a.createElement(ce.a.Text,null,i.a.createElement("pre",null,r.join("\n"))));s.push(p)}return s}((a=null===t||void 0===t?void 0:t.map((function(e,t){var s=[],a=i.a.createElement(Te,{doc:e,key:t});return function(e,t,s){0!==e&&(e%t.sm===0&&s.push(i.a.createElement("div",{className:"w-100 d-none d-sm-block d-md-none",key:"sm"+e})),e%t.md===0&&s.push(i.a.createElement("div",{className:"w-100 d-none d-md-block d-lg-none",key:"md"+e})),e%t.lg===0&&s.push(i.a.createElement("div",{className:"w-100 d-none d-lg-block d-xl-none",key:"lq"+e})),e%t.xl===0&&s.push(i.a.createElement("div",{className:"w-100 d-none d-xl-block",key:"xl"+e})))}(t,Le,s),s.push(a),s}))).length,Le);(n=a).push.apply(n,Object(Pe.a)(r)),console.log("FeatureDeck LIST = ",a),s=i.a.createElement(_e.a,null,i.a.createElement(_e.a.Toggle,{as:ke.a,eventKey:"0"},"Full JSON"),i.a.createElement(_e.a.Collapse,{eventKey:"0"},i.a.createElement("pre",null,JSON.stringify(t,void 0,1))))}return i.a.createElement(i.a.Fragment,null,i.a.createElement(Re,{title:e.title}),i.a.createElement(Se,{pager:e.pager}),i.a.createElement(R.a,null,i.a.createElement(Ae.a,null,a)),i.a.createElement(Se,{pager:e.pager}),i.a.createElement(we.a,null,s))}function Re(e){return e.title?i.a.createElement("h5",{className:"sui-relatedHeader"},e.title):null}function Ie(e){var t=le.a.map(e.docs,(function(e){return i.a.createElement(ce.a,{className:"p-0 m-1"},i.a.createElement(_e.a,null,i.a.createElement(ce.a.Body,{className:"p-1"},i.a.createElement("span",{className:"shanticon-"+e.asset_type+" icon"})," ",e.title," (",e.uid,")",i.a.createElement(_e.a.Toggle,{as:"span",eventKey:"0",onClick:function(e){"(+)"===e.target.innerHTML?e.target.innerHTML="(-)":e.target.innerHTML="(+)"}},"(+)"),i.a.createElement(_e.a.Collapse,{eventKey:"0"},i.a.createElement(ce.a,null,i.a.createElement("pre",null,JSON.stringify(e,void 0,2)))))))})),s=i.a.createElement("div",null,i.a.createElement(R.a,null,i.a.createElement(Se,{pager:e.pager}),t,i.a.createElement(Se,{pager:e.pager})));return i.a.createElement("div",null,s,i.a.createElement("pre",null,JSON.stringify(e,void 0,2)))}var Me=s(62),Ue=s(226);function Fe(e){var t=Object(C.h)();console.log("FeatureCollection: params: ",t);var s=t.viewMode,n=Object(a.useState)("deck"),r=Object(T.a)(n,2),l=r[0],o=r[1],c=s||e.viewMode;if(console.log("FeatureCollection: props.viewMode = ",e.viewMode),console.log("FeatureCollection: requestedViewMode = ",c),console.log("FeatureCollection: paramsViewMode = ",s),le.a.isEmpty(c)||l===c||o(c),l&&s&&s!==l)return i.a.createElement(C.a,{to:l});console.log("FeatureCollection: FINAL VIEWMODE = ",l);var u=i.a.createElement(C.a,{to:"deck"});switch(l){case"gallery":u=i.a.createElement(De,e);break;case"deck":u=i.a.createElement(Ne,e);break;case"list":u=i.a.createElement(Ie,e)}return i.a.createElement("div",null,i.a.createElement("h5",null,"View Mode: ",i.a.createElement(Ge,{viewMode:l})),u)}function Ge(e){var t=Object(C.g)(),s=e.viewMode;var a=i.a.createElement("span",{className:"shanticon-vcard-o icon"}),n=i.a.createElement("span",{className:"shanticon-image icon"}),r=i.a.createElement("span",{className:"shanticon-list2 icon"});return i.a.createElement(Ue.a,{name:s,value:s,type:"radio",onChange:function(e){return function(e){console.log("navigating ",e),t.push(e)}(e)}},i.a.createElement(Me.a,{name:"viewMode",value:"deck",type:"radio"},a),i.a.createElement(Me.a,{name:"viewMode",value:"gallery",type:"radio"},n),i.a.createElement(Me.a,{name:"viewMode",value:"list",type:"radio"},r))}function qe(e){var t,s=Object(C.h)().relatedType,a=null===(t=e.relateds)||void 0===t?void 0:t.assets,n=a?a[s]:null,r=null===n||void 0===n?void 0:n.docs,l="all"!==s?"Related ".concat(s):"All Related Items";return i.a.createElement(Fe,{docs:r,pager:e.pager,title:l,viewMode:"gallery"})}function Be(e){var t=i.a.createElement("div",{className:"termsviewer"},"Loading...");return e.kmasset&&e.kmasset.asset_type&&(t=i.a.createElement("div",{className:"termsviewer"},i.a.createElement("div",{className:"sui-terms"},i.a.createElement(ye,{kmasset:e.kmasset}),i.a.createElement(C.d,null,i.a.createElement(C.b,{path:"/view/:viewerType/:id/related/:relatedType/:viewMode"},i.a.createElement(qe,e)),i.a.createElement(C.b,{path:"/view/:viewerType/:id/related/:relatedType"},i.a.createElement(C.a,{to:"./all"})),i.a.createElement(C.b,null,i.a.createElement(ge,{kmap:e.kmap}),i.a.createElement(ve,{kmap:e.kmap}),i.a.createElement(me,{kmap:e.kmap}),i.a.createElement(be,{kmap:e.kmap})))))),t}function He(e){return i.a.createElement(Fe,Object.assign({},e,{viewMode:"deck"}))}var Ke=function(e){Object(c.a)(s,e);var t=Object(u.a)(s);function s(e){var a;if(Object(l.a)(this,s),a=t.call(this,e),console.error(typeof e.sui),"object"!==typeof e.sui)throw new Error("sui must be passed as a property to the component!");if("object"!==typeof e.sui.pages)throw new Error("sui.pages must be passed as part of the sui passed to the constructor!");return a.sui=e.sui,a.props=e,a}return Object(o.a)(s,[{key:"componentDidMount",value:function(){}},{key:"componentDidCatch",value:function(e,t){}},{key:"componentWillUnmount",value:function(){}},{key:"componentDidUpdate",value:function(e,t,s){}},{key:"shouldComponentUpdate",value:function(e,t,s){}},{key:"render",value:function(){return i.a.createElement("div",{class:"collections legacy"},"COLLECTIONS LEGACY ",JSON.stringify(this.props))}}]),s}(i.a.Component),ze=s(46),Je=s.n(ze),Ve=s(75),Qe=s(52),Ye=s.n(Qe),We=s(53),$e=s.n(We),Xe=s(227),Ze=s.n(Xe);function et(e){return Ze.a.createHash("sha1").update(e).digest("base64")}function tt(e){return st.apply(this,arguments)}function st(){return(st=Object(Ve.a)(Je.a.mark((function e(t){return Je.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nt(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function at(e){var t=null;if(sessionStorage)try{var s=sessionStorage.getItem(et(JSON.stringify(e)));s&&(t=JSON.parse(s))}catch(a){console.log("Ignored sessionStorage error: ",a)}return console.log("getCached: returning: ",t),t}function it(e,t){if(sessionStorage)try{sessionStorage.setItem(et(JSON.stringify(e)),JSON.stringify(t)),console.log("Cached: data for ",JSON.stringify(e))}catch(s){console.log("Ignored sessionStorage error: ",s)}}function nt(e){console.log("UNPACKING search: ",e);var t=e.page,s=e.query;console.log("UNPACKING page: ",t),console.log("UNPACKING query: ",s);var a={fl:"*",wt:"json",echoParams:"explicit",indent:"true",start:t.start||0,rows:t.rows||10,"json.facet":JSON.stringify({asset_count:{type:"terms",field:"asset_type",limit:500},related_subjects:{type:"terms",field:"kmapid_subjects_idfacet",limit:500},related_terms:{type:"terms",field:"kmapid_terms_idfacet",limit:500},feature_types:{limit:300,type:"terms",field:"feature_types_idfacet"},languages:{limit:300,type:"terms",field:"node_lang"},collections:{limit:300,type:"terms",field:"collection_idfacet"},collection_nid:{limit:300,type:"terms",field:"collection_nid"},collection_uid:{limit:300,type:"terms",field:"collection_uid_s"},asset_subtype:{limit:300,type:"terms",field:"asset_subtype",facet:{parent_type:{limit:1,type:"terms",field:"asset_type"}}},node_user:{limit:300,type:"terms",field:"node_user_full_s"},creator:{limit:300,type:"terms",field:"creator"}})},i=function(e){var t=(n=e||"",n=(n=(n=(n=(n=(n=(n=(n=n.replace(/ /g,"\\ ")).replace("(","\\(")).replace(")","\\)")).replace(":","\\:")).replace("+","\\+")).replace("-","\\-")).replace('"','\\"')).replace("?","\\?")),s=t.length?t+"*":"*",a=t.length?"*"+t+"*":"*",i=t+"/";var n;e&&0!==t.length||(t=a=i="*");return{q:"( title:${xact}^100 title:${slashy}^100 title:${starts}^80 names_txt:${xact}^90 names_txt:${starts}^70)",xact:t,starts:s,search:a,slashy:i}}(e.query.searchText);a=Object(S.a)(Object(S.a)({},a),i);var n={adapter:$e.a,callbackParamName:"json.wrf",url:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev/select",params:a};return new Promise((function(e,t){var s=at(n);s?e(s):(console.log("getAssetSearchPromise(): Calling axios:",n),performance.mark("getAssetSearchPromise:start"),Ye.a.request(n).then((function(t){console.log("getAssetSearchPromise():  Yay! axios call succeeded!",t),console.log("getAssetSearchPromise(): res = ",t);var s={numFound:t.data.response.numFound,docs:le.a.map(t.data.response.docs,(function(e){return ct(e)})),facets:t.data.facets};it(n,s),e(s)})).catch((function(e){console.log("getAssetSearchPromise(): OUCH axios call failed!",e),t(e)})).finally((function(){performance.mark("getAssetSearchPromise:done"),performance.measure("getAssetSearchPromise","getAssetSearchPromise:start","getAssetSearchPromise:done"),console.log("performance:",performance.getEntriesByName("getAssetSearchPromise")),performance.getEntriesByName("getAssetSearchPromise").forEach((function(e){console.log("getAssetSearchPromise() duration:"+e.duration)})),console.log("performance getEntries:",performance.getEntries()),performance.clearMeasures()})))}))}function rt(e){var t={adapter:$e.a,callbackParamName:"json.wrf",url:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev/select",params:{fl:"*",wt:"json",echoParams:"explicit",indent:"true",start:0,rows:1,q:"uid:${kmapid}",kmapid:e}};return new Promise((function(e,s){var a=at(t);a?e(a):(console.log("getAssetDataPromise(): Calling axios:"),Ye.a.request(t).then((function(s){console.log("getAssetDataPromise():  Yay! axios call succeeded!",s);var a=s.data.response.docs[0];it(t,a),e(a)})).catch((function(e){console.log("gertAssetDataPromise(): OUCH axios call failed!",e),s(e)})))}))}function lt(e){var t={adapter:$e.a,callbackParamName:"json.wrf",url:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmterms_dev/select",params:{fl:"*,[child parentFilter=block_type:parent limit=1000]",wt:"json",echoParams:"explicit",indent:"true",start:0,rows:1,q:"uid:${kmapid}",kmapid:e}};return new Promise((function(e,s){var a=at(t);a?e(a):(console.log("getFullKmapDataPromise(): Calling axios:"),Ye.a.request(t).then((function(s){console.log("getFullKmapDataPromise(): Yay! axios call succeeded!",s);var a=function(e){return console.log("clean kmap data = ",e),e}(s.data.response.docs[0]);it(t,a),e(a)})).catch((function(e){console.log("getFullKmapDataPromise(): OUCH axios call failed!",e),s(e)})))}))}function ot(e,t,s,a){console.log("getRelatedAssetsPromise() Promising: ",arguments);var i="ss251856-us-east-1-aws.measuredsearch.com",n="kmassets_dev",r="https://"+i+"/solr/"+n+"/select",l=0,o=100,c=["audio-video","images","texts","visuals","sources","subjects","places","terms"],u="undefined"===typeof t||"all"===t?c:[t],d="undefined"===typeof s?l:s,p="undefined"===typeof a?o:a;console.log("getRelatedAssetsPromise: start = "+d+" rows = "+p);var h=JSON.stringify({asset_counts:{limit:20,type:"terms",field:"asset_type",domain:{excludeTags:"ast"}}}),m={fl:"*",wt:"json",echoParams:"explicit",indent:"true",start:d,rows:p,"json.facet":h,q:"(uid:${kmapid}^100+kmapid:${kmapid})",kmapid:e,fq:"{!tag=ast}asset_type:( "+u.join(" ")+")"},g={adapter:$e.a,callbackParamName:"json.wrf",url:r,params:m},f=function(i){console.log("unpacking asset_counts: ",i.data.facets);var n=i.data.facets.asset_counts.buckets,r={all:{count:0,docs:i.data.response.docs}};return n.forEach((function(e){r[e.val]={count:e.count,docs:[]},r.all.count+=e.count})),console.log("unpacking assets: ",i.data.response.docs),i.data.response.docs.forEach((function(e){var t=ct(e);r[e.asset_type].docs.push(t)})),{uid:e,start:s,rows:a,type:t,stateKey:[e,t,s,a].join("/"),assets:r}},v=new Promise((function(e,t){var s=at(g);s?e(s):(console.log("getRelatedAssetsPromise(): Calling axios:"),Ye.a.request(g).then((function(t){console.log("getRelatedAssetsPromise():  Yay! axios call succeeded!",t);var s=f(t);it(g,s),e(s)})).catch((function(e){console.log("getRelatedAssetsPromise(): OUCH axios call failed!",e),t(e)})))}));return v}function ct(e){var t=e.asset_type;switch(console.log("cleanAssetData ",t),t){case"texts":case"sources":case"subjects":case"places":case"terms":case"collections":e.url_large="/mandala-om/gradient.jpg",e.url_thumb="/mandala-om/gradient.jpg",e.url_thumb_height=100,e.url_thumb_width=150;break;case"images":e.url_large=function(e,t){console.log("deriveImageUrl: ",e);var s=e.toString().replace("200,200",t+","+t);return console.log("deriveImageUrl: large = ",s),s}(e.url_thumb,1200)}return console.log("clean thumb = ",e.url_thumb),console.log("returning clean: ",e),e}function ut(e){console.log("KmapContext: props=",e);var t=Object(a.useState)(""),s=Object(T.a)(t,2),n=(s[0],s[1]),r=Object(a.useState)({}),l=Object(T.a)(r,2),o=l[0],c=l[1],u=Object(a.useState)({}),d=Object(T.a)(u,2),p=d[0],h=d[1],m=Object(a.useState)({}),g=Object(T.a)(m,2),f=g[0],v=g[1],b=Object(a.useState)(!1),y=Object(T.a)(b,2),_=(y[0],y[1],Object(a.useState)(0)),k=Object(T.a)(_,2),w=k[0],x=k[1],E=Object(a.useState)(10),S=Object(T.a)(E,2),j=S[0],D=S[1],O=Object(C.h)(),P=O.id,A=O.relatedType,L={getMaxPage:function(){if(p.assets&&p.assets[A]){var e=p.assets[A].count,t=Math.floor((e-1)/j);return console.log("getMaxPage(): pageSize = ",j," maxCount = ",e," => maxPage = ",t),t}return 0},getPage:function(){return w},setPage:function(e){e=Number(e);var t=p.assets[A].count,s=Math.floor(t/j);e=le.a.isNaN(e)?0:e,x(e>s?function(){return s}:e<0?function(){return 0}:function(){return e})},setPageSize:function(e){e=Number(e);var t=Number(e),s=Number(w);e=e<1?1:e,e=le.a.isNaN(e)?t:e,D(e);var a=Math.floor(j/t*s);a=le.a.isNaN(a)?0:a,L.setPage(a)},getPageSize:function(){return j},nextPage:function(){L.setPage(L.getPage()+1)},prevPage:function(){L.setPage(L.getPage()-1)},lastPage:function(){L.setPage(L.getMaxPage())},firstPage:function(){L.setPage(0)}};if(!e.children)return i.a.createElement("h2",null,"No Children?");var N=!1,R=w*j;console.log("KmapContext: id = "+P+" relatedType = "+A);var I=[rt(P),lt(P),ot(P,A,R,j)];return Promise.allSettled(I).then((function(t){var s=Object(T.a)(t,3),a=s[0],i=s[1],r=s[2],l=a.status,u=a.value,d=i.status,m=i.value,g=r.status,b=r.value,y={};m&&"fulfilled"===d&&f.uid!==m.uid&&(y.kmap=m,v(m),n(P),N=!0),u&&"fulfilled"===l&&o.uid!==u.uid&&(y.kmasset=u,c(u),N=!0),console.log("relateds looks like: ",b),"fulfilled"===g&&p.stateKey!==b.stateKey&&(y.relateds=b,h(b),N=!0),N&&e.onStateChange&&e.onStateChange({id:P,kmap:f,kmasset:o,relateds:p,pager:L})})).catch((function(e){console.error("oh dear! ",e)})),i.a.Children.map(e.children,(function(e){return e.type?i.a.cloneElement(e,{id:P,kmap:f,kmasset:o,relateds:p,pager:L}):e}))}var dt,pt,ht=s(20);!function(e){e.Places="places",e.Subjects="subjects",e.Terms="terms",e.AudioVideo="audio-video",e.Images="images",e.Visuals="visuals",e.Sources="sources"}(dt||(dt={})),function(e){e.Not="NOT",e.And="AND",e.Or="OR"}(pt||(pt={}));var mt,gt,ft={loadingState:!1,results:{numFound:0,docs:[],facets:[]},query:{searchText:"",filters:[{id:"places",label:"Places",operator:pt.Or,field:"asset_type",match:dt.Places}],facetConfigs:[]},page:{current:0,start:0,rows:10,maxStart:219},gotoPage:Object(ht.b)((function(e,t){t*e.page.rows>e.page.maxStart?t=Math.floor(e.page.maxStart/e.page.rows):t<0&&(t=0),console.error("gotoPage() pageNum = ",t),e.page.start=e.page.rows*t,e.page.current=t})),nextPage:Object(ht.b)((function(e,t){t|=1,console.log("SearchModel: pager.nextPage() ",t),console.log("SearchModel: state.page ",e.page);e.page.current;var s=e.page.start+t*e.page.rows;s>e.page.maxStart&&(s=e.page.rows*Math.floor(e.page.maxStart/e.page.rows)),console.log("SearchModel: newStart ",s),e.page.start=s,e.page.current=Math.floor(s/e.page.rows)})),prevPage:Object(ht.b)((function(e,t){t|=1,console.log("SearchModel: pager.prevPage() ",t),console.log("SearchModel: state.page ",e.page);var s=e.page.start-t*e.page.rows;s<0&&(s=0),console.log("SearchModel: newStart ",s),e.page.start=s,e.page.current=Math.floor((s+1)/e.page.rows)})),lastPage:Object(ht.b)((function(e){e.page.start=e.page.rows*Math.floor(e.page.maxStart/e.page.rows),e.page.current=Math.floor(e.page.maxStart/e.page.rows)})),firstPage:Object(ht.b)((function(e){e.page.start=0,e.page.current=0})),setPageSize:Object(ht.b)((function(e,t){t<1&&(t=1),e.page.rows=t})),update:Object(ht.e)(function(){var e=Object(Ve.a)(Je.a.mark((function e(t,s,a){var i,n;return Je.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=a.getStoreState().search).loadingState=!0,console.log("SEARCH START: ",i.page.current),e.next=5,tt(i);case 5:n=e.sent,console.log("SEARCH DONE: ",i.page.current),i.loadingState=!1,t.receiveResults(n);case 9:case"end":return e.stop()}}),e)})));return function(t,s,a){return e.apply(this,arguments)}}()),receiveResults:Object(ht.b)((function(e,t){console.log("SEARCH Receive RESULTS: ",t),e.page.maxStart!==t.numFound&&(e.page.maxStart=t.numFound),e.results!==t&&(e.results=t)})),setSearchText:Object(ht.b)((function(e,t){e.query.searchText=t})),addFilters:Object(ht.b)((function(e,t){})),removeFilters:Object(ht.b)((function(e,t){})),clearFilters:Object(ht.b)((function(e,t){})),onUpdate:Object(ht.f)((function(e,t){return[e.setPageSize,e.nextPage,e.prevPage,e.gotoPage,e.lastPage,e.firstPage,e.removeFilters,e.clearFilters,e.addFilters,e.setSearchText]}),function(){var e=Object(Ve.a)(Je.a.mark((function e(t,s){return Je.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.update();case 1:case"end":return e.stop()}}),e)})));return function(t,s){return e.apply(this,arguments)}}())};!function(e){e.FeatureTypes="feature_types",e.RelatedPlaces="related_places"}(mt||(mt={})),function(e){e.Child="child"}(gt||(gt={}));var vt={kmap:{uid:"",kmap:{uid:""},asset:{uid:""},relateds:[]},search:ft},bt=Object(ht.d)(),yt=bt.useStoreActions,_t=bt.useStoreState;bt.useStoreDispatch,bt.useStore;function kt(e){var t,s,n=Object(C.h)();console.log("SearchContext params = ",n);var r,l=_t((function(e){return e.search})),o=(r=yt((function(e){return e.search})),le.a.reduce(r,(function(e,t,s){var a;return e[s]=(a=t,le.a.debounce(a,500)),e}),{})),c=o.update,u=o.setSearchText,d=o.addFilters,p=o.gotoPage,h=o.nextPage,m=o.prevPage,g=o.lastPage,f=o.firstPage,v=o.clearFilters,b=o.removeFilters,y=o.setPageSize,_=l.query;console.log("setting searchControls: search = ",l);var k={query:_,currentText:l.searchText,update:c,setSearchText:u,addFilters:d,clearFilters:v,removeFilters:b};Object(a.useEffect)((function(){console.log("INITING"),c()}),[]);var w=null===(t=l.results)||void 0===t?void 0:t.docs,x={numFound:l.results.numFound,currentPage:l.page.current,currentPageSize:l.page.rows,getMaxPage:function(){var e;if(null===(e=l.results)||void 0===e?void 0:e.numFound){var t=l.results.numFound,s=l.page.rows;return Math.floor((t-1)/s)}return 0},getPage:function(){return l.page.current},setPage:function(e){e=Number(e);var t=l.results.numFound,s=l.page.rows,a=Math.floor(t/s);(e=le.a.isNaN(e)?0:e)>a?p(a):e<0?(console.log("SearchContext: gotoPage: 0"),p(0)):(console.log("SearchContext: gotoPage: "+e),p(e))},setPageSize:function(e){e=Number(e);var t=Number(e),s=Number(l.page.current);e=e<1?1:e,e=le.a.isNaN(e)?t:e,y(e);var a=l.page.rows,i=Math.floor(a/t*s);i=le.a.isNaN(i)?0:i,x.setPage(i)},getPageSize:function(){return l.page.rows},nextPage:function(){h()},prevPage:function(){m()},firstPage:function(){f()},lastPage:function(){g()}},E=null===(s=l.results)||void 0===s?void 0:s.facets;return i.a.Children.map(e.children,(function(e){return e.type?i.a.cloneElement(e,{docs:w,facets:E,pager:x,search:k}):e}))}function wt(e,t,s){var a=function(e,t,s){var a="";switch(e){case"local":a="https://"+t+".dd:8443";break;case"dev":a="https://"+t+"-dev.shanti.virginia.edu";break;case"stage":a="https://"+t+"-stage.shanti.virginia.edu";break;default:a="https://"+t+".shanti.virginia.edu"}var i="";switch(t){case"texts":i=a+"/shanti_texts/node_json/"+s;break;default:i=a}return i}(e,t,s),i={adapter:$e.a,callbackParamName:"json.wrf",url:a};return new Promise((function(e,t){Ye.a.request(i).then((function(t){var s=t.data;!function(e,t){if(sessionStorage)try{sessionStorage.setItem(JSON.stringify(e),JSON.stringify(t)),console.log("Cached: data for ",JSON.stringify(e))}catch(s){console.log("Ignored sessionStorage error: ",s)}}(i,s),e(s)})).catch((function(e){t(e)}))}))}function xt(e){var t=Object(a.useState)(e.assettype),s=Object(T.a)(t,2),n=s[0],r=(s[1],Object(a.useState)({})),l=Object(T.a)(r,2),o=l[0],c=l[1],u=Object(C.h)().id;if(u.indexOf("-")>1&&(u=u.split("-").pop()),!e.children)return i.a.createElement("h2",null,"No Children?");var d=!1,p=[wt("dev",n,u)];return Promise.allSettled(p).then((function(t){var s=Object(T.a)(t,1)[0],a=s.status,i=s.value;"fulfilled"===a?s&&o.nid!==i.nid&&(c(i),d=!0):"rejected"==a&&(c(!1),d=!0),d&&e.onStateChange&&e.onStateChange({id:u,asset_type:n,mdlasset:o})})).catch((function(e){console.error("oh dear! failure!??? ",e)})),i.a.Children.map(e.children,(function(e){return e.type?i.a.cloneElement(e,{id:u,asset_type:n,mdlasset:o}):e}))}function Et(e){console.log("ContentPanel: props =  ",e);var t=Object(C.i)().path,s=e.title||"Untitled",a=e.site||"defauit";return i.a.createElement("div",{id:"sui-content",className:"sui-content"},i.a.createElement(P,{siteClass:a,title:s,sui:e.sui,kmasset:e.kmasset}),i.a.createElement("div",{id:"sui-results"},i.a.createElement(C.d,null,i.a.createElement(C.b,{path:"".concat(t,"/audio-video/:id")},i.a.createElement(L,{id:e.id,sui:e.sui,onStateChange:e.onStateChange})),i.a.createElement(C.b,{path:"".concat(t,"/images/:id")},i.a.createElement(N,{id:e.id,sui:e.sui,onStateChange:e.onStateChange})),i.a.createElement(C.b,{path:"".concat(t,"/texts/:id")},i.a.createElement(xt,{assettype:"texts"},i.a.createElement($,{onStateChange:e.onStateChange}))),i.a.createElement(C.b,{path:"".concat(t,"/sources/:id")},i.a.createElement(X,{id:e.id,sui:e.sui,onStateChange:e.onStateChange})),i.a.createElement(C.b,{path:"".concat(t,"/visuals/:id")},i.a.createElement(Z,{id:e.id,sui:e.sui,onStateChange:e.onStateChange})),i.a.createElement(C.b,{path:"".concat(t,"/places/:id")},i.a.createElement(ee,{id:e.id,sui:e.sui,onStateChange:e.onStateChange})),i.a.createElement(C.b,{path:"".concat(t,"/subjects/:id")},i.a.createElement(te,{id:e.id,sui:e.sui,onStateChange:e.onStateChange})),i.a.createElement(C.b,{path:"".concat(t,"/assets/:id")},i.a.createElement(se,{id:e.id,onStateChange:e.onStateChange}),i.a.createElement(ne,{id:e.id,sui:e.sui,onStateChange:e.onStateChange})),i.a.createElement(C.b,{path:["".concat(t,"/terms/:id/related/:relatedType/:viewMode"),"".concat(t,"/terms/:id")]},i.a.createElement(ut,null,i.a.createElement(se,{id:e.id,onStateChange:e.onStateChange}),i.a.createElement(Be,{onStateChange:e.onStateChange}))),i.a.createElement(C.b,{path:"".concat(t,"/terms/:id/related/:relatedType")},i.a.createElement(C.a,{to:"./default"})),i.a.createElement(C.b,{path:"".concat(t,"/collections/:id")},i.a.createElement(Ke,{id:e.id,sui:e.sui,onStateChange:e.onStateChange})),i.a.createElement(C.b,{path:"".concat(t,"/search/:viewMode")},i.a.createElement(kt,null,i.a.createElement(He,null))),i.a.createElement(C.b,{exact:!0,path:"".concat(t,"/search")},i.a.createElement(C.a,{to:"".concat(t,"/search/default")})),i.a.createElement(C.b,{path:"*"},i.a.createElement(Ut,null)))))}function St(e){var t=e.hamburgerOpen?"open":"closed";return i.a.createElement("div",{className:"sui-hamburger ".concat(t),id:"sui-hamburger"},i.a.createElement("span",{id:"sui-help",className:"sui-hamItem"},"\ue67e","\xa0\xa0HELP GUIDE"),i.a.createElement("span",{id:"sui-home",className:"sui-hamItem"},"\ue60b","\xa0\xa0HOME"))}p()(document).ready((function(){window.show_not_found=setTimeout((function(){p()(".loading").hide(),p()(".not-found-msg").show()}),5e3)}));var Tt=s(32);function jt(e){var t=Object(a.useRef)(null),s=Object(ht.g)((function(e){return e}));console.debug("BasicSearch: state = ",s);var n=s.search.query.searchText,r=function(){e.search.setSearchText(t.current.value),e.onSubmit(t.current.value)},l=le.a.debounce((function(){console.log("handleChange: ",t.current.value)}),500);return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"sui-search1"},i.a.createElement("input",{type:"text",id:"sui-search",className:"sui-search2",defaultValue:n,placeholder:"Enter Search",onChange:l,onKeyDownCapture:function(e){13===e.keyCode&&r()},ref:t}),i.a.createElement("div",{id:"sui-clear",className:"sui-search3",onClick:function(){t.current.value="",e.onSubmit(t.current.value)}},"\ue610")),i.a.createElement("div",{id:"sui-searchgo",className:"sui-search4",onClick:r},"\ue623"))}var Ct=function(e){Object(c.a)(s,e);var t=Object(u.a)(s);function s(e){var a;return Object(l.a)(this,s),(a=t.call(this,e)).toggleAdvanced=a.toggleAdvanced.bind(Object(Tt.a)(a)),a.setAdvanced=a.setAdvanced.bind(Object(Tt.a)(a)),a}return Object(o.a)(s,[{key:"setAdvanced",value:function(e){this.props.onStateChange({advanced:e})}},{key:"toggleAdvanced",value:function(){this.setAdvanced(!this.props.advanced)}},{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(e,t,s){}},{key:"componentWillUnmount",value:function(){}},{key:"componentDidCatch",value:function(e,t){}},{key:"render",value:function(){var e=this.props.advanced?Mt:It;return i.a.createElement("div",{onClick:this.toggleAdvanced,id:"sui-mode",className:"sui-search5",title:"{label}"},e)}}]),s}(i.a.Component),Dt=function(e){Object(c.a)(s,e);var t=Object(u.a)(s);function s(e){var a;return Object(l.a)(this,s),(a=t.call(this,e)).toggleHamburger=a.toggleHamburger.bind(Object(Tt.a)(a)),a.setHamburgerOpen=a.setHamburgerOpen.bind(Object(Tt.a)(a)),a}return Object(o.a)(s,[{key:"setHamburgerOpen",value:function(e){this.props.onStateChange({hamburgerOpen:e})}},{key:"toggleHamburger",value:function(){this.setHamburgerOpen(!this.props.hamburgerOpen)}},{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(e,t,s){}},{key:"componentWillUnmount",value:function(){}},{key:"componentDidCatch",value:function(e,t){}},{key:"render",value:function(){return i.a.createElement("div",{onClick:this.toggleHamburger,id:"sui-hamBut",className:"sui-hamBut",title:"Help + options"},"\ue627")}}]),s}(i.a.Component),Ot=function(e){Object(c.a)(s,e);var t=Object(u.a)(s);function s(e){var a;return Object(l.a)(this,s),(a=t.call(this,e)).state={advanced:!1,hamburgerOpen:!1},a.handleStateChange=a.handleStateChange.bind(Object(Tt.a)(a)),a.handleInputChange=a.handleInputChange.bind(Object(Tt.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(Tt.a)(a)),a}return Object(o.a)(s,[{key:"render",value:function(){return i.a.createElement("div",{id:"sui-top",className:"sui-top"},i.a.createElement("div",{style:{display:"inline-block"}},i.a.createElement(kt,null,i.a.createElement(jt,{onSubmit:this.handleSubmit,onChange:this.handleInputChange}),i.a.createElement(Ct,{onStateChange:this.handleStateChange,advanced:this.state.advanced}),i.a.createElement(Dt,{onStateChange:this.handleStateChange,hamburgerOpen:this.state.hamburgerOpen}))))}},{key:"handleInputChange",value:function(e){console.log("Input Change",e.target.value),this.setState({search:e.target.value})}},{key:"handleSubmit",value:function(e){console.log("Submit: "+e)}},{key:"handleClearBasic",value:function(e){console.log("Clear"),e.preventDefault()}},{key:"handleStateChange",value:function(e){var t=this;this.setState(e,(function(){t.props.onStateChange(t.state)}))}}]),s}(i.a.Component),Pt=s(230);function At(e){var t,s=Object(a.useState)(!1),n=Object(T.a)(s,2),r=n[0],l=n[1],o=e.icon,c=e.assetType,u=(e.filters,o=o||{"audio-video":"\ue648",texts:"\ue636",images:"\ue62a",sources:"\ue631",visuals:"\ue63b",places:"\ue62b",subjects:"\ue634",terms:"\ue635",collections:"\ue633","recent-searches":"\ue62e",assets:"\ue60b",users:"\ue600",languages:"\ue670"}[c]),d=e.label||"UNKNOWN LABEL";var p=le.a.map(null===(t=e.facets)||void 0===t?void 0:t.buckets,(function(e){var t="shanticon-"+e.val,s=function(e,t){var s=e.val.split("|"),a=Object(T.a)(s,2),n=a[0],r=a[1];n=n||"undefined";var l=t&&r?i.a.createElement("span",null,"(",r,")"):"";return i.a.createElement("span",null,le.a.startCase(le.a.lowerCase(n))," ",l)}(e),a=e.count;return i.a.createElement("div",{className:"sui-advEditLine",id:"sui-advEditLine-0"},i.a.createElement("span",{className:t})," ",s," (",a,") ")}));return i.a.createElement("div",{className:"sui-advBox",id:"sui-advBox-"+e.id},i.a.createElement("div",{className:"sui-advHeader",id:"sui-advHeader-A",onClick:function(){return l(!r)}},u,"\xa0\xa0",d,i.a.createElement("span",{id:"sui-advPlus-"+e.id,style:{float:"right"}},i.a.createElement(Pt.a,{pill:!0,variant:p.length?"primary":"secondary"},p.length)," ",r?"\ue66a":"\ue669")),i.a.createElement("div",{className:"sui-advTerm",id:"sui-advTerm-"+e.id}),i.a.createElement("div",{className:"sui-advEdit "+(r?"open":"closed"),id:"sui-advEdit-"+e.id},i.a.createElement("input",{placeholder:"Search this list",value:"",style:{width:"90px",border:"1px solid #999",borderRadius:"12px",fontSize:"11px",paddingLeft:"6px"}}),p))}function Lt(e){var t=e.advanced?"open":"closed";return console.debug("SearchAdvanced: query = ",e.search.query),console.debug("SearchAdvanced: facets = ",e.facets),i.a.createElement("div",{id:"sui-adv",className:"sui-adv ".concat(t)},i.a.createElement(At,{id:"squawk",label:"item type",facets:e.facets.asset_count,assetType:"assets"}),i.a.createElement(At,{id:"squawk",label:"related subjects",facets:e.facets.related_subjects,assetType:"subjects"}),i.a.createElement(At,{id:"squawk",label:"related places",facets:e.facets.related_places,assetType:"places"}),i.a.createElement(At,{id:"squawk",label:"related terms",facets:e.facets.related_terms,assetType:"terms"}),i.a.createElement(At,{id:"squawk",label:"collections",facets:e.facets.collections,assetType:"collections"}),i.a.createElement(At,{id:"squawk",label:"languages",facets:e.facets.languages,assetType:"languages"}),i.a.createElement(At,{id:"squawk",label:"users",facets:e.facets.node_user,assetType:"users"}),i.a.createElement(At,{id:"squawk",label:"recent searches",assetType:"recent-searches"}),i.a.createElement("div",{style:{marginTop:"14px",float:"right",fontSize:"13px"}},i.a.createElement("div",null,"Show Boolean Controls? \xa0",i.a.createElement("input",{type:"checkbox",id:"sui-showBool",defaultChecked:"checked"}))),i.a.createElement("div",{id:"sui-footer",className:"sui-footer"}))}var Nt={kmasset:{header:"Mandala",title:["Mandala"],uid:"mandala"}};function Rt(e){var t=Object(a.useState)(Nt),s=Object(T.a)(t,2),n=s[0],r=s[1],l=function(e){console.log("Setting state with: ",e),console.log("Old state = ",n),r(Object(S.a)(Object(S.a)({},n),e)),console.log("New state = ",n),console.log("Main() state = ",n)};return i.a.createElement(j.a,{basename:"/mandala-om"},i.a.createElement("div",{id:"sui-main",className:"sui-main"},i.a.createElement("div",null,i.a.createElement(D,null),i.a.createElement(Ot,{onStateChange:l}),i.a.createElement(C.d,null,i.a.createElement(C.b,{path:"/home"},i.a.createElement(O,null)),i.a.createElement(C.b,{exact:!0,path:"/"},i.a.createElement(C.a,{to:"/home"})),i.a.createElement(C.b,{path:"/view"},i.a.createElement(Et,{site:"mandala",mode:"development",title:"Mandala",sui:e.sui,kmasset:n.kmasset,kmap:n.kmap,onStateChange:l})),i.a.createElement(C.b,{path:"*"},i.a.createElement(Ut,null),i.a.createElement(O,null))),i.a.createElement(kt,null,i.a.createElement(Lt,{advanced:n.advanced})),i.a.createElement(St,{hamburgerOpen:n.hamburgerOpen}))))}s(447);var It="Advanced Search",Mt="Basic Search";function Ut(){return i.a.createElement("div",null,i.a.createElement("h2",null,"OUCH!"),"Unknown Path: ",window.location.pathname)}var Ft=function(e){Object(c.a)(s,e);var t=Object(u.a)(s);function s(e){var a;return Object(l.a)(this,s),a=t.call(this),window.sui||(window.sui=new m),a.sui=window.sui,window.sui.pages||(a.sui.pages=window.sui.pages=new E(a.sui)),a}return Object(o.a)(s,[{key:"render",value:function(){return i.a.createElement(Rt,{sui:this.sui})}}]),s}(i.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Gt=Object(ht.c)(vt);r.a.render(i.a.createElement(ht.a,{store:Gt},i.a.createElement(Ft,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[233,1,2]]]);
//# sourceMappingURL=main.46fa4400.chunk.js.map